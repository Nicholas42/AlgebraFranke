\documentclass[a4paper,parskip=half,numbers=enddot, DIV=12]{scrreprt}
%\usepackage[utf8]{inputenc}

\usepackage{../header}
\usepackage{../frankenumbering2}
\usepackage{../shortcuts2}

\usepackage{eurosym}
\usepackage{skull}
\usetikzlibrary{fadings}

\usepackage{csquotes}
%\usepackage{tikz-cd}%I cannot draw diagrams without it - Felix. %well, I can - Ferdinand
\usepackage[backend=biber,style=alphabetic]{biblatex}
\setcounter{biburlnumpenalty}{7000}
\setcounter{biburllcpenalty}{7000}
\setcounter{biburlucpenalty}{8000}
\addbibresource{../literatur.bib}

% Title Page
\title{Algebraic Geometry II}
\author{\textsc{Lecturer:} Jens Franke\\
	\textsc{Notes:} Ferdinand Wagner}
\date{Sommersemester 2018}

\displaywidowpenalty=8000
%\postdisplaypenalty=8000
\widowpenalty=8000
\clubpenalty=8000

\newcommand{\vC}{\v{C}}

\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}

\begin{document}
\pagenumbering{Alph}
\maketitle
\pagenumbering{roman}

\thispagestyle{plain}
This text consists of notes on the lecture Algebraic Geometry II, taught at the University of Bonn by Professor Jens Franke in the summer term (Sommersemester) 2018. 

Please report bugs, typos etc. through the \emph{Issues} feature of github.

\tableofcontents

\addchap{Introduction}
\pagenumbering{arabic}
This lecture will develop the cohomology of (quasi)coherent sheaves of modules. Professor Franke assumes familiarity with the contents of last term's Algebraic Geometry I. In particular, this includes the category of (pre)schemes, equalizers and fibre products of preschemes as well as in arbitrary categories and quasi-coherent $\Oo_X$-modules. If you want to brush up your knowledge about these topics, the \href{https://github.com/Nicholas42/AlgebraFranke/tree/master/AlgGeoI}{\emph{lecture notes from Algebraic Geometry I}} \cite{alggeo1} might be your friend.

Professor Franke started the lecture with an example of sheaf cohomology entering the game. Let $X$ be a topological space, $\Cc_X$ the sheaf of continuous $\IC$-valued functions on $X$ and $\underline{\IZ}_X$ the sheaf of locally constant (i.e., continuous) functions on $X$ with values in $\IZ$. Then there is a short exact sequence
\begin{align*}
	0\morphism \underline{\IZ}_X\morphism[\cdot 2\pi\mathrm{i}] \Cc_X\morphism[\exp]\Cc_X^\times\morphism 0
\end{align*}
of sheaves of abelian groups. In general, taking global section doesn't preserve exactness but gives rise to a long exact sequence
\begin{diagram*}
	\node[ob] (0o) at (0,1.5) {$0$};
	\node[ob] (0u) at (0,0) {$0$};
	\node[ob] (H0Z) [right=0.5 of 0u] {$H^0(X,\underline{\IZ}_X)$};
	\node[ob] (H0CX) [right=0.5 of H0Z] {$H^0(X,\Cc_X)$};
	\node[ob] (H0CXx) [right=0.5 of H0CX] {$H^0(X,\Cc_X^\times)$};
	\node[ob] (Z) at (0o -| H0Z) {$\underline{\IZ}_X(X)$};
	\node[ob] (CX) at (0o -| H0CX) {$\Cc_X(X)$};
	\node[ob] (CXx) at (0o -| H0CXx) {$\Cc_X^\times(X)$};
	\node[ob, shift={(0,1.5)}] (H1Z) [right=0.75 of H0CXx] {$H^1(X,\underline{\IZ}_X)$};
	\node[ob] (H1CX) [right=0.5 of H1Z] {$H^1(X,\Cc_X)$};
	\node[ob] (dots) [right=0.5 of H1CX] {$\ldots$};
	\scriptsize
	\draw[->] (0o) -- (Z);
	\draw[->] (0u) -- (H0Z);
	\draw[->] (Z) -- (CX);
	\draw[->] (H0Z) -- (H0CX);
	\draw[->] (CX) -- (CXx);
	\draw[->] (H0CX) -- (H0CXx);
	\draw[->] (CXx) -- (H1Z) node[pos=0.5, above] {$d$};
	\draw[->] (H0CXx) -- (H1Z);
	\draw[->] (H1Z) -- (H1CX);
	\draw[->] (Z) -- (H0Z) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
	\draw[->] (CX) -- (H0CX) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
	\draw[->] (CXx) -- (H0CXx) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
	\draw[->] (H1CX) -- (dots);
\end{diagram*}
in which the $H^k(X,\underline{\IZ}_X)$, $H^k(X,\Cc_X)$, and $H^k(X,\Cc_X^\times)$ are \emph{sheaf cohomology groups}. There is the more general notion of \emph{derived functors} (Grothendieck, T\^{o}hoku paper), but this won't appear in the lecture.

Background in homological algebra is not required safe for cohomology groups of cochain complexes, the long exact cohomology sequence and the following famous lemma.
\begin{lem*}[Five lemma] Given a diagram
	\begin{diagram*}
		\node[ob] (A) at (0,1.5) {$A$};
		\node[ob] (B) at (1.5,1.5) {$B$};
		\node[ob] (C) at (3,1.5) {$C$};
		\node[ob] (D) at (4.5,1.5) {$D$};
		\node[ob] (E) at (6,1.5) {$E$};
		\node[ob] (A') at (0,0) {$A'$};
		\node[ob] (B') at (1.5,0) {$B'$};
		\node[ob] (C') at (3,0) {$C'$};
		\node[ob] (D') at (4.5,0) {$D'$};
		\node[ob] (E') at (6,0) {$E'$};
		\scriptsize
		\draw[->] (A) -- (B);
		\draw[->] (B) -- (C);
		\draw[->] (C) -- (D);
		\draw[->] (D) -- (E);
		\draw[->] (A') -- (B');
		\draw[->] (B') -- (C');
		\draw[->] (C') -- (D');
		\draw[->] (D') -- (E');
		\draw[->] (A) -- (A') node[pos=0.5, left] {$\alpha$};
		\draw[->] (B) -- (B') node[pos=0.5, left] {$\beta$};
		\draw[->] (C) -- (C') node[pos=0.5, left] {$\gamma$};
		\draw[->] (D) -- (D') node[pos=0.5, left] {$\delta$};
		\draw[->] (E) -- (E') node[pos=0.5, left] {$\epsilon$};
	\end{diagram*}
	of (abelian) groups/$R$-modules/etc.\ with exact rows, in which $\beta$ and $\delta$ are isomorphisms, $\alpha$ is an epimorphism and $\epsilon$ a monomorphism, then $\gamma$ is an isomorphism as well.
\end{lem*}
\begin{proof}
	Easy diagram chase.
\end{proof}

\chapter{Cohomology of quasi-coherent sheaves of modules}
\section{Recollection of basic definitions and results}
\begin{defi}[{\cite[Definitions~1.5.2 and 1.5.9\itememph{b}]{alggeo1}}]
	\begin{alphanumerate}
		\item A \defemph{prescheme} (Professor Franke prefers ``EGA termology'') is a locally ringed space $(X,\Oo_X)$ which locally has the form $\Spec R$ for some rings $R$.
		\item A prescheme $X$ is called a \defemph{scheme}, if, for any prescheme $T$ and any pair of morphisms $T\doublemorphism[a][b]X$, the equalizer $\Eq\Big(T\doublemorphism[a][b]X\Big)$ is a closed subprescheme of $X$.
	\end{alphanumerate}
\end{defi}
\begin{rem*}
	Equivalently, a prescheme $X$ is a scheme iff the diagonal $\Delta\colon X\xrightarrow{(\id_X,\id_X)}X\times X$ is a closed immersion (cf.\ \cite[Fact~1.5.8]{alggeo1}). In other words, schemes are \emph{separated} preschemes
\end{rem*}
\begin{prop}\lbl{prop:SchemesAffineIntersec}
	If $U$ and $V$ are affine open subsets of a scheme $X$, then their intersection $U\cap V$ is again affine (and open of course).
\end{prop}
\begin{proof}
	This was proved in \cite[Proposition~1.5.4]{alggeo1}.
\end{proof}
	Note that open subsets of the form $\Spec(R_f)\cong \Spec R\setminus V(f)$ form a topology base on $\Spec R$ and that the \emph{saturation} of $\{1,f,f^2,\ldots\}$ (i.e.\ the largest multiplicative subset of $R$ which still gives the same localization) depends only on $\Spec R\setminus V(f)$. Hence, for any $R$-module $M$, the localization $M_f$ depends (up to canonical isomorphism) only on $\Spec R\setminus V(f)$ and $M$. One defines a sheaf of modules $\snake{M}$ on $\Spec R$ as the sheafification of $\Spec (R_f)\mapsto M_f$. Then
	\begin{align*}
		\snake{M}(U)=\left\{(m_\pp)\in\prod_{\pp\in U}M_\pp\st
		\begin{array}{c}
			\text{for every }\qq\in U\text{ there are }f\in R\setminus\qq\text{ and }\mu\in M_f\text{ such that}\\
			m_\pp=\left(\text{image of }\mu\text{ under }M_f\morphism M_\pp\right)\text{ for all }\pp\in\Spec (R_f)
		\end{array}
		\right\}\;.
	\end{align*}
	In the following, I will deviate from Franke's numbering in the lecture, but I simply refuse to call a definition ``remark''.
\begin{defi}[{\cite[Definition~1.4.2]{alggeo1}}]\lbl{def:QuasicoherentSpecR}
	A sheaf of modules $\Mm$ on $\Spec R$ is called \defemph{quasi-coherent} if $\Mm\cong \snake{M}$ for some $R$-module $M$.
\end{defi}
\begin{defi}[{\cite[Definition~1.5.3]{alggeo1}}]
	A prescheme is called \defemph{quasi-compact} if the underlying topological space is quasi-compact and \defemph{quasi-separated} if the intersection of any two quasi-compact open subsets is quasi-compact.
\end{defi}

\begin{defi}[{\cite[Definition~1.5.4]{alggeo1}}]\lbl{def:Quasicoherent}
	Let $X$ be a prescheme. An $\Oo_X$-module $\Mm$ is called \defemph{quasi-coherent} if it satisfies the following equivalent conditions.
	\begin{alphanumerate}
		\item $X$ may be covered by affine open subsets $U$ such that $\Mm|_U$ is quasi-coherent in the sense of Definition~\reff{def:QuasicoherentSpecR}.
		\item For any affine open $U\subseteq X$, $\Mm|_U$ is quasi-coherent.
		\item For any quasi-compact and quasi-separated open $U\subseteq X$ and $f\in\Oo_X(U)$, the canonical morphism
		\begin{align}\lbl{eq:qcIso}
		\Mm(U)_f\morphism\Mm(U\setminus V(f))
		\end{align}
		(coming from the universal property of localization) is an isomorphism.
		\item The morphism \eqreff{eq:qcIso} is an isomorphism when $U$ is quasi-compact and quasi-separated and injective when $U$ is only quasi-compact.
		\item When $U\subseteq X$ is affine, the canonical morphism
		\begin{align}\lbl{eq:qcIso2}
		\Mm(U)_{\pp_x}\morphism\Mm_x
		\end{align}
		is an isomorphism for all $x\in U$, where $\pp_x=\left\{f\in\Oo_X(U)\st x\in V(f)\right\}$ is the prime ideal in $\Spec \Oo_X(U)$ corresponding to $x$.
	\end{alphanumerate}
\end{defi}
\begin{rem*}
	To be fair: Despite Professor Franke's usual fondness of proving definitions (or rather stating definitions in a way they need a proof), the equivalence of \itememph{a} to \itememph{d} wasn't proposed as a definition in Algebraic Geometry I. 
\end{rem*}
\begin{proof}[Proof of Definition~\reff{def:Quasicoherent}]
	 The equivalence of  \itememph{a} to \itememph{d} was proved in \cite[Proposition~1.5.1]{alggeo1}, but property \itememph{e} is something we haven't seen yet. Recall the \emph{adjunction} (cf.\ Definition~\reff{def:AdjointFunctors})
	\begin{align}\lbl{eq:ROXAdjunction}
		\Hom_{\Oo_{\Spec R}}(\snake{M}, \Nn)\isomorphism\Hom_R(M,\Nn(\Spec R))
	\end{align}
	for $M$ an $R$-module and $\Nn$ a sheaf of $\Oo_{\Spec R}$-modules (cf.\ \cite[Proposition~1.4.3]{alggeo1}). When \eqreff{eq:qcIso2} is an isomorphism for all $x\in U\cong\Spec R$, it follows that the canonical morphism $\snake{M}\morphism\Mm|_U$ (with $M=\Mm(U)$) coming from \eqreff{eq:ROXAdjunction} is an isomorphism on stalks, hence an isomorphism. This shows \itememph{e} $\Rightarrow$ \itememph{b}.
	
	Conversely, if \itememph{b} holds, then $\snake{M}\morphism\Mm|_U$ (with $M=\Mm(U)$) is an isomorphism for all affine open $U\subseteq X$, hence induces isomorphisms on stalks, which shows \itememph{b} $\Rightarrow$ \itememph{e}. Hence, \itememph{e} is equivalent to the other properties.
\end{proof}

Let ${\cat A}$ be the category $\cat{Mod}(R)$ and ${\cat B}$ be $\cat{Mod}(\Oo_{\Spec R})$, then the functor $L$ given by $M\mapsto\snake{M}$ and the functor $\Mm\mapsto\Mm(\Spec R)$ are an adjoint pair of functors by \eqreff{eq:ROXAdjunction}. It follows that $L$ commutes with cokernels and coproducts. In particular, the full subcategory $\cat{QCoh}(X)\subseteq\cat{Mod}(\Oo_X)$ of quasi-coherent $\Oo_X$-modules is closed under taking cokernels and direct sums for $X=\Spec R$, and by locality of quasi-coherence this holds for all preschemes $X$.
\begin{defi}[{\cite[Definition~2.1.1 and Definition~2.1.2]{alggeo1}}]\lbl{def:qcqs}
	A morphism $X\morphism[f]Y$ of preschemes is \defemph{quasi-compact} if it satisfies the following equivalent conditions.
	\begin{alphanumerate}
		\item For quasi-compact open $U\subseteq Y$, $f^{-1}(U)$ is quasi-compact.
		\item For affine open $U\subseteq Y$, $f^{-1}(U)$ is quasi-compact.
		\item One can cover $Y$ by affine open $U$ such that $f^{-1}(U)$ is quasi-compact.
	\end{alphanumerate}
	It is called \defemph{quasi-separated} if it satisfies the following equivalent conditions.
	\begin{alphanumerate}\setcounter{enumi}{3}
		\item For an open quasi-separated $U\subseteq Y$, $f^{-1}(U)$ is quasi-separated again.
		\item For affine open subsets $U\subseteq Y$, $f^{-1}(U)$ is quasi-separated.
		\item It is possible to cover $Y$ by affine open $U$ such that $f^{-1}(U)$ is quasi-separated.
	\end{alphanumerate}
\end{defi}
\begin{proof}
	Equivalence was proved in \cite[Fact~2.1.1]{alggeo1} for quasi-compactness and in \cite[Lemma~2.1.1]{alggeo1} for quasi-separatedness.
\end{proof}

\begin{prop}\lbl{prop:PushforwardOfQcIsQc}
	If $X\morphism[f]Y$ is quasi-compact and quasi-separated morphism of preschemes and $\Mm\in\Ob(\cat{QCoh}(X))$, then $f_*\Mm\in\Ob\left(\cat{QCoh}(Y)\right)$.
\end{prop}
\begin{proof}
	This is \cite[Proposition~1.5.2\itememph{b}]{alggeo1}.
\end{proof}
\begin{prop}
	\begin{alphanumerate}
		\item \lbl{prop:QCohHasKerCoker}The full subcategory $\cat{QCoh}(X)\subseteq\cat{Mod}(\Oo_X)$ of quasi-coherent sheaves of $\Oo_X$-modules on a prescheme $X$ is closed under taking kernels and cokernels of morphisms and under taking (finite) direct sums.
		\item If $\Mm$ is a quasi-coherent $\Oo_X$-module and $U\subseteq X$ open, then $\Mm|_U\in\Ob\left(\cat{QCoh}(U)\right)$.
	\end{alphanumerate}
\end{prop}
\begin{proof}
	Part \itememph{a}. For cokernels and finite direct sums (which are finite coproducts since $\cat{Mod}(\Oo_X)$ is an abelian category by Proposition~\reff{prop:RmodAbelian}), consider the case $X=\Spec R$ first. Then $\cat{Mod}(R)\morphism[L]\cat{Mod}(\Oo_X)$, $M\mapsto\snake{M}$ and $\cat{Mod}(\Oo_X)\morphism \cat{Mod}(R)$, $\Mm\mapsto\Mm(X)$ are adjoint functors by \eqreff{eq:ROXAdjunction}. By Remark~\reff{rem:AdjunctionPreservesStuff}, $L$ preserves cokernels and coproducts. By locality of quasi-coherence, this follows for all preschemes $X$.
	
	Closedness under taking kernels was proved in \cite[Fact~1.5.3]{alggeo1}. It's worth pointing out that in fact, the proof given there shows that $M\mapsto\snake{M}$ preserves kernels as well. 
	
	Part \itememph{b} follows immediately from (e.g.) Definition~\reff{def:Quasicoherent}\itememph{b}.
\end{proof}
\begin{cor}\lbl{cor:kerAndCokerForQcModules}
	Let $X$ be a prescheme, $\Mm\morphism[f]\Nn$ a morphism of quasi-coherent $\Oo_X$-modules and $U\subseteq X$ open, then
	\begin{align*}
		\ker\Big(\Mm(U)\morphism[f]\Nn(U)\Big)\cong\ker(f)(U)\;.
	\end{align*}
	If $U$ is, in addition, affine, then
	\begin{align*}
		\coker\Big(\Mm(U)\morphism[f]\Nn(U)\Big)\cong\coker(f)(U)\;.
	\end{align*}
\end{cor}
\begin{proof}
	The first assertion holds by our explicit construction of $\ker(f)$ in Lemma~\reff{lem:RModHasKernels}. For the second one, we may assume $X=U=\Spec R$. Denoting $M=\Mm(X)$, $N=\Nn(X)$, then
	\begin{align*}
		\coker\Big(\Mm\morphism[f]\Nn\Big)=\coker\Big(\snake{M}\morphism[f]\snake{N}\Big)\cong\Big(\coker\Big(M\morphism[f]N\Big)\Big)^\qcmod
	\end{align*}
	as $M\mapsto\snake{M}$ preserves cokernels.
\end{proof}
\begin{cor}\lbl{cor:GlobalSectionsExactOnAffine}
	Let $0\morphism\Mm'\morphism\Mm\morphism\Mm''\morphism0$ be a short exact sequence of quasi-coherent $\Oo_X$-modules on a prescheme $X$ and $U\subseteq X$ be affine open, then 
	\begin{align*}
		0\morphism\Mm'(U)\morphism\Mm(U)\morphism\Mm''(U)\morphism 0
	\end{align*}
	is exact as well.
\end{cor}
\begin{proof}
	Follows from Corollary~\reff{cor:kerAndCokerForQcModules}.
\end{proof}
\begin{rem*}
	It turns out to be sufficient to assume that two of the above three sheaves $\Mm',\Mm,\Mm''$ are quasi-coherent. Indeed, we proved in Proposition~\reff{prop:QCohHasKerCoker} that kernels and cokernels of morphisms between quasi-coherent sheaves are quasi-coherent again, so the only case in question is where $\Mm$ is not required to be quasi-coherent. This case, however, will be treated by cohomological methods.
\end{rem*}
Our plan is to associate to any quasi-coherent $\Oo_X$-module on a scheme $X$ \emph{cohomology groups} $H^i(X,\Mm)$ such that
\begin{itemize}
	\item $H^0(X,\Mm)\cong\Mm(X)$.
	\item when $0\morphism\Mm'\morphism\Mm\morphism\Mm''\morphism0$ is an exact sequence of $\Oo_X$-modules, we have a canonical long exact sequence
	\begin{multline*}
		0\morphism H^0(X,\Mm')\morphism H^0(X,\Mm)\morphism H^0(X,\Mm'')\\
		\morphism[d] H^1(X,\Mm')\morphism H^1(X,\Mm)\morphism H^1(X,\Mm'')\morphism[d]H^2(X,\Mm')\morphism\ldots
	\end{multline*}
\end{itemize}
But before we do this, we introduce the notion of \emph{coherent} $\Oo_X$-modules.
\begin{prop}
	If $X$ is a prescheme, associating to (the isomorphism class of) a closed embedding $Y\monomorphism[i]X$ the sheaf of ideals $\Jj=\ker\Big(\Oo_X\morphism[i^*]i_*\Oo_Y\Big)$ gives a bijection between the set of closed subpreschemes of $X$ and the quasi-coherent sheaves of ideals in $\Oo_X$.
\end{prop}
\begin{proof}
	This is \cite[Proposition~1.5.3]{alggeo1}.
\end{proof}
\begin{lem}\lbl{lem:locFinGen}
	For a quasi-coherent $\Oo_X$-module $\Mm$ on a prescheme $X$, the following conditions are equivalent.
	\begin{alphanumerate}
		\item For any affine open $U\subseteq X$, $\Mm(U)$ is a finitely generated $\Oo_X(U)$-module.
		\item It is possible to cover $X$ by affine open subsets $U\subseteq X$, for which $\Mm(U)$ is a finitely generated $\Oo_X(U)$-module.
	\end{alphanumerate}
\end{lem}
\begin{proof}
	This will follow from Lemma~\reff{lem:localProperty} and Lemma~\reff{lem:FinitelyGeneratedLocal} below.
\end{proof}
\begin{lem}\lbl{lem:localProperty}
	Let $\Pp$ be a property of affine open subsets of a prescheme $X$ such that
	\begin{alphanumerate}
		\item[\itememph{\alpha}] If $U\subseteq X$ is affine and $f\in\Oo_X(U)$, then $\Pp(U)$ implies $\Pp(U\setminus V(f))$.
		\item[\itememph{\beta}] If $U$ is affine and $f_1,\ldots,f_n\in\Oo_X(U)$ are such that $\bigcap_{i=1}^nV(f_i)=\emptyset$ and such that $\Pp(U\setminus V(f_i))$ holds for all $i=1,\ldots,n$, then $\Pp(U)$ holds.
	\end{alphanumerate}
	Then the following assertions about $X$ are equivalent.
	\begin{alphanumerate}
		\item If $U\subseteq X$ is affine open, $\Pp(U)$ holds.
		\item $X$ may be covered by affine open $U$ for which $\Pp(U)$ holds.
	\end{alphanumerate}
\end{lem}
\begin{proof}
	We proved this in \cite[Lemma~2.2.2]{alggeo1}.
\end{proof}
\begin{lem}
	\begin{alphanumerate}
		\item \lbl{lem:FinitelyGeneratedLocal}If $M$ is a finitely generated $R$-module, then $M_f$ is a finitely generated $R_f$-module.
		\item If $M$ is an $R$-module and $f_1,\ldots,f_n\in R$ such that $\bigcap_{i=1}^nV(f_i)=\emptyset$ in $\Spec R$ and such that $M_{f_i}$ is finitely generated over $R_{f_i}$, then $M$ is finitely generated over $R$.
	\end{alphanumerate}
\end{lem}
\begin{proof}
	Part \itememph{a} is trivial, as the images of $R$-generators of $M$ in $M_f$ generate it as an $R_f$-module.
	
	Now for part \itememph{b}. As $M_{f_i}$ is finitely generated over $R_{f_i}$, there are $k\in\IN$ and $m_{i,j}\in M$, $j=1,\ldots,N_i$ such that $m_{i,j}f^{-k}$ generate $M_{f_i}$ over $R_{f_i}$ (as there are only finitely many generators, we can choose a common exponent $k$ for all of them). Then also the $m_{i,j}$ generate $M_{f_i}$ since $f_i$ is a unit in $R_{f_i}$. We claim that the $\left\{m_{i,j}\st i=1,\ldots, n\text{ and }j=1,\ldots, N_i\right\}$ generate $M$ as an $R$-module. Indeed, let $m\in M$, then
	\begin{align*}
		m=\sum_{j=1}^{N_i}\frac{r_{i,j}}{f_i^\ell}m_{i,j}\quad\text{in }M_{f_i}\;,
	\end{align*}
	where $r_{i,j}\in R$ and $\ell\in\IN$ (again, we can choose a common exponent $\ell$). Then there is some $\ell'\in \IN$ such that
	\begin{align*}
		f_i^{\ell+\ell'}m=\sum_{j=1}^{N_i}r_{i,j}f_i^{\ell'}m_{i,j}\quad\text{in }M\;.
	\end{align*}
	Replacing $\ell$ by $\ell+\ell'$ and $r_{i,j}$ by $f_i^{\ell'}r_{i,j}$ we may assume $\ell'=0$, i.e.
	\begin{align*}
		f_i^{\ell}m=\sum_{j=1}^{N_i}r_{i,j}m_{i,j}\quad\text{in }M\;.
	\end{align*}
	We now have $\bigcap_{i=1}^nV(f_i^\ell)=\bigcap_{i=1}^nV(f_i)=\emptyset$, hence the ideal generated by the $f_i^\ell$ is $R$ and we thus find $g_1,\ldots,g_n\in R$ such that $\sum_{i=1}^{n}f_i^\ell g_i=1$ in $R$. It follows that
	\begin{align*}
		m=\sum_{i=1}^nf_i^\ell g_im=\sum_{i=1}^{n}\sum_{j=1}^{N_i}r_{i,j}g_im_{i,j}
	\end{align*}
	is an element of the submodule generated by the $m_{i,j}$.
\end{proof}
\begin{defi}
	\begin{alphanumerate}
		\item \lbl{def:locFinGenerated}We call a quasi-coherent $\Oo_X$-module \defemph{locally finitely generated} if it satisfies the equivalent conditions from Lemma~\reff{lem:locFinGen}.
		\item When $X$ is locally noetherian (cf.\ \cite[Definition~2.2.2]{alggeo1}), an $\Oo_X$-module is called \defemph{coherent} if it is quasi-coherent and locally finitely generated.
	\end{alphanumerate}
\end{defi}
\begin{rem*}
	There is a general definition of \emph{coherent} sheaves of modules on arbitrary ringed spaces, which in the case of a locally noetherian prescheme is equivalent to the above.
\end{rem*}
%Composite letter `\textasciicaron+C'(hyperref) not defined in PD1 encoding,(hyperref) removing `\textasciicaron'
\section{\vC ech cohomology}
Let $\Uu\colon X=\bigcup_{i\in I}U_i$ be an open cover of a topological space $X$. In the following, we will use the convention
\begin{align}\lbl{eq:capConvention}
U_{i_0,\ldots,i_n}=\bigcap_{k=0}^nU_{i_k}\;.
\end{align}
\begin{defi}\lbl{def:cech}
	For an open cover $\Uu$ of a topological space $X$ (e.g., a prescheme) and $\Mm$ a presheaf of abelian groups (e.g., a quasi-coherent $\Oo_X$-module) on $X$ the \defemph{\vC ech complex} $\check{C}^\bullet (\Uu,\Mm)$ is the cochain complex defined as follows. Let
	\begin{align*}
		\check{C}^n(\Uu,\Mm)\coloneqq\prod_{(i_0,\ldots,i_n)\in I^{n+1}}\Mm(U_{i_0,\ldots,i_n})\;.
	\end{align*}
	Let the elements of $\check{C}^n(\Uu,\Mm)$ be denoted $\psi=(\psi_{i_0,\ldots,i_n})_{(i_0,\ldots,i_n)\in I^{n+1}}$. The differentials $\check{C}^n(\Uu,\Mm)\morphism[\hacek{d}^n]\check{C}^{n+1}(\Uu,\Mm)$ are defined by
	\begin{align*}
		(\hacek{d}^n\psi)_{i_0,\ldots,i_{n+1}}=\sum_{j=0}^{n+1}(-1)^j\psi_{i_0,\ldots,\hat{i}_j,\ldots,i_{n+1}}|_{U_{i_0,\ldots,i_{n+1}}}
	\end{align*}
	where $\hat{i}_j$ denotes the omission of the index $i_j$. For instance,
	\begin{align*}
		(\hacek{d}^0\psi)_{i,j}=\psi_j|_{U_{i,j}}-\psi_i|_{U_{i,j}}\quad\text{and}\quad (\hacek{d}^1\psi)_{i,j,k}=\psi_{j,k}|_{U_{i,j,k}}-\psi_{i,k}|_{U_{i,j,k}}+\psi_{i,j}|_{U_{i,j,k}}\;.
	\end{align*}
	The \defemph{\vC ech cohomology} $\check{H}^\bullet (\Uu,\Mm)$ is defined as the cohomology of the \vC ech complex, i.e.,
	\begin{align*}
		\check{H}^i(\Uu,\Mm)=H^i\left(\check{C}^\bullet (\Uu,\Mm)\right)\;.
	\end{align*}	
\end{defi}
To see that $\check{C}^\bullet (\Uu,\Mm)$ is indeed a cochain complex, we need to prove $\hacek{d}^2=0$ -- and we won't do this in a remark!
\begin{proof}[Proof of Definition~\reff{def:cech}]
	For $\ell=0,\ldots,n+1$ let $\check{C}^n(\Uu,\Mm)\morphism[d_\ell]\check{C}^{n+1}(\Uu,\Mm)$ be given by
	\begin{align*}
		(d_\ell\psi)_{i_0,\ldots,i_{n+1}}=\psi_{i_0,\ldots,\hat{i}_\ell,\ldots,i_{n+1}}|_{U_{i_0,\ldots,i_{n+1}}}\;.
	\end{align*}
	Again, $\hat{i}_\ell$ denotes the omission of the index $i_\ell$.
	
	\emph{Step 1.} We prove that
	\begin{align}\lbl{eq:simplicialStuff}
		d_md_\ell=d_{\ell+1}d_m\quad\text{when }\ell\geq m\;.
	\end{align}
	Indeed, we have $(d_md_\ell\psi)_{\boldsymbol{i}}=\psi_{\boldsymbol{j}}|_{U_{\boldsymbol{i}}}$, where $\boldsymbol{j}$ is obtained from $\boldsymbol{i}$ by omitting the indices $i_\ell$ and $i_m$ when $\ell<m$ and the indices $i_{\ell+1}$ and $i_m$ when $\ell\geq m$. The assertion follows.
	
	\emph{Step 2.} We prove the following. Let $C^\bullet $ be any family of abelian groups (or objects of an abelian category) and $C^n\morphism[d_\ell]C^{n+1}$ morphisms for $\ell=0,\ldots,n+1$. Suppose that $C^n=0$ for $n<0$ and that \eqreff{eq:simplicialStuff} holds. Then $d^\bullet$ with
	\begin{align*}
		d^n=\sum_{i=0}^{n+1}(-1)^id_i
	\end{align*}
	satisfies $d^{n+1}d^n=0$. Indeed,
	\begin{align*}
		d^{n+1}d^n&=\sum_{m=0}^{n+2}\sum_{\ell=0}^{n+1}(-1)^{\ell+m}d_md_\ell=\sum_{m=0}^{n+2}\sum_{\ell=0}^{m-1}(-1)^{\ell+m}d_md_\ell+\sum_{m=0}^{n+2}\sum_{\ell=m}^{n+1}(-1)^{\ell+m}d_md_\ell\\
		&=\sum_{m=0}^{n+2}\sum_{\ell=0}^{m-1}(-1)^{\ell+m}d_md_\ell+\sum_{m=0}^{n+1}\sum_{\ell=m}^{n+1}(-1)^{\ell+m}d_{\ell+1}d_m\\
		&=\sum_{i>j}(-1)^{i+j}d_id_j+\sum_{i>j}(-1)^{i+j-1}d_id_j=0\;,
	\end{align*}
	as required.
\end{proof}
\begin{rem*}
	Our program is to show that $\check{H}^\bullet (\Uu,\Mm)$ is independent of $\Uu$ and has the desired properties, when $X$ is a scheme, $\Mm\in\Ob(\cat{QCoh}(X))$ and $\Uu$ is an affine open cover.
\end{rem*}
\begin{rem*}
	For instance, the cohomology of $\IP_R^1=\Proj(R[X_0,X_1])$ can be calculated using the affine open cover 
	\begin{align*}
		U_i=\IP_R^1\setminus V(X_i)\cong \Spec \left(R[X_0,X_1]_{X_i}\right)_0\cong \Spec R[t_i]\quad\text{where }t_i=
		\begin{cases}
			X_1\cdot X_0^{-1} & \text{if }i=0\\
			X_0\cdot X_1^{-1} & \text{if }i=1
		\end{cases}\;.
	\end{align*}
	Unfortunately, calculations become complicated by the fact that there are infinitely many non-zero terms in $\check{C}^\bullet (\Uu,\Mm)$.
\end{rem*}
	Let $\check{C}_\alt^n(\Uu,\Mm)\subseteq\check{C}^n(\Uu,\Mm)$ be the subgroup containing all $\psi\in\check{C}^n(\Uu,\Mm)$ such that
	\begin{align*}
		\psi_{i_{\pi(0)},,\ldots,i_{\pi(n)}}=\sgn(\pi)\psi_{i_0,\ldots,i_n}\in \Mm(U_{i_0,\ldots,i_n})\quad\text{and}\quad\psi_{i_0,\ldots,i_{n-1},i_{n-1}}=0\in\Mm(U_{i_0,\ldots,i_{n-1}})
	\end{align*}
	for all permutations $\pi\in\SS_n$. Note that $U_{i_0,\ldots,i_n}=U_{i_{\pi(0)},\ldots,i_{\pi(n)}}$ as permuting indices doesn't change intersections, so the first property makes sense. Also note that both properties together imply that $\psi_{i_0,\ldots,i_n}=0$ whenever $(i_0,\ldots,i_n)$ contains a repeated index.
	
	\begin{defi}\lbl{def:alternatingCech}
		$\check{C}_\alt^\bullet (\Uu,\Mm)\subseteq\check{C}^\bullet (\Uu,\Mm)$ is a subcomplex, called the \defemph{alternating \vC ech complex}.
	\end{defi}
	\begin{proof}
		We need to confirm that the differential $\hacek{d}^n$ maps $\check{C}_\alt^n(\Uu,\Mm)$ into $\check{C}_\alt^{n+1}(\Uu,\Mm)$. To do this, define \emph{codegeneracy maps} 
		\begin{align*}
			\check{C}^n(\Uu,\Mm)\morphism[s_\ell]\check{C}^{n-1}(\Uu,\Mm)\;,\quad (s_\ell\psi)_{i_0,\ldots,i_{n-1}}=\psi_{i_0,\ldots,i_\ell,i_\ell,\ldots,i_{n-1}}\quad\text{for }\ell=0,\ldots,n-1
		\end{align*}
		(i.e., $s_\ell$ repeats the $\ell\ordinalth$ index) as well as \emph{transposition maps}
		\begin{align*}
			\check{C}^n(\Uu,\Mm)\morphism[t_\ell]\check{C}^n(\Uu,\Mm)\;,\quad (t_\ell\psi)_{i_0,\ldots,i_n}=\psi_{i_0,\ldots,i_{\ell-1},i_{\ell+1},i_\ell,i_{\ell+2},\ldots,i_{n}}\quad\text{for }\ell=0,\ldots,n-1
		\end{align*}
		(i.e., $t_\ell$ swaps the $\ell\ordinalth$ and $(\ell+1)\ordinalst$ index). As any permutation may be expressed as a composition of elementary transpositions, $\check{C}_\alt^n(\Uu,\Mm)\subseteq\check{C}^n(\Uu,\Mm)$ is given by the relations
		\begin{align*}
			s_\ell\psi=0\quad\text{and}\quad t_\ell\psi=-\psi\quad\text{for }\ell=0,\ldots,n-1
		\end{align*}
		So what we need to check to confirm that $\check{C}_\alt^\bullet (\Uu,\Mm)$ is indeed a subcomplex of $\check{C}^\bullet (\Uu,\Mm)$ is that the above relations are preserved by the differential $\hacek{d}$.
		
		One may easily check the relations
		\begin{align}\lbl{eq:cosimplicialDegeneracies}
			s_\ell d_i=\begin{cases}
				d_is_{\ell-1} & \text{if }i<\ell\\
				\id &  \text{if }i=\ell\text{ or }i=\ell+1\\
				d_{i-1}s_\ell &  \text{if }i>\ell+1
			\end{cases}
		\end{align}
		and
		\begin{align}\lbl{eq:transpositions}
			t_\ell d_j=\begin{cases}
				d_jt_{\ell} & \text{if }\ell<j-1\\
				d_\ell &  \text{if }\ell=j-1\\
				d_{\ell+1} &  \text{if }\ell=j\\
				d_jt_{\ell-1} & \text{if }\ell>j
			\end{cases}\;.
		\end{align}
		Now let $\psi\in\check{C}^n(\Uu,\Mm)$ such that $t_j\psi=-\psi$ for all $j=0,\ldots,n-1$. Using \eqreff{eq:transpositions}, we get
		\begin{align*}
			t_\ell\hacek{d}\psi&=\sum_{j=0}^{\ell-1}(-1)^jt_\ell d_j\psi+(-1)^\ell t_\ell d_\ell\psi+(-1)^{\ell+1} t_\ell d_{\ell+1}\psi+\sum_{j=\ell+2}^n(-1)^jt_\ell d_j\psi\\
			&=\sum_{j=0}^{\ell-1}(-1)^jd_jt_{\ell-1}\psi+(-1)^\ell d_{\ell+1}\psi+(-1)^{\ell+1} d_\ell\psi+\sum_{j=\ell+2}^{n}(-1)^j d_jt_\ell\psi\\
			&=-\sum_{j=0}^{\ell-1}(-1)^jd_j\psi-(-1)^\ell d_\ell\psi-(-1)^{\ell+1} d_{\ell+1}\psi-\sum_{j=\ell+2}^{n}(-1)^j d_j\psi\\
			&=-\hacek{d}\psi\;.
		\end{align*}
		Similarly, one can check that $s_\ell\hacek{d}\psi=0$ when $s_j\psi=0$ for all $j=0,1,\ldots,n-1$. This shows that $\hacek{d}$ restricts to a differential on $\check{C}_\alt
		^n(\Uu,\Mm)$, as required.
	\end{proof}
	It will eventually turn out that the cohomology groups $\check{H}_\alt^i(\Uu,\Mm)=H^i\left(\check{C}_\alt^\bullet (\Uu,\Mm)\right)$ obtained from the alternating \vC ech complex are the same as the regular \vC ech cohomology groups $\check{H}^i(\Uu,\Mm)$.
\begin{rem}
	A \emph{cosimplicial object} of a category ${\cat A}$ is a sequence of objects $(X^n)_{n\geq 0}$ with morphisms $d_j\colon X^n\morphism X^{n+1}$ for $j=0,\ldots,n+1$ satisfying \eqreff{eq:simplicialStuff} and $s_j\colon X^n\morphism X^{n-1}$ for $j=0,\ldots,n$ satisfying a version of \eqreff{eq:simplicialStuff} together with \eqreff{eq:cosimplicialDegeneracies}. In other words, a cosimplicial object is a covariant functor from the \emph{simplex category} $\Delta$ to ${\cat A}$.
	
	There is a \emph{Dold--Kan correspondence} between cochain complexes concentrated in nonnegative degrees and cosimplicial objects of an abelian category.  
\end{rem}
\begin{example}
	\begin{alphanumerate}
		\item \lbl{ex:FirstCechComputations}By the sheaf axiom, 
		\begin{align*}
			\Mm(X)&\cong\left\{(m_i)_{i\in I}\in\prod_{i\in I}\Mm(U_i)\st m_i|_{U_{i,j}}=m_j|_{U_{i,j}}\right\}\\
			&=\ker\Big(\check{C}^0(\Uu,\Mm)\morphism[\hacek{d}^0]\check{C}^1(\Uu,\Mm)\Big)\cong \check{H}^0(\Uu,\Mm)\\
			&=\ker\Big(\check{C}_\alt^0(\Uu,\Mm)\morphism[\hacek{d}^0]\check{C}_\alt^1(\Uu,\Mm)\Big)\cong \check{H}_\alt^0(\Uu,\Mm)
		\end{align*}
		\item For the trivial cover $\Uu_0\colon X=X$, the \vC ech complex $\check{C}^\bullet (\Uu_0,\Mm)$ has the form
		\begin{align*}
		\Mm(X)\morphism[0]\Mm(X)\morphism[\id]\Mm(X)\morphism[0]\ldots\;,
		\end{align*}
		and the alternating \vC ech complex $\check{C}_\alt^\bullet (\Uu_0,\Mm)$ looks like
		\begin{align*}
		\Mm(X)\morphism 0\morphism 0\morphism0\morphism\ldots
		\end{align*}
		so
		\begin{align*}
			\check{H}^n(\Uu_0,\Mm)=\check{H}_\alt^n(\Uu_0,\Mm)=\begin{cases}
				\Mm(X) & \text{if }n=0\\
				0 & \text{else}
			\end{cases}\;.
		\end{align*}
		\item If $\Mm$ and $\Nn$ are presheaves of modules on $X$ and $\Uu$ is an open cover of $X$, then 
		\begin{align*}
			\check{C}^\bullet (\Uu,\Mm\oplus\Nn)=\check{C}^\bullet (\Uu,\Mm)\oplus\check{C}^\bullet (\Uu,\Nn)
		\end{align*}
		and, more generally, 
		\begin{align*}
			\check{C}^\bullet \bigg(\Uu,\prod_{i\in I}\Mm_i\bigg)=\prod_{i\in I}\check{C}^\bullet (\Uu,\Mm_i)\;.
		\end{align*}
		The same holds for $\check{C}_\alt^\bullet (\Uu,-)$.
	\end{alphanumerate}
\end{example}
If $\Uu\colon X=\bigcup_{i\in I}U_i$ is a cover of a scheme $X$ by affine open subsets $U_i$, then all intersections $U_{i_0,\ldots,i_n}$ are affine again by Proposition~\reff{prop:SchemesAffineIntersec}. If $0\morphism\Mm'\morphism\Mm\morphism\Mm''\morphism 0$ is a short exact sequence in $\cat{QCoh}(X)$, Corollary~\reff{cor:GlobalSectionsExactOnAffine} provides short exact sequences
\begin{align*}
	0\morphism \check{C}^\bullet (\Uu,\Mm')\morphism \check{C}^\bullet (\Uu,\Mm)\morphism \check{C}^\bullet (\Uu,\Mm'')\morphism 0
\end{align*}
and
\begin{align*}
	0\morphism \check{C}_\alt^\bullet (\Uu,\Mm')\morphism \check{C}_\alt^\bullet (\Uu,\Mm)\morphism \check{C}_\alt^\bullet (\Uu,\Mm'')\morphism 0
\end{align*}
of chain complexes. For $\check{C}^\bullet (\Uu,-)$ this is immediate from Definition~\reff{def:cech} and from the fact that products of short exact sequences are short exact again. To see this for $\check{C}_\alt^\bullet (\Uu,-)$, choose any linear ordering of $I$ and note that 
\begin{align*}
	\check{C}_\alt^n(\Uu,\Mm)\cong\prod_{i_0<\ldots<i_n\in I}\Mm(U_{i_0,\ldots,i_n})\;,
\end{align*}
then the same argument may be applied.

Taking long exact cohomology sequences we just proved
\begin{prop}\lbl{prop:LongExactCechSequence}
	If $\Uu$ is an affine open cover of a scheme $X$ and $0\morphism \Mm'\morphism\Mm\morphism\Mm''\morphism 0$ a short exact sequence of quasi-coherent sheaves of $\Oo_X$-modules, then there is a long exact cohomology sequence
	\begin{diagram*}
		\node[ob] (0o) at (0,1.5) {$0$};
		\node[ob] (0u) at (0,0) {$0$};
		\node[ob] (H0Z) [right=0.5 of 0o] {$\check{H}^0(\Uu,\Mm')$};
		\node[ob] (H0CX) [right=0.5 of H0Z] {$\check{H}^0(\Uu,\Mm)$};
		\node[ob] (H0CXx) [right=0.5 of H0CX] {$\check{H}^0(\Uu,\Mm'')$};
		\node[ob] (Z) at (0u -| H0Z) {$\Mm'(X)$};
		\node[ob] (CX) at (0u -| H0CX) {$\Mm(X)$};
		\node[ob] (CXx) at (0u -| H0CXx) {$\Mm''(X)$};
		\node[ob] (H1Z) [right=0.75 of H0CXx] {$\check{H}^1(\Uu,\Mm')$};
		\node[ob] (H1CX) [right=0.5 of H1Z] {$\check{H}^1(\Uu,\Mm)$};
		\node[ob] (dots) [right=0.5 of H1CX] {$\ldots$};
		\scriptsize
		\draw[->] (0u) -- (Z);
		\draw[->] (0o) -- (H0Z);
		\draw[->] (Z) -- (CX);
		\draw[->] (H0Z) -- (H0CX);
		\draw[->] (CX) -- (CXx);
		\draw[->] (H0CX) -- (H0CXx);
		\draw[->] (H0CXx) -- (H1Z)node[pos=0.5, above] {$d$};;
		\draw[->] (H1Z) -- (H1CX);
		\draw[->] (H0Z) -- (Z) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
		\draw[->] (H0CX) -- (CX) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
		\draw[->] (H0CXx) -- (CXx) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
		\draw[->] (H1CX) -- (dots);
	\end{diagram*}
	and similar for $\check{H}_\alt^\bullet (\Uu,-)$.
\end{prop}
\begin{rem}
	For arbitrary preschemes, the situation is more difficult (cf.\ Thomason, \emph{The Grothendieck Festschrift}).
\end{rem}
\begin{defi}
	An open cover $\Vv\colon X=\bigcup_{j\in J}V_j$ is a \defemph{refinement} of $\Uu\colon X=\bigcup_{i\in I}U_i$ if there is a map $v\colon J\morphism I$ such that $V_j\subseteq U_{v(j)}$ for all $j\in J$. Such a $v$ is called a \defemph{refinement map} for the pair $(\Vv,\Uu)$. 
\end{defi}
Note that Professor Franke isn't sure whether \emph{refinement map} is the usual term. Assuming the axiom of choice, the existence of $v$ is equivalent to every $V_j$ being contained in some $U_i$. 

A refinement map $v$ induces a morphism
\begin{align*}
	\check{C}^\bullet (\Uu,\Mm)\morphism[v^*]\check{C}^\bullet (\Vv,\Mm)\;,\quad(v^n\psi)_{j_0,\ldots,j_n}=\psi_{v(j_0),\ldots,v(j_n)}|_{V_{j_0,\ldots,j_n}}\quad\text{for }\psi\in\check{C}^n(\Uu,\Mm)\;.
\end{align*}
Clearly, $v^*$ commutes with the $d_j$, $s_j$, and $t_j$, hence restricts to a morphism of chain complexes $\check{C}_\alt^\bullet (\Uu,\Mm)\morphism[v^*]\check{C}_\alt^\bullet (\Vv,\Mm)$.
\begin{lem}
	\begin{alphanumerate}
		\item \lbl{lem:refinementPullback}A refinement $\Ww$ of a refinement $\Vv$ of $\Uu$ is a refinement of $\Uu$ and if $v$ and $w$ are associated refinement maps for $(\Vv,\Uu)$ and $(\Ww,\Vv)$, then $vw$ is a refinement map for $(\Ww,\Uu)$. Moreover, $(vw)^*=w^*v^*$ and the identity $\id_I$ is a refinement map for $(\Uu,\Uu)$ and $\id_I^*=\id_{\check{C}^*(\Uu,-)}$.
		\item Two arbitrary open covers have a common refinement. When $X$ is a prescheme, this common refinement can be chosen affine.
		\item If $v_1,v_2\colon J\morphism I$ are two refinement maps for $(\Vv,\Uu)$, then $v_1^*$ and $v_2^*$ induce the same morphism on \vC ech cohomology.
	\end{alphanumerate}
\end{lem}
\begin{proof}
	Part \itememph{a} is obvious. For \itememph{b}, let $\Uu$ and $\Vv$ be open covers of $X$. Then $X=\bigcup_{(i,j)\in I\times J}U_i\cap V_j$ is a common refinement. When $X$ is a prescheme, we may cover each $U_i\cap V_j$ by affine open subsets and thus obtain a common affine refinement of $\Uu$ and $\Vv$.
	
	Now for part \itememph{c}. Define maps $h^n\colon\check{C}^n(\Uu,\Mm)\morphism\check{C}^{n-1}(\Vv,\Mm)$ as follows: We put 
	\begin{align*}
		h^n=\sum_{\ell=0}^{n-1}(-1)^\ell h_\ell\;,
	\end{align*}
	where $h_\ell\colon\check{C}^n(\Uu,\Mm)\morphism\check{C}^{n-1}(\Vv,\Mm)$ is given by
	\begin{align*}
		(h_\ell\psi)_{j_0,\ldots,j_{n-1}}=\psi_{v_1(j_0),\ldots,v_1(j_\ell),v_2(j_\ell),\ldots,v_2(j_{n-1})}|_{V_{j_0,\ldots,j_{n-1}}}\quad\text{for }\psi\in\check{C}^n(\Uu,\Mm)\;.
	\end{align*}
	Then it's a straightforward but tedious check that the following relations hold:
	\begin{align}\lbl{eq:SHIT}
		h_\ell d_k=\begin{cases}
			d_kh_{\ell-1} & \text{if }0\leq k<\ell\\
			h_{\ell-1}d_{k} & \text{if }0< k=\ell\\
			v_2^n & \text{if }0=k=\ell\\
			h_{\ell+1}d_{k} & \text{if }k=\ell+1<n\\
			v_1^n & \text{if }k=\ell+1=n\\
			d_{k-1}h_\ell & \text{if }k>\ell+1
		\end{cases}\;.
	\end{align}
	(I tried my best to get the indices right and I claim my hit ratio is way higher than Franke's). Our goal is to show 
	\begin{align*}
		\hacek{d}^{n-1}h^n+h^{n+1}\hacek{d}^n=v_2^n-v_1^n\;,
	\end{align*}
	for then $h$ is a cochain homotopy between $v_1^*$ and $v_2^*$ and it's a well-known fact from homological algebra that cochain homotopic maps induce the same morphisms on cohomology. Indeed, pulling the double sum apart we get
	\begin{align*}
		h^{n+1}\hacek{d}^n&=\sum_{\ell=0}^{n}\sum_{k=0}^{n+1}(-1)^{\ell+k}h_\ell d_k\\
		&=\begin{multlined}[t]
			\sum_{\ell=0}^{n}\sum_{k=0}^{\ell-1}(-1)^{\ell+k}h_\ell d_k+(-1)^0h_0d_0+\sum_{\ell=1}^{n}(-1)^{2\ell}h_\ell d_\ell\\
			+\sum_{\ell=0}^{n-1}(-1)^{2\ell+1}h_\ell d_{\ell+1}+(-1)^{2n+1}h_nd_{n+1}+\sum_{\ell=0}^{n}\sum_{k=\ell+2}^{n+1}(-1)^{\ell+k}h_\ell d_k\;.
		\end{multlined}
	\end{align*}
	Now the various cases of \eqreff{eq:SHIT} may be applied and we can continue the above chain of equations by
	\begin{align*}
		h^{n+1}\hacek{d}^n&=\begin{multlined}[t]
			\sum_{\ell=0}^{n}\sum_{k=0}^{\ell-1}(-1)^{\ell+k}d_k h_{\ell-1}+v_2^n+\sum_{\ell=1}^{n}h_{\ell-1} d_\ell\\
			-\sum_{\ell=0}^{n-1}h_\ell d_{\ell+1}-v_1^n+\sum_{\ell=0}^{n}\sum_{k=\ell+2}^{n+1}(-1)^{\ell+k}d_{k-1} h_{\ell}
		\end{multlined}\\
		&=\sum_{\ell=0}^{n-1}\sum_{k=0}^{\ell}(-1)^{\ell+1+k}d_k h_{\ell}+\sum_{\ell=0}^{n}\sum_{k=\ell+1}^{n}(-1)^{\ell+k+1}d_{k} h_{\ell}+v_2^n-v_1^n\\
		&=-\sum_{k=0}^{n}\sum_{\ell=0}^{n-1}(-1)^{\ell+k}d_kh_\ell +v_2^n-v_1^n\\
		&=-\hacek{d}^{n-1}h^n+v_2^n-v_1^n\;,
	\end{align*}
	as required.
\end{proof}
\begin{cor}\lbl{cor:refinementPullback}
	Let $\Mm$ be a presheaf of modules on a space $X$ and $\Uu,\Vv$ be open covers of $X$.
	\begin{alphanumerate} 
		\item If $\Vv$ is a refinement of $\Uu$, we have a canonical morphism 
		\begin{align*}
			\tau_{\Uu,\Vv}\colon \check{H}^\bullet (\Uu,\Mm)\morphism\check{H}^\bullet (\Vv,\Mm)
		\end{align*}
		satisfying $\tau_{\Vv,\Ww}\tau_{\Uu,\Vv}=\tau_{\Uu,\Ww}$ if $\Ww$ is another open cover of $X$ which is a refinement of $\Vv$, as well as $\tau_{\Uu,\Uu}=\id$.
		\item If $\Uu$ is a refinement of $\Vv$ and $\Vv$ a refinement of $\Uu$, then $\tau_{\Uu,\Vv}$ and $\tau_{\Vv,\Uu}$ are isomorphisms which are inverse to each other.
		\item If there is an $i^*\in I$ such that $U_{i^*}=X$, then $\check{H}^n(\Uu,\Mm)=0$ for $n\geq 1$.
	\end{alphanumerate}
\end{cor}
\begin{proof}
	Part \itememph{a} follows from Lemma~\reff{lem:refinementPullback}. Part \itememph{b} follows from \itememph{a} as $\tau_{\Vv,\Uu}\tau_{\Uu,\Vv}=\tau_{\Uu,\Uu}=\id$. Part \itememph{c} follows from \itememph{b} and Example~\reff{ex:FirstCechComputations} as $\Uu$ and the trivial cover $\Uu_0\colon X=X$ are refinements of each other in this case.
\end{proof}
\begin{rem}\lbl{rem:trivialCalt}
	In general, the cochain homotopy used in the proof of Lemma~\reff{lem:refinementPullback} won't preserve the subcomplex $\check{C}_\alt^\bullet (-,\Mm)\subseteq\check{C}^\bullet (-,\Mm)$. However, Corollary~\reff{cor:refinementPullback}\itememph{c} for $\check{H}_\alt^\bullet (\Uu,\Mm)$ can still be obtained, using the \emph{cochain contraction} $h\colon \check{C}^\bullet (\Uu,\Mm)\morphism\check{C}^\bullet (\Uu,\Mm)$, where $h^n\colon \check{C}^n(\Uu,\Mm)\morphism\check{C}^{n-1}(\Uu,\Mm)$ for $n\geq 1$ is given by
	\begin{align*}
		(h^n\psi)_{i_0,\ldots,i_n}=\psi_{i^*,i_0,\ldots,i_n}\;.
	\end{align*}
	It's a straightforward check that $h$ preserves $\check{C}_\alt^\bullet (\Uu,\Mm)\subseteq \check{C}^\bullet (\Uu,\Mm)$. Moreover, one has the relations
	\begin{align*}
		h^nd_k=\begin{cases}
			\id &\text{if }k=0\\
			d_{k-1}h^{n-1} & \text{if }k>0
		\end{cases}\;,
	\end{align*}
	hence
	\begin{align*}
		\hacek{d}^{n-1}h^n+h^{n+1}\hacek{d}^n&=\sum_{k=0}^{n}(-1)^kd_kh^n+\sum_{k=0}^{n+1}(-1)^kd_kh^{n+1}\\
		&=\id+\sum_{k=0}^{n}\left((-1)^k+(-1)^{k+1}\right)d_kh^n\\
		&=\id\;,
	\end{align*}
	proving that $h$ is indeed a cochain contraction, hence $\check{H}_\alt^i(\Uu,\Mm)=0$ for $i>0$. For our purposes, this will turn out to be sufficient.
\end{rem}
We now arrive at the main result of this section.
\begin{prop}\lbl{prop:CechCohoOnScheme}
	 Let $X$ be a quasi-compact scheme, $\Mm$ be a quasi-coherent $\Oo_X$-module and $\Uu$ an affine open cover of $X$.
	\begin{alphanumerate}
		\item If $\Vv$ is another affine open cover of $X$ which is a refinement of $\Uu$, then
		\begin{align*}
			\tau_{\Uu,\Vv}\colon \check{H}^\bullet (\Uu,\Mm)\isomorphism\check{H}^\bullet (\Vv,\Mm)\;.
		\end{align*}
		\item The inclusion $\check{C}_\alt^\bullet (\Uu,\Mm)\subseteq \check{C}^\bullet (\Uu,\Mm)$ of cochain complexes induces an isomorphism
		\begin{align*}
			\check{H}_\alt^\bullet (\Uu,\Mm)\isomorphism\check{H}^\bullet (\Uu,\Mm)\;.
		\end{align*}
		\item If $X$ is affine and $i>0$, then $\check{H}_\alt^i(\Uu,\Mm)=\check{H}^i(\Uu,\Mm)=0$.
	\end{alphanumerate}
\end{prop}
Before the proof, a lemma.
\begin{lem}\lbl{lem:CohomologyOfPushforward}
	For an open cover $\Uu\colon X=\bigcup_{i\in I}\Uu_i$ of a topological space $X$ and a continuous map $f\colon Y\morphism X$, let $f^{-1}(\Uu)$ be the cover $Y=\bigcup_{i\in I}f^{-1}(U_i)$. Let $\Ff$ be a sheaf of abelian groups on $Y$.
	\begin{alphanumerate}
		\item We have an isomorphism of cochain complexes $\check{C}^\bullet (f^{-1}(\Uu),\Ff)\cong \check{C}^\bullet (\Uu,f_*\Ff)$ and this isomorphism restricts to an isomorphism $\check{C}_\alt^\bullet (f^{-1}(\Uu),\Ff)\cong \check{C}_\alt^\bullet (\Uu,f_*\Ff)$.
		\item If the image of $f$ is contained in one of the open subsets $U_i$, then $\check{H}^p(\Uu,f_*\Ff)=\check{H}_\alt^p(\Uu,f_*\Ff)=0$ for $p>0$.
	\end{alphanumerate}
\end{lem}
\begin{proof}
	Part \itememph{a} is pretty much tautological. Let $\Vv=f^{-1}(\Uu)$, $V_i=f^{-1}(U_i)$, then we have $V_{i_0,\ldots,i_n}=f^{-1}(U_{i_0,\ldots,i_n})$, hence $f_*\Ff(V_{i_0,\ldots,i_n})=\Ff(U_{i_0,\ldots,i_n})$ by definition of the \emph{direct image} $f_*\Ff$. The differentials $\hacek{d}$ as well as the degeneracy and transposition maps $s_\ell,t_\ell$ of $\check{C}^\bullet (f^{-1}(\Uu),\Ff)$ and $\check{C}^\bullet (\Uu,f_*\Ff)$ clearly coincide, proving the asserted isomorphisms of cochain complexes.
	
	Part \itememph{b} follows from \itememph{a}, Corollary~\reff{cor:refinementPullback}\itememph{c} and Remark~\reff{rem:trivialCalt}.
\end{proof}
\begin{proof}[Proof of Proposition~\reff{prop:CechCohoOnScheme}]
	Part \itememph{a}. We fix the covers $\Uu$ and $\Vv$ such that $\Vv$ is a refinement of $\Uu$ and consider the following conditions on $\Mm$:
	\begin{quote}
		$\Mm$ has \defemph{property $\boldsymbol{A_i(\Mm)}$} iff $\check{H}^j(\Uu,\Mm)\xrightarrow{\tau_{\Uu,\Vv}}\check{H}^j(\Vv,\Mm)$ is an isomorphism for $j<i$ and injective for $i=j$.
	\end{quote}
	\begin{claim}\lbl{claim:AiAi+1}
		For a short exact sequence $0\morphism \Mm'\morphism \Mm\morphism \Mm''\morphism 0$ of quasi-coherent $\Oo_X$-modules one has the implication
		\begin{align*}
		\left[A_{i+1}(\Mm)\text{ and }A_i(\Mm'')\right] \Longrightarrow A_{i+1}(\Mm')\;.
		\end{align*}
	\end{claim}
	To prove Claim~\reff{claim:AiAi+1}, consider the commutative diagram
	\begin{diagram*}
		\node[ob] (A) at (0,1.5) {$\check{H}^{j-1}(\Uu,\Mm)$};
		\node[ob] (B) at (3,1.5) {$\check{H}^{j-1}(\Uu,\Mm'')$};
		\node[ob] (C) at (6,1.5) {$\check{H}^{j}(\Uu,\Mm')$};
		\node[ob] (D) at (9,1.5) {$\check{H}^j(\Uu,\Mm)$};
		\node[ob] (E) at (12,1.5) {$\check{H}^{j}(\Uu,\Mm'')$};
		\node[ob] (A') at (0,0) {$\check{H}^{j-1}(\Vv,\Mm)$};
		\node[ob] (B') at (3,0) {$\check{H}^{j-1}(\Vv,\Mm'')$};
		\node[ob] (C') at (6,0) {$\check{H}^{j}(\Vv,\Mm')$};
		\node[ob] (D') at (9,0) {$\check{H}^{j}(\Vv,\Mm)$};
		\node[ob] (E') at (12,0) {$\check{H}^{j}(\Vv,\Mm'')$};
		\scriptsize
		\draw[->] (A) -- (B);
		\draw[->] (B) -- (C);
		\draw[->] (C) -- (D);
		\draw[->] (D) -- (E);
		\draw[->] (A') -- (B');
		\draw[->] (B') -- (C');
		\draw[->] (C') -- (D');
		\draw[->] (D') -- (E');
		\draw[->] (A) -- (A') node[pos=0.5, left] {$\alpha$};
		\draw[->] (B) -- (B') node[pos=0.5, left] {$\beta$};
		\draw[->] (C) -- (C') node[pos=0.5, left] {$\gamma$};
		\draw[->] (D) -- (D') node[pos=0.5, left] {$\delta$};
		\draw[->] (E) -- (E') node[pos=0.5, left] {$\epsilon$};
	\end{diagram*}
	When $j\leq i$, then $\alpha,\beta$, and $\delta$ are isomorphisms, while $\epsilon$ is injective, proving $\gamma$ to be an isomorphism by the five lemma. When $j=i+1$, $\alpha$ is an isomorphism by $A_{i+1}(\Mm)$ while $\beta$ and $\delta$ are injective, proving $\gamma$ to be injective by the four lemma. Claim~\reff{claim:AiAi+1} follows.
	\begin{claim}\lbl{claim:BigN}
		For any quasi-coherent $\Oo_X$-module $\Mm$ there are a quasi-coherent $\Oo_X$-module $\Nn$ such that $A_i(\Nn)$ holds for arbitary $i$, and a monomorphism $\Mm\monomorphism\Nn$.
	\end{claim}
	To show this, let $j_W\colon W\morphism X$ be the embedding of any affine open subset $W$ contained in one of the open subsets forming the cover $\Vv$. As $X$ is a scheme, the morphism $j_W$ is affine, i.e., preimages of affine open subsets are affine (cf.\ \cite[Definition~2.5.1]{alggeo1}). Indeed, since preimages in this case are intersections with $W$, this follows from Proposition~\reff{prop:SchemesAffineIntersec}. Being an open embedding, $j_W$ is also quasi-separated. By Proposition~\reff{prop:PushforwardOfQcIsQc} and Proposition~\reff{prop:QCohHasKerCoker}\itememph{b}, $(j_W)_*\Mm|_W$ is a quasi-coherent $\Oo_X$-module. Since $X$ is quasi-compact, we find finitely many affine open subsets $W_1,\ldots,W_n$ covering $X$, each $W_i$ contained in an element of $\Vv$ (that is, $X=\bigcup_{i=1}^nW_i$ is a finite affine refinement of $\Vv$). Then
	\begin{align*}
		\Nn\coloneqq\bigoplus_{i=1}^n(j_{W_i})_*\Mm|_{W_i}
	\end{align*}
	is quasi-coherent by Proposition~\reff{prop:QCohHasKerCoker}\itememph{a}.
	
	We have morphisms
	\begin{align*}
		\Mm(U)&\morphism\Nn(U)=\bigoplus_{i=1}^n(j_{W_i})_*(\Mm|_{W_i})(U)=\bigoplus_{i=1}^n\Mm(U\cap W_i)\\
	m&\longmapsto (m|_{U\cap W_i})_{i=1}^n
	\end{align*}
	which are injective as $\Mm$ satisfies the sheaf axiom and form a morphism of $\Oo_X$-modules $\Mm\morphism\Nn$, which is thus a monomorphism.
	
	By Example~\reff{ex:FirstCechComputations}\itememph{c}, 
	\begin{align*}
		\check{H}^k(\Uu,\Nn)=\bigoplus_{i=1}^n\check{H}^k(\Uu,(j_{W_i})_*\Mm|_{W_i})
	\end{align*}
	and same for $\Vv$. But Example~\reff{ex:FirstCechComputations}\itememph{a} and  Lemma~\reff{lem:CohomologyOfPushforward}\itememph{b} (which applies here as every $W_i$ is contained in an element of $\Vv$, thus also of $\Uu$) show that 
	\begin{align*}
		\check{H}^k(\Uu,(j_{W_i})_*\Mm|_{W_i})=\check{H}^k(\Vv,(j_{W_i})_*\Mm|_{W_i})=\begin{cases}
			\Mm(W_i) &\text{if }k=0\\
			0 & \text{else}
		\end{cases}\;,
	\end{align*}
	hence $(j_{W_i})_*\Mm|_{W_i}$ has property $A_i$ for arbitrary $i$. Now $\Nn$ inherits the property $A_i$ from its summands, proving Claim~\reff{claim:BigN}.
		
	We are now able to finish the proof of Proposition~\reff{prop:CechCohoOnScheme}\itememph{a}. We prove by induction on $i$ that $A_i(\Mm)$ holds for arbitrary quasi-coherent $\Oo_X$-modules $\Mm$.  For $i=0$, note that $\check{H}^0(\Uu,\Mm)\cong \check{H}^0(\Vv,\Mm)\cong \Mm(X)$ for all $\Oo_X$-modules $\Mm$ (quasi-coherent or not), i.e., $A_0(\Mm)$ holds. 
	
	Now suppose $i\geq 1$ and $A_{i-1}$ holds for every quasi-coherent $\Oo_X$-module. Using Claim~\reff{claim:BigN}, we choose an embedding $\Mm\monomorphism[\iota]\Nn$ where $\Nn$ is quasi-coherent and satisfies $A_i$, then apply Claim~\reff{claim:AiAi+1} to the exact sequence
	\begin{align*}
		0\morphism\Mm\morphism[\iota]\Nn\morphism\coker(\iota)\morphism 0
	\end{align*}
	to derive $A_i(\Mm)$ from $A_i(\Nn)$ and $A_{i-1}(\coker(\iota))$. Here, Proposition~\reff{prop:QCohHasKerCoker}\itememph{a} ensures that $\coker(\iota)$ is quasi-coherent as well.
	
	Part \itememph{b}. The proof of part \itememph{a} can be carried over with the following modifications.
	\begin{itemize}
		\item $A_i(\Mm)$ is now the condition that $\check{H}_\alt^j(\Uu,\Mm)\morphism \check{H}^j(\Uu,\Mm)$ is an isomorphism when $j<i$ and injective for $j=i$.
		\item Claim~\reff{claim:AiAi+1} also holds for the new $A_i$.
		\item If $W\subseteq X$ is affine and contained in one of the $V_i$ and $\Ff\in\Ob(\cat{QCoh}(W))$, then $(j_W)_*\Ff$ satisfies all $A_i$ (which follows like above from Lemma~\reff{lem:CohomologyOfPushforward}\itememph{b} and Example~\reff{ex:FirstCechComputations}).
	\end{itemize}
	
	Part \itememph{c}. Apply \itememph{a} with $\Uu$ the trivial cover $X=X$ and $\Vv$ any affine open cover of $X$ to conclude $\check{H}^i(\Vv,\Mm)=0$ when $i>0$ and $\Mm$ is a quasi-coherent $\Oo_X$-module. Then one uses \itememph{b} to show that $\check{H}_\alt^\bullet (\Vv,\Mm)$ also vanishes in positive degrees.
\end{proof}
\begin{defi}
	Let $X$ be a quasi-compact scheme and $\Mm$ a quasi-coherent $\Oo_X$-module. We put
	\begin{align*}
		H^i(X,\Mm)\coloneqq \check{H}^i(\Vv_0,\Mm)\;,
	\end{align*}
	where $\Vv_0$ is the affine open cover of $X$ consisting of all affine open subsets of $X$.
\end{defi}
Summing up our previous work, we obtain the following Theorem~\reff{thm:CohoOnSchemes} in full glory.
\begin{thm}\lbl{thm:CohoOnSchemes}
	Let $X$ be a quasi-compact scheme and $\Mm$ a quasi-coherent $\Oo_X$-module.
	\begin{alphanumerate}
		\item If $\Uu$ is any affine open over of $X$, then
		\begin{align*}
			H^\bullet (X,\Mm)\isomorphism[\tau_{\Uu,\Vv_0}]\check{H}^\bullet (\Uu,\Mm)\lisomorphism \check{H}_\alt^\bullet (\Uu,\Mm)
		\end{align*}
		are isomorphisms compatible with the (iso)morphisms $\check{H}^\bullet (\Uu,\Mm)\xrightarrow{\tau_{\Uu,\Vv}}\check{H}^\bullet (\Vv,\Mm)$ when $\Vv$ is an affine refinement of $\Uu$.
		\item When $X$ is affine, $H^i(X,\Mm)=0$ when $i>0$.
		\item There is a canonical isomorphism $H^0(X,\Mm)\cong \Mm(X)$.
		\item When $0\morphism \Mm'\morphism\Mm\morphism\Mm''\morphism0$ is a short exact sequence of quasi-coherent $\Oo_X$-modules, one has a long exact cohomology sequence
		\begin{multline*}
			\begin{tikzpicture}[line cap=round, line join=round]
			\node[ob] (0o) at (0,0) {$0$};
			\node[ob] (0u) at (0,1.5) {$0$};
			\node[ob] (H0Z) [right=0.575 of 0o] {$H^0(X,\Mm')$};
			\node[ob] (H0CX) [right=0.575 of H0Z] {$H^0(X,\Mm)$};
			\node[ob] (H0CXx) [right=0.575 of H0CX] {$H^0(X,\Mm'')$};
			\node[ob] (Z) at (0u -| H0Z) {$\Mm'(X)$};
			\node[ob] (CX) at (0u -| H0CX) {$\Mm(X)$};
			\node[ob] (CXx) at (0u -| H0CXx) {$\Mm''(X)$};
			\node[ob] (H1Z) [right=0.575 of H0CXx] {$H^1(X,\Mm')$};
			\node[ob] (H1CX) [right=0.575 of H1Z] {$\ldots$};
			\scriptsize
			\draw[->] (0u) -- (Z);
			\draw[->] (0o) -- (H0Z);
			\draw[->] (Z) -- (CX);
			\draw[->] (H0Z) -- (H0CX);
			\draw[->] (CX) -- (CXx);
			\draw[->] (H0CX) -- (H0CXx);
			\draw[->] (H0CXx) -- (H1Z)node[pos=0.5, above] {$d$};
			\draw[->] (H1Z) -- (H1CX);
			\draw[->] (H0Z) -- (Z) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
			\draw[->] (H0CX) -- (CX) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
			\draw[->] (H0CXx) -- (CXx) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
			\end{tikzpicture}\\
			\ldots \morphism H^{i-1}(X,\Mm'')\morphism[d]H^i(X,\Mm')\morphism H^i(X,\Mm)\morphism H^i(X,\Mm'')\morphism[d]\ldots
		\end{multline*}
	\end{alphanumerate}
\end{thm}
\begin{proof}
	Part \itememph{a} follows from Proposition~\reff{prop:CechCohoOnScheme} and the fact that every affine open cover $\Uu$ is a refinement of $\Vv_0$. Part \itememph{b} is Proposition~\reff{prop:CechCohoOnScheme}\itememph{c}. Part \itememph{c} was seen in Example~\reff{ex:FirstCechComputations}\itememph{a} and \itememph{d} follows from Proposition~\reff{prop:LongExactCechSequence}.
\end{proof}
\begin{cor}
	Let $0\morphism \Mm'\morphism[\alpha]\Mm\morphism[\beta]\Mm''\morphism0$ be a short exact sequence of $\Oo_X$-modules, where $X$ is any prescheme. Then if two of $\Mm',\Mm,\Mm''$ are quasi-coherent, so is the third, and for any affine open subset $U\subseteq X$ the sequence
	\begin{align}\lbl{eq:exactAffineSectionSequence}
		0\morphism \Mm'(U)\morphism[\alpha]\Mm(U)\morphism[\beta]\Mm''(U)\morphism 0\tag{$*$}
	\end{align}
	is exact.
\end{cor}
\begin{proof}
	We have seen in Proposition~\reff{prop:QCohHasKerCoker}\itememph{a} that the category $\cat{QCoh}(X)$ of quasi-coherent $\Oo_X$-modules is stable under kernels and cokernels. Therefore, $\Mm'$ is quasi-coherent when $\Mm$ and $\Mm''$ are and $\Mm''$ is quasi-coherent when $\Mm'$ and $\Mm$ are. We may thus assume that $\Mm'$ and $\Mm''$ are the quasi-coherent ones.
	
	To show exactness of \eqreff{eq:exactAffineSectionSequence}, we may replace $X$ by $U$ and the involved sheaves by their restriction to $U$ and thus assume that $X=U\cong\Spec R$ is affine. This may also be assumed in the proof of quasi-coherence of $\Mm$, which is a local question.% At this point it would be nice to have the long exact cohomology sequence from Theorem~\reff{thm:CohoOnSchemes}\itememph{d} available, but we haven't, since $\Mm$ is not (yet) quasi-coherent. In the lecture, we fixed this by doing the cohomology argument ``on foot''. I would like to present a different way to circumvent this problem.
	
	Clearly, we only need to show surjectivity of $\Mm(X)\morphism[\beta]\Mm''(X)$, and for this, it suffices to pick an arbitrary $m''\in\Mm''(X)$ and show that it is in the image of $\beta$. Let $\Mm''=\snake{M}''$, where $M''$is the $R$-module defining $\Mm''$. Let $N''=\langle m''\rangle_R$ be the submodule generated by $m''$ and $\Nn''=\snake{N}''$. For every open $U\subseteq X$, let $\Nn(U)\subseteq \Mm(U)$ be the preimage of $\Nn''(U)\subseteq \Mm''(U)$ under $\beta$. Since $\Nn''$ is a subsheaf of $\Mm''$, it's easily seen that the sheaf axiom also holds for $\Nn$, so that $\Nn$ becomes a subsheaf of $\Mm$. Moreover, it's not hard to check that the stalk $\Nn_x$ is given by $\langle m_x\rangle_{\Oo_{X,x}}+\Mm_x'$, where $m_x\in\Mm_x$ is a lift of the image of $m''$ in $\Mm_x''$. Hence
	\begin{align*}
		0\morphism \Mm'\morphism \Nn\morphism \Nn''\morphism 0
	\end{align*}
	is still a short exact sequence of $\Oo_X$-modules. Because $\beta$ induces surjections on stalks, every $x\in X$ has a neighbourhood $U_x\ni x$ such that $m''|_{U_x}$ has a preimage in $\Mm(U_x)$. Moreover, we can choose $U_x$ to be affine. If $\Uu$ is the open cover of $X$ by these subsets, we see that
	\begin{align*}
		0\morphism \check{C}^\bullet(\Uu,\Mm')\morphism \check{C}^\bullet(\Uu,\Nn)\morphism \check{C}^\bullet(\Uu,\Nn'')\morphism 0
	\end{align*}
	is a short exact sequence of \vC ech complexes. By Example~\reff{ex:FirstCechComputations}\itememph{a}, the resulting long exact cohomology sequence takes the form
	\begin{align*}
		0\morphism \Mm'(X)\morphism \Nn(X)\morphism \Nn''(X)\morphism\check{H}^1(\Uu,\Mm')\morphism \ldots\;,
	\end{align*}
	in which $\check{H}^1(\Uu,\Mm')=0$ by Theorem~\reff{thm:CohoOnSchemes}\itememph{a} and \itememph{b} since $X$ is affine and $\Mm'$ quasi-coherent. This shows surjectivity of $\Nn(X)\morphism\Nn''(X)$, i.e., $m''$ has a preimage under $\beta$.	
	
	%We then only need to show surjectivity of $\Mm(X)\morphism[\beta]\Mm''(X)$. If we had the long exact cohomology sequence available, this would be an immediate consequence of the vanishing of $H^1(X,\Mm')$ -- but we haven't, so what the proof does is mimicking the cohomological argument on foot. For this, let $m''\in\Mm''(X)$. As $\Mm\morphism[\beta]\Mm''$ is an epimorphism and the affine open subsets form a topology base in $X$, there is an affine open cover $\Vv\colon X=\bigcup_{i\in I}V_i$ such that $m''|_{V_i}$ is in the image of $\beta(m_i)$ for some $m_i\in \Mm(V_i)$.
	%
	%The $m_i$ satisfy $\beta(m_i|_{V_{i,j}}-m_j|_{V_{i,j}})=0\in\Mm''(V_{i,j})$, hence there are $m'_{i,j}\in\Mm(V_{i,j})$ such that $\alpha(m'_{i,j})=m_i|_{V_{i,j}}-m_j|_{V_{i,j}}$, the sequence $0\morphism\Mm'(V_{i,j})\morphism[\alpha]\Mm(V_{i,j})\morphism[\beta]\Mm''(V_{i,j})$ being exact. Consider the elements $\mu=(m_i)_{i\in I}\in \check{C}^0(\Vv,\Mm)$ and $\mu'=(m'_{i,j})_{(i,j)\in I^2}\in \check{C}^1(\Vv,\Mm')$. Then $\alpha(\mu')=\hacek{d}\mu$. Thus 
	%\begin{align*}
	%	\alpha(\hacek{d}\mu')=\hacek{d}\alpha(\mu')=\hacek{d}^2\mu=0\;,
	%\end{align*}
	%hence $\hacek{d}\mu'=0$ by injectivity of $\alpha$. This means that $\mu'$ is a cocycle, and by the vanishing of $\check{H}^1(\Vv,\Mm')$ (due to Proposition~\reff{prop:CechCohoOnScheme}\itememph{c}), also a coboundary. That is, $\mu'=\hacek{d}\lambda'$ for some $\lambda\in\check{C}^0(\Vv,\Mm')$.\footnote{At this point Professor Franke ``ran out of primes'', which is odd since there are infinitely many of them.} Let $\lambda=\alpha(\lambda')$. As $\hacek{d}(\mu-\lambda)=\alpha(\mu')-\alpha(\mu')=0$, the $\mu_i-\lambda_i$ lift by the sheaf axiom to a single element $m^*\in\Mm(X)$ such that $m^*|_{V_i}=\mu_i-\lambda_i$. Since $\beta(\mu-\lambda)=\beta(\mu)-\beta(\alpha(\lambda'))=\beta(\mu)$, we have $\beta(m^*)=m''$. This proves the surjectivity of $\Mm(X)\morphism\Mm''(X)$ and thus \eqreff{eq:exactAffineSectionSequence}.
	
	To show that $\Mm$ is quasi-coherent, consider $0\morphism M'\morphism M\morphism M''\morphism 0$ where $M'=\Mm'(X)$, $M=\Mm(X)$, and $M''=\Mm''(X)$ which is an exact sequence of $R$-modules (as we just proved). As pointed out in the proof of Proposition~\reff{prop:QCohHasKerCoker}\itememph{a},  the functor $\cat{Mod}(R)\morphism\cat{QCoh}(\Spec R)$ mapping $N\mapsto \snake{N}$ preserves kernels and cokernels, hence the diagram
	\begin{diagram*}
		\node[ob] (A) at (0,1.5) {$0$};
		\node[ob] (B) at (1.5,1.5) {$\snake{M}'$};
		\node[ob] (C) at (3,1.5) {$\snake{M}$};
		\node[ob] (D) at (4.5,1.5) {$\snake{M}''$};
		\node[ob] (E) at (6,1.5) {$0$};
		\node[ob] (A') at (0,0) {$0$};
		\node[ob] (B') at (1.5,0) {$\Mm'$};
		\node[ob] (C') at (3,0) {$\Mm$};
		\node[ob] (D') at (4.5,0) {$\Mm''$};
		\node[ob] (E') at (6,0) {$0$};
		\scriptsize
		\draw[->] (A) -- (B);
		\draw[->] (B) -- (C);
		\draw[->] (C) -- (D);
		\draw[->] (D) -- (E);
		\draw[->] (A') -- (B');
		\draw[->] (B') -- (C');
		\draw[->] (C') -- (D');
		\draw[->] (D') -- (E');
		\draw[->] (B) -- (B') node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
		\draw[->] (C) -- (C');% node[pos=0.5, left] {$\gamma$};
		\draw[->] (D) -- (D') node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
	\end{diagram*}
	has exact rows. Since $\snake{M}'\morphism\Mm'$ and $\snake{M}''\morphism\Mm''$ are isomorphisms, so is $\snake{M}\morphism\Mm$ by the five lemma.
\end{proof}
In the following, if $\Uu\colon X=\bigcup_{i\in I}U_i$ is an open cover and $Y\subseteq X$, we will write $\Uu\cap Y$ for the open cover $Y=\bigcup_{i\in I}(Y\cap U_i)$.
\begin{cor}\lbl{cor:CohomologyOfPushforward}
	Let $X$ be a quasi-compact scheme.
	\begin{alphanumerate}
		\item If $W\monomorphism[j]X$ is the embedding of the affine open subset $W$ and $\Mm\in\Ob(\cat{QCoh}(W))$, then $H^p(X,j_*\Mm)=0$ for $p>0$.
		\item Let $W_i\monomorphism[j_i]X$ be the embeddings of affine open subsets $W_i$ for $i=1,\ldots,n$. Let $W=\bigcup_{i=1}^nW_i$. If $\Mm\in\Ob(\cat{QCoh}(X))$, then
		\begin{align*}
			H^p\bigg(X,\bigoplus_{i=1}^n(j_i)_*\Mm|_{W_i}\bigg)=0\quad\text{for }p>0
		\end{align*}
		and if $\Kk$ denotes the kernel of $\Mm\morphism\bigoplus_{i=1}^n(j_i)_*\Mm|_{W_i}$ sending $m\in\Mm(U)$ to
		\begin{align*}
			\left(m|_{U\cap W_i}\right)_{i=1}^n\in\bigoplus_{i=1}^n\Mm(U\cap W_i)=\bigoplus_{i=1}^n(j_i)_*\Mm|_{W_i}(U)\;,
		\end{align*}
		then $\Kk$ satisfies $\Kk|_W=0$.
	\end{alphanumerate}
\end{cor}
\begin{proof}
	Part \itememph{a}. Let $\Uu$ be any affine open cover of $X$. By Proposition~\reff{prop:SchemesAffineIntersec}, the $U_i\cap W$ are affine and we have $\check{H}^p(\Uu\cap W,\Mm)\cong \check{H}^p(\Uu,j_*\Mm)=0$ by Lemma~\reff{lem:CohomologyOfPushforward}\itememph{a} and Proposition~\reff{prop:CechCohoOnScheme}\itememph{c}.
	
	Part \itememph{b} follows from the fact that each $j_i$ is a monomorphism and the sheaf axiom.
\end{proof}
\begin{lem}\lbl{lem:LocalizedCechComplex}
	Let $\Uu$ be a finite open cover of the quasi-separated prescheme $X$ by quasi-compact open subsets and $f\in\Oo_X(X)$. By the universal property of localization, we have morphisms $\Mm(U)_f\morphism\Mm(U\setminus V(f))$ for arbitrary $\Oo_X$-modules $\Mm$ and open $U\subseteq X$. When applied to $U=U_{i_0,\ldots,i_n}$, this gives a morphism
	\begin{align*}
		\check{C}^\bullet (\Uu,\Mm)_f\morphism\check{C}^\bullet \Big(\Uu\cap\big(X\setminus V(f)\big),\Mm\Big)
	\end{align*}
	of \vC ech complexes. When $\Mm$ is quasi-coherent, this is an isomorphism.
\end{lem}
\begin{rem*}
	The structure of an $\Oo_X(X)$-module on $\check{C}^\bullet (\Uu,\Mm)$ is obtained using the $\Oo_X(U_{i_0,\ldots,i_n})$-module structures on $\Mm(U_{i_0,\ldots,i_n})$ followed by $\Oo_X(X)\morphism \Oo_X(U_{i_0,\ldots,i_n})$. Taking the product over all $(i_0,\ldots,i_n)\in I^{n+1}$ gives the structure of a cochain complex of $\Oo_X(X)$-modules on $\check{C}^\bullet (\Uu,\Mm)$, which is used in the formulation of Lemma~\reff{lem:LocalizedCechComplex}. The morphism under investigation is a morphism of cochain complexes  of $\Oo_X(X)_f$-modules.
\end{rem*}
\begin{proof}[Proof of Lemma~\reff{lem:LocalizedCechComplex}]
	As $\check{C}^n(\Uu,\Mm)=\prod_{(i_0,\ldots,i_n)\in I^{n+1}}\Mm(U_{i_0,\ldots,i_n})$ is a finite product and localization commutes with finite products, it is sufficient to show that
	\begin{align*}
		\Mm(U_{i_0,\ldots,i_n})_f\isomorphism\Mm(U_{i_0,\ldots,i_n}\setminus V(f))\;.
	\end{align*}
	By Definition~\reff{def:Quasicoherent}\itememph{c}, this will hold if $U_{i_0,\ldots,i_n}$ is quasi-compact and quasi-separated. It is quasi-separated as an open subset of the quasi-separated prescheme $X$. It is quasi-compact as an intersection of the quasi-compact subsets $U_{i_0},\ldots,U_{i_n}$ using quasi-separatedness of $X$.
\end{proof}
\begin{prop}\lbl{prop:localiedCoho}
	Let $X$ be a quasi-compact scheme, $\Mm$ a quasi-coherent $\Oo_X$-module, and $f\in\Oo_X(X)$. Then we have a canonical isomorphism
	\begin{align*}
		H^\bullet (X,\Mm)_f\isomorphism H^\bullet \left(X\setminus V(f),\Mm|_{X\setminus V(f)}\right)\;.
	\end{align*}
\end{prop}
\begin{proof}
	Follows from Lemma~\reff{lem:LocalizedCechComplex}. Note that the open subset $X\setminus V(f)\subseteq X$ is a scheme again by \cite[Fact~1.5.9\itememph{c}]{alggeo1} and quasi-compact by \cite[Fact~2.1.2]{alggeo1}.
\end{proof}
\begin{rem*}
	In general, there is the notion of \emph{derived functors} (from Grothendieck's famous \emph{T\^{o}hoku paper}) applicable to the left-exact functors on an abelian category with sufficiently many injective objects, like $\cat{Mod}(\Rr)$ ($\Rr$ being any sheaf of rings on any topological space) and $\cat{QCoh}(X)$ ($X$ being any prescheme). When $\Mm$ is an $\Rr$-module on any topological space $X$, the derived functors taken on the category of $\Rr$-modules or sheaves of abelian groups are canonically isomorphic. When $X$ is quasi-compact (or paracompact, this is actually sufficient) scheme, these are isomorphic to the cohomology introduced here and also to the derived functor of the global section functor taken for $\cat{QCoh}(X)$.
\end{rem*}
\section{The affinity criterion of Serre}
\begin{prop}[Serre's affinity criterion]\lbl{prop:serreAffinity}
	For a quasi-compact scheme $X$, the following conditions are equivalent.
	\begin{alphanumerate}
		\item $X$ is affine.
		\item $H^p(X,\Mm)=0$ for $p>0$ when $\Mm$ is a quasi-coherent $\Oo_X$-module.
		\item $H^1(X,\Jj)=0$ when $\Jj$ is a quasi-coherent sheaf of ideals on $X$.
	\end{alphanumerate}
\end{prop}
\begin{rem*}
	In EGA III, this is shown under the weaker assumptions that $X$ is quasi-compact and quasi-separated (instead of separated), using $H^\bullet $ defined as a derived functor on $\cat{Mod}(\Oo_X)$.
\end{rem*}
To prove Proposition~\reff{prop:serreAffinity} we need the following.
\begin{prop}
	\begin{alphanumerate}
		\item\lbl{prop:closedPoint} If $Z$ is a non-empty quasi-compact closed subset of a prescheme $X$, it contains a closed point.
		\item\lbl{prop:qcSheafOfIdealsDefinedByVf} If $Z\subseteq X$ is a closed subset of a prescheme $X$, then $\Jj(U) \coloneqq \{f \in \Oo_X(U) \mid Z\cap U \subseteq V(f)\}$
defines a quasi-coherent sheaf of ideals.
	\item\lbl{prop:intersectQc} If $\Nn_1,\Nn_2\subseteq \Mm$ are quasi-coherent subsheaves of the quasi-coherent sheaf of modules $\Mm$, $(\Nn_1 \cap \Nn_2)(U) \coloneqq \Nn_1(U)\cap
\Nn_2(U)$ defines a quasi-coherent sheaf of modules.
	\end{alphanumerate}
\end{prop}
\begin{proof}
	Part \itememph{a} is proved in \cite[Proposition~2.1.1]{alggeo1}

	Part \itememph{b}. Let $U\subseteq X$ be quasi-compact and quasi-separated, $f\in\Oo_X(U)$ and $\varphi \in \Jj(U)$ such
	that $\varphi\vert_{U\cap V(f)}=0$. Then, as $\Oo_X$ is quasi-coherent, there exists $n\in\IN$ such that $f^n\varphi = 0$ by Definition~\reff{def:Quasicoherent}\itememph{c}.
	It follows that the canonical map $\Jj(U)_f\rightarrow \Jj(U\setminus V(f))$ is injective.

	If $\psi \in \Jj(U\setminus V(f))$, then as $\Oo_X$ is quasi-coherent, there is $n\in\IN$ such that $f^n\psi$ extends to some
	$g\in \Oo_X(U)$ (using Definition~\reff{def:Quasicoherent}\itememph{c} again). Now $fg$ extends $f^{n+1}\psi$ and is in $\Jj(U)$. Indeed, we need to show $Z\cap U \subseteq V(fg)$ and this follows from
	\begin{align*}
		(Z\cap U)\setminus V(f)\subseteq V(\psi)\subseteq V\left(f^{n+1} \psi\right)=V\left(fg\vert_{U\setminus V(f)}\right)\subseteq V(fg)
	\end{align*}
	(the first inclusion coming from $\psi\in \Jj(U\setminus V(f))$) and $V(f)\subseteq V(fg)$. Thus we get an isomorphism $\Jj(U)_f\isomorphism \Jj(U\setminus V(f))$, which is the criterion from Definition~\reff{def:Quasicoherent}\itememph{c} once again.

	Part \itememph{c}. It is directly possible to verify $(\Nn_1\cap \Nn_2)(U)_f\isomorphism (\Nn_1\cap \Nn_2)(U\setminus V(f))$ similar
	as above. Alternatively, note that $\Nn_1\cap \Nn_2 = \ker(\Nn_1\rightarrow \Mm\rightarrow\Mm/\Nn_2)$ and use that $\cat{QCoh}(X)$ has kernels and cokernels by Proposition~\reff{prop:QCohHasKerCoker}\itememph{a}.
\end{proof}
\begin{proof}[Proof of Proposition \reff{prop:serreAffinity}]
 The implication \itememph{a} $\Rightarrow$ \itememph{b} follows from Theorem \reff{thm:CohoOnSchemes}\itememph{c} and \itememph{b} $\Rightarrow$ \itememph{c} is trivial.

Let's do \itememph{c} $\Rightarrow$ \itememph{a}. We first derive \itememph{c} $\Rightarrow$ \itememph{c^{++}}, where \itememph{c^{++}} is the condition
\begin{description}
	\item[\itememph{c^{++}}] If $\Mm\subseteq \Oo_X^{\oplus n}$ is a quasi-coherent submodule, then $H^1(X,\Mm)=0$.
\end{description}
We prove \itememph{c^{++}} by induction on $n$. The case $n=0$ is trivial. Now let $n\geq 1$ and assume that \itememph{c^{++}} holds for $n-1$. If $\Oo_X^{\oplus n-1}(U)$ is identified with
$\{(f_1,\ldots,f_{n-1},0) \in \Oo_X(V)^n\} \subseteq \Oo_X(U)^n$, then
$\Mm' = \Mm\cap \Oo_X^{\oplus n-1}$ is quasi-coherent by Proposition \reff{prop:intersectQc}\itememph{c}.
Moreover,
\begin{align*}
	\Mm'' \coloneqq \Mm/\Mm'&\morphism \Oo_X\\
	(f_1,\ldots,f_n)\bmod\Mm'&\longmapsto f_n
\end{align*}
is a monomorphism. Hence $H^1(X,\Mm')=0$ by induction and $H^1(X,\Mm'')=0$ by \itememph{c}. Now looking at the piece
\begin{align*}
\ldots\morphism H^1(X,\Mm')\morphism H^1(X,\Mm)\morphism H^1(X,\Mm'')\morphism\ldots
\end{align*}
of the long exact cohomology sequence, we get $H^1(X,\Mm)=0$, completing the induction.

Now we prove \itememph{c^{++}} $\Rightarrow$ \itememph{a}. Let $R=\Oo_X(X)$, so we have a morphism $X\morphism[p]\Spec R$ corresponding to $\id_R$
under the adjunction
\begin{align*}
\Hom_{\cat{LRS}}(X,\Spec R) \cong \Hom_{\cat{Ring}}(R,\Oo_X(X))
\end{align*}
from \cite[Proposition~1.4.2]{alggeo1}. We have to show that $p$ is an isomorphism. For this it is sufficient to show the following.
\begin{alphanumerate}
	\item[\itememph{\alpha}] If $f\in R$ is chosen such that $X\setminus V(f)$ is affine, then $X\setminus V(f) = p^{-1}(\Spec R\setminus V(f))$
	is isomorphically mapped to $\Spec R\setminus V(f)\cong \Spec(R_f)$ by $p$.
	\item[\itememph{\beta}] The open subsets $X\setminus V(f)$ with $f$ as in \itememph{\alpha} cover $X$.
	\item[\itememph{\gamma}] If $f_1,\ldots,f_n \in R$ are as in \itememph{\alpha} and $X=\bigcup_{i=1}^n (X\setminus V(f_i))$ then
	\begin{align*}
		\Spec R = \bigcup_{i=1}^n (\Spec R\setminus V(f_i))\;.
	\end{align*}
\end{alphanumerate}
By \itememph{\beta} and the quasi-compactness of $X$, it is possible to find
$f_1,\ldots,f_n\in R$ to which \itememph{\gamma} may be applied. Then the open subsets
$U_i = (\Spec R\setminus V(f_i))$ cover $\Spec R$
and $p^{-1}(U_i) \isomorphism U_i$. Then we get
$p\colon X\isomorphism\Spec R$.

\emph{Proof of \itememph{\alpha}}.
The fact $X\setminus V(f)=p^{-1}(\Spec R\setminus V(f))$ follows from the explicit construction of $p$.
Namely, $p$ maps a point $x\in X$ to the prime ideal $\pp \subseteq R$ which is the preimage of the maximal ideal $\mm_{X,x}\subseteq \Oo_{X,x}$ under $R=\Oo_X(X)\morphism\Oo_{X,x}$.
Hence $x\in X\setminus V(f) \Leftrightarrow f \notin p(x) \Leftrightarrow p(x) \in \Spec R\setminus V(f)$, showing that $X\setminus V(f)$ is indeed the preimage of $\Spec R\setminus V(f)$.

If $X\setminus V(f)$ is affine, we get
\begin{diagram*}%Let's try it
\node[ob] (Xf) at (0,1.5) {${X\setminus V(f)}$};
\node[ob] (SpecOX) at (4,1.5) {${\Spec\big(\Oo_X(X\setminus V(f))\big)}$};
\node[ob] (SpecRf) at (8,1.5) {$\Spec(R_f)$};
\node[ob] (X) at (0,0) {$X$};
\node[ob] (SpecO) at (4,0) {${\Spec \Oo_X(X)}$};
\node[ob] (SpecR) at (8,0) {$\Spec R$};
\scriptsize
\draw[->] (Xf) -- (X);
\draw[->] (SpecRf) -- (SpecR);
\draw[transform canvas={yshift=1pt}] (SpecO) -- (SpecR);
\draw[transform canvas={yshift=-1pt}] (SpecO) -- (SpecR);
\draw[->] (X) -- (SpecO) node[pos=0.5, above] {$p$};
\draw[->] (SpecOX) -- (SpecO);
\draw[->] (Xf) -- (SpecOX) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
\draw[->] (SpecOX) -- (SpecRf) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
\end{diagram*}
The first isomorphism comes from the fact that $X\setminus V(f)$ is affine.
For the second, we use $\Oo_X(X\setminus V(f)) \isomorphism \Oo_X(X)_f= R_f$,
which follows from Definition~\reff{def:Quasicoherent}\itememph{c} using
that $\Oo_X$ is quasi-coherent, and $X$ is both quasi-compact and quasi-separated.
This shows \itememph{\alpha}.

\emph{Proof of \itememph{\beta}}.
Let $U\subseteq X$ be the union of the affine open subsets of the form $X\setminus V(f)$
and $Z=X\setminus U$. If $Z\neq \emptyset$, there is a closed point $z\in Z$ by Proposition \reff{prop:closedPoint}\itememph{a}.
Choose an affine open neighbourhood $V$ of $z$. Let $Y_1\subseteq X$ be the closed subset $X\setminus V$, let
$Y_2 = \{z\}$ and $Y = Y_1\cup Y_2$. The sheaf of ideals $\Jj$ of functions $f\in \Oo_X(W)$ such
that $Y\cap W\subseteq V(f)$ is quasi-coherent by Proposition \reff{prop:qcSheafOfIdealsDefinedByVf}\itememph{b}.
By \itememph{c}, we have $H^1(X,\Jj)=0$. Note that $Y$ (equipped with its canonical reduced subprescheme structure) is the closed subprescheme of $X$ defined
by $\Jj$ and denote by $Y\monomorphism[i]X$ its embedding, i.e., $\Jj = \ker\big(\Oo_X\xrightarrow{i^\ast} i_\ast \Oo_Y\big)$. We get
some $\varphi\in\Oo_Y(Y) = i_\ast \Oo_Y(X)$ such that
$\varphi\vert_{Y_1}=0$ and $\varphi\vert_{Y_2}=1$ as $Y$ is the disjoint union of its open subsets $Y_1,Y_2$.

By the cohomology sequence
\begin{align*}
0\morphism \Jj(X)\morphism\Oo_X(X)\morphism[i^*] i_\ast \Oo_Y(X)\morphism H^1(X,\Jj)=0\;,
\end{align*}
there is some $f\in\Oo_X(X)$ such that $i^*f=\varphi$. Hence
$Y_1\subseteq V(f)$ and $z\notin V(f)$, so
$z\in X\setminus V(f) = (X\setminus Y_1)\setminus V(f) = V\setminus V(f)$, which is an affine open subset of $X$.
We get $z\in U$, a contradiction.

\emph{Proof of \itememph{\gamma}}. Let $f_1,\ldots,f_n$ be as requested. Consider the morphisms $\Oo_X\morphism[\cdot f_i]\Oo_X$ given by multiplication with $f_i$ and let $f\colon\Oo_X^{\oplus n}\morphism \Oo_X$ be the morphism induced by the $\cdot f_i$. Then $\cdot f_i$ is an isomorphism on $U_i = X\setminus V(f_i)$, hence induces isomorphisms on stalks $\Oo_{X,x}$ for $x\in U_i$, and the $U_i$ cover $X$. Thus $f$
is an epimorphism on stalks, hence an epimorphism of sheaves. Let $\Mm$ be the kernel of this epimorphism. We have
\begin{diagram*}
\node[ob] (Rn) at (0,1.5) {$\vphantom{R^n}$\scriptsize$\hphantom{(r_1,\ldots,r_n)}$};
\node[ob] at (0,1.5) {$R^n$};
\node[ob] (R) at (3,1.5) {$\vphantom{R}$\scriptsize$\hphantom{\sum r_i f_i}$};
\node[ob] at (3,1.5) {$R$};
\node[ob] (OxXn) at (0,0) {$\Oo_X(X)^n$};
\node[ob] (OxX) at (3,0) {$\Oo_X(X)$};
\node[ob] (H1M) at (5.5,0) {$H^1(X,\Mm)$};
\scriptsize
\node[ob] (ri) at ($(Rn.east)+(0,0.5)$) [left] {$(r_1,\ldots,r_n)$};
\node[ob] (sum) at ($(R.west)+(0,0.5)$) [right] {$\sum r_i f_i$};
\draw[|->] (ri) -- (sum);
\draw[->] (Rn) -- (OxXn) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
\draw[->] (R) -- (OxX) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
\draw[->] (Rn) -- (R);
\draw[->] (OxXn) -- (OxX) node[pos=0.5, above] {$f$};
\draw[->] (OxX) -- (H1M);
\end{diagram*}
The lower row is an extract of a long exact cohomology sequence.
Note that $H^1(X,\Mm)=0$ by \itememph{c^{++}}, hence the $f_i$ generate $R$ as an ideal of $R$ and $\bigcap_{i=1}^n V(f_i)=\emptyset$
in $\Spec R$ as stated.
\end{proof}
\begin{rem*}
$H^1(X,\Oo_X)=0$ is not enough (even when $X$ is a quasi-compact scheme) for affinity of $X$ as it holds, e.g., for $X=\IP^n_R$.
\end{rem*}
\section{Cohomological dimension}
\begin{prop}[Grothendieck]\lbl{prop:CohoDimension}
Let $X$ be a quasi-compact scheme and $Z\subseteq X$ a closed subset which is noetherian as topological space. %
%\footnote{It is possible that we will later add the further assumption that $X$ is noetherian as a topological space. The necessity of such an assumption will hopefully be clear once a full proof of this proposition is presented.}
Let $\Mm$ be a quasi-coherent sheaf of $\Oo_X$-modules satisfying $\Mm\vert_{X\setminus Z}=0$ and let $p>\dim(Z)$ (the Krull dimension of $Z$, which may be infinite). Then $H^p(X,\Mm)=0$.
\end{prop}
\begin{rem*}
	Grothendieck shows $H^p(Z,\Gg)=0$ when $Z$ is a noetherian topological space, $\Gg$ a sheaf of abelian groups on it and $p>\dim(Z)$. This, however, requires the construction of $H^p$ as a derived functor.
	
	In our situation, the bound may fail to be sharp.
\end{rem*}
\begin{proof}[Proof of Proposition~\reff{prop:CohoDimension}]
There is nothing to show if $\dim(Z)=+ \infty$ and for $\dim(Z)=-\infty$ (i.e., $Z=\emptyset$) the assertion is trivial, so we may show this by induction on $d=\dim(Z)$. Also, the case $d=0$ uses the same construction as the inductive step, so we will do both at once.

%Let $\dim(Z)=0$ and $Z=\bigcup_{i=1}^n Z_i$ the decomposition of $Z$ into its irreducible components. Each $Z_i$ is noetherian (as $Z$ is), hence quasi-compact, and closed, thus contains a closed point $z_i$ by Proposition~\reff{prop:closedPoint}\itememph{a}. But then $Z_i = \{z_i\}$ as $\{z_i\}$ is irreducible and $\dim(Z_i)=0$.

%As the affine open subsets form a topology base on $X$, there are affine open neighbourhoods $W_i\subseteq X$ of $z_i$ such that $Z\cap W_i = \{z_i\}$. Let $\Nn_i := (j_i)_\ast\left(\Mm\vert_{W_i}\right)$ where $W_i\monomorphism[j_i] X$ is the corresponding open immersion. Let $\Nn= \bigoplus_{i=1}^n \Nn_i$. We have seen in Corollary~\reff{cor:CohomologyOfPushforward}\itememph{b} that $H^p(X,\Nn)=0$ when $p>0$% and that $\ker(M\rigtharrow\snake\Mm)$ vanishes on $W=\bigcup_{i=1}^n W_i$.
%As $\Mm$ and $\snake\Mm$ vanish on $U=X\setminus Z$ and $X=U\cup W$, it follows that $\Mm\rightarrow \snake\Mm$ is a monomorphism 
%. Moreover, $(\Nn_j)_{z_i}=0$ when $i\neq j$ while $\Nn\rightarrow \Mm_i$ is an isomorphism on $W_i$, hence induces an isomorphism $\Nn_{z_i}\isomorphism(\Nn_i)_{z_i}=\Nn_{z_i}$ on stalks at $z_i$. Moreover, since $\Mm$ and $\Mm_i$ vanish on $X\setminus Z$, we see that $\Ff\isomorphism\Mm$ and the assertion follows.

Let $d=\dim(Z)$ be finite and the assertion be proved for quasi-coherent $\Mm$ supported on closed
subsets of smaller Krull dimension. Let $Z=\bigcup_{i=1}^n Z_i$ be the decomposition into irreducible components $Z_i$. Then $Z_i\setminus \bigcup_{j\neq i}Z_j$ is non-empty, as $Z_i\subseteq Z_j$ otherwise by irreducibility of $Z_i$. Hence we find affine open subsets $W_i\subseteq X$ such that $W_i$ intersects $Z_i$ but no $Z_j$ for $j\neq i$.

Let $\Nn_i = (j_i)_\ast\Mm\vert_{W_i}$ where $W_i\monomorphism[j_i]X$ is the inclusion of the open subset $W_i\subseteq X$ and let $\Nn=\bigoplus_{i=1}^n\Nn_i$. We consider the morphism $\Mm\morphism\Nn$ given by
\begin{align*}
\Mm(U)&\morphism\Nn(U)=\bigoplus_{i=1}^n(j_{i})_*(\Mm|_{W_i})(U)=\bigoplus_{i=1}^n\Mm(U\cap W_i)\\
m&\longmapsto (m|_{U\cap W_i})_{i=1}^n\;.
\end{align*}
As was seen in Corollary~\reff{cor:CohomologyOfPushforward}\itememph{b}, $H^p(X,\Nn)=0$ when $p>0$ and also $\Mm\morphism\Nn$ is a monomorphism outside $\snake{X}=X\setminus\bigcup_{i=1}^nW_i$ (well, this is the same construction as in Claim~\reff{claim:BigN}). Let $\snake{Z}=Z\cap \snake{X}$. 
%Remark, what monomorphism _outside_ means
We have $\Mm|_{X\setminus Z}=0=\Nn|_{X\setminus Z}$, hence $\Mm\morphism \Nn$ is also a monomorphism outside $Z$, hence a monomorphism outside $\snake{Z}$. We claim:
\begin{claim}\lbl{claim:epicClaim}
	The morphism $\Mm\morphism\Nn$ is also an epimorphism outside $\snake{Z}$.
\end{claim}
Assuming this for the moment, we have an exact sequence
\begin{align}\lbl{eq:4termsequence}
	0\morphism\Kk\morphism\Mm\morphism\Nn\morphism\Cc\morphism 0\tag{\S}
\end{align}
(with $\Kk=\ker(\Mm\morphism\Nn)$ and $\Cc=\coker(\Mm\morphism\Nn)$), where $\Kk$ and $\Cc$ vanish outside $\snake{Z}$. Since $W_i$ intersects $Z_i$, we have $Z_i\not\subseteq \snake{X}$, hence no irreducible component of $Z$ is contained in $\snake{Z}$ and we obtain $\dim(\snake{Z})<\dim(Z)=d$. If $d=0$, this implies $\snake{Z}=\emptyset$, hence $\Mm\cong \Nn$ has vanishing cohomology in positive degrees. Otherwise, the induction assumption implies $H^p(X,\Kk)=0=H^p(X,\Cc)$ when $p\geq d$. We split \eqreff{eq:4termsequence} into $0\morphism\Bb\morphism\Nn\morphism\Cc\morphism 0$ and $0\morphism \Kk\morphism\Mm\morphism\Bb\morphism 0$, where $\Bb=\ker(\Nn\morphism\Cc)$ which is also the image of $\Mm\morphism\Nn$. These give
\begin{align*}
	\ldots\morphism H^{p-1}(X,\Cc)\morphism H^p(X,\Bb)\morphism H^p(X,\Nn)\morphism \ldots\;,
\end{align*}
hence $H^p(X,\Bb)=0$ when $p>d$, and then
\begin{align*}
	\ldots\morphism H^p(X,\Kk)\morphism H^p(X,\Mm)\morphism H^p(X,\Bb)\morphism \ldots\;,
\end{align*}
implying $H^p(X,\Mm)=0$ when $p>d$. The vanishing assertion follows.

It remains to prove Claim~\reff{claim:epicClaim} that $\Cc|_{X\setminus \snake{Z}}$ vanishes. For this, we use that
\begin{align}\lbl{eq:stalksOfNn}
	(\Nn_i)_x\cong\begin{cases}
		\Mm_x & \text{if }x\in Z_i\cap W_i\\
		0 & \text{if }x\notin Z_i
	\end{cases}\;.\tag{\#}
\end{align}
Where does \eqreff{eq:stalksOfNn} come from? Let $x\in Z_i\cap W_i$ first. Note that $\Nn_i(U)=\Mm(U)$ when $U\subseteq W_i$, hence $\Nn_i|_{W_i}=\Mm|_{W_i}$ and then also their stalks at $x$ coincide. Suppose $x\notin Z_i$ now. Then $(\Nn_i)_x=0$ is an immediate  consequence of $\Nn_i|_{X\setminus Z_i}=0$ (note that $X\setminus Z_i$ is an open subset of $X$ since $Z_i$ is closed, so this makes sense), which we will show now. If $U\subseteq X$ is an open subset not intersecting $Z_i$, then $U\cap W_i$ doesn't intersect $Z$ since $W_i$ doesn't intersect $Z_j$ for $j\neq i$. Thus $\Nn_i(U)=\Mm(U\cap W_i)=0$ by the $\Mm|_{X\setminus Z}=0$ assumption.

When $x\notin Z$, \eqreff{eq:stalksOfNn} implies $\Nn_x=0$, hence $\Mm_x\morphism\Nn_x$ is surjective. When $x\in Z\setminus \snake{Z}$, then $x\in Z\cap W_i$ for some $i$, hence $x\in Z_i\cap W_i$ and $x\notin Z_j$ for $j\neq i$ since $W_i$ doesn't intersect $Z_j$ for $j\neq i$. Thus
\begin{align*}
	\Nn_x=\bigoplus_{i=1}^n(\Nn_i)_x=\Mm_x\oplus\bigoplus_{j\neq i}0 =\Mm_x
\end{align*}
and $\Mm_x\isomorphism\Nn_x$ is surjective in this case as well.
\end{proof}

\section{Cohomology of morphisms and functorial properties of cohomology}\lbl{sec:Rp}
Let $X\morphism[f]Y$ be a quasi-compact and separated morphism of preschemes. The set $\Bb$ of quasi-compact open subsets $U\subseteq Y$ which are schemes form a topology base on $Y$ (well, it contains all affine open subsets). By well-known properties of quasi-compact and of separated morphisms, $f^{-1}(U)$ is a quasi-compact scheme when $U\in \Bb$ (quasi-compactness is just Definition~\reff{def:qcqs} and $f^{-1}(U)\morphism\Spec\IZ$ is separated as the composition of the separated morphisms $f$ and $U\morphism\Spec \IZ$, cf.\ \cite[Fact~1.5.7\itememph{c}]{alggeo1}). We thus have for any quasi-coherent $\Oo_X$-module $\Mm$ a presheaf
\begin{align}\lbl{eq:cohoPresheaf}
	\Phi^pf_*\Mm\colon U\mapsto H^p\left(f^{-1}(U),\Mm\right)\tag{$*$}
\end{align}
on $\Bb$. The presheaf structure on \eqreff{eq:cohoPresheaf} is defined as follows. Let $V\subseteq U$ be elements of $\Bb$ and $\Uu,\Vv$ the covers of $f^{-1}(U)$ and $f^{-1}(V)$ by their affine open subsets. Then the morphism of restricting to the intersection with $f^{-1}(V)$ gives $\check{C}^\bullet (\Uu,\Mm)\morphism\check{C}^\bullet (\Uu\cap f^{-1}(V),\Mm)$ which may be followed by any morphism $\check{C}^\bullet (\Uu\cap f^{-1}(V),\Mm)\morphism\check{C}^\bullet (\Vv,\Mm)$ coming from a refinement map for the pair $(\Vv,\Uu\cap f^{-1}(\Vv))$ 
(we proved in Lemma~\reff{lem:refinementPullback}\itememph{c} that any two refinement maps induce the same morphism on cohomology, so this choice doesn't matter), which gives
\begin{align*}
	H^p\left(f^{-1}(U),\Mm\right)=\check{H}^p(\Uu,\Mm)\morphism\check{H}^p(\Vv,\Mm)=H^p\left(f^{-1}(V),\Mm\right)\;,
\end{align*}
and this is the desired presheaf structure.

\begin{defi}
	Sheafifying $\Phi^pf_*\Mm$ gives an $\Oo_Y$-module called the \defemph{$p\ordinalth$ direct image} of $\Mm$ under $f$ and denoted $R^pf_*\Mm$.
\end{defi}
 We have a morphism
 \begin{align}\lbl{eq:HpToRp}
 	H^p\left(f^{-1}(U),\Mm\right)\morphism R^pf_*\Mm(U)=H^0(U,R^pf_*\Mm)
 \end{align}
 (for $U\in\Bb$) as a special case of the morphism from a presheaf to its sheafification.
 
 \begin{prop}\lbl{prop:HigherDirectImage}
 	Let $X\morphism[f]Y$ is a quasi-compact and separated morphism of preschemes and $\Mm$ a quasi-coherent $\Oo_X$-module.
 	\begin{alphanumerate}
 		\item $R^0f_*\Mm\cong f_*\Mm$ canonically.
 		\item The $\Oo_X$-modules $R^pf_*\Mm$ are quasi-coherent.
 		\item For a short exact sequence $0\morphism\Mm'\morphism\Mm\morphism\Mm''\morphism 0$ of quasi-coherent $\Oo_X$-modules one has a long exact cohomology sequence 
 		\begin{multline*}
 		\begin{tikzpicture}[line cap=round, line join=round]
 		\node[ob] (0o) at (0,0) {$0$};
 		\node[ob] (0u) at (0,1.5) {$0$};
 		\node[ob] (H0Z) [right=0.575 of 0o] {$R^0f_*\Mm'$};
 		\node[ob] (H0CX) [right=0.575 of H0Z] {$R^0f_*\Mm$};
 		\node[ob] (H0CXx) [right=0.575 of H0CX] {$R^0f_*\Mm''$};
 		\node[ob] (Z) at (0u -| H0Z) {$f_*\Mm'$};
 		\node[ob] (CX) at (0u -| H0CX) {$f_*\Mm$};
 		\node[ob] (CXx) at (0u -| H0CXx) {$f_*\Mm''$};
 		\node[ob] (H1Z) [right=0.575 of H0CXx] {$R^1f_*\Mm'$};
 		\node[ob] (H1CX) [right=0.575 of H1Z] {$\ldots$};
 		\scriptsize
 		\draw[->] (0u) -- (Z);
 		\draw[->] (0o) -- (H0Z);
 		\draw[->] (Z) -- (CX);
 		\draw[->] (H0Z) -- (H0CX);
 		\draw[->] (CX) -- (CXx);
 		\draw[->] (H0CX) -- (H0CXx);
 		\draw[->] (H0CXx) -- (H1Z)node[pos=0.5, above] {$\delta$};
 		\draw[->] (H1Z) -- (H1CX);
 		\draw[->] (H0Z) -- (Z) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
 		\draw[->] (H0CX) -- (CX) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
 		\draw[->] (H0CXx) -- (CXx) node[pos=0.5, above=-0.25ex, sloped] {$\sim$};
 		\end{tikzpicture}\\
 		\ldots \morphism R^{p-1}f_*\Mm''\morphism[\delta]R^pf_*\Mm'\morphism R^pf_*\Mm\morphism R^pf_*\Mm''\morphism[\delta]\ldots
 		\end{multline*}
 		\item When $U\subseteq Y$ is affine, \eqreff{eq:HpToRp} becomes an isomorphism $H^p\left(f^{-1}(U),\Mm\right)\isomorphism R^pf_*\Mm(U)$.
 	\end{alphanumerate}
 \end{prop}
 \begin{proof}
 	Part \itememph{a}. We have $\Phi^0f_*\Mm(U)=H^0(f^{-1}(U),\Mm)\cong \Mm(f^{-1}(U))=f_*\Mm(U)$, hence $\Phi^0f_*\Mm\cong f_*\Mm|_\Bb$. Then sheafifying gives $f_*\Mm$ again by \cite[Proposition~1.2.1\itememph{c},\itememph{d}]{alggeo1}.
 	
 	Part \itememph{c}. By Theorem~\reff{thm:CohoOnSchemes} we have a similar long exact cohomology sequence of presheaves on $\Bb$. Sheafifying it gives the desired sequence, as sheafification  is an exact functor.\footnote{Exactness may be tested on stalks and sheafification preserves stalks by \cite[Proposition1.2.1\itememph{a}]{alggeo1} \ldots\ but why is an exact sequence of presheaves also exact on stalks? This is a legitimate question, since in the presheaf case exactness means to be exact \emph{on sections}! However, exactness on stalks is then automatic. Indeed, taking stalks is a colimit, hence commutes with cokernels by Corollary~\reff{cor:ColimitsCommute} -- and it is even a \emph{filtered} one, so it also commutes with kernels.}
 	
 	It is easy to see that our construction of $R^pf_*$ is base-local, i.e.,
 	\begin{align*}
 		R^pf_*\Mm|_U\cong R^p\left(f|_{f^{-1}(U)}\right)_*\Mm|_{f^{-1}(U)}\;.
 	\end{align*}
 	Thus we may assume $Y=\Spec R$ to be affine (quasi-coherence is a local property) for \itememph{b} and $Y=U=\Spec R$ in \itememph{d}. 
 	
 	Put $M=H^p(X,\Mm)$. We consider $M$ (which has a natural $\Oo_X(X)$-module structure) as a $R=\Oo_Y(Y)$-module via $f^*\colon \Oo_Y(Y)\morphism f_*\Oo_X(Y)=\Oo_X(X)$.  If we show $R^pf_*\Mm=\snake{M}$, this will show \itememph{b} and \itememph{d} (with the above simplifications) at once.
 	
 	Since $Y=\Spec R$ is affine, the set $\Bb=\left\{Y\setminus V(\lambda)\st \lambda\in R\right\}$ forms a topology base of $Y$ consisting of quasi-compact schemes. Restricting $\Phi^pf_*\Mm$ to $\Bb$ still gives $R^pf_*\Mm$ under sheafification by \cite[Proposition~1.2.1\itememph{c}]{alggeo1}. For $Y\setminus V(\lambda)\in\Bb$ we have
 	\begin{align*}
 	H^p\left(f^{-1}\big(Y\setminus V(\lambda)\big),\Mm\right)= H^p(X\setminus V(f^*\lambda),\Mm)\cong H^p(X,\Mm)_{f^*\lambda} =M_\lambda
 	\end{align*}
 	by Proposition~\reff{prop:localiedCoho}. Why is $H^p(X,\Mm)_{f^*\lambda} =M_\lambda$? Well, this is how we defined the $R$-module structure on $M$.  We also used $f^{-1}(Y\setminus V(\lambda))=X\setminus V(f^*\lambda)$ as $f$ is a morphism of locally ringed spaces (cf.\ \cite[Definition~1.3.4\itememph{b}]{alggeo1}). It follows that $R^pf_*\Mm$ is canonically isomorphic to the sheafififation of $Y\setminus V(\lambda)\mapsto M_\lambda$, which is just $\snake{M}$ by definition of the twiddlelization (\cite[Definition~1.5.1]{alggeo1}, actually). We are done.
 \end{proof}
 In general, the morphism \eqreff{eq:HpToRp} fails to be an isomorphism: The \emph{restriction to fibres} (for $Y$ a quasi-compact scheme)
 \begin{align}\lbl{eq:RestrictionToFibres}
 	H^p(X,\Mm)\morphism R^pf_*\Mm(Y)=E_2^{0,p}
 \end{align}
 as a special case of \eqreff{eq:HpToRp} is normally not an isomorphism when $Y$ is not affine. There is another morphism, the \emph{pull-back} (for $Y$ again a quasi-compact scheme)
 \begin{align}\lbl{eq:pull-back}
 	E_2^{p,0}=H^p(Y,f_*\Mm)\morphism H^p(X,\Mm)
 \end{align}
(also not an isomorphism unless $f$ is affine) which can be constructed as follows. Let $\Uu_Y$ be the open cover of $Y$ by its affine subsets and $\Vv$ any affine refinement of $f^{-1}(\Uu_Y)$. Then, using Lemma~\reff{lem:CohomologyOfPushforward}\itememph{b} and Proposition~\reff{prop:CechCohoOnScheme}\itememph{a} we obtain
\begin{align*}
	H^p(Y,f_*\Mm)=\check{H}^p(\Uu_Y,f_*\Mm)=\check{H}^p\left(f^{-1}(\Uu_Y),\Mm\right)\morphism \check{H}^p(\Vv,\Mm)\lisomorphism H^p(X,\Mm)
\end{align*}
defining the above pull-back morphism \eqreff{eq:pull-back}.

There is an also inverse image functor $f^*\colon \cat{Mod}(\Oo_Y)\morphism \cat{Mod}(\Oo_X)$ which preserves quasi-coherence and is left-adjoint to $f_*$\footnote{\lbl{footnote:f^*}We constructed $f^*$ on exercise sheet \#10 of Algebraic Geometry~I, and also proved the relevant properties there. It is given by $f^*\Mm=f^\sharp\Mm\otimes_{f^\sharp \Oo_Y}\Oo_X$, where $f^\sharp$ is constructed as in \cite[Remark~1.2.4]{alggeo1}.
	
	\textsc{Edit:} Eventually, Professor Franke realized he can no longer procrastinate defining sheaf inverse images. Have a look at Remark~\reff{rem:SheafInverseImage}.}. Thus, for $\Nn$ a quasi-coherent $\Oo_Y$-module, there is a canonical morphism $\Nn\morphism f_*f^*\Mm$ which gives another type of pull-back morphism
\begin{align*}
	H^p(Y,\Nn)\morphism H^p(Y,f_*f^*\Nn)\morphism[\text{\eqreff{eq:pull-back}}]H^p(X,f^*\Nn)\;.
\end{align*}
In general, \eqreff{eq:RestrictionToFibres} and \eqreff{eq:pull-back} will fail to be isomorphisms but are part of the \emph{Leray spectral sequence}
\begin{align*}
	E_2^{p,q}=H^p(Y,R^qf_*\Mm)\converge H^{p+q}(X,\Mm)
\end{align*}
converging ``to $H^{p+q}(X,\Mm)$'' (actually to some limit filtration of this). 

This means the following: One has a sequence $\left(E_k^{\bullet,\bullet}\right)_{k=2}^\infty$ of doubly graded abelian groups (or $R$-modules or objects of any other abelian category) equipped with morphisms (the \emph{differentials}) $d_k=d_k^{p,q}\colon E_k^{p,q}\morphism E_k^{p+k,q+1-k}$ such that 
\begin{align*}
	E_k^{p,q}\morphism[d_k]E_k^{p+k,q+1-k}\morphism[d_k]E_k^{p+2k,q+1-2k}
\end{align*}
vanishes and such that $E_{k+1}^{\bullet,\bullet}=H^\bullet (E_k^{\bullet,\bullet},d_k^{\bullet,\bullet})$ in the sense that
\begin{align}\lbl{eq:eta}
	E_{k+1}^{p,q}=\ker\Big(E_k^{p,q}\morphism[d_k]E_k^{p+k,q+1-k}\Big)/\Im\Big(E_k^{p-k,q+k-1}\morphism[d_k]E_k^{p,q}\Big)\tag{$\eta$}\;.
\end{align}
Thus $E_k^{p,q}=0$ for all $k\geq 2$ when $E_2^{p,q}=0$. When $E_2^{\bullet,\bullet}$ is supported in the $1\ordinalst$ quadrant (i.e., $E_2^{p,q,}=0$ if $p<0$ or $q<0$), the same is true for all $E_k^{\bullet,\bullet}$ and \eqreff{eq:eta} becomes
\begin{align}\lbl{eq:eta'}
	E_{k+1}^{p,q}=\coker\Big(E_k^{p-k,q+k-1}\morphism[d_k]E_k^{p,q}\Big)\quad\text{for }k>q+1\tag{$\eta'$}
\end{align}
and 
\begin{align}\lbl{eq:eta''}
	E_{k+1}^{p,q}=\ker\Big(E_k^{p,q}\morphism[d_k]E_k^{p+k,q-k+1}\Big)\quad\text{for }k>p\tag{$\eta''$}
\end{align}
and we deduce $E_{k+1}^{p,q}=E_k^{p,q}$ for $k>\max\{p,q+1\}$.

For $1\ordinalst$ quadrant sequences (like Leray's) we put $E_\infty^{p,q}=E_k^{p,q}$ where $k$ is large enough. When the spectral sequence \emph{converges to some filtration on its limit} $L^\bullet $ (we have $L^\bullet =H^\bullet (X,\Mm)$ for Leray), it is meant that there is a filtration $F^\bullet L^\bullet \colon L^\bullet =F^0L^\bullet \supseteq F^1L^\bullet\supseteq \ldots$ with $E_\infty^{p,q}\cong F^pL^{p+q}/F^{p+1}L^{p+q}$. Thus, for $1\ordinalst$ quadrant sequences,
\begin{align*}
	F^1L^p=\ker\left(L^p\morphism E_\infty^{0,p}\right)=\ker\Big(L^p\morphism E_2^{0,p}\Big)
\end{align*}
(where we use $E_\infty^{0,p}\subseteq E_2^{0,p}$ by \eqreff{eq:eta''}) has \eqreff{eq:RestrictionToFibres} as a special case. Also, using $F^{p+1}L^p=0$ for $1\ordinalst$ quadrant sequences we obtain an epimorphism
\begin{align*}
	F^pL^p\cong E_\infty^{p,q}\lepimorphism E_2^{p,0}
\end{align*}
by \eqreff{eq:eta'}. The resulting morphism $E_2^{p,0}\morphism L^p$ has \eqreff{eq:pull-back} as a special case.

There is also a Leray spectral sequence $R^pg_*R^qf_*\Mm\converge R^{p+q}(gf)_*\Mm$. In this case, the $E_k^{p,q}$ terms are sheaves (of quasi-coherent modules) instead of groups.

\section{Affine morphisms and the relative \texorpdfstring{$\SPEC$}{Spec} functor}
\begin{prop}\lbl{prop:AffineMorphism}
	Let $X\morphism[f]Y$ be a morphism of preschemes, then the following conditions are equivalent.
	\begin{alphanumerate}
		\item If $U\subseteq Y$ is an affine open subset, then so is $f^{-1}(U)\subseteq X$.
		\item It is possible to cover $Y$ by affine open $U$ such that $f^{-1}(U)$ is affine open.
	\end{alphanumerate}
	When $X$ is, in addition, quasi-separated, this is moreover equivalent to
	\begin{alphanumerate}\setcounter{enumi}{2}
		\item $f$ is separated and quasi-compact and we have $R^pf_*\Mm=0$ when $\Mm$ is a quasi-coherent $\Oo_X$-module and $p>0$.
	\end{alphanumerate}
\end{prop}
\begin{proof}
	An unconditional proof of \itememph{a} $\Leftrightarrow$ \itememph{b} was given in \cite[Lemma~2.5.1]{alggeo1}.
	
	The implication \itememph{a} $\Rightarrow$ \itememph{b} is trivial. For \itememph{b} $\Rightarrow$ \itememph{c}, it is obvious that $f$ is quasi-compact and separatedness was proved in \cite[Fact~2.6.1]{alggeo1}. To show $R^pf_*\Mm=0$, note that if $U\subseteq Y$ is affine open such that $f^{-1}(U)$ is affine and $\lambda\in\Oo_X(U)$, then $f^{-1}(U\setminus V(\lambda))=f^{-1}(U)\setminus V(f^*\lambda)$ is affine as well. In particular, the $U\subseteq Y$ such that $f^{-1}(U)$ is affine form a topology base on $Y$.  By Theorem~\reff{thm:CohoOnSchemes}\itememph{b} and Proposition~\reff{prop:HigherDirectImage}\itememph{b}, $\Phi^pf_*\Mm$ thus vanishes on a topology base of $Y$. Hence $R^pf_*\Mm=0$ as the sheafification of  $\Phi^pf_*\Mm$. In particular, we didn't need the additional assumption.
	
	Now for \itememph{c} $\Rightarrow$ \itememph{a} assuming that $X$ is quasi-separated. If $U\subseteq Y$ is affine and $\Mm$ a quasi-coherent $\Oo_{f^{-1}(U)}$-module, then $\Mm$ extends to $X$ by Lemma~\reff{lem:weirdLemma}, and by Proposition~\reff{prop:HigherDirectImage}\itememph{d}
	\begin{align*}
		H^p\left(f^{-1}(U),\Mm\right)\cong R^pf_*\Mm(U)=0\;.
	\end{align*}
	By Serre's affinity criterion (Proposition~\reff{prop:serreAffinity}), $f^{-1}(U)$ is affine.
\end{proof}
\begin{lem}\lbl{lem:weirdLemma}
	Let $X$ be a quasi-separated prescheme and $\Nn$ a quasi-coherent $\Oo_U$-module for some quasi-compact open subset $U\subseteq X$. Then there is a quasi-coherent $\Oo_X$-module $\Mm$ such that $\Mm|_U\cong \Nn$.
\end{lem}
\begin{proof}
	The open immersion $U\monomorphism[j]X$ is quasi-separated (in fact, separated as is any monomorphism between preschemes, cf.\ \cite[Fact~1.5.7\itememph{a}]{alggeo1}) and quasi-compact since $X$ is quasi-separated and $U$ is quasi-compact. Hence $\Mm=j_*\Nn$ is quasi-coherent by Proposition~\reff{prop:PushforwardOfQcIsQc} and $\Mm|_U\cong \Nn$.
\end{proof}
\begin{defi}
	\begin{alphanumerate}
		\item \lbl{def:AffineMorphism}A morphism $X\morphism[f]Y$ between preschemes is called \defemph{affine} if it satisfies the equivalent conditions from Proposition~\reff{prop:AffineMorphism}\itememph{a} and \itememph{b}.
		\item It is called \defemph{finite} if in addition for any affine open $U\subseteq Y$, $\Oo_X(f^{-1}(U))$ is a finitely generated $\Oo_Y(U)$-module, or, equivalently, if this holds for sufficiently many $U$ to cover $Y$ (by Lemma~\reff{lem:locFinGen}).
	\end{alphanumerate}
\end{defi}
\begin{rem*}
	In other words, $f$ is finite iff $f$ is affine and $f_*\Oo_X$ is a locally finitely generated $\Oo_Y$-module in the sense of Definition~\reff{def:locFinGenerated}\itememph{a}. If $Y$ is noetherian, this is equivalent to $f$ being affine and $f_*\Oo_X$ a \emph{coherent} $\Oo_Y$-module in the sense of Definition~\reff{def:locFinGenerated}\itememph{b}.
\end{rem*}
\begin{cor}\lbl{cor:AffinePushforwardIso}
	If $X\morphism[f]Y$ is an affine morphism and $\Mm$ a quasi-coherent $\Oo_X$-module, then $R^pf_*\Mm=0$ when $p>0$. When $Y$ is a quasi-compact scheme, the morphism
	\begin{align*}
		H^p(Y,f_*\Mm)\xrightarrow{\text{\eqreff{eq:pull-back}}}H^p(X,\Mm)
	\end{align*} 
	is an isomorphism.
\end{cor}
\begin{proof}
	The first assertion follows from the fact that $R^pf_*\Mm$ is the sheafification of the presheaf $U\mapsto H^p(f^{-1}(U),\Mm)$, which vanishes on the topology base of affine open subsets $U\subseteq Y$ when $p>0$ by Theorem~\reff{thm:CohoOnSchemes}\itememph{b}.
	
	When $Y$ is a quasi-compact scheme, then $X$ is a scheme as well since $X\morphism\Spec \IZ$ is separated as the composition of the separated morphisms $f$ and $Y\morphism\Spec \IZ$. Also, $X$ is quasi-compact as $f$ and $Y$ are quasi-compact. Let $\Uu_Y$ be the open cover of $Y$ by its affine open subsets, then
	\begin{align*}
		H^p\left(Y,f_*\Mm\right)\cong \check{H}^p\left(\Uu_Y,f_*\Mm\right)\cong \check{H}^p\left(f^{-1}(\Uu_Y),\Mm\right)\cong H^p\left(X,\Mm\right)
	\end{align*}
	(which was our description of \eqreff{eq:pull-back}) where the last isomorphism holds as $f$ is affine, hence $f^{-1}(\Uu)$ is an affine open cover of $X$.
	
	This proves the second assertion under the assumptions which we constructed the relevant cohomology groups.
\end{proof}
\begin{rem*}
	Using the general derived functor construction this also follows from the Leray spectral sequence
	\begin{align*}
		E_2^{p,q}=H^p(Y,R^qf_*\Mm)\converge H^{p+q}(X,\Mm)
	\end{align*}
	and the vanishing of $R^qf_*\Mm$ when $q>0$, $\Mm$ is quasi-coherent and $f$ affine.
\end{rem*}
Let $X$ be any prescheme. Recall the construction of the $\SPEC_X(-)$ functor from \cite[Subsection~2.5.1]{alggeo1}, which is given as follows. When $\Aa$ is a quasi-coherent $\Oo_X$-algebra, one has schemes $\Spec \Aa(U)\morphism \Spec \Oo_X(U)\cong U$ when $U\subseteq X$ is an affine open subset. When $V\subseteq U$ is another affine open subset, then $\Spec A(V)$ is isomorphic to the preimage of $V$ under $\Spec \Aa(U)\morphism U$. This allows one to glue the different $\Spec \Aa(U)$ together to one prescheme $\SPEC_X(\Aa)\morphism X$ which also admits the following description:
\begin{itemize}
	\item \emph{Points.} As a set,
	\begin{align*}
	\SPEC_X(\Aa) = \left\{(x,\pp) \st 
	\begin{array}{c}
	x\in X\text{, }\pp \in \Spec(\Aa_x) \text{ such that the preimage of }\pp\\
	\text{under } \Oo_{X,x}\morphism \Aa_x \text{ is } \mm_{X,x}\text{ (the maximal ideal of }\Aa_x)
	\end{array}
	\right\}
	\end{align*}
	\item \emph{Topology base.} Let
	\begin{align*}
	\Omega(U,\lambda) = \left\{ (x,\pp) \st x\in U\text{ and }\pp\not\ni (\text{image of } \lambda \text{ under } \Aa(U)\to \Aa_x)\right\}
	\end{align*}
	where $U\subseteq X$ is open and $\lambda \in \Aa(U)$. As $\Omega(U,\lambda) \cap \Omega(V,\vartheta) = \Omega(U\cap V, \lambda|_{U\cap V} \cdot \vartheta|_{U\cap V})$ this is indeed a base for some topology.
	\item \emph{Local rings.} There is only one reasonable choice and this is $\Oo_{Y,[x,\pp]} \coloneqq (\Aa_x)_\pp$. Here, $Y=\SPEC_X(\Aa)$ for brevity.
	\item \emph{Structure sheaf.} For $\Omega\subseteq Y$ open, let
	\begin{align*}
	\Oo_Y(\Omega) = \left\{\alpha=(\alpha_{x,\pp})\in \prod_{(x,\pp)\in \Omega} \Oo_{Y,[x,\pp]}\st 
	\begin{array}{c}
	\alpha\text{ fulfills the \emph{cohe-}}\\
	\text{\emph{rence condition}\texttrademark}
	\end{array}
	\right\}\;.
	\end{align*}
	Here, the \emph{coherence condition}\texttrademark\ says that every $\omega\in \Omega$ has a neighbourhood $\Omega(U,\lambda)$ together with an $a\in \Aa(U)_\lambda$ such that whenever $(x,\pp)\in \Omega\cap \Omega(U,\lambda)$, we have
	\begin{align*}
	\alpha_{x,\pp}=\left(\text{image of }a\text{ under }\Aa(U)_\lambda \to (\Aa_x)_\lambda \to (\Aa_x)_\pp = \Oo_{Y,[x,\pp]}\right)\;.
	\end{align*}
\end{itemize}
\begin{prop}\lbl{prop:SPECAdjunction}
	Let $Y$ be a prescheme, $\Aa$ an $\Oo_Y$-algebra and $X\morphism[\xi]Y$ a morphism of preschemes.
	\begin{alphanumerate}
		\item The morphism $\Spec_Y(\Aa)\morphism Y$ is affine.
		\item One has a bijection
		\begin{align}\lbl{eq:SPECAdjunction}
			\Hom_{\cat{Alg}(\Oo_Y)}(\Aa,\xi_*\Oo_X)\lisomorphism\Hom_{\cat{PSch}/Y}(X,\SPEC_Y(\Aa))
		\end{align}
		by gluing the adjunctions 
		\begin{align*}
			\Hom_{\cat{Mod}(\Oo_Y(U))}\left(\Aa(U),\Oo_X(\xi^{-1}U)\right)\cong \Hom_{\cat{PSch}}\left(\xi^{-1}U,\Spec \Aa(U)\right)
		\end{align*}
		together.
		\item The morphism $\xi$ is affine iff $\xi_*\Oo_X$ is a quasi-coherent $\Oo_Y$-algebra and the morphism $X\morphism\SPEC_Y(\xi_*\Oo_X)$ corresponding to $\id_{\xi_*\Oo_X}$ under \eqreff{eq:SPECAdjunction} is an isomorphism.
	\end{alphanumerate}
\end{prop}
\begin{proof}[Sketch of a proof]
	For \itememph{a}, the preimage of an affine open $U\subseteq Y$ is $\Spec \Aa(U)$, hence affine. Part \itememph{b} was sketched in \cite[Proposition~2.5.1]{alggeo1} and part \itememph{c} is \cite[Lemma~2.5.1]{alggeo1}.
\end{proof}
\begin{cor}\lbl{cor.SPECfibreProducts}
	Let $\snake{Y}\morphism[f] Y$ be a morphism of preschemes. Let $f^*\colon \cat{Alg}(\Oo_Y)\morphism\cat{Alg}(\Oo_{\snake{Y}})$ be the inverse image functor from Remark~\reff{rem:SheafInverseImage}. If $\Aa$ is a $\Oo_Y$-algebra, we have 
	\begin{align*}
		\SPEC_{\snake{Y}}(f^*\Aa)\cong \SPEC_Y(\Aa)\times_Y\snake{Y}\;.
	\end{align*}
\end{cor}
\begin{proof}
	Recall that $f^*$ is left-adjoint to $f_*$ Let $X\morphism[\xi]\snake{Y}$ be a $\snake{Y}$-prescheme (cf.\ \cite[Definition~1.5.7]{alggeo1}). Repeatedly applying Proposition~\reff{prop:SPECAdjunction}\itememph{b} we get
	\begin{align*}
		\Hom_{\cat{PSch}/\snake{Y}}\left(X,\SPEC_{\snake{Y}}(f^*\Aa)\right)&\cong \Hom_{\cat{Alg}(\Oo_{\snake{Y}})}\left(f^*\Aa,\xi_*\Oo_X\right)\\
		&\cong\Hom_{\cat{Alg}(\Oo_Y)}\left(\Aa,f_*\xi_*\Oo_X\right)\\
		&\cong \Hom_{\cat{PSch}/Y}\left(X,\SPEC_Y(\Aa)\right)\;.
	\end{align*}
	In the last line, the $Y$-prescheme structure on $X$ is given by $X\morphism[\xi]\snake{Y}\morphism[f]Y$. If you think about it for a moment, a morphism of $Y$-preschemes from $X$ to $\Spec_Y(\Aa)$, where the $Y$-prescheme structure on $X$ factors over $\snake{Y}$ is exactly the commuting square from the universal property of the fibre product $\SPEC_Y(\Aa)\times_Y\snake{Y}$ and we're done.
\end{proof}

\section{The relation between \texorpdfstring{$\check{H}^1$}{H} and torsors}
The usual term for these things seems to be \emph{torsor} rather than \emph{torseur}, so we will deviate from the lecture's notation here.
\begin{defi}\lbl{def:torsor}
	Let $X$ be any topological space, $\Gg$ a sheaf of groups on $X$. A \defemph{$\Gg$-torsor} or \defemph{$\Gg$-principal homogeneous space} is a sheaf of sets $\Xx$ on $X$ with a morphism
	\begin{align*}
		\Gg\times \Xx\morphism\Xx
	\end{align*}
	of sheaves of sets indicated by $(g,\xi)\mapsto g\cdot \xi$, with the property that $1_{\Gg(U)}\cdot \xi=\xi$ and $g\cdot(h\cdot \xi)=(gh)\cdot \xi$ for $g,h\in\Gg(U)$ and $\xi\in\Xx(U)$ and such that $\Xx_x\neq \emptyset$ for any $x\in X$ and the action of $\Gg_x$ on $\Xx_x$ is simply transitive for each $x\in X$.
	
	The torsor is called \defemph{trivial} if $\Xx(X)\neq \emptyset$ (and \emph{yes}, the $\neq$ is correct here).
\end{defi}
\begin{example}
	$\Gg$ with its group multiplication is a $\Gg$-torsor and trivial as $1_{\Gg(X)}\in\Gg(X)$.
\end{example}
\begin{rem}
	\begin{alphanumerate}
		\item \lbl{rem:torsorIsoStuff}If $\xi\in\Xx(X)$ then 
		\begin{align*}
			\Gg&\morphism\Xx\\
			g\in\Gg(U)&\longmapsto g\cdot \xi|_U
		\end{align*}
		is an isomorphism (by the simple transitivity stuff it is an isomorphism on stalks).
		\item If $\Xx$ and $\Yy$ are $\Gg$-torsors then any morphism $\Xx\morphism[f]\Yy$ of sheaves of sets compatible with the $\Gg$-actions induces isomorphisms on stalks, i.e., is automatically an isomorphism of sheaves. Thus, the category of $\Gg$-torsors is a \emph{groupoid} -- a category, in which every morphism is an isomorphism.
		\item I think the following should be pointed out separately (though it wasn't in the lecture). Let $\Xx$ be a $\Gg$-torsor, $U\subseteq X$ open. Then $\Gg(U)$ acts simply transitively on $\Xx(U)$. Indeed, if $\Xx(U)=\emptyset$ this is trivial. Otherwise, $\Xx|_U$ is a trivial $\Gg|_U$-torsor by \itememph{a} and the assertion is just as trivial. 
		
		For $\xi,\upsilon\in\Gg(U)$ the unique element $g$ such that $g\cdot \upsilon=\xi$ will be denoted $g=\frac{\xi}{\upsilon}$ (or $\xi-\upsilon$, if the $\Gg$-action is written additively).
	\end{alphanumerate}		
\end{rem}
\begin{example}
	\begin{alphanumerate}
		\item \lbl{ex:torsorsVectorBundles}Let $(X,\Oo_X)$ be a ringed space. If $\Ll$ is a \emph{line bundle} on $X$ (i.e., a locally free $\Oo_X$-module of rank $1$) then
		\begin{align*}
			U\mapsto \Ll^\times(U)&=\left\{\ell\in\Ll(U)\st \Oo_U\morphism[\cdot \ell]\Ll|_U\text{ is an isomorphism}\right\}\\
			&=\left\{\ell\in\Ll(U)\st 
			\begin{array}{c}
				\text{the image of }\ell \text{ in }\Ll_x\text{ is a generator of}\\
				\text{that free }\Oo_{X,x}\text{-module for all }x\in U
			\end{array}
			\right\}
		\end{align*}
		is an $\Oo_X^\times$-torsor when equipped with the $\Oo_X^\times$-action given by $(f,\ell)\mapsto f\cdot \ell$.
		
		If $(X,\Oo_X)$ is locally ringed with maximal ideals $\mm_x\subseteq \Oo_{X,x}$ and $\ell\in\Ll(U)$ for some open subset $U\subseteq X$, we put
		\begin{align*}
			V(\ell)=\left\{x\in U\st (\text{image of }\ell\text{ in }\Ll_x)\in\mm_x\Ll_x\right\}\;.
		\end{align*}
		If $\lambda\in\Ll(U)$ happens to be a free generator of $\Ll|_U$, then $V(\ell)$ coincides with $V\left(\frac{\ell}{\lambda}\right)$, the latter vanishing set being taken in $\Oo_X$ as usual (that is, as in \cite[Definition~1.3.3]{alg1}). Then
		\begin{align*}
			\Ll^\times (U)=\left\{\ell\in\Ll(U)\st V(\ell)=\emptyset\right\}\;.
		\end{align*}
		The line bundle $\Ll$ is trivial iff $\Ll^\times$ has a global section, i.e., iff it's a \emph{trivial} torsor in  the sense of Definition~\reff{def:torsor}. It is obvious that for an isomorphism $\phi\colon \Ll\isomorphism\Mm$ of line bundles, we have an isomorphism $\Phi\colon \Ll^\times \isomorphism\Mm^\times$ sending $\ell\in\Ll^\times(U)$ to $\phi(\ell)\in\Mm^\times (U)$. Vice versa, if $\Phi\colon \Ll^\times \isomorphism\Mm^\times $ is an isomorphism of $\Oo_X^\times$-torsors (or just a morphism -- it's automatically an isomorphism by Remark~\reff{rem:torsorIsoStuff}\itememph{b}), there is a unique isomorphism $\phi\colon \Ll\isomorphism\Mm$ such that $\Phi(\ell)=\phi(\ell)$ for all open $U\subseteq X$ and $\ell\in\Ll^\times(U)$.
		
		We thus get a bijection between the isomorphism classes of line bundles and the isomorphism classes of $\Oo_X^\times$-torsors. As was pointed out, we need to check that every $\Oo_X^\times$-torsor is given as $\Ll^\times$ for some line bundle $\Ll$. If $\Xx$ is an $\Oo_X^\times$-torsor, define $\Ll$ as the sheafification of the presheaf of sets, which for open $U\subseteq X$ is given by
		\begin{align*}
			U\mapsto \left\{(f,\xi)/_\sim\st f\in\Oo_X(U)\text{ and }\xi\in\Xx(U)\right\}\;,
		\end{align*}
		where the equivalence relation $\sim$ is defined by $(f,\xi)\sim (g,\upsilon)$ iff $f=g\cdot\frac{\xi}{\upsilon}$. Then $\Ll$ becomes an $\Oo_X$-module via $h\cdot (f,\xi)/_\sim=(fh,\xi)/_\sim$ and $(f,\xi)/_\sim+(g,\upsilon)/_\sim=\left(g+f\cdot \frac{\xi}{\upsilon},\upsilon\right)/_\sim$.
		\item Let $(X,\Oo_X)$ be a locally ringed space again. Define a sheaf $\GL_n(\Oo_X)$ by
		\begin{align*}
			\GL_n(\Oo_X)(U)&=\left\{g\in\Oo_X(U)^{n\times n}\st V(\det g)=\emptyset\right\}\\
			&=\left\{g\in\Oo_X(U)^{n\times n}\st g\text{ has an inverse matrix}\right\}
		\end{align*}
		Then there is a similar bijection
		\begin{align*}
			\left\{\begin{array}{c}
				\text{isomorphism classes of }n\text{-dimen-}\\
				\text{sional vector bundles on }X
			\end{array}
			\right\} & \isomorphism\left\{\begin{array}{c}
			\text{isomorphism classes of}\\
			\GL_n(\Oo_X)\text{-torsors}
			\end{array}
			\right\}\\
			[\Ee]&\longmapsto \left[\left\{e\in\Ee(U)^n\st 
			\begin{array}{c}
			e\text{ is a vector of free}\\
			\text{generators of }\Ee|_U
			\end{array}
			\right\}\right]\;,
		\end{align*}
		where $\GL_n(\Oo_X)$ acts by right multiplication with the column vector $e$.
	\end{alphanumerate}
\end{example}
Let $\Gg$ be a sheaf of abelian groups, $\Xx$ a $\Gg$-torsor, $\Uu\colon X=\bigcup_{i\in I}U_i$ an open cover such that $\Xx|_{U_i}$ is trivial (we will then say that $\Xx$ is trivial on $\Uu$). To be compatible with our notation for \vC ech cohomology we will write the $\Gg$-action on $\Xx$ additively. If $\xi_i\in\Xx(U_i)$ for all $i\in I$ are given, there are unique $\psi_{i,j}\coloneqq \xi_i|_{U_{i,j}}-\xi_j|_{U_{i,j}}\in\Gg(U_{i,j})$ as in Remark~\reff{rem:torsorIsoStuff}\itememph{c}. Let $\psi=(\psi_{i,j})_{(i,j)\in I^2}\in\check{C}^1(\Uu,\Gg)$. One easily verifies the correctness of the formal calculation
\begin{align*}
	(\hacek{d}^1\psi)_{i,j,k}&=\psi_{j,k}|_{U_{i,j,k}}-\psi_{i,k}|_{U_{i,j,k}}+\psi_{i,j}|_{U_{i,j,k}}\\
	&=\left(\xi_j|_{U_{i,j,k}}-\xi_k|_{U_{i,j,k}}\right)-\left(\xi_i|_{U_{i,j,k}}-\xi_k|_{U_{i,j,k}}\right)+\left(\xi_i|_{U_{i,j,k}}-\xi_j|_{U_{i,j,k}}\right)\\
	&=0\;,
\end{align*}
that is, $\psi$ is a cocycle.

\begin{prop}
	\begin{alphanumerate}
		\item \lbl{prop:torsorsH1Bij}The cohomology class $[\psi]\in \check{H}^1(\Uu,\Gg)$ depends only on the isomorphism class of the $\Gg$-torsor $\Xx$, not on the choice of trivializations.
		\item One gets a bijection between the isomorphism classes of $\Gg$-torsors trivial on $\Uu$ and $\check{H}^1(\Uu,\Gg)$.
	\end{alphanumerate}
\end{prop}
\begin{proof}
	Part \itememph{a}. If $\snake{\xi}$ is another trivialization yielding $\snake{\psi}_{i,j}=\snake{\xi}_i|_{U_{i,j}}-\snake{\xi}_j|_{U_{i,j}}$, then $\snake{\xi}_i=\gamma_i+\xi_i$ where $\gamma_i=\snake{\xi}_i-\xi_i\in\Gg(U_i)$ (Remark~\reff{rem:torsorIsoStuff}\itememph{c}) and putting $\gamma=(\gamma_i)_{i\in I}\in \check{C}^0(\Uu,\Gg)$ we get $\snake{\psi}=\hacek{d}^0\gamma+\psi$.
	
	Part \itememph{b}. By \itememph{a} it is clear that we have a map from isomorphism classes of $\Gg$-torsors trivial on $\Uu$ to $\check{H}^1(\Uu,\Gg)$. To construct a converse map, let $\eta\in \check{H}^1(\Uu,\Gg)$ and let $\psi\in\check{C}^1(\Uu,\Gg)$ be a representative of $\eta$ (so that $\hacek{d}^1\psi =0$) and let $\Xx_\psi$ be the sheaf of sets on $X$ given by
	\begin{align*}
		\Xx_\psi(V)=\left\{\gamma\in \check{C}^0(\Uu\cap V,\Gg|_V)\st \hacek{d}^0\gamma=\psi|_V\right\}\;.
	\end{align*}
	We get a $\Gg$-action on $\Xx_\psi$ via $g+\gamma=(g|_{U_i\cap V}+\gamma_i)_{i\in I}$ for $g\in\Gg(V)$, $\gamma\in\check{C}^0(\Uu\cap V,\Gg)$. We verify that $\Gg$ acts simply transitively on stalks and that $\Xx$ trivializes on $\Uu$. Note that if $\gamma,\gamma'\in \Xx(V)$, then $\hacek{d}^0(\gamma-\gamma')=0$, hence $\gamma-\gamma'\in\check{C}^0(\Uu\cap V,\Gg)$ corresponds to (unique) element of $\Gg(V)$. So the action on $\Xx_\psi(V)$ is simply transitive for every $V\subseteq X$ open and the only thing left to check is triviality on $\Uu$. For this, note that $\check{H}^1(\Uu\cap U_i,\Gg|_{U_i})=0$ by Corollary~\reff{cor:refinementPullback}\itememph{c}, so $\psi|_{U_i}$ has a preimage in $\check{C}^0(\Uu\cap U_i,\Gg)$ and consequently $\Xx_\psi(U_i)\neq\emptyset$. In particular, the stalks $(\Xx_\psi)_x$ are non-empty and $\Xx_\psi$ is a $\Gg$-torsor trivial on $\Uu$.
	
	If $\snake{\psi}=\psi+\hacek{d}^0\phi$ with $\phi\in\check{C}^0(\Uu,\Gg)$ then we have an isomorphism of $\Gg$-torsors
	\begin{align*}
		\Xx_\psi&\isomorphism\Xx_{\snake{\psi}}\\
		\gamma\in\Xx_\psi(V) &\mapsto \gamma+\phi|_V\;.
	\end{align*}
	Therefore, we get a map in the opposite direction
	\begin{align*}
		\check{H}^1(\Uu,\Gg)&\morphism\left\{\begin{array}{c}
			\text{isomorphism classes of}\\
			\Gg\text{-torsors trivial on }\Uu
		\end{array}\right\}\\
		\eta=[\psi]&\longmapsto[\Xx_\psi]\;.
	\end{align*}
	We claim that the maps we constructed from $\check{H}^1(\Uu,\Gg)$ to the set of isomorphism classes of $\Uu$-trivial $\Gg$-torsors and vice versa are inverse to each other. 
	
	Indeed, we may choose $\xi_i\in\Xx_\psi(U_i)$ such that $(\xi_i)_j=\psi_{ij}$ -- using $\hacek{d}^1\psi=0$ they indeed satisfy $\hacek{d}^0\xi_i=\psi|_{U_{i,j}}$ -- and using $\hacek{d}^1\psi=0$ again we find $\xi_i|_{U_{i,j}}-\xi_j|_{U_{i,j}}=\psi_{i,j}$. So we send $[\Xx_\psi]$ to the cohomology class $[\psi]$ and then back to $[\Xx_\psi]$.
	
	And for the other direction, if an arbitrary $\Uu$-trivial $\Gg$-torsor $\Xx$ is given, choose trivializations $\xi_i\in\Xx(U_i)$ and put $\psi=(\xi_i|_{U_{i,j}}-\xi_j|_{U_{i,j}})_{(i,j)\in I^2}\in\check{C}^1(\Uu,\Gg)$. Then we get an isomorphism $\Xx\isomorphism\Xx_\psi$ via
	\begin{align*}
		\Xx(V)&\morphism \Xx_\psi(V)\\
		\upsilon &\longmapsto \left(\xi_i|_{U_i\cap V}-\upsilon|_{U_i\cap V}\right)_{i\in I}\in\check{C}^1(\Uu\cap V,\Gg)
	\end{align*}
	(this is a morphism of $\Gg$-torsors, hence an isomorphism by Remark~\reff{rem:torsorIsoStuff}\itememph{b}), so $[\Xx]$ is mapped to $[\psi]$ and then back to $[\Xx_\psi]=[\Xx]$ again.
\end{proof}
\begin{rem*}
	When $\Gg$ is any sheaf of groups on $X$, one can define $H^1(X,\Gg)$ as the set of isomorphism classes of $\Gg$-torsors on $X$. This is a pointed set, the base point being the isomorphism class of the trivial torsor. Thus, the isomorphism classes of line bundles and of $n$-dimensional vector bundles on $X$ are in canonical bijection with $H^1(X,\Oo_X^\times)$ and $H^1(X,\GL_n(\Oo_X))$ respectively by Example~\reff{ex:torsorsVectorBundles}.
\end{rem*}
\begin{cor}
	If $X$ is an affine scheme, $\Mm$ a quasi-coherent $\Oo_X$-module and $\Xx$ an $\Mm$-torsor on $X$, then $\Xx$ is trivial.
\end{cor}
\begin{proof}
	Let $\Uu$ be an open cover of $X$ on which $\Xx$ trivializes. We may replace $\Uu$ by an affine refinement. Then $\check{H}^1(\Uu,\Mm)=H^1(X,\Mm)=0$ by Theorem~\reff{thm:CohoOnSchemes}\itememph{a} and \itememph{b}, proving that $\Xx$ is trivial by Proposition~\reff{prop:torsorsH1Bij}\itememph{b}.
\end{proof}
Let $X$ be an $S$-prescheme (cf.\ \cite[Definition~1.5.7]{alggeo1}). Recall the construction of the sheaf of Khler differentials $\Omega_{X/S}$ from exercise 5 on sheet \#5 from Algebraic Geometry I. We have a homomorphism of abelian groups
\begin{align*}
	d_{X/S}\log\colon\Oo_X^\times &\morphism \Omega_{X/S}\\
	f&\longmapsto d_{X/S}\log f=\frac{d_{X/S}f}{f}
\end{align*}
defining a morphism of \vC ech cohomology groups $\check{H}^1(X,\Oo_X^\times)\morphism \check{H}^1(X,\Omega_{X/S})$. When no open cover is specified, we put 
\begin{align*}
	\check{H}^1(X,\Ff)=\colimit[\Uu]\check{H}^1(\Uu,\Ff)
\end{align*}
for a presheaf $\Ff$ on $X$, where the colimit is taken over all open covers $\Uu$ of $X$, partially ordered by refinement. We have to use \vC ech cohomology here since we don't have any other available, unless $X$ is a quasi-compact scheme and $\Ff$ a quasi-coherent $\Oo_X$-module. In this case, the affine open covers are cofinal in the poset of open covers and $\check{H}^1(X,\Ff)=H^1(X,\Ff)$ is what we expect.
\begin{defi}
	Let $\Ll$ be line bundle on $X$. The image under the above map of the element of $\check{H}^1(X,\Oo_X^\times)$ associated to the torsor $\Ll^\times$ by Proposition~\reff{prop:torsorsH1Bij}\itememph{b} is called the \defemph{first Chern class} of $\Ll$ and is denoted
	\begin{align*}
		c_1(\Ll)\in \check{H}^1(X,\Omega_{X/S})\;.
	\end{align*}
\end{defi}
\begin{defi}
	Let $\Vv$ and $\Ww$ be vector bundles on the locally ringed space $(X,\Oo_X)$. An \defemph{extension} of $\Ww$ by $\Vv$ is a short exact sequence 
	\begin{align*}
		0\morphism \Vv\morphism[a]\Ee\morphism[b]\Ww\morphism 0\;.
	\end{align*}
	A \defemph{morphism of extensions} is a commutative diagram
	\begin{diagram*}
		\node[ob] (A) at (0,1.5) {$0$};
		\node[ob] (B) at (1.5,1.5) {$\Vv$};
		\node[ob] (C) at (3,1.5) {$\Ee$};
		\node[ob] (D) at (4.5,1.5) {$\Ww$};
		\node[ob] (E) at (6,1.5) {$0$};
		\node[ob] (A') at (0,0) {$0$};
		\node[ob] (B') at (1.5,0) {$\Vv$};
		\node[ob] (C') at (3,0) {$\Ee'$};
		\node[ob] (D') at (4.5,0) {$\Ww$};
		\node[ob] (E') at (6,0) {$0$};
		\scriptsize
		\draw[->] (A) -- (B);
		\draw[->] (B) -- (C) node[pos=0.5,above] {$a$};
		\draw[->] (C) -- (D) node[pos=0.5,above] {$b$};
		\draw[->] (D) -- (E);
		\draw[->] (A') -- (B');
		\draw[->] (B') -- (C') node[pos=0.5,above] {$a'$};
		\draw[->] (C') -- (D') node[pos=0.5,above] {$b'$};
		\draw[->] (D') -- (E');
		\draw[transform canvas={xshift=1pt}] (B) -- (B');
		\draw[transform canvas={xshift=-1pt}] (B) -- (B');
		\draw[->] (C) -- (C') node[pos=0.5, left] {$\epsilon$};
		\draw[transform canvas={xshift=1pt}](D) -- (D');
		\draw[transform canvas={xshift=-1pt}](D) -- (D');
	\end{diagram*}
\end{defi}
Note that $\epsilon$ in the above diagram is automatically an isomorphism. Indeed, this follows immediately from the five lemma in the abelian category $\cat{Mod}(\Oo_X)$.

For sheaves $\Ff$ and $\Gg$ on a topological space $X$, we get another sheaf on $X$ via 
\begin{align*}
	U\longmapsto \Hom_{\cat{Sh}(U)}(\Ff|_U,\Gg|_U)\quad\text{for open subsets }U\subseteq X\;.
\end{align*}
This sheaf is denoted $\Hhom(\Ff,\Gg)$. If $\Rr$ is  a sheaf of rings on $X$ and $\Ff$ and $\Gg$ are $\Rr$-modules, we can restrict to homomorphisms respecting the $\Rr$-module structures and obtain a sheaf $\Hhom_\Rr(\Ff,\Gg)$ by $\Hhom_{\Rr}(\Ff,\Gg)(U)=\Hom_{\cat{Mod}(\Rr|_U)}(\Ff|_U,\Gg|_U)$ for $U\subseteq X$ open.
\begin{prop}\lbl{prop:TorsorsExtensions}
	Let $(X,\Oo_X)$ be a locally ringed space and $\Vv,\Ww$ vector bundles on $X$. Associating to any extension $\Ee$ of $\Ww$ by $\Vv$ the $\Hhom_{\Oo_X}(\Ww,\Vv)$-torsor $\Xx$ given by
	\begin{align*}
		\Xx(U)=\left\{\text{morphisms }\Ee|_U\morphism[\pi]\Vv|_U\text{ of }\Oo_U\text{-modules}\st \pi a=\id_{\Vv|_U}\right\}
	\end{align*}
	for $U\subseteq X$ open, whose $\Hhom_{\Oo_X}(\Ww,\Vv)$-action is given by $h\in\Hom_{\cat{Mod}(\Oo_U)}(\Ww|_U,\Vv|_U)$ sending $\pi$ to $\pi+h b$) is an equivalence of groupoids between extensions of $\Ww$ by $\Vv$ and $\Hhom_{\Oo_X}(\Ww,\Vv)$-torsors on $X$.
\end{prop}
Franke didn't prove this in the lecture. For the sake of completeness, however, I will do my best to sketch the important steps.
\begin{proof}[Sketch of a proof]
	Denote $\Hh=\Hhom_{\Oo_X}(\Ww,\Vv)$ for short and let $\Xx_\Ee$ be the $\Hh$-torsor associated to an extension $\Ee$. Let's first give an argument why $\Xx_\Ee$ is even an $\Hh$-torsor. If $\pi,\pi'\in\Xx_\Ee(U)$ are two sections of $a$ on $U$, then $(\pi-\pi')a=0$, hence $\pi-\pi'$ factors uniquely over the cokernel of $\Vv_U\morphism[a]\Ee|_U$, which is $\Ww|_U$. That is, there is a unique morphism $\Ww|_U\morphism[h]\Vv|_U$ of $\Oo_U$-modules such that $\pi-\pi'=hb$. This shows that $\Hh(U)$ acts simply transitively on $\Xx_\Ee(U)$. It remains to show that the stalks $\Xx_{\Ee,x}$ are non-empty. But $\Vv$ and $\Ww$ are vector bundles, so every $x\in X$ has a neighbourhood $U$ in which $\Ww|_U$ and $\Vv|_U$ are free $\Oo_U$-modules. In particular, $\Ww|_U$ is projective and the extension $\Ee|_U$ is split, i.e., $\Ee|_U\cong \Ww|_U\oplus \Vv|_U$. Then $\Xx_\Ee(V)$ is non-empty for all open subsets $V\subseteq U$, hence $\Xx_{\Ee,x}\neq \emptyset$.
	
	Now about the functoriality properties. To a morphism $\Ee\morphism[\epsilon]\Ee'$ of extensions we associate the morphism $\Xx_\Ee\morphism\Xx_{\Ee'}$ which takes $\pi\in\Xx_\Ee(U)$ to $\epsilon^{-1}\pi\in\Xx_{\Ee'}(U)$ (recall that $\epsilon$ is automatically an isomorphism; we could have taken $\epsilon\pi$ instead to get a contravariant equivalence of groupoids). This gives a functor $\Phi$ from the groupoid of extensions of $\Ww$ by $\Vv$ to the groupoid of $\Hh$-torsors. 
	
	We show fully faithfulness first. Faithfulness of $\Phi$ is straightforward: If $\epsilon,\epsilon'\colon \Ee\morphism\Ee'$ are morphisms of extensions such that $\Phi(\epsilon)=\Phi(\epsilon')$, then choose an open cover $\Uu\colon X=\bigcup_{i\in I}U_i$ on which $\Vv$ and $\Ww$ trivialize (i.e., $\Vv|_{U_i}$ is a free $\Oo_{U_i}$-module for all $i\in U$ and same for $\Ww$). Then $\Ee|_{U_i}\cong \Ww|_{U_i}\oplus \Vv|_{U_i}$ is a split extension (and same for $\Ee'|_{U_i}$), hence the $\Xx_\Ee(U_i)$ are non-empty and we may choose $\pi_i\in \Xx_\Ee(U_i)$ for all $i\in I$. From $\epsilon^{-1}\pi_i=(\epsilon')^{-1}\pi_i$ and splitness of $\Ee|_{U_i},\Ee'|_{U_i}$ it's easy to deduce $\epsilon=\epsilon'$ on $U_i$. Since the $U_i$ cover $X$, this holds on all of $X$ and we are done.
	
	Now suppose $\Xx_\Ee\morphism[\phi]\Xx_{\Ee'}$ is a morphism of $\Hh$-torsors. We need to construct a morphism $\Ee\morphism[\epsilon]\Ee'$ of extensions such that $\Phi(\epsilon)=\phi$. If $\pi\in\Xx_\Ee(U)$ is a section of $a$ on $U$, then $\pi$ and $\phi(\pi)$ induce splittings $\Ee|_U\cong \Ww|_U\oplus\Vv|_U\cong \Ee'|_U$, which immediately gives a morphism $\Ee|_U\morphism[\epsilon_U]\Ee'|_U$ of extensions of $\Ww|_U$ by $\Vv|_U$. It can be easily checked that $\epsilon_U$ is actually independent of $\pi$. So choosing a trivializing open cover $\Uu$ as above, we get $\epsilon_{U_i}$ for all $i\in I$ which can be glued together (by naturality of their construction) to a morphism $\Ee\morphism[\epsilon]\Ee'$ which indeed satisfies $\Phi(\epsilon)=\phi$.
	
	And essential surjectivity. Let $\Xx$ be an $\Hh$-torsor. To construct an extension $\Ee$ such that $\Xx\cong \Xx_\Ee$, the idea is -- of course -- to choose $\Ee|_U\cong \Ww|_U\oplus\Vv|_U$ on small neighbourhoods where $\Xx$ trivializes, and then to glue them together somehow. Actually we will take the smallest possible ``neighbourhoods'' -- the stalks $\Ee_x\cong\Ww_x\oplus\Vv_x$ and impose a suitable coherence condition. To do this, choose an element $\pi_x\in\Xx_x$ for every $x\in X$ and put
	\begin{align*}
	\Ee(U)=\left\{e=(w_x,v_x)_{x\in U}\in \prod_{x\in U}\Ww_x\oplus\Vv_x\st\begin{array}{c}
	e\text{ fulfills the \emph{cohe-}}\\
	\text{\emph{rence condition}\texttrademark}
	\end{array}\right\}\;,
	\end{align*}
	where the \emph{coherence condition}\texttrademark\ says that every $x\in U$ has a neighbourhood $V\subseteq U$ on which $\pi_x$, $w_x$ and $v_x$ have preimages $\pi_V\in \Xx(V)$, $w_V\in\Ww(V)$ and $v_V\in\Vv(V)$ such that the following holds: $\pi_{V,y}$, $w_{V,y}$ and $v_{V,y}$ denote the respective images in $\Xx_y$, $\Ww_y$ and $\Vv_y$, then $w_y=w_{V,y}$ and $v_y=v_{V,y}+h(w_y)$, where $h=\pi_y-\pi_{V,y}\in\Hh_y$. It is possible to show that this indeed defines an extension of $\Ww$ by $\Vv$ and that $\Xx\cong\Xx_\Ee$.
\end{proof}

\chapter{Cohomology of projective spaces}
\section{Regular sequences and the Koszul complex}
We will use the following conventions: 
\begin{defi}
	\begin{alphanumerate}
		\item \lbl{def:cone}For a cochain complex $(C^\bullet, d_{C}^\bullet)$ let the \defemph{shift} $C[p]^\bullet$ be the cochain complex defined by $C[p]^q=C^{p+q}$ and whose differential $d_{C[p]}^\bullet$ is given by $d_{C[p]}^q=(-1)^pd_{C}^{p+q}$.
		\item Let $A^\bullet\morphism[\phi]B^\bullet$ be a morphism of cochain complexes. Then the \defemph{cone} $\Cone(\phi)$ is the cochain complex defined by 
		\begin{align}\lbl{eq:cone}
			\Cone(\phi)^p=B^p\oplus A^{p+1}\quad\text{and}\quad d_{\Cone(\phi)}^p(b,a)=\left(d_B^p(b)+\phi(a),-d_A^{p+1}(a)\right)\;.
		\end{align}
	\end{alphanumerate}
\end{defi}
\begin{rem}
	\begin{alphanumerate}
		\item Obviously, $H^q(C[p]^\bullet)=H^{p+q}(C^\bullet)$.
		\item Note that $d^\bullet=d_{\Cone(\phi)}^ \bullet$ is indeed a differential of cochain complexes, as
		\begin{align*}
			d^{p+1}d^p(b,a)&=d^{p+1}\left(d_B^p(b)+\phi(a),-d_A^{p+1}(a)\right)\\
			&=\left(d_B^{p+1}d_B^p(b)+d_B^{p+1}\phi(a)-\phi d_A^{p+1}(a),d_A^{p+2}d_A^{p+1}(a)\right)\\
			&=0\;.
		\end{align*}
		\item We get a short exact sequence
		\begin{align*}
			0\morphism B^\bullet\morphism\Cone(\phi)\morphism A[1]^\bullet\morphism 0
		\end{align*}
		of cochain complexes. The connecting homomorphism $H^{p+1}(A^\bullet)=H^p(A[1]^\bullet)\morphism[\partial]H^{p+1}(B^\bullet)$ coincides with the morphism induced by $\phi$. We thus get a long exact cohomology sequence
		\begin{align}\lbl{eq:MappingConeSeq}
			\ldots\morphism H^p(A^\bullet)\morphism[\phi]H^p(B^\bullet)\morphism H^p(\Cone(\phi))\morphism H^{p+1}(A^\bullet)\morphism\ldots\;.
		\end{align}
		In particular, $\phi$ induces isomorphisms on cohomology iff $H^\bullet(\Cone(\phi))$ vanishes.
	\end{alphanumerate}
\end{rem}
Naturally arising in the computation of cohomology of projective spaces, \emph{regular sequences} are interesting enough to be studied on their own.
\begin{defi}
	Let $R$ be a ring and $M$ an $R$-module. A sequence $(x_0,\ldots,x_n)$ of elements of $R$ is called \defemph{$M$-regular} if for $i=0,\ldots,n$
	\begin{align*}
		M/(x_0M+\ldots+x_{i-1}M)\morphism[x_i\cdot]M/(x_0M+\ldots+x_{i-1}M)
	\end{align*}
	is an injective map. A \defemph{regular sequence} in $R$ is an $M$-regular sequence where $M=R$.
\end{defi}
\begin{example}
	\begin{alphanumerate}
		\item \lbl{ex:(X0Xn)regular}If $A$ is any ring and $R=A[X_0,\ldots,X_n]$, then the sequence $(X_0,\ldots,X_n)$ is $R$-regular. Indeed, $R/(X_0R+\ldots+X_{i-1}R)\cong A[X_i,\ldots,X_n]$ and multiplication by $X_i$ in the polynomial ring $A[X_i,\ldots,X_n]$ is clearly injective.
		\item The sequence $(1,0)$ is always regular, but $(0,1)$ is only regular when $R=0$.
	\end{alphanumerate}
\end{example}
In the following, let $[n]=\{0,\ldots,n\}$. We follow the usual convention that $[n]^0=*$ is a singleton (i.e., a set with only one element).
\begin{defi}\lbl{def:KoszulComplex}
	Let $R$ be a ring, $M$ be an $R$-module, $(x_0,\ldots,x_n)$ a sequence of elements of $R$. The \defemph{Koszul complex} $K^\bullet\big((x_0,\ldots,x_n),M\big)$ is a cochain complex defined as follows. For $m\geq0$, let $K^m\big((x_0,\ldots,x_n),M\big)$ be the collection of maps $f\colon [n]^m\morphism M$ with the following properties:
	\begin{alphanumerate}
		\item $f(i_1,\ldots,i_m)=0$ when $i_k=i_\ell$ for some integers $1\leq k<\ell\leq m$.
		\item $f\left(i_{\pi(1)},\ldots,i_{\pi(m)}\right)=\sgn(\pi)f(i_1,\ldots,i_m)$ for every permutation $\pi\in\SS_m$.
	\end{alphanumerate}
	The differential $d^m\colon K^m\big((x_0,\ldots,x_n),M\big)\morphism K^{m+1}\big((x_0,\ldots,x_n),M\big)$ is given by 
	\begin{align*}
		d^mf=\sum_{j=0}^m(-1)^jd_jf\quad\text{where}\quad d_jf(i_1,\ldots,i_{m+1})=x_{i_{j+1}}f(i_1,\ldots,\hat{i}_{j+1},\ldots,i_{m+1})\;.
	\end{align*}
	As in Definition~\reff{def:cech}, the hat $\hat{i}_{j+1}$ denotes the omission of $i_{j+1}$.
\end{defi} 
Since $[n]^0=*$,  we see that $K^0\big((x_0,\ldots,x_n),M\big)=M$ and $d^0\mu$ for $\mu\in M$ becomes the \emph{coaugmentation} given by $d^0\mu(i)=x_i\mu$ for $i=0,\ldots,n$.
\begin{rem}
	 Before we check that $K^\bullet\big((x_0,\ldots,x_n),M\big)$ is indeed a cochain complex, let's answer the question \emph{how on earth} Definition~\reff{def:KoszulComplex} is related to the definition you may find in the literature (e.g., \cite[p.~423]{eisenbudCommAlg})? Well, they are equivalent (duh!) and here is how.
	 
	 Let $0\leq\ell_1<\ldots< \ell_m\leq n$ and $\delta_{\ell_1,\ldots,\ell_m}\colon [n]^m\morphism R$ be the map satisfying 
	 \begin{align*}
	 	\delta_{\ell_1,\ldots,\ell_m}(i_1,\ldots,i_m)=\begin{cases}
		 	\sgn(\pi) & \text{when }(i_1,\ldots,i_m)=(\ell_{\pi(1)},\ldots,\ell_{\pi(m)})\text{ for }\pi\in\SS_{m}\\
		 	0 & \text{when }(i_1,\ldots,i_m)\text{ is no permutation of }(\ell_1,\ldots,\ell_m)
	 	\end{cases}\;.
	 \end{align*}
	  Clearly, $K^m\big((x_0,\ldots,x_n),M\big)$ is generated by the $\delta_{\ell_1,\ldots,\ell_m}\cdot \mu$ for $\mu\in M$. For $K^m(x_0,\ldots,x_n)\coloneqq K^m\big((x_0,\ldots,x_n),R\big)$ the $\delta_{\ell_1,\ldots,\ell_m}$ even form a basis and we easily get an isomorphism
	  \begin{align*}
	  	K^\bullet\big((x_0,\ldots,x_n),M\big)\cong K^\bullet(x_0,\ldots,x_n)\otimes_R M
	  \end{align*}
	  of cochain complexes. Moreover, if $e_0,\ldots,e_n$ denote the standard basis vectors of $R^{n+1}$, mapping $\delta_{\ell_1,\ldots,\ell_m}\mapsto e_{\ell_1}\wedge \cdots\wedge e_{\ell_m}$ sends a basis of $K^m(x_0,\ldots,x_n)$ to a basis of $\bigwedge^mR^{n+1}$ and we find that they are isomorphic.
	  
	  Let us also find out which map $d^m$ corresponds to. Note that $d_j\delta_{\ell_1,\ldots,\ell_m}(i_1,\ldots,i_{m+1})$ is only non-zero when $(i_1,\ldots,i_{m+1})$ is a permutation of $(k,\ell_1,\ldots,\ell_m)$ for some $k\in[n]$ with $k$ at the $(j+1)\ordinalst$ position. In this case, it takes the value $\pm x_k$, depending on the sign of the permutation of the $\ell_i$. If you think about this for a while, $d^m\delta_{\ell_1,\ldots,\ell_m}$ corresponds to $\sum_{k=0}^nx_ke_k\wedge e_{\ell_1}\wedge \ldots \wedge e_{\ell_m}$. So $d^m$ in $K^\bullet(x_0,\ldots,x_n)$ simply corresponds to the map
	  \begin{align*}
	  	(x_0,\ldots,x_n)\wedge -\colon \bigwedge^mR^{n+1}\morphism \bigwedge^{m+1}R^{n+1}\;.
	  \end{align*}
	  In $K^\bullet\big((x_0,\ldots,x_n),M\big)\cong K^\bullet(x_0,\ldots,x_n)\otimes_R M$, this just gets tensored with $M$.
	  
	  Also note that $\bigwedge^0N=R$ for every $R$-module $N$ by definition, so the above special case $m=0$ now fits naturally with the rest.
\end{rem}
\begin{rem}
	\begin{alphanumerate}
		\item \lbl{rem:FirstKoszulFacts}It is easy to check that the $d_j$ satisfy relations similar to \eqreff{eq:simplicialStuff}, \eqreff{eq:cosimplicialDegeneracies}, and \eqreff{eq:transpositions}. As in the proofs of Definition~\reff{def:cech} and Definition~\reff{def:alternatingCech}, we deduce that $d^\bullet$ preserves the antisymmetry conditions and is a differential in a cochain complex. 
		
		Alternatively, from the above considerations it's immediately clear that $d^\bullet$ is well-defined and satisfies $d^{m+1}d^m=0$, since wedging with $(x_0,\ldots,x_n)$ two times in a row obviously gives $0$.
		\item A short exact sequence of $R$-modules induces a short exact sequence of Koszul complexes. Indeed, in the representation $K^m\big((x_0,\ldots,x_n),M\big)\cong \bigwedge^mR^{n+1}\otimes_RM\cong M^{\binom{n+1}{m}}$ this is pretty obvious.
		\item Let $\phi$ be the map $\phi\colon K^\bullet\big((x_0,\ldots,x_{n-1}),M\big)\morphism[x_n\cdot]K^\bullet\big((x_0,\ldots,x_{n-1}),M\big)$. We have a canonical isomorphism
		\begin{align}\lbl{eq:KoszulCone}
			\begin{split}
				K^\bullet\big((x_0,\ldots,x_n),M\big)&\isomorphism\Cone(\phi)[-1]\\
				f\in K^m\big((x_0,\ldots,x_n),M\big)&\longmapsto \left(f(n,-)|_{[n-1]^{m-1}}, -f|_{[n-1]^{m}}\right)
			\end{split}			
		\end{align}
		(I'm pretty sure there should be a minus in the second component for the differentials to be compatible, i.e., consistent with the \emph{two} sign conventions from Definition~\reff{def:cone}\itememph{a} and \itememph{b} which are in play here, though we didn't put a minus there in the lecture). This isomorphism corresponds to the decomposition $\bigwedge^mR^{n+1}=e_n\wedge \bigwedge^{m-1}R^n\oplus \bigwedge^mR^n\cong \bigwedge^{m-1}R^n\oplus \bigwedge^mR^n$, sending $e_n\wedge y+z$ to $(y,-z)$ (and you have to tensor it with $M$, of course). If you think about this long enough, this is compatible.
	\end{alphanumerate}
\end{rem}
In the following we put $H^j\big((x_0,\ldots,n),M\big)\coloneqq H^j\left(K^\bullet\big((x_0,\ldots,x_n),M\big)\right)$ for ``short''.
\begin{example}
	\begin{alphanumerate}
		\item \lbl{ex:firstKoszulComputations}For small values of $n$, we have
		\begin{align*}
			K^\bullet\big(\emptyset,M\big)&=\Big(0\morphism M\morphism 0\morphism\ldots\Big)\\
			K^\bullet\big((x_0),M\big)&=\Big(0\morphism M\morphism[x_0\cdot] M\morphism 0\morphism\ldots\Big)\\
			K^\bullet\big((x_0,x_1),M\big)&=\Big(0\morphism M\xrightarrow{(x_0,x_1)} M\oplus M\xrightarrow{\left(\begin{smallmatrix}
			-x_1\\
			x_0
			\end{smallmatrix}\right)} M\morphism 0\morphism\ldots\Big)\;.
		\end{align*}
		\item In general, $K^\bullet((x_0,\ldots,x_n),M)$ vanishes in degrees $<0$ and $>n+1$ (as $\bigwedge^mR^{n+1}$ is only non-zero for $0\leq m\leq n+1$). The differentials  $d^0,d^n$ are given by $d^0\mu=\sum_{j=0}^nx_je_j\otimes \mu$ and $d^n\left(\sum_{j=0}^n(e_0\wedge\cdots\wedge\roof{e}_j\wedge\cdots\wedge e_n)\otimes \mu_j\right)=\sum_{j=0}^n(-1)^jx_j (e_0\wedge\cdots\wedge e_n)\otimes\mu_j$. This shows
		\begin{align*}
			H^0\big((x_0,\ldots,x_n),M\big)\cong\bigcap_{i=0}^n\ker\left(M\morphism[x_i\cdot ]M\right)
		\end{align*}
		and
		\begin{align*}
			H^{n+1}\big((x_0,\ldots,x_n),M\big)\cong M/(x_0M+\ldots+x_nM)\;.
		\end{align*}
	\end{alphanumerate}
\end{example}
\begin{fact}\lbl{fact:RegularSeqKoszulComplex}
	Let $R$ be a ring, $(x_0,\ldots,x_n)$ a sequence of elements of $R$ and $M$ an $R$-module.
	\begin{alphanumerate}
		\item Let $0\leq i\leq n$, then $(x_0,\ldots,x_n)$ is $M$-regular iff $(x_0,\ldots,x_{i-1})$ is $M$-regular and $(x_i,\ldots,x_n)$ is $M/(x_0M+\ldots+x_{i-1}M)$-regular.
		\item A sequence $(x_0,\ldots,x_n)$ is $M$-regular iff $H^j\big((x_0,\ldots,x_i),M\big)=0$ for all $i,j$ such that $0\leq i\leq n$ and $j\neq i+1$.
		\item Let $0\morphism M'\morphism M\morphism M''\morphism 0$ be a short exact sequence of $R$-modules. If $(x_0,\ldots,x_n)$ is $M'$-regular and $M''$-regular, then it is $M$-regular.
		\item If $(x_0,\ldots,x_n)$ is $M$-regular and $k_0,\ldots,k_n\in \IN$ are natural exponents, then $(x_0^{k_0},\ldots,x_n^{k_n})$ is also $M$-regular.
	\end{alphanumerate}
\end{fact}
\begin{proof}
	Part \itememph{a} is obvious. For \itememph{b}, we use induction on $n$. For $n=-1$, there is nothing to show. Now suppose that $n\geq 0$ and the assertion holds for $n-1$. From \eqreff{eq:MappingConeSeq} and \eqreff{eq:KoszulCone} we get a long exact sequence
	\begin{multline}\lbl{eq:KoszulSeq}
		\ldots\morphism H^{j-1}\big((x_0,\ldots,x_{n-1}),M\big)\morphism[x_n\cdot ] H^{j-1}\big((x_0,\ldots,x_{n-1}),M\big)\morphism H^j\big((x_0,\ldots,x_n),M\big)\\
		\morphism H^j\big((x_0,\ldots,x_{n-1}),M\big)\morphism[x_n\cdot] H^j\big((x_0,\ldots,x_{n-1}),M\big)\morphism\ldots\;.\tag{$*$}
	\end{multline}
	Suppose that $H^j\big((x_0,\ldots,x_i),M\big)$ vanishes for $0\leq i\leq n$ and $j\neq i+1$. Then $(x_0,\ldots,x_{n-1})$ is $M$-regular by induction. Using $H^{n-1}\big((x_0,\ldots,x_{n-1}),M\big)=0$ and Example~\reff{ex:firstKoszulComputations}\itememph{b}, for $j=n$ the sequence \eqreff{eq:KoszulSeq} becomes
	\begin{align}\lbl{eq:KoszulSeq2}
		0\morphism H^n\big((x_0,\ldots,x_n),M\big)\morphism M/(x_0M+\ldots+x_{n-1}M)\morphism[ x_n\cdot]M/(x_0M+\ldots+x_{n-1}M)\tag{\#}
	\end{align}
	The vanishing of $H^n\big((x_0,\ldots,x_n),M\big)$ in \eqreff{eq:KoszulSeq2} and exactness show that $x_n\cdot$ is injective on $M/(x_0M+\ldots+x_{n-1}M)$, hence $(x_0,\ldots,x_n)$ is $M$-regular.
	
	Conversely, assume that $(x_0,\ldots,x_n)$ is $M$-regular. Vanishing of $H^j\big((x_0,\ldots,x_i),M\big)$ for $0\leq i\leq n-1$ and $j\neq i+1$ follows from induction (in particular, we still get \eqreff{eq:KoszulSeq2}) and for $i=n$ and $j>n+1$ this is also clear. From \eqreff{eq:KoszulSeq} we get $H^j\big((x_0,\ldots,x_n),M\big)=0$ for $j<n$ and for $j=n$ this follows from \eqreff{eq:KoszulSeq2} and injectivity of $x_n\cdot$ on $M/(x_0M+\ldots+x_{n-1}M)$.
	
	
	Part \itememph{c} follows from \itememph{b} and the long exact cohomology sequence associated to the short exact sequence $0\morphism K^\bullet\big((x_0,\ldots,x_n),M'\big)\morphism K^\bullet\big((x_0,\ldots,x_n),M\big)\morphism K^\bullet\big((x_0,\ldots,x_n),M''\big)\morphism 0$ of Koszul complexes due to Remark~\reff{rem:FirstKoszulFacts}\itememph{b}.
	
	Part \itememph{d}. We use induction on $n$. For $n=-1$, there is nothing to show. Let $n\geq 0$ and assume that \itememph{d} holds for $n-1$ and any $R$-module $M$. Then $M/x_0^{k_0}M$ has a filtration by submodules $x_0^iM/x_0^{k_0}M$ for $i=0,\ldots,k_0$ and with filtration quotients $x_0^iM/x_0^{i+1}M$. Since $x_0\cdot$ is injective on $M$, $x_0^i\cdot$ induces an isomorphism $x_0^iM/x_0^{i+1}M\lisomorphism M/x_0M$. Since $(x_1,\ldots,x_n)$ is $M/x_0M$-regular by \itememph{a}, repeatedly applying \itememph{c} implies that $(x_1,\ldots,x_n)$ is $M/x_0^{k_0}M$-regular. By the induction assumption, $(x_1^{k_1},\ldots,x_n^{k_n})$ is $M/x_0^{k_0}$-regular as well. An application of \itememph{a} completes the proof.
\end{proof}
\begin{defi}\lbl{def:PerfectPairing}
	Let $R$ be a ring, $M$ and $N$ be finitely generated free (or projective) $R$-modules. A \defemph{perfect pairing}\footnote{Note that Professor Franke used the term \emph{non-degenerate pairing} in the lecture. However, it seems that this is not necessarily the common terminology. Non-degeneracy sometimes only means that one of $M\morphism \Hom_R(N,R)$ or $N\morphism\Hom_R(M,R)$ is injective. In particular, this is \emph{not} symmetric in $M,N$. So to avoid any ambiguity we will use the term \emph{perfect} instead.} $\langle -,-\rangle\colon M\times N\morphism R$ is a $R$-bilinear map such that one of the induced maps $M\morphism\Hom_R(N,R)$ or $N\morphism \Hom_R(M,R)$ is an isomorphism.
\end{defi}
\begin{rem*}
	Note that if $M\morphism\Hom_R(N,R)$ is an isomorphism, then so is $N\morphism\Hom_R(M,R)$. To show this, denote $L^*\coloneqq \Hom_R(L,R)$ for $R$-modules $L$. Our first claim is that for finitely generated projective $R$-modules $P$ and $f\in R$ the canonical morphism $\Hom_R(P,R)_f\morphism \Hom_{R_f}(P_f,R_f)$ is an isomorphism. Indeed, if $P$ is free, then $P\cong P^*$ and this is clear. For projective $P$, choose another finitely generated projective $R$-module $Q$ such that $P\oplus Q$ is free, then
	\begin{align*}
	\Hom_R(P,R)_f\oplus\Hom_R(Q,R)_f&\cong\Hom_R(P\oplus Q,R)_f\\
	&\cong\Hom_{R_f}(P_f\oplus Q_f,R_f)\\
	&\cong \Hom_{R_f}(P_f,R_f)\oplus \Hom_{R_f}(Q_f,R_f)
	\end{align*}
	proves this also for $P$. Thus, $N\morphism M^*$ being an isomorphism can be checked locally and we may replace $R$ by $R_f$ such that $M_f$ and $N_f$ are free. That is, we have reduced the situation to the case where $M$ and $N$ are free. Let $B=(m_1,\ldots,m_k)$ and $C=(n_1,\ldots,n_\ell)$ be bases of $M$ and $N$. Let $B^*$ and $C^*$ be the corresponding dual bases of $M^*$, $N^*$ respectively. Since $M\morphism N^*$ is an isomorphism, we must have $k=\ell$ and the coordinate matrix $A=(\langle m_j,n_i\rangle)_{i,j}$ with respect to $B$ and $C^*$ must be invertible. Then its transpose $A^T$ is the coordinate matrix of $N\morphism M^*$ with respect to the bases $C$ and $B^*$ and invertible as well, thus $N\morphism M^*$ is an isomorphism too.
\end{rem*}
\begin{cor}\lbl{cor:KoszulCoho}
	Let $A$ be any ring, $R=A[X_0,\ldots,X_n]$. The Koszul complex $K^\bullet\big((X_0^\ell,\ldots,X_n^\ell),R\big)$ is acyclic in cohomological degree $\neq n+1$. Its cohomology in dimension $n+1$ is a free $A$-module.
	
	The Koszul complex becomes a complex of graded $R$-modules via
	\begin{align*}
		K^m\big((X_0^\ell,\ldots,X_n^\ell),R\big)_k\coloneqq \left\{f\in K^m\big((X_0^\ell,\ldots,X_n^\ell),R\big)\st f([n]^m)\subseteq R_{k+\ell m}\right\}\;,
	\end{align*}
	where $R_{k+\ell m}$ denotes the degree-$(k+\ell m)$ part of $R=A[X_0,\ldots,X_n]$, and
	\begin{alphanumerate}
		\item $H^{n+1}\big((X_0^\ell,\ldots,X_n^\ell),R\big)_k=0$ when $k>-n-1$.
		\item We have an isomorphism
		\begin{align}\lbl{eq:Hn+1Iso}
			\begin{split}
				H^{n+1}\big((X_0^\ell,\ldots,X_n^\ell),R\big)_{-n-1}&\isomorphism A\\
				[f]&\longmapsto \text{coefficient of }(X_0X_1\cdots X_n)^{\ell-1}\text{ in }f(0,1,\ldots,n)
			\end{split}
		\end{align}
		(where $[f]$ denotes the cohomology class of $f\in K^{n+1}\big((X_0^\ell,\ldots,X_n^\ell),R\big)$ which is a cocycle).
		\item For $0<k<\ell$ we have a perfect pairing
		\begin{align}\lbl{eq:KoszulNonDegPairing}
			R_k\times H^{n+1}\big((X_0^\ell,\ldots,X_n^\ell),R\big)_{-n-1-k}\morphism H^{n+1}\big((X_0^\ell,\ldots,X_n^\ell),R\big)_{-n-1}\overset{\text{\eqreff{eq:Hn+1Iso}}}{\cong} A.
		\end{align}
		(simply given by multiplication).
	\end{alphanumerate}
\end{cor}
\begin{proof}
	By Example~\reff{ex:(X0Xn)regular}\itememph{a}, $(X_0,\ldots,X_n)$ is an $R$-regular sequence, hence so is $(X_0^\ell,\ldots,X_n^\ell)$ by Fact~\reff{fact:RegularSeqKoszulComplex}\itememph{d}. Hence the vanishing of $H^i\big((X_0^\ell,\ldots,X_n^\ell),R\big)$ is a consequence of Fact~\reff{fact:RegularSeqKoszulComplex}\itememph{b}. Moreover, by Example~\reff{ex:firstKoszulComputations}\itememph{b} we have 
	\begin{align*}
		H^{n+1}\big((X_0^\ell,\ldots,X_n^\ell),R\big)\cong R/(X_0^\ell,\ldots,X_n^\ell) 
	\end{align*}
	which is a free $A$-module with basis $[X_0^{\alpha_0}\cdots X_n^{\alpha_n}]=X_0^{\alpha_0}\cdots X_n^{\alpha_n}+(X_0^\ell,\ldots,X_n^\ell)$ for $0\leq\alpha_i<\ell$. The elements of this basis are homogeneous for the above grading and to get an element of homogeneous degree $-n-1$ we need $\alpha_0+\ldots+\alpha_n=-n-1+\ell(n+1)=(\ell-1)(n+1)$ and there is no other way to have this than $\alpha_i=\ell-1$ for $i=0,\ldots,n$. This proves \itememph{b}.
	
	Along the same lines we see that \itememph{a} holds. Indeed, for an element of degree $k>-n-1$ we would need $\alpha_0+\ldots+\alpha_n>(\ell-1)(n+1)$ and then there is some $\alpha_i\geq \ell$, contradiction.
	
	The pairing from \itememph{c} pairs $X_0^{\beta_0}\cdots X_n^{\beta_n}$ with $[X_0^{\alpha_0}\cdots X_n^{\alpha_n}]\in H^{n+1}\big((X_0^\ell,\ldots,X_n^\ell),R\big)_{-n-1-k}$ to a non-zero element (which is then automatically $(X_0\cdots X_n)^{\ell-1}$) iff $\alpha+\beta=(\ell-1,\ldots,\ell-1)$. For every $\alpha$ contributing to our basis of $H^{n+1}\big((X_0^\ell,\ldots,X_n^\ell),R\big)_{-n-1-k}$ the corresponding $\beta=(\ell-1,\ldots,\ell-1)-\alpha$ is an element of $\IN_0^{n+1}$ and $\beta_0+\ldots+\beta_n=k$. If $k<\ell$ and $\beta\in\IN_0^{n+1}$ satisfies $\beta_0+\ldots+\beta_n=k$, then $\beta_i\leq k\leq\ell-1$ for all components of $\beta$, hence $\alpha=(\ell-1,\ldots,\ell-1)-\beta\in\IN_0^{n+1}$ contributes to our basis of $H^{n+1}\big((X_0^\ell,\ldots,X_n^\ell),R\big)_{-n-1-k}$, showing perfectness of the pairing.
\end{proof}
And finally for a lemma which is perhaps worthwhile to know.
\begin{lem}
	Let $R$ be a noetherian local ring with maximal ideal $\mm$, $M$ a finitely generated $R$-module and $x_0,\ldots,x_n\in\mm$. Then $(x_0,\ldots,x_n)$ is $M$-regular iff $H^i\big((x_0,\ldots,x_n),M\big)=0$ for $i\neq n+1$. In particular, reordering $(x_0,\ldots,x_n)$ will again produce an $M$-regular sequence.
\end{lem}
\begin{proof}
	The \emph{only if} part being trivial after Fact~\reff{fact:RegularSeqKoszulComplex}\itememph{b}, we assume now that $H^i\big((x_0,\ldots,x_n),M\big)$ vanishes for $i\neq n+1$. From \eqreff{eq:KoszulCone} and the cone sequence \eqreff{eq:MappingConeSeq} we obtain a part of a long exact sequence
	\begin{multline*}
	H^j\big((x_0,\ldots,x_n),M\big)\morphism H^j\big((x_0,\ldots,x_{n-1}),M\big)\morphism[x_n\cdot] H^j\big((x_0,\ldots,x_{n-1}),M\big)\\
	\morphism H^{j+1}\big((x_0,\ldots,x_n),M\big)\;.
	\end{multline*}
	For $j<n$ the outer terms vanish by assumption, hence
	\begin{align*}
	H^j\big((x_0,\ldots,x_{n-1}),M\big)\morphism[x_n\cdot] H^j\big((x_0,\ldots,x_{n-1}),M\big)
	\end{align*}
	is an isomorphism. But we are working over a noetherian ring $R$ and $M$ is finitely generated, so all involved constructions are finitely generated as well. In particular, $H^j\big((x_0,\ldots,x_{n-1}),M\big)$ is finitely generated. As $x_n\in\mm$, Nakayama's lemma shows $H^j\big((x_0,\ldots,x_{n-1}),M\big)=0$ for $j<n$. For $j>n$ this holds as well, obviously. Inductively, this shows $H^j\big((x_0,\ldots,x_i),M\big)=0$ for all $i<n$ and $j\neq i+1$, hence $(x_0,\ldots,x_n)$ is regular by Fact~\reff{fact:RegularSeqKoszulComplex}\itememph{b}.			
\end{proof}

\section{The scheme \texorpdfstring{$\IP_R^n$}{P} and its cohomology}\lbl{sec:PnCoho}
\subsection{The \texorpdfstring{$\Proj$}{Proj} construction}
Let $R$ be an $\IN_0$-graded ring. Let $R_+\subseteq R$ be the ideal of elements of $R$ of positive homogeneous degree. Recall that there is a bijection
\begin{align*}
	\left\{\text{homogeneous }\pp\in\Spec R\st \pp\supseteq R_+\right\}&\isomorphism \Spec R_0\\
	\pp&\longmapsto \qq=\pp\cap R_0\\
	\pp=\qq+R_+&\longmapsfrom \qq\;.
\end{align*}
We recapitulate the construction and basic properties of $\Proj R$, which has been introduced in \cite[Definition~2.6.2]{alggeo1} and exercise sheet \#11 of Algebraic Geometry I. As a set, put
\begin{align*}
	\Proj R=\left\{\text{homogeneous }\pp\in\Spec R\st \pp\not\supseteq R_+\right\}
\end{align*}
and for $I\subseteq R$ a homogeneous ideal, let
\begin{align*}
	V_\proj(I)=V(I)=\left\{\pp\in\Proj R\st \pp\supseteq I\right\}\;.
\end{align*}
As $\bigcap_{\lambda\in\Lambda}V(I_\lambda)=V\left(\sum_{\lambda\in\Lambda}I_\lambda\right)$ and $V(I)\cup V(J)=V(I\cap J)=V(IJ)$ and $V(R)=V(R_+)=\emptyset$ and $V(0)=\Proj R$ the $V(I)$ are the closed subsets of some topology on $\Proj R$.

We define a sheaf of graded rings $\Oo=\bigoplus_{k\in\IZ}\Oo(k)$ on $P=\Proj R$ as follows. Let $\Oo(k)_{[\pp]}=(R_\pp)_k$ for homogeneous prime ideals $\pp\subseteq R$, where we use the convention that $R_\pp$ is obtained from $R$ by inverting the \defemph{homogeneous elements of $R\setminus \pp$ only (!)}. Note that the subsets of the form $P\setminus V(f)$ with $f\in R$ homogenous form a topology base of $P$. We put
\begin{align*}
	\Oo(k)(U)=\left\{(g_\pp)\in\prod_{\pp\in U}(R_\pp)_k\st\begin{array}{c}
		\text{every }x\in U\text{ has a neighbourhood }V=P\setminus V(f)\subseteq U\text{,}\\
		\text{ where }f\text{ is homogeneous,  such that there is a }\gamma\in (R_f)_k\\
		\text{with }g_\pp=\left(\text{image of }\gamma\text{ under }R_f\morphism R_\pp\right)\text{ for all }\pp\in V
	\end{array}\right\}\;.
\end{align*}
Then there are operations
\begin{align*}
	\Oo(k)\times \Oo(k)&\morphism \Oo(k)\\
	\left((f_\pp)_{\pp\in U},(g_\pp)_{\pp\in U}\right)&\longmapsto (f_\pp)_{\pp\in U}+(g_\pp)_{\pp\in U}=(f_\pp+g_\pp)_{\pp\in U}
\end{align*}
and
\begin{align*}
	\Oo(k)\times \Oo(\ell)&\morphism \Oo(k+\ell)\\
	\left((f_\pp)_{\pp\in U},(g_\pp)_{\pp\in U}\right)&\longmapsto (f_\pp)_{\pp\in U}\cdot (g_\pp)_{\pp\in U}=(f_\pp g_\pp)_{\pp\in U}	
\end{align*}
making $\Oo$ into a sheaf of graded rings with $\Oo(0)=\Oo_{\Proj R}$. Moreover, we get a map
\begin{align}\lbl{eq:ProjPretenderStalk}
	\begin{split}
		\Oo(k)_\pp&\morphism\Oo(k)_{[\pp]}\\
		\left(\begin{array}{c}
			\text{image of}\\
			(g_\qq)\in\Oo(k)(U)\text{ in }\Oo(k)_\pp
		\end{array}\right)&\longmapsto g_\pp\;.
	\end{split}\tag{$*$}
\end{align}
\begin{fact}
	The map \eqreff{eq:ProjPretenderStalk} is an isomorphism.
\end{fact}
\begin{proof}
	By Proposition~\reff{prop:FirstProjProperties}\itememph{a} and \itememph{c} below, 
	\begin{align*}
		\Oo(k)_\pp=\colimit[f\notin \pp]\Oo(k)\big(\Proj R\setminus V(f)\big)\cong \colimit[f\notin\pp](R_f)_k=(R_\pp)_k=\Oo(k)_{[\pp]}\;,
	\end{align*}
	the colimits ranging over all $f$ which are homogeneous of positive degree.
\end{proof}
\begin{prop}
	\begin{alphanumerate}
		\item \lbl{prop:FirstProjProperties}Open subsets of the form $\Proj R\setminus V(f)$ where $f\in R_k$ with $k>0$ are affine and form a topology base.
		\item Every finite subset of $\Proj R$ is contained in an affine open subset. In particular, $\Proj R$ is a scheme.
		\item The sheaf of modules $\Oo(k)$ on $\Proj R$ is quasi-coherent, and for $f\in R$ which is homogeneous of positive degree there is a homeomorphism
		\begin{align}\lbl{eq:ProjLocal}
			\begin{split}
				\Proj R\setminus V(f)&\isomorphism \Spec (R_f)_0\\
				\pp &\longmapsto \qq=\pp R_f\cap (R_f)_0\\
				\pp=\sqrt{\qq R_f}\cap R&\longmapsfrom \qq\in\Spec (R_f)_0
			\end{split}
		\end{align}
		under which $(R_\pp)_0\cong ((R_f)_0)_\qq$. We thus get an identification 
		\begin{align*}
			\Oo(0)|_{\Proj R\setminus V(f)}\cong \Oo_{\Spec (R_f)_0}\;.
		\end{align*}		
		Moreover, under \eqreff{eq:ProjLocal} there is a similar isomorphism $(R_\pp)_k\cong ((R_f)_k)_\qq$ (the latter denotes the localization of the $(R_f)_0$-module $(R_f)_k$ with respect to $\qq$, and here we don't need to restrict to homogeneous elements). This gives an identification
		\begin{align}\lbl{eq:O(k)isQC}
			\Oo(k)|_{\Proj R\setminus V(f)}\cong ((R_f)_k)^\qcmod\;.
		\end{align}
		\item When $R$ is generated by $R_1$ as an $R_0$-algebra (or equivalently, $R_+$ by $R_1$ as an ideal in $R$) the sheaves of modules $\Oo(k)$ are line bundles and the morphism 
		\begin{align*}
			\Oo(k)\otimes_{\Oo_{\Proj R}}\Oo(\ell)&\morphism\Oo(k+\ell)\\
			f\otimes g&\longmapsto fg
		\end{align*}
		is an isomorphism (the tensor product of sheaves is introduced in Remark~\reff{rem:tensorProductSheaves}).
		\item We have a morphism of preschemes $\pi\colon\Proj R\morphism \Spec R_0$ whose topological component is given by
		\begin{align}\lbl{eq:Proj(R)toSpecR0}
			\begin{split}
				\pi\colon\Proj R&\morphism \Spec R_0\\
				\pp &\longmapsto \pp\cap R_0
			\end{split}
		\end{align}
		and the algebraic component $\pi^*\colon \Oo_{\Spec R_0}\morphism \pi_*\Oo_{\Proj R}$ is defined by sending an element $rf^{-k}\in (R_0)_f\cong \Oo_{\Spec R_0}(\Spec R_0\setminus V(f))$ to precisely that element in $\Oo(0)(\Proj R\setminus V(f))$. The morphism $\pi$ is of finite type (cf.\ \cite[Definition~2.2.1]{alggeo1}) if $R$ is an $R_0$-algebra of finite type.
		\item If $R$ is noetherian (which is the case iff $R_0$ is noetherian and $R$ of finite type over $R_0$) then $\Proj R$ is noetherian (cf.\ \cite[Definition~2.2.2]{alggeo1}) and the $\Oo(k)$ are coherent.
	\end{alphanumerate}
\end{prop}
\begin{proof}
	Most of this follows from exercise sheet~\#11 of Algebraic Geometry I. We show the topology base part of \itememph{a} first: Let $I$ be a homogeneous ideal and $\pp\notin V(I)$ a homogeneous prime ideal. Then $I\setminus \pp$ contains a homogeneous element $f$. Clearly $\Proj R\setminus V(f)\subseteq \Proj R\setminus V(I)$. If $f$ has positive degree, we are done. Otherwise choose an element $g\in R_+\setminus \pp$ and replace $f$ by $fg$. The fact that the $\Proj R\setminus V(f)$ are affine follows from \eqreff{eq:ProjLocal}.
	
	For \itememph{c}, do exercise~1 and apply this to \eqreff{eq:ProjLocal}. From this, it is clear that for $M$ a graded $R$-module the sheafification $\snake{M}$ of the presheaf 
	\begin{align*}
		\Proj R\setminus V(f)\longmapsto (M_f)_0\quad\text{for }f\text{ homogeneous of positive degree}
	\end{align*}
	is quasi-coherent as it equals $((M_f)_0)^\qcmod$ on $\Proj R\setminus V(f)$ (this is actually the first part of exercise~3). Applying this to $M=R[k]$ (the shift of $R$ as in Definition~\reff{def:cone}\itememph{a}) shows that $\Oo(k)$ is quasi-coherent and \eqreff{eq:O(k)isQC} holds.
	
	Part \itememph{b}. Let $\pp_1,\ldots,\pp_n\in\Proj R$. Since $R_+$ isn't contained in any $\pp_i$, it is also not contained in the union $\bigcup_{i=1}^n\pp_i$ by the prime avoidance lemma (cf.\ \cite[Lemma~2.5.1]{alg1}). Then for any homogeneous $f\in R_+\setminus \bigcup_{i=1}^n\pp_i$, $\Proj R\setminus V(f)\cong \Spec (R_f)_0$ is a common affine open neighbourhood of $\pp_1.\ldots,\pp_n$ by \eqreff{eq:ProjLocal}. From \cite[Fact~1.5.9\itememph{a}]{alggeo1} we get that $\Proj R$ is a scheme.
	
	Part \itememph{d}. If $R_+$ is generated by $R_1$ as an ideal in $R$, a homogeneous prime ideal $\pp$ contains $R_+$ iff it contains $R_1$. Hence the $\Proj R\setminus V(f)$ for $f\in R_1$ cover $\Proj R$. On $U=\Proj R\setminus V(f)$ however, an isomorphism $\Oo_{\Proj R}|_U=\Oo(0)|_U\isomorphism \Oo(k)|_U$ is given by multiplication with $f^k$. To show that $\Oo(k)\otimes_{\Oo_{\Proj R}}\Oo(\ell)\isomorphism\Oo(k+\ell)$, it is enough to check this stalk-wise. But $\Oo(k)_\pp\cong \Oo_{\Proj R,\pp}\cong (R_\pp)_0$ holds for $\pp\in\Proj R$ as we just have seen, and similar for $\Oo(\ell)_\pp$ and $\Oo(k+\ell)_\pp$, so the isomorphism
	\begin{align*}
		\Oo(k)_\pp\otimes_{\Oo_{\Proj R,\pp}}\Oo(\ell)_\pp\isomorphism \Oo(k+\ell)_\pp
	\end{align*}
	is pretty much obvious.
	
	Part \itememph{e}. Let $\alpha_1,\ldots,\alpha_n$ be generators of $R$ as an $R_0$-algebra. Decomposing them into homogeneous components, we may assume that they are homogeneous of degrees $d_1,\ldots,d_n>0$. By \cite[Proposition~2.2.1\itememph{b}]{alggeo1}  and \itememph{c} it is enough to show that $(R_f)_0\cong\Oo_{\Proj R}(\Proj R\setminus V(f))$ is of finite type over $R_0$ for all $f\in R_+$. Let $d$ be the homogeneous degree of $f$. One may check that $(R_f)_0$ is indeed generated as an $R_0$-algebra by those
	\begin{align*}
	\alpha_1^{k_1}\cdots \alpha_n^{k_n}\cdot f^{-k}\quad\text{where }0\leq k_i<d\text{ and }0\leq k<d\cdot(d_1+\ldots+d_n)
	\end{align*}
	which have homogeneous degree $0$. 
	
	To show that $\pi$ is quasi-compact, it suffices to show quasi-compactness of $\Proj R$ by \cite[Fact~2.1.2]{alggeo1}. Since $R$ is of finite type over $R_0$, the augmentation ideal $R_+$ is finitely generated. Let $f_1,\ldots,f_n$ be homogeneous generators of $R_+$. Then the $\Proj R\setminus V(f_i)\cong \Spec (R_{f_i})_0$ cover $\Proj R$, so $\Proj R$ is a finite union of quasi-compact sets and thus quasi-compact itself.
	
	And finally part \itememph{f}. The stuff in parentheses was proved in \cite[Proposition~2.2.1]{alg2}, by the way. In \itememph{e} we have seen that $\Proj R$ is finite type over $\Spec R_0$ which is noetherian, hence $\Proj R$ is noetherian by Hilbert's Basissatz. By an argument similar to \itememph{e}, $(R_f)_k$ is finitely generated as an $(R_f)_0$-module for all $f\in R_+$, hence $\Oo(k)$ is locally finitely generated over $\Oo_{\Proj R}$ by \itememph{c} and thus coherent in the sense of Definition~\reff{def:locFinGenerated}\itememph{b}.
\end{proof}
\begin{rem}\lbl{rem:GradedSnakeM}
	For a graded $R$-module $M$ and open $U\subseteq P=\Proj R$ let 
	\begin{align*}
		\snake{M}(U)=\left\{(\mu_\pp)\in\prod_{\pp\in U}(M_\pp)_0\st\begin{array}{c}
		\text{every }x\in U\text{ has a neighbourhood }V=P\setminus V(f)\subseteq U\text{,}\\
		\text{ where }f\text{ is homogeneous,  such that there is a }m\in (M_f)_0\\
		\text{with }\mu_\pp=\left(\text{image of }m\text{ under }M_f\morphism M_\pp\right)\text{ for all }\pp\in V
		\end{array}\right\}\;.
	\end{align*}
	 This is actually the sheafification of the presheaf 
	 \begin{align*}
		 \Proj R\setminus V(f)\longmapsto (M_f)_0\quad\text{for }f\text{ homogeneous of positive degree}
	 \end{align*}
	 we have already seen in the proof if Proposition~\reff{prop:FirstProjProperties}\itememph{c}. Note that the localizations $M_\pp$ appearing here are understood to be obtained by inverting the \emph{homogeneous} elements of $R\setminus \pp$ only. On open subsets of the form $\Proj R\setminus V(f)\cong \Spec (R_f)_0$ for $f\in R_+$ homogeneous, $\snake{M}$ equals $((M_f)_0)^\qcmod$, proving that it is quasi-coherent. In the case $M=R[k]$ we obtain $\snake{M}\cong \Oo(k)$.
\end{rem}
\begin{rem}\lbl{rem:ProjFunctoriality}
	In general, the $\Proj$ construction is not functorial, not even for graded ring morphisms. However, we do have the following: If $R\morphism[\phi]S$ is a ring morphism such that there is a positive integer $d$ satisfying $\phi(R_k)\subseteq S_{dk}$ for all $k$ and such that $S_+=\sqrt{S\phi(R_+)}$, then we have a continuous map
	\begin{align*}
		\Proj S&\morphism\Proj R\\
		\pp &\longmapsto\phi^{-1}(\pp)
	\end{align*}
	together with morphisms $(R_{\phi^{-1}(\pp)})_0\morphism[\phi](S_\pp)_0$, defining a morphism $\Proj S\morphism \Proj R$ of preschemes. 
	
	For instance, there is a morphism (a closed immersion even) from $\IP_A^m\coloneqq\Proj A[X_0,\ldots,X_m]$ to $\IP_A^n$ for $m\leq n$ defined by the ring morphism $A[X_0,\ldots,X_n]\morphism A[X_0,\ldots,X_m]$ sending $X_{m+1},\ldots,X_n$ to $0$. By contrast, there is no morphism $\IP_A^m\morphism\IP_A^n$ defined by $A[X_0,\ldots,X_n]\subseteq A[X_0,\ldots,X_m]$ when $n<m$ (because the radical property fails).
	
	As an example with $d>1$ we may take $R=A[X_0,X_1,X_2]$, $S=A[Y_0,Y_1]$ and $\phi(X_0)=Y_0^2$, $\phi(X_1)=Y_0Y_1$, $\phi(X_2)=Y_1^2$. The condition $S_+=\sqrt{S\phi(R_+)}$ holds as all monomials of even degree in $Y_0,Y_1$ can be decomposed as a product of the three monomials $Y_0^2,Y_0Y_1,Y_1^2$. We obtain a closed immersion $\IP_A^1=\Proj S\morphism \IP_A^2=\Proj R$ identifying $\IP_A^1$ with the closed subprescheme $V(X_0X_2-X_1^2)\subseteq \IP_A^2$.
\end{rem}
\begin{rem}\lbl{rem:tensorProductSheaves}
	We will construct a sheaf tensor product. Let $\Rr$ be a sheaf of rings on some space $X$ and $\Mm,\Nn$ be $\Rr$-modules. We define $\Mm\otimes_\Rr\Nn$ to be the sheafification of the presheaf 
	\begin{align*}
		\Pp\colon U\longmapsto \Mm(U)\otimes_{\Rr(U)}\Nn(U)\quad\text{for open subsets }U\subseteq X\;.
	\end{align*}
	It is ``easy to see'' that the stalk $\Pp_x$ is given by $\Mm_x\otimes_{\Rr_x}\Nn_x$\footnote{If you really want to do this, you could use that both the free module and its submodule of relations-to-be-modded-out appearing in the explicit construction of the tensor product commute with colimits, as does taking the quotient. In fact, since $\Mm_x=\colimit[U\ni x] \Mm(U)$ is a \emph{filtered} colimit, it is the same as being taken in the category of sets, and the free module functor is left-adjoint to the forgetful functor, hence preserves colimits (Remark~\reff{rem:AdjunctionPreservesStuff}). So does taking quotients, since colimits commute with colimits (Corollary~\reff{cor:ColimitsCommute}).}. Then the stalk at $x$ of $\Mm\otimes_\Rr\Nn$ is given by $\Mm_x\otimes_{\Rr_x}\Nn_x$ as well and we get
	\begin{align*}
		(\Mm\otimes_\Rr\Nn)(U)=\left\{(f_x)\in\prod_{x\in U}\Mm_x\otimes_{\Rr_x}\Nn_x\st\begin{array}{c}
			\text{every }x\in U\text{ has a neighbourhood }V\subseteq U\\
			\text{and }\phi\in \Mm(V)\otimes_{\Rr(V)}\Nn(V)\text{ such that }f_y\text{ is}\\
			\text{the image of }\phi\text{ in }\Mm_x\otimes_{\Rr_x}\Nn_x\text{ for all }y\in V
		\end{array}\right\}
	\end{align*}
	This satisfies the universal property 
	\begin{align*}
		\Hom_{\cat{Mod}(\Rr)}(\Mm\otimes_\Rr\Nn,\Tt)&\isomorphism \operatorname{Bil}_\Rr(\Mm\times \Nn,\Tt)\\
		\phi&\longmapsto\big(\beta\colon (m,n)\longmapsto \phi(m\otimes n)\big)
	\end{align*}
	for every $\Rr$-module $\Tt$ (where the set $\operatorname{Bil}_\Rr(\Mm\times \Nn,\Tt)$ of bilinear morphisms of sheaves $\Mm\times \Nn\morphism \Tt$ is defined in the obvious way).
	
	Now let $X=\Spec R$ and $\Mm=\snake{M}$, $\Nn=\snake{N}$ for some $R$-modules $M,N$. Then $(M\otimes_RN)_\pp=M\otimes_RN\otimes_RR_\pp=M_\pp\otimes_{R_\pp}N_\pp$ shows that $\Mm\otimes _{\Oo_X}\Nn=(M\otimes_RN)^\qcmod$. Hence the tensor product over arbitrary preschemes preserves quasi-coherence of modules. In fact, this is still true if the tensor product is taken over any quasi-coherent $\Oo_X$-algebra $\Rr$ rather than $\Oo_X$ itself.
	
	When $\Ll$ is a line bundle on a ringed space $(X,\Oo_X)$ and $\Mm$ an $\Oo_X$-module, then $\Mm\otimes_{\Oo_X}\Ll$ is locally (non-canonically) isomorphic to $\Mm$, a local isomorphism being given by 
	\begin{align*}
		\Mm|_U&\isomorphism (\Mm\otimes_{\Oo_X}\Ll)|_U\\
		m&\longmapsto m\otimes \lambda\;,
	\end{align*}
	where $\lambda\in\Ll(U)$ is a free generator of $\Ll|_U$. In that sense, $\Mm\otimes_{\Oo_X}\Ll$ may be viewed as a \emph{twist} of $\Mm$. Similarly, when $\Vv$ is an $n$-dimensional vector bundle on $X$, then $\Mm\otimes_{\Oo_X}\Vv$ is locally (non-canonically) isomorphic to  $\Mm^n$.
	Let $R$ be a graded ring such that $R_+$ is generated by $R_1$ over $R$. By Proposition~\reff{prop:FirstProjProperties}\itememph{d}, the $\Oo(k)$ are line bundles and for a graded $R$-module $M$ we get an isomorphism
	\begin{align*}
		\snake{M}\otimes_{\Oo_{\Proj R}}\Oo(k)&\isomorphism (M[k])^\qcmod\\
		m\otimes r&\longmapsto rm
	\end{align*}
	(which is easily checked stalk-wise). In particular, this generalizes Proposition~\reff{prop:FirstProjProperties}\itememph{d} (which is the special case $M=R[\ell]$). Also keep in mind that the $\snake{M}$ occurring here is the one from Remark~\reff{rem:GradedSnakeM}.
\end{rem}

\subsection{Cohomology of \texorpdfstring{$\IP_R^n$}{P}}	
Now let $A$ be a ring, $R=A[X_0,\ldots,X_n]$ be equipped with the usual grading and put $\IP_A^n=\Proj R$. Then $\Uu\colon \IP_A^n=\bigcup_{i=0}^nU_i$ with $U_i=\IP_A^n\setminus V(X_i)$ is an affine open cover of $\IP_A^n$ and by \eqreff{eq:ProjLocal} we have
\begin{align*}
	U_{i_0,\ldots,i_\ell}=\IP_A^n\setminus V\left(X_{i_0}\cdots X_{i_\ell}\right)\cong \Spec R[(X_{i_0}\cdots X_{i_\ell})^{-1}]_0\;.
\end{align*}
\begin{thm}\lbl{thm:CohoOfIP^n}
	Let $A$ be a ring, $R=A[X_0,\ldots,X_n]$ and $\Uu$ be the affine open cover of $X=\IP_A^n$ from above. 
	\begin{alphanumerate}
		\item  For $k\geq 0$ there is an isomorphism
		\begin{align}\lbl{eq:Oo(k)(IP^n)}
			\begin{split}
				R_k&\isomorphism \Oo(k)(X)\\
				r&\longmapsto \big(\text{image of }r\text{ in }(R_\pp)_k\big)_{\pp\in X}\;.
			\end{split}
		\end{align}
		For $k<0$ we have $\Oo(k)(X)=0$.
		\item For $0<p<n$ we have $H^p(X,\Oo(k))=0$ for all integers $k$.
		\item $H^n(X,\Oo(k))=0$ for $k>-n-1$ and $n>0$.
		\item There is an isomorphism $H^n(X,\Oo(-n-1))\isomorphism A$ defined (up to sign) by
		\begin{align}\lbl{eq:H^nIP^nO(-n-1)}
			\begin{split}
				\check{C}_\alt^n\big(\Uu,\Oo(-n-1)\big)\cong R[(X_0\cdots X_n)^{-1}]_{-n-1}&\morphism A\\
				f=\sum_{\alpha\in\IZ^n}f_\alpha X_0^{\alpha_0}\cdots X_n^{\alpha_n}&\longmapsto f_{(-1,\ldots,-1)}\;.
			\end{split}
		\end{align}
		\item For all $k\in\IZ$, the groups $H^0(X,\Oo(k))$ and $H^n(X,\Oo(k))$ are finitely generated free $A$-modules and there is a perfect pairing (which is trivial for $k<0$)
		\begin{align}\lbl{eq:nonDegCohoPairing}
			\begin{split}
				H^0\big(X,\Oo(k)\big)\times H^n\big(X,\Oo(-n-1-k)\big)&\morphism H^n(X,\Oo(-n-1))\overset{\text{\itememph{d}}}{\cong}A\\
				(f,[g])&\longmapsto [fg]\;,
			\end{split}
		\end{align}
		where for $f\in\Oo(k)(X)$ and $g\in\check{C}_\alt^n(\Uu,\Oo(-n-1-k))$,  $fg\in\check{C}_\alt^n(\Uu,\Oo(-n-1))$ is defined by $(fg)_{i_0,\ldots,i_n}=f|_{U_{i_0,\ldots,i_n}}\cdot g_{i_0,\ldots,i_n}$ for all indices $i_0,\ldots,i_n$.
	\end{alphanumerate}
\end{thm}
\begin{rem*}
	The pairing in \eqreff{eq:nonDegCohoPairing} is canonical but the isomorphism $H^n(X,\Oo(-n-1))\cong A$ is not.
\end{rem*}
\begin{proof}[Proof of Theorem~\reff{thm:CohoOfIP^n}]
	Surprisingly, the proof will be almost trivial once we discover the connection between the \vC ech complex and the Koszul complex. By \eqreff{eq:O(k)isQC}, on $U_{i_0,\ldots,i_\ell}= \IP_A^n\setminus V(X_{i_0}\cdots X_{i_\ell})$ we have
	\begin{align*}
		\Oo(k)(U_{i_0,\ldots,i_\ell})\cong R[(X_{i_0}\cdots X_{i_\ell})^{-1}]_k
	\end{align*}
	for all $k\in \IZ$. Considering the sheaf of graded rings $\Oo=\bigoplus_{k\in\IZ}\Oo(k)$ as before, this can be written in a more compact way as
	\begin{align*}
		\Oo(U_{i_0,\ldots,i_\ell})\cong R[(X_{i_0}\cdots X_{i_\ell})^{-1}]\;.
	\end{align*}
	Note that we have isomorphisms
	\begin{align}\lbl{eq:CechKoszulIso1}
			R[(X_{i_0}\cdots X_{i_\ell})^{-1}]\lisomorphism \colimit \left(R\xrightarrow{\cdot(X_{i_0}\cdots X_{i_\ell})}R\xrightarrow{\cdot(X_{i_0}\cdots X_{i_\ell})}R\xrightarrow{\cdot(X_{i_0}\cdots X_{i_\ell})}\ldots\right)\tag{$*$}
	\end{align}
	sending the image of $r\in R$ (as an element of the $j\ordinalth$ member of the sequence) in the colimit to $r\cdot (X_{i_0}\cdots X_{i_\ell})^{-j}$.
	
	For every $j\in\IN$ we get a morphism
	\begin{align*}
		\check{C}_\alt^\ell(\Uu,\Oo)\cong \prod_{0\leq i_0<\cdots<i_\ell\leq n}R[(X_{i_0}\cdots X_{i_\ell})^{-1}]\lmorphism \bigwedge^{\ell+1}R^{n+1}\cong K^{\ell+1}\big((X_0^j,\ldots,X_n^j),R\big)
	\end{align*}
	sending $e_{i_0}\wedge \cdots \wedge e_{i_\ell}$ to $(0,\ldots,(X_{i_0}\cdots X_{i_\ell})^{-j},\ldots,0)$ (with the only non-zero entry at position $(i_0,\ldots,i_\ell)$, obviously). This gives a morphism $\check{C}_\alt^\bullet(\Uu,\Oo)\lmorphism K^\bullet\big((X_0^j,\ldots,X_n^j),R\big)[-1]$ of cochain complexes (compatibility with differentials is easily checked). Using $\bigwedge^{\ell+1}R^{n+1}\cong \bigoplus _{0\leq i_0<\cdots <i_\ell\leq n}R$ and \eqreff{eq:CechKoszulIso1}, these morphisms assemble to an isomorphism
	\begin{align*}
		\check{C}_\alt^\ell(\Uu,\Oo)\lisomorphism \colimit[j\in \IN] K^{\ell+1}\big((X_0^j,\ldots,X_n^j),R\big)\;,
	\end{align*}
	where the transition morphisms $K^{\ell+1}\big((X_0^j,\ldots,X_n^j),R\big)\morphism K^{\ell+1}\big((X_0^{j+1},\ldots,X_n^{j+1}),R\big)$ (with respect to which the colimit is taken) sends an element $f\in K^{\ell+1}\big((X_0^j,\ldots,X_n^j),R\big)$ to the element $\phi\in K^{\ell+1}\big((X_0^{j+1},\ldots,X_n^{j+1}),R\big)$ defined by $\phi(t_1,\ldots,t_{\ell+1})=X_{t_1}\cdots X_{t_{\ell+1}}f(t_1,\ldots,t_{\ell+1})$. Convince yourself that this is compatible with the Koszul differential, so in fact we get a transition map $K^\bullet\big((X_0^j,\ldots,X_n^j),R\big)\morphism K^\bullet\big((X_0^{j+1},\ldots,X_n^{j+1}),R\big)$, and using this an isomorphism
	\begin{align}\lbl{eq:CechKoszulIso2}
		\left(R\morphism\check{C}_\alt^0(\Uu,\Oo)\morphism\check{C}_\alt^1(\Uu,\Oo)\morphism\ldots\right)\lisomorphism \colimit[j\in\IN]K^\bullet\big((X_0^j,\ldots,X_n^j),R\big)[-1]
	\end{align}
	 of cochain complexes. The term $R$ in cohomological degree $-1$ comes from the fact that the $K^\bullet\big((X_0^j,\ldots,X_n^j),R\big)$ for all $j\in\IN$ have such a term in degree $0$.
	
	Note that if $n=0$, then $\IP_A^0=\Proj A[X_0]\cong \Spec A$ and everything follows from well-known properties of affine schemes. Now assume $n>0$. By Example~\reff{ex:(X0Xn)regular}\itememph{a}, the sequence $(X_0,\ldots,X_n)$ is a regular sequence in $R$. By Fact~\reff{fact:RegularSeqKoszulComplex}\itememph{d}, so are $(X_0^j,\ldots,X_n^j)$ for $j\in\IN$. We can now reduce the various assertions about the cohomology of $X=\IP_A^n$ to their Koszul counterparts.
	
	Part~\itememph{a}. By Fact~\reff{fact:RegularSeqKoszulComplex}\itememph{b}, $H^p\big((X_0^j,\ldots,X_n^j),R\big)=0$ in degree $p\neq n+1$. In particular, by exactness of filtered colimits, equation \eqreff{eq:CechKoszulIso2} gives
	\begin{align*}
		H^0\left(R\morphism\check{C}_\alt^\bullet(\Uu,\Oo)\right)\lisomorphism\colimit[j\in\IN]H^1\big((X_0^j,\ldots,X_n^j),R\big)=0\;,
	\end{align*}
	hence the kernel $\ker\left(\check{C}_\alt^0(\Uu,\Oo)\morphism\check{C}_\alt^1(\Uu,\Oo)\right)\cong H^0(X,\Oo)\cong \Oo(X)$ equals the image of $R$ in $\check{C}_\alt^0(\Uu,\Oo)$. Thus $\Oo(X)\cong S$ and \itememph{a} follows by comparing degrees.
	
	Part~\itememph{b}. Just as in \itememph{a}, for $0<p<n$ we obtain
	\begin{align*}
		H^p\left(R\morphism\check{C}_\alt^\bullet(\Uu,\Oo)\right)\lisomorphism\colimit[j\in\IN]H^{p+1}\big((X_0^j,\ldots,X_n^j),R\big)=0\;,
	\end{align*}
	from Fact~\reff{fact:RegularSeqKoszulComplex}\itememph{b}, hence $H^p(X,\Oo(k))=0$ for all $k\in\IZ$ by comparing degrees.
	
	And finally parts~\itememph{c}, \itememph{d}, and \itememph{e} follow in a similar colimit-taking fashion from Corollary~\reff{cor:KoszulCoho}\itememph{a}, \itememph{b}, and \itememph{c}.
\end{proof}
Our next aim is to investigate the trivialization of the $A$-module $H^n(\IP_A^n,\Oo(-n-1))$ by Theorem~\reff{thm:CohoOfIP^n}\itememph{d}, which is non-canonical unless the coordinates and their order are fixed. What happens when the coordinates are changed by an element of $\GL_{n+1}(A)$ (inducing an automorphism of $R$, hence of $\Proj R=\IP_A^n$) with a compatible action on the line bundles $\Oo(k)$?
\begin{lem}
	An element $g\in\GL_{n+1}(A)$ acts on $H^n(\IP_A^n,\Oo(-n-1))$ by multiplication with $\det(g)^{-1}$.
\end{lem}
\begin{proof}
	We will reduce this to the case where $A=K$ is an algebraically closed field. It is easy to see that changing the trivializations of $H^n(\IP_A^n,\Oo(-n-1))$ gives an action of $\GL_{n+1}(A)$ on $A$, hence a group homomorphism 
	\begin{align*}
		\phi_A\colon \GL_{n+1}(A)\morphism\Aut_A(A)\cong A^\times\;,
	\end{align*}
	where $\Aut_A(A)$ is the automorphism group of $A$ as an $A$-module. 
	
	If $B\morphism[\alpha]A$ is a ring morphism, we get a graded ring morphism $B[X_0,\ldots,X_n]\morphism[\alpha] A[X_0,\ldots,X_n]$ defining a morphism of preschemes $\IP_A^n\morphism[p]\IP_B^n$ together with morphisms $\Oo_{\IP_B^n}(k)\morphism p_*\Oo_{\IP_A^n}(k)$ defined by the above ring morphism $\alpha$ on open subsets of the form $\IP_B^n\setminus V(X_i)$. 
	
	Note that $\IP_A^n\morphism[p]\IP_B^n$ is an affine morphism by Proposition~\reff{prop:AffineMorphism}\itememph{b}, since the preimage of $\IP_B^n\setminus V(X_i)$ (which is affine by Proposition~\reff{prop:FirstProjProperties}\itememph{c}) is $\IP_A^n\setminus V(X_i)$ (which is affine) and the $\IP_B^n\setminus V(X_i)$ cover $\IP_B^n$. In particular, we get
	\begin{align*}
		H^n\left(\IP_B^n,\Oo_{\IP_B^n}(-n-1)\right)\morphism[p^*]H^n\left(\IP_B^n,p_*\Oo_{\IP_A^n}(-n-1)\right)\isomorphism H^n\left(\IP_A^n,\Oo_{\IP_A^n}(-n-1)\right)\;,
	\end{align*}
	the isomorphism coming from Corollary~\reff{cor:AffinePushforwardIso}. Suppose that $h\in\GL_{n+1}(B)$ satisfies $\alpha(g)=h$. By naturality of our cohomology constructions\footnote{If $\Uu\colon \IP_A^n=\bigcup_{i=0}^n\IP_A^n\setminus V(X_i)$ is our standard affine open cover, let $g(\Uu)\colon \IP_A^n=\bigcup_{i=0}^n\IP_A^n\setminus V(g(X_i))$ be its image under $g$. Then $g$ induces a map of \vC ech complexes $\check{C}^\bullet (\Uu,\Oo(k))\morphism\check{C}^\bullet (g(\Uu),\Oo(k))$ and this is all natural and stuff; and both \vC ech complexes give $H^n(\IP_A^n,\Oo(k))$ by Theorem~\reff{thm:CohoOnSchemes}\itememph{a}.}
	\begin{diagram*}
		\node[ob] (a) at (0,1.5) {$H^n\left(\IP_B^n,\Oo_{\IP_B^n}(-n-1)\right)$};
		\node[ob] (c) at (0,0) {$H^n\left(\IP_B^n,\Oo_{\IP_B^n}(-n-1)\right)$};
		\node[ob] (b) at (5,1.5) {$H^n\left(\IP_A^n,\Oo_{\IP_A^n}(-n-1)\right)$};
		\node[ob] (d) at (5,0) {$H^n\left(\IP_A^n,\Oo_{\IP_A^n}(-n-1)\right)$};
		\scriptsize
		\draw[->] (a) -- (b) node[pos=0.5, above] {$p^*$};
		\draw[->] (c) -- (d) node[pos=0.5, above] {$p^*$};
		\draw[->] (a) -- (c) node[pos=0.5, left] {$h$};
		\draw[->] (b) -- (d) node[pos=0.5, right] {$g=\alpha(h)$};
	\end{diagram*} 
	is a commutative diagram, showing that $\phi_A(g)=\alpha(\phi_A(h))$. In general, there is a ring morphism
	\begin{align*}
		B=\IZ\left[Y_{i,j}\st i,j=0,\ldots,n\right][\det(Y_{i,j})^{-1}]\morphism A
	\end{align*}
	sending $Y_{i,j}$ to the corresponding entry in the matrix $g$ (so the matrix $h=(Y_{i,j})$ is sent to $g$) and $\det(h)^{-1}$ to $\det(g)^{-1}$. This reduces the assertion to the case of the infinite domain $B$. Embedding $B$ into an algebraic closure $K$ of its field of quotients, we did the advertised reduction.
	
	In this case, the morphism $\phi_K\colon \GL_{n+1}(K)\morphism K^\times$ factors over the abelianization of $\GL_{n+1}(K)$. For algebraically closed fields (actually, for fields with more than $3$ elements) the commutator subgroup of $\GL_{n+1}(K)$ is $\SL_{n+1}(K)$. Moreover, every element $C\in\GL_{n+1}(K)$ can be written as the product of a matrix $\lambda\id_{K^{n+1}}$ and a matrix in $\SL_{n+1}(K)$ (using that $\det C$ has an $(n+1)\ordinalst$ root in the algebraically closed field $K$). This reduces to the case $g=\lambda\id_{K^{n+1}}$. In this case, it is easily seen from Proposition~\reff{prop:FirstProjProperties}\itememph{c} that $g$ acts as the identity on $\IP_K^n$ and as multiplication by $\lambda^k$ on $\Oo_{\IP_K^n}(k)$. This proves our claim.
\end{proof}
\begin{defi}\lbl{def:AmpleLineBundle}
	A line bundle $\Ll$ on a quasi-compact prescheme $X$ is called \defemph{ample} if it satisfies the following equivalent conditions.
	\begin{alphanumerate}
		\item For every locally finitely generated quasi-coherent $\Oo_X$-module $\Mm$ there is an integer $m(\Mm)$ such that for all $m<m(\Mm)$, there is an epimorphism
		\begin{align*}
		(\Ll^{\otimes m})^{\oplus n}\epimorphism \Mm\;,
		\end{align*}
		for some natural number $n=n(m)$.
		\item For every quasi-coherent locally finitely generated $\Oo_X$-module $\Mm$ there is an integer $k(\Mm)$ such that for all $k>k(\Mm)$, $\Ll^{\otimes k}\otimes_{\Oo_X}\Mm$ is \defemph{generated by its global sections}. This shall mean the following: There is a family of global sections $(\lambda_i)_{i\in I}$ such that each stalk $\Ll_x^{\otimes k}\otimes_{\Oo_{X,x}}\Mm_x$ is generated as an $\Oo_{X,x}$-module by the images of the $\lambda_i$.
	\end{alphanumerate}
\end{defi}
\begin{rem}
	\begin{alphanumerate}
		\item \lbl{rem:LineBundleGroup}In Definition~\reff{def:AmpleLineBundle} we put $\Ll^{-1}=\Hhom_{\Oo_X}(\Ll,\Oo_X)$ and $\Ll^{\otimes (-m)}=(\Ll^{-1})^{\otimes m}$ if $-m\in\IZ$ is negative. These are line bundles again, because in the case $\Ll=\Oo_X$ they are canonically isomorphic to $\Oo_X$, which locally and up to isomorphism is always the case. For the same reason, the morphism
		\begin{align*}
			\Ll\otimes_{\Oo_X}\Ll^{-1}\morphism\Oo_X
		\end{align*}
		defined by the bilinear map of evaluation $\Ll\times\Hhom_{\Oo_X}(\Ll,\Oo_X)\morphism\Oo_X$, $(\lambda,\eta)\mapsto\eta(\lambda)$ and the universal property of the (sheaf) tensor product (cf.\ Remark~\reff{rem:tensorProductSheaves}) is an isomorphism. 
		
		More generally, evaluation gives an isomorphism 
		\begin{align*}
			\Ll\otimes_{\Oo_X}\Hhom_{\Oo_X}(\Ll,\Mm)\isomorphism\Mm
		\end{align*}
		for every quasi-coherent $\Oo_X$-module $\Mm$. Isomorphism classes of line bundles on $X$ thus get an abelian group structure with $-\otimes_{\Oo_X}-$ defining multiplication, $\Oo_X$ the neutral element and $\Ll^{-1}$ the inverse to $\Ll$. This group is called the \defemph{Picard group} $\Pic(X)$.
		
		Ok, actually, we have yet to check that our construction of inverse elements is compatible with the group structure, i.e., $(\Ll\otimes_{\Oo_X}\Mm)^{-1}\lisomorphism \Ll^{-1}\otimes_{\Oo_X}\Mm^{-1}$. To obtain a sheaf isomorphism 
		\begin{align*}
			\Hhom_{\Oo_X}(\Ll,\Oo_X)\otimes_{\Oo_X}\Hhom_{\Oo_X}(\Mm,\Oo_X)\isomorphism\Hhom_{\Oo_X}(\Ll\otimes_{\Oo_X}\Mm,\Oo_X)
		\end{align*}
		we can map $f\otimes g\in\Hom_{\cat{Mod}(\Oo_U)}(\Ll|_U,\Oo_U)\otimes_{\Oo_X(U)}\Hom_{\cat{Mod}(\Oo_U)}(\Mm|_U,\Oo_U)$ (for an open subset $U\subseteq X$) to the morphism $(\Ll\otimes_{\Oo_X}\Mm)|_U\morphism\Oo_U$ sending $\lambda\otimes\mu$ to $f(\lambda)\cdot g(\mu)$. It is clear that this is locally (where $\Ll$ and $\Mm$ trivialize) an isomorphism, hence an isomorphism in total.
		\item On $X=\IP_A^n$, there is an isomorphism
		\begin{align*}
			\Oo(k)&\isomorphism\Hhom_{\Oo_{\IP_A^n}}\big(\Oo(\ell),\Oo(\ell+k)\big)\\
			f&\longmapsto (g\mapsto f\cdot g)\;.
		\end{align*}
		\item Definition~\reff{def:AmpleLineBundle}\itememph{b} seems way more common in the literature.
		\item Don't confuse Definition~\reff{def:AmpleLineBundle} with a \emph{relative} notion of ampleness.
	\end{alphanumerate}
\end{rem}
\begin{proof}[Proof of Definition~\reff{def:AmpleLineBundle} (this has to be)]
	First note that $\Ll^{\otimes k}\otimes_{\Oo_X}\Mm$ is still locally finitely generated, so by quasi-compactness of $X$ the family in \itememph{b} can be chosen finite (I will leave that to you).
	
	We show \itememph{a} $\Rightarrow$ \itememph{b} first. Let $k>-m(\Mm)$. Then there is an epimorphism $(\Ll^{\otimes (-k)})^{\oplus n}\epimorphism \Mm$. Tensoring with $\Ll^{\otimes k}$ gives an epimorphism $\Oo_X^{\oplus n}\epimorphism \Ll^{\otimes k}\otimes_{\Oo_X}\Mm$ (tensor products of sheaves preserve epimorphisms, since this clearly holds on stalks). Then the images of the standard unit vectors in $\Oo_X(X)^{\oplus n}$ generate $\Ll^{\otimes k}\otimes_{\Oo_X}\Mm$.
	
	And \itememph{b} $\Rightarrow$ \itememph{a}. Let $m<-k(\Mm)$. Since $\Ll^{\otimes(-m)}\otimes_{\Oo_X}\Mm$ is generated by finitely many global sections, say, $n$ of them, there is an epimorphism $\Oo_X^{\oplus n}\epimorphism\Ll^{\otimes(-m)}\otimes_{\Oo_X}\Mm$. Tensoring with $\Ll^{\otimes m}$ gives an epimorphism $(\Ll^{\otimes m})^{\oplus n}\epimorphism\Mm$.
\end{proof}
\begin{defi}
	Let $\Ll$ be a line bundle on a locally ringed space $(X,\Oo_X)$, with $\mm_x\subseteq \Oo_{X,x}$ the maximal ideal of the local ring at $x$. If $U\subseteq X$ is open and $\lambda\in\Ll(U)$, its \defemph{vanishing set} is
	\begin{align*}
		V(\lambda)=\left\{x\in U\st\text{the image of }\lambda\text{ in }\Ll_x\text{ is in }\mm_x\Ll_x\right\}\;.
	\end{align*}
\end{defi}
\begin{rem*}
	When $\Ll=\Oo_X$, this coincides with the vanishing sets introduced in \cite[Definition~1.3.3]{alggeo1}. Since locally and up to isomorphism this is always the case, $V(\lambda)$ is closed in $U$ by \cite[Fact~1.3.1]{alggeo1} and the usual trick in such situations (\cite[Remark~1.1.4\itememph{a}]{alggeo1}). Similarly, $V(\lambda\otimes \mu)=V(\lambda)\cup V(\mu)$ for the section $\lambda\otimes\mu$ of $\Ll\otimes_{\Oo_X}\Mm$ when $\Ll$ and $\Mm$ are line bundles. 
\end{rem*}
\begin{lem}\lbl{lem:powersOfLl}
	Let $X$ be a quasi-compact prescheme, $\Ll$ a line bundle on $X$, $\lambda\in\Ll(X)$ and $\Mm$ a quasi-coherent $\Oo_X$-module.
	\begin{alphanumerate}
		\item If $m\in\Mm(X)$ with $m|_{X\setminus V(\lambda)}=0$, then there is $k\in\IN$ such that $\lambda^{\otimes k}\otimes m=0$ in $\Ll^{\otimes k}\otimes_{\Oo_X}\Mm(X)$.
		\item If $X$ is in addition quasi-separated and $m\in\Mm(X\setminus V(\lambda))$, then there is $k\in\IN$ such that $\lambda^{\otimes k}\otimes m\in(\Ll^{\otimes k}\otimes_{\Oo_X}\Mm)(X\setminus V(\lambda))$ extends to a global section of $\Ll^{\otimes k}\otimes_{\Oo_X}\Mm$ on $X$.
	\end{alphanumerate}
\end{lem}
\begin{rem*}
	When $\Ll=\Oo_X$, this is identical with one of our definitions of quasi-coherence for sheaves of $\Oo_X$-modules, as we will immediately see.
\end{rem*}
\begin{proof}[Proof of Lemma~\reff{lem:powersOfLl}]
	When $\Ll=\Oo_X$, assertion \itememph{a} is equivalent to the injectivity and \itememph{b} to the surjectivity of 
	\begin{align*}
		\Mm(X)_\lambda\xrightarrow{\text{\eqreff{eq:qcIso}}}\Mm(X\setminus V(\lambda))\;.
	\end{align*}
	Since this holds when $\Mm$ is quasi-coherent and $X$ is quasi-compact (resp.\ quasi-compact and quasi-separated) by Definition~\reff{def:Quasicoherent}\itememph{d}, the assertion is true for $\Ll=\Oo_X$.
	
	Since $X$ is quasi-compact, we have a finite cover $X=\bigcup_{i=1}^nU_i$ by affine open subsets $U_i$ such that $\Ll|_{U_i}$ is trivial. Also put $U_{i,j}=U_i\cap U_j$ as in our \vC ech complex convention.
	
	For \itememph{a}, we have $(m|_{U_i})|_{U_i\setminus V(\lambda)}=0$, hence by the special case treated above there is $k_i\in\IN$ such that $\lambda^{\otimes k_i}\otimes m=0$ on $U_i$. Taking $k=\max_ik_i$ we get $\lambda^{\otimes k}\otimes m=0$ on all of $X$.
	
	For \itememph{b} we use the above special case again to obtain $\ell_i\in\IN$ and $\mu_i\in(\Ll^{\otimes \ell_i}\otimes_{\Oo_X}\Mm)(U_i)$ such that $\lambda^{\otimes \ell_i}\otimes m=\mu_i$ on $U_i\setminus V(\lambda)$. Putting $\ell=\max_i \ell_i$ and replacing $\mu_i$ by $\lambda^{\otimes (\ell-\ell_i)}\otimes \mu_i$ we may assume $\ell_1=\ldots=\ell_n=\ell$. As $X$ is quasi-separated, the $U_{i,j}=U_i\cap U_j$ are quasi-compact. Since $\mu_i|_{U_{i,j}\setminus V(\lambda)}=\mu_j|_{U_{i,j}\setminus V(\lambda)}$, by \itememph{a} there are $k_{i,j}$ such that $\lambda^{\otimes k_{i,j}}\otimes \mu_i=\lambda^{\otimes k_{i,j}}\otimes \mu_j$ on $U_{i,j}$. Put $k=\max_{i,j}k_{i,j}$, then $\lambda^{\otimes k}\otimes \mu_i|_{U_{i,j}}=\lambda^{\otimes k}\otimes \mu_j|_{U_{i,j}}$, hence by the sheaf axiom the $\lambda^{\otimes k}\otimes \mu_i$ extend to a global section $\mu\in\Ll^{\otimes k}\otimes_{\Oo_X}\Mm$. Then $\mu|_{X\setminus V(\lambda)}=\lambda^{\otimes(k+\ell)}\otimes m$, so $\mu$ extends $\lambda^{\otimes(k+\ell)}\otimes m$.
\end{proof}
\begin{prop}\lbl{prop:AmplenessCriterion}
	Let $X$ be a quasi-compact and quasi-separated prescheme and $\Ll$ a line bundle on $X$ such that $X$ may be covered by affine open subsets of the form $X\setminus V(\lambda)$ where $\lambda\in\Ll(X)$. Then $\Ll$ is ample.
\end{prop}
\begin{proof}
	By quasi-compactness of $X$ and the assumption we find a finite cover $X=\bigcup_{i=1}^nU_i$, where $U_i=X\setminus V(\lambda_i)$ is affine with $\lambda_i\in \Ll(X)$. Let $\Mm$ be a locally finitely generated quasi-coherent $\Oo_X$-module, then $M_i=\Mm(U_i)$ is finitely generated over $\Oo_X(U_i)$, say by $m_{i,j}$ for $j=1,\ldots,n_i$. By Lemma~\reff{lem:powersOfLl}\itememph{b} we can choose $k_0$ sufficiently large so that the $\lambda^{\otimes k_0}\otimes m_{i,j}$ extend to a global section of $\Ll^{\otimes k_0}\otimes_{\Oo_X}\Mm$ on $X$. Then $\Ll^{\otimes k}\otimes_{\Oo_X}\Mm$ is generated by its global sections $\lambda^{\otimes k}\otimes m_{i,j}$ (or more precisely their extensions) for all $k>k_0$, hence $\Ll$ is ample by Definition~\reff{def:AmpleLineBundle}\itememph{b}.
\end{proof}
\begin{cor}
	\begin{alphanumerate}
		\item \lbl{cor:O(1)ample}The line bundle $\Oo(1)$ on $\IP_A^n$ is ample.
		\item If $X$ is quasi-affine (i.e., an open subscheme of an affine scheme), then $\Oo_X$ is ample.
	\end{alphanumerate}
\end{cor}
\begin{proof}
	For part \itememph{a}, note that the $\IP_A^n\setminus V(X_i)$ are affine and cover $\IP_A^n$. For \itememph{b}, write $X=\ov{X}\setminus Z$ with $\ov{X}$ affine and $Z$ closed, then the open subsets of the form $X\setminus V(f|_X)=\ov{X}\setminus V(f)$ with $f\in\Oo_{\ov{X}}(\ov{X})$ such that $V(f)\supseteq Z$ are affine and cover $X$. In both cases we win by Proposition~\reff{prop:AmplenessCriterion}.
\end{proof}
Let $\Mm$ be a quasi-coherent module on $\IP_A^n$. For every $k\in \IZ$ we put $\Mm(k)=\Mm\otimes_{\Oo_X}\Oo(k)$ and call this a \emph{Serre twist} of $\Mm$.
\begin{thm}[Serre]\lbl{thm:SerreTwistStuff}
	Let $A$ be a noetherian ring. If $\Mm$ is a coherent sheaf of modules on $X=\IP_A^n$, then the groups $H^p(X,\Mm)$ are finitely generated $A$-modules and vanish for $p>n$. When $p>0$ and $k$ is sufficiently large, $H^p(X,\Mm(k))=0$.
\end{thm}
\begin{proof}
	We prove both assertions by downward induction on $p$. When $p>n$, by Proposition~\reff{prop:CechCohoOnScheme}\itememph{b} we can use the alternating \vC ech complex associated to the standard affine open cover $\Uu\colon \IP_A^n=\bigcup_{i=0}^n\IP_A^n\setminus V(X_i)$ to compute $H^p(X,\Mm)=\check{H}_\alt^p(\Uu,\Mm)=0$ since $\check{C}_\alt^\bullet(\Uu,\Mm)$ is concentrated in degrees $\leq n$.
	
	Now suppose the assertion is proved in cohomological dimension $p+1$. Since $\Oo(1)$ is ample by Corollary~\reff{cor:O(1)ample}\itememph{a}, there is an epimorphism $\Oo(-j)^{\oplus \ell}\epimorphism[p]\Mm$ when $j$ is large enough (Definition~\reff{def:AmpleLineBundle}\itememph{a}). Putting $\Kk=\ker(p)$, we get a short exact sequence $0\morphism \Kk\morphism \Oo(-j)^{\oplus \ell}\morphism\Mm\morphism 0$ of quasi-coherent $\Oo_X$-modules ($\Kk$ is quasi-coherent by Proposition~\reff{prop:QCohHasKerCoker}) and hence an exact sequence
	\begin{align*}
		H^p(X,\Oo(-j))^{\oplus \ell}\cong H^p\Big(X,\Oo(-j)^{\oplus \ell}\Big)\morphism H^p(X,\Mm)\morphism H^{p+1}(X,\Kk)
	\end{align*}
	as part of the long exact cohomology sequence from Theorem~\reff{thm:CohoOnSchemes}\itememph{d}. Since $A$ is noetherian, $\Kk$ is coherent. Indeed, by Proposition~\reff{prop:FirstProjProperties}\itememph{f}, $X=\IP_A^n$ is a noetherian scheme. Then $\Kk(U)$ is a $\Oo_X(U)$-submodule of $\Oo(-j)(U)^{\oplus \ell}$ for every affine open subset $U\subseteq X$, hence $\Kk(U)$ is finitely generated by noetherianness of $\Oo_X(U)$. That is, $\Kk$ is locally finitely generated and thus coherent by Definition~\reff{def:locFinGenerated}\itememph{b}, as claimed. 
	
	Now the right end of the above sequence is a finitely generated $A$-module by the induction assumption. For the left end, this holds by Theorem~\reff{thm:CohoOfIP^n}\itememph{b} and \itememph{e}. It follows that $H^p(X,\Mm)$ in the middle is finitely generated as well. 
	
	Since tensoring with $\Oo(k)$ is exact (it preserves exactness on stalks since $\Oo(k)$ is a line bundle by Proposition~\reff{prop:FirstProjProperties}\itememph{d}, hence preserves exactness in general), we get short exact sequences $0\morphism \Kk(k)\morphism \Oo(k-j)^{\oplus \ell}\morphism \Mm(k)\morphism 0$. Thus
	\begin{align*}
		H^p(X,\Oo(k-j))^{\oplus \ell}\cong H^p\Big(X,\Oo(k-j)^{\oplus \ell}\Big)\morphism H^p(X,\Mm(k))\morphism H^{p+1}(X,\Kk(k))
	\end{align*}
	is exact. For $k>j-n$ and $p>0$ the left term vanishes by Theorem~\reff{thm:CohoOfIP^n}\itememph{b} and \itememph{c}. So does $H^{p+1}(X,\Kk(k))$ for sufficiently large $k$ by the induction assumption. Hence $H^p(X,\Mm(k))$ vanishes as well when $k\gge 0$.
\end{proof}
\begin{prop}\lbl{prop:restrictionSurjective}
	Let $A$ be a noetherian ring and $X$ a closed subprescheme of $\IP_A^n$. For sufficiently large $k$ the restriction map
	\begin{align*}
		A[X_0,\ldots,X_n]_k\cong H^0\left(\IP_A^n,\Oo_{\IP_A^n}(k)\right)\morphism H^0(X,\Oo_X(k))
	\end{align*}
	is surjective.
\end{prop}
\begin{rem}
	\begin{alphanumerate}
		\item \lbl{rem:WhatIsO_X(k)}In the case where $A$ is a field, this was (essentially) shown on exercise sheet \#10 of Algebra~II.
		\item The isomorphism $A[X_0,\ldots,X_n]_k\cong H^0\left(\IP_A^n,\Oo_{\IP_A^n}(k)\right)$ comes from Theorem~\reff{thm:CohoOfIP^n}\itememph{a}.
		\item Did we define $\Oo_X(k)$? No, we didn't, but we will now. Let $Y=\IP_A^n$ and $X\monomorphism[i]Y$ be the closed embedding we're talking about. Then we put $\Oo_X(k)=i^*\Oo_Y(k)$. Here, $i^*\colon \cat{Mod}(\Oo_Y)\morphism\cat{Mod}(\Oo_X)$ denotes the pull-back functor from Remark~\reff{rem:SheafInverseImage}. Since $i^*$ is left-adjoint to $i_*$, we have a canonical morphism $\Oo_Y(k)\morphism i_*\Oo_X(k)$, giving $H^0(Y,\Oo_Y(k))\morphism H^0(Y,i_*\Oo_X(k))$. 
		
		Since $i$ is affine\footnote{Every closed embedding is. Indeed, locally a closed embedding looks like $\Spec R/I\monomorphism\Spec R$ for some ring $R$ and some ideal $I\subseteq R$ (cf.\ the proof of \cite[Proposition~1.5.3]{alggeo1}) which is clearly affine.}, Corollary~\reff{cor:AffinePushforwardIso} gives $H^0(Y,i_*\Oo_X(k))\cong H^0(X,\Oo_X(k))$. From this we get the restriction map in the formulation of Proposition~\reff{prop:restrictionSurjective}.
		\item There is a canonical isomorphism $i_*\Mm\otimes_{\Oo_Y}\Nn\cong  i_*(\Mm\otimes_{\Oo_X}i^*\Nn)$ for all $\Oo_X$-modules $\Mm$ and $\Oo_Y$-modules $\Nn$ (quasi-coherent or not). To prove this, we first construct the morphism and then prove that it is isomorphic. We get a morphism $i_*\Mm\morphism i_*(\Mm\otimes_{\Oo_X}i^*\Nn)$ from the push-forward of $\Mm\morphism\Mm\otimes_{\Oo_X}i^*\Nn$. Similarly, we get a canonical morphism $i_*i^*\Nn\morphism i_*(\Mm\otimes_{\Oo_X}i^*\Nn)$, which can be composed with $\Nn\morphism i_*i^*\Nn$. Together, they define a bilinear map $i_*\Mm\times \Nn\morphism i_*(\Mm\otimes_{\Oo_X}i^*\Nn)$ and thus a canonical morphism
		\begin{align}\lbl{eq:i_*Iso}
			i_*\Mm\otimes_{\Oo_Y}\Nn\morphism i_*(\Mm\otimes_{\Oo_X}i^*\Nn)\tag{\$}
		\end{align}
		of $\Oo_Y$-modules. Checking that it is an isomorphism is a job done stalk-wise. First of all, note that for every $\Oo_X$-module $\Ff$, the stalk of $i_*\Ff$ at $y\in Y$ is given by
		\begin{align*}
			(i_*\Ff)_y=\begin{cases}
				\Ff_x &\text{if }y=i(x)\\
				0 & \text{if }y\text{ isn't in the image of }i
			\end{cases}\;.
		\end{align*}
		Indeed, since $i$ is an embedding, every open neighbourhood of $x\in X$ is of the form $X\cap U=i^{-1}(U)$ for some open neighbourhood $U$ of $i(x)$, hence the first case, and the embedding is closed, hence the second. Also recall that the stalk of $i^*\Nn$ at $x\in X$ is given by $\Oo_{X,x}\otimes_{\Oo_{Y,i(x)}}\Nn_{i(x)}$ (we proved this on exercise sheet \#10 of Algebraic Geometry I). Hence the stalks at $y\in Y$ of the two guys from \eqreff{eq:i_*Iso} are either both $0$ or given by 
		\begin{align*}
			\Mm_x\otimes_{\Oo_{Y,i(x)}}\Nn_{i(x)}\quad\text{and}\quad \Mm_x\otimes_{\Oo_{X,x}}\left(\Oo_{X,x}\otimes_{\Oo_{Y,i(x)}}\Nn_{i(x)}\right)
		\end{align*}
		(for $y=i(x)$) respectively. Clearly they are isomorphic and it's easy to see that \eqreff{eq:i_*Iso} actually induces that isomorphism.
	\end{alphanumerate}
\end{rem}
\begin{proof}[Proof of Proposition~\reff{prop:restrictionSurjective}]
	Put $Y=\IP_A^n$. Let $\Jj\subseteq \Oo_Y$ be the sheaf of ideals defining the closed embedding $i$ (cf.\ \cite[Corollary~1.5.3\itememph{a}]{alggeo1}). Let $k\in\IZ$. Then $\Oo_{X,x}=\Oo_{Y,i(x)}/\Jj_x$ and a stalk-wise argument similar to Remark~\reff{rem:WhatIsO_X(k)}\itememph{d} shows that $0\morphism \Jj(k)\morphism \Oo_Y(k)\morphism i_*\Oo_X(k)\morphism 0$ is a short exact sequence of coherent $\Oo_Y$-modules (coherence of $\Jj$ and $\Oo_Y(k)$ follows from $A$ being noetherian and this implies that the others involved are coherent as well). This gives
	\begin{align*}
		H^0(Y,\Oo_Y(k))\morphism H^0(Y,i_*\Oo_X(k))\morphism H^1(Y,\Jj(k))
	\end{align*}
	in which the right end vanishes by Theorem~\reff{thm:SerreTwistStuff} when $k$ is large enough. In view of Remark~\reff{rem:WhatIsO_X(k)}\itememph{c}, this proves the assertion.
\end{proof}
\begin{exc}
	Let $k$ be a field, $n\geq 2$ and $Z\subseteq \IP_k^n$ a closed reduced subprescheme whose irreducible components are of codimension $1$ (e.g., a curve in $\IP_k^2$). Then
	\begin{align*}
		k[X_0,\ldots,X_n]_\ell\morphism H^0(Z,\Oo_Z(\ell))
	\end{align*}
	is surjective for every $\ell\geq 0$. From this, one can deduce Max Noether's \emph{Restsatz}, cf.\ \cite[Theorem~23]{alg2}.
\end{exc}
\begin{proof}[Sketch of a proof]
	Let $R=k[X_0,\ldots,X_n]$. Since $\IP_k^n$ is noetherian by Proposition~\reff{prop:FirstProjProperties}\itememph{f}, we may decompose $Z=\bigcup_{i=1}^NZ_i$ into irreducible components, which again have codimension $1$. By considering their intersections with the standard affine open cover of $\IP_k^n$ and using \cite[Proposition~2.1.3]{alg1} (and probably \emph{locality of codimension} as well, cf.\ \cite[Remark~2.1.3]{alg1}) one can show that $Z_i\cong \Proj R/(p_i)$ for some homogeneous prime element $p_i\in R$ (here we use that $Z$ is reduced). Then the ideal $\Jj\subseteq \Oo_{\IP_k^n}$ that cuts out $Z$ is given by $\Jj=p_1\cdots p_N\Oo_{\IP_k^n}$. But then $H^1(\IP_k^n,\Jj(\ell))$ is easily seen to vanish for all $\ell\geq 0$ since $\Jj$ is actually isomorphic to $\Oo_{\IP_k^n}$ and we know that $H^1(\IP_k^n,\Oo(k))$ vanishes by Theorem~\reff{thm:CohoOfIP^n}\itememph{b}. 
	
	The assumption then follows from the long exact cohomology sequence associated to the short exact sequence $0\morphism \Jj(k)\morphism \Oo(k)\morphism i_*\Oo_Z(k)\morphism 0$, with $i$ denoting the embedding of $Z$.
\end{proof}
Recall the construction of the quasi-coherent $\Oo_{\Proj R}$-module $\Mm=\snake{M}$ from Remark~\reff{rem:GradedSnakeM} when $M$ is a graded module over the graded ring $R$. When $M$ is over $R$ and $R$ is of finite type over $R_0$, an argument similar (but even more technical) to the proof of Proposition~\reff{prop:FirstProjProperties}\itememph{e} shows that $(M_f)_0$ is a finitely generated $(R_f)_0$-module for every homogeneous $f\in R_+$, i.e., $\Mm$ is locally finitely generated. When $R_0$ is, in addition, noetherian, Proposition~\reff{prop:FirstProjProperties}\itememph{f} assures that $\Mm$ is coherent.
\begin{prop}[Serre]\lbl{prop:SerreAgain}
	Let $A$ be a noetherian ring and $M$ a finitely generated graded module over $R=A[X_0,\ldots,X_n]$. Put $X=\IP_A^n$ and $\Mm=\snake{M}$.
	\begin{alphanumerate}
		\item When $\ell$ is sufficiently large, $M_\ell\morphism H^0(X,\Mm(\ell))$ is an isomorphism.
		\item When $A=k$ is a field,
		\begin{align*}
			\chi(X,\Mm(\ell))\coloneqq\sum_{p=0}^{n}(-1)^p\dim_kH^p(X,\Mm(\ell))=P_M(\ell)\;,
		\end{align*}
		where $P_M$ is the Hilbert polynomial of $M$, cf.\ \cite[Definition~3.1.3]{alg2}.
	\end{alphanumerate}
\end{prop}
\begin{rem*}
	\begin{alphanumerate}
		\item The sum $\chi(X,\Mm(\ell))$ occurring in Proposition~\reff{prop:SerreAgain}\itememph{b} reminds of the \emph{Euler--Poincar characteristic} from topology, and we will occasionally refer to it by that term.
		\item The $k$-vector spaces $H^p(X,\Mm(\ell))$ appearing here are all finite-dimensional by Theorem~\reff{thm:SerreTwistStuff}, so the alternating sum is well-defined.
	\end{alphanumerate}
\end{rem*}
\begin{proof}[Proof of Proposition~\reff{prop:SerreAgain}]
	Part \itememph{a}. An element $m\in M_\ell$ is in the kernel if and only if the restrictions of its image to $\IP_A^n\setminus V(X_i)$ vanish for all $i=0,\ldots,n$, i.e., when $m=0$ in $(M_{X_i})_\ell$. Then there is some $j\in\IN$ such that $X_i^j m=0$ for $i=0,\ldots,n$. Thus, the kernel of the map in question is
	\begin{align*}
		\bigcup_{j=0}^\infty\left\{m\in M\st X_i^jm=0\text{ for all }i=0,\ldots,n\right\}\eqqcolon N\subseteq M\;.
	\end{align*}
	As $M$ is a finitely generated module over $R$, which is noetherian by Hilbert's Basissatz, $N$ is finitely generated as well, hence there is an $j\in\IN$ such that $X_i^j$ annullate $N$ for $i=0,\ldots,n$. Choose some generators of $N$ and let $d$ be their largest degree. Then $N$ vanishes in degrees $>d+(n+1)j$, and in such degrees the considered map is injective.
	
	For $M=R$ we have $\Mm=\Oo_X$ and the surjectivity of $R_\ell\morphism H^0(X,\Oo_X(\ell))$ follows from Theorem~\reff{thm:CohoOfIP^n}\itememph{a}. In the general case, choosing homogeneous generators of $M$ of degrees $d_1,\ldots,d_N$ gives a surjection $\bigoplus_{i=1}^NR[d_i]\epimorphism M$ of graded $R$-modules. Let $K$ be its kernel and $\Kk=\snake{K}$, then we get a short exact sequence
	\begin{align*}
		0\morphism\Kk\morphism\bigoplus_{i=1}^N\Oo_X(d_i)\morphism \Mm\morphism 0
	\end{align*}
	of coherent $\Oo_X$-modules. When $\ell$ is so large that $H^1(X,\Kk(\ell))=0$ (Theorem~\reff{thm:SerreTwistStuff}), the long exact cohomology sequence shows that every element of $H^0(X,\Mm(\ell))$ comes from an element of
	\begin{align*}
		 H^0\bigg(X,\bigoplus_{i=1}^N\Oo_X(\ell+d_i)\bigg)\cong\bigoplus_{i=1}^NR_{\ell+d_i} 
	\end{align*}
	(the isomorphism coming from Theorem~\reff{thm:CohoOfIP^n}\itememph{a}), hence from an element of $M_\ell$.
	
	Part \itememph{b}. By Theorem~\reff{thm:SerreTwistStuff}, the summands in $\chi(X,\Mm(\ell))$ vanish for $p>0$ and sufficiently large twists $\ell$, while the $p=0$ summand becomes $\dim_kM_\ell=\length_kM_\ell$ when $\ell$ is sufficiently large by \itememph{a}. Hence by \cite[Theorem~18]{alg2} the assertion holds when $\ell$ is large enough, and in particular, it suffices to show that $\chi(X,\Mm(\ell))$ is given by a polynomial in $\ell$. We will show this by induction on $n$.
	
	If $n=-1$, we have $\IP_k^{-1}=\Proj k=\emptyset$ and everything is trivial (whereas the $n=0$ case doesn't seem as obvious to me as Professor Franke made it look like). Now let $n\geq 0$ and the assertion be valid for $n-1$. Let $0\morphism \Mm'\morphism\Mm\morphism\Mm''\morphism 0$ be a short exact sequence of coherent $\Oo_X$-modules. 
	\begin{claim}\lbl{claim:chiAdditive}
		For all $\ell\in \IZ$ we have
		\begin{align*}
			\chi(X,\Mm'(\ell))+\chi(X,\Mm''(\ell))=\chi(X,\Mm(\ell))
		\end{align*}
	\end{claim}
	Indeed, the long exact cohomology sequence associated to the short exact sequence $0\morphism \Mm'(\ell)\morphism\Mm(\ell)\morphism\Mm''(\ell)\morphism 0$ vanishes in cohomological degrees $>n$ and consists of finite-dimensional $k$-vector spaces by Theorem~\reff{thm:SerreTwistStuff}. Using that dimension behaves additively in exact sequences, the claimed additivity of the Euler--Poincar characteristic follows after an easy calculation.
	
	In particular, when the Euler--Poincar characteristic is a polynomial in $\ell$ for two of $\Mm'$, $\Mm$, and $\Mm''$, so it is for the third. Now let $\Mm$ be coherent and consider the sequence
	\begin{align*}
		0\morphism \Kk\morphism \Mm\xrightarrow{X_n\cdot }\Mm(1)\morphism \Qq\morphism 0\;,
	\end{align*}
	in which $\Kk$ and $\Qq$ are the appropriate kernel and cokernel. Both are clearly coherent. We may split this 4-term sequence into $0\morphism \Kk\morphism \Mm\morphism \Nn\morphism 0$ and $0\morphism\Nn\morphism\Mm(1)\morphism \Qq\morphism 0$ for some coherent $\Oo_X$-module $\Nn$ to obtain
	\begin{align*}
		\chi(X,\Mm(\ell))=\chi(X,\Kk(\ell))+\chi(X,\Nn(\ell))=\chi(X,\Kk(\ell))+\chi(X,\Mm(\ell+1))-\chi(X,\Qq(\ell))\;,
	\end{align*}
	hence
	\begin{align*}
		\chi(X,\Mm(\ell+1))-\chi(X,\Mm(\ell))=\chi(X,\Qq(\ell))-\chi(X,\Kk(\ell))\;.
	\end{align*}
	But the right-hand side of this is a polynomial in $\ell$. Indeed, $\Kk$ and $\Qq$ are annullated by $X_n$, hence they are direct images of coherent sheaves on $\IP_A^{n-1}$ under the closed embedding $\IP_A^{n-1}\isomorphism V(X_n)\monomorphism \IP_A^n$ and we can apply the induction hypothesis (and before that, we use Corollary~\reff{cor:AffinePushforwardIso} to pull cohomology of $\Kk$ and $\Qq$ back to $\IP_A^{n-1}$). From well-known elementary facts like \cite[Fact~3.1.1\itememph{a}]{alg2} it follows that $\chi(X,\Mm(\ell))$ is a polynomial in $\ell$ as well.
\end{proof}
To finish this section, Professor Franke briefly introduces a somewhat different topic.
\paragraph{Line bundles and Weil divisors on locally noetherian schemes.} \lbl{par:Divisors}Let $R$ be a local noetherian normal domain (i.e., a domain which is integrally closed in its field of quotients $K$). Then
\begin{align}\lbl{eq:IntersectionOfLocalizations}
	R=\bigcap_{\hoehe(\pp)=1}R_\pp\tag{$*$}\;.
\end{align}
The proof of this apparently needs \emph{primary decompositions} and may be found in \cite[Theorem~11.5]{matsumuraCRT}. The $R_\pp$ appearing here are one-dimensional noetherian local normal domains, hence \emph{discrete valuation rings} by \cite[Theorem~21\itememph{e}]{alg2}.

Now let $X$ be a noetherian normal connected prescheme (cf.\ \cite[Definition~2.2.2, Definition~2.4.5]{alggeo1}) with generic point $\eta$ (cf.\ \cite[Definition~2.1.3]{alggeo1}) and $K=\Oo_{X,\eta}$\footnote{As usual, Franke gives all necessary information while simultaneously hiding everything essential. Since $X$ is noetherian, so is its underlying topological space by \cite[Fact~2.2.3\itememph{c}]{alggeo1}. Also, the stalks $\Oo_{X,x}$ are normal, hence, in particular, domains for all $x\in X$. Then $X$ is integral by \cite[Proposition~2.1.4\itememph{d}]{alggeo1}, in particular, irreducible, and thus has a unique generic point $\eta$ by \cite[Fact~2.1.9]{alggeo1}.}. It defines a quasi-coherent sheaf of $\Oo_X$-modules $\Kk$ given by
\begin{align*}
	\Kk(U)=\begin{cases}
		0 & \text{if }U=\emptyset\\
		K & \text{otherwise}
	\end{cases}\;.
\end{align*}
Let $X_1\subseteq X$ be the subset of codimension $1$ points. There is a function
\begin{align*}
	\div\colon \Kk(U)^\times \morphism\bigoplus_{x\in U\cap X_1}\IZ
\end{align*}
given by $\div(f)_x=v_x(f)$ when $f\in K$ and $v_x$ is the valuation of the DVR $\Oo_{X,x}$ (whose quotient field is $K$, so it makes sense to put $f$ in there).

By \eqreff{eq:IntersectionOfLocalizations} we have
\begin{align*}
	\Oo_X(U)^\times =\ker\bigg(\Kk(U)^\times\morphism[\div]\bigoplus_{x\in U\cap X_1}\IZ\bigg)
\end{align*}
for all affine open subsets $U\subseteq X$. Similarly,
\begin{align*}
	\Oo_X(U)=\left\{f\in\Kk(U)\st \div(f)\geq 0\right\}\;,
\end{align*}
where $(d_x)\in \bigoplus_{x\in U\cap X_1}\IZ$ is considered $\geq 0$ iff $d_x\geq 0$ for all $x\in U\cap X_1$ and $\div(0)\coloneqq\infty$. Let $\Div(X)$ be the group of all formal $\IZ$-linear combinations of elements of $X_1$, i.e., $\Div(X)=\bigoplus_{x\in X_1}\IZ$. For $D\in\Div(X)$ and open subsets $U\subseteq X$ let
\begin{align*}
	\Oo_X(D)(U)=\left\{f\in\Kk(U)\st\div(f)+D|_U\geq 0\right\}\;.
\end{align*}
When $X$ is locally factorial, $\Oo_X(D)$ is a line bundle on $X$ (for general normal $X$ it is only a coherent sheaf).

\section{Projective morphisms}
There are several definitions of \emph{projective morphism} around which are in common use. Professor Franke would like to stick with the EGA version. Also the $\PROJ$ construction occuring in the definition is very important and we will describe it first.

Let $\Rr$ be a graded quasi-coherent $\Oo_X$-algebra, where $X$ is a prescheme. That is,
\begin{align*}
	\Rr=\bigoplus_{i=0}^\infty\Rr_i
\end{align*}
where the $\Rr_i$ are quasi-coherent $\Oo_X$-modules and are equipped with an $\Oo_X$-bilinear multiplication $\Rr_i\times\Rr_j\morphism \Rr_{i+j}$ which is commutative and associative. Moreover, this multiplication should make $\Rr_0$ into a sheaf of rings and the $\Rr_i$ into sheaves of $\Rr_0$-modules (in particular, multiplication with $1\in\Rr_0(U)$ for open $U\subseteq X$ is the identity). Now we define $\PROJ_X(\Rr)$ as follows.
\begin{itemize}
	\item \emph{Points.} As a set ,
	\begin{align*}
	\PROJ_X(\Aa) = \left\{(x,\pp) \st 
	\begin{array}{c}
	x\in X\text{, }\pp \in \Spec(\Rr_x) \text{ a homogeneous prime ideal}\\
	\text{not containing the augmentation ideal and such}\\
	\text{that its preimage under }\Oo_{X,x}\morphism\Rr_x\text{ is }\mm_{X,x}
	\end{array}
	\right\}
	\end{align*}
	\item \emph{Topology base.} For $U\subseteq X$ open and $f\in\Rr_m(U)$ for some $m\in\IN_0$ put
	\begin{align*}
	\Omega(U,f) = \left\{ (x,\pp) \st x\in U\text{ and }\pp\not\ni (\text{image of }f \text{ under } \Rr_m(U)\to (\Rr_m)_x\to\Rr_x)\right\}\;.
	\end{align*}
	Since $\PROJ_X(\Rr)=\Omega(X,1)$ and $\Omega(U,f) \cap \Omega(V,g) = \Omega(U\cap V, f|_{U\cap V} \cdot g|_{U\cap V})$ this is indeed a base for some topology.
	\item \emph{Local rings.} Put $P=\PROJ_X(\Rr)$ for brevity. There is an obvious candidate for the pretender stalks and it is $\Oo_{P,[x,\pp]} \coloneqq ((\Rr_x)_\pp)_0$.
	\item \emph{Structure sheaf.} For $\Omega\subseteq P$ open, let
	\begin{align*}
	\Oo_P(\Omega) = \left\{\rho=(\rho_{x,\pp})\in \prod_{(x,\pp)\in \Omega} \Oo_{P,[x,\pp]}\st 
	\begin{array}{c}
	\rho\text{ fulfills the \emph{cohe-}}\\
	\text{\emph{rence condition}\texttrademark}
	\end{array}
	\right\}\;.
	\end{align*}
	Here, the \emph{coherence condition}\texttrademark\ says that every $\omega\in \Omega$ has a neighbourhood $\Omega(U,f)$ contained in $\Omega$ together with an $r\in (\Rr(U)_f)_0$ such that whenever $(x,\pp)\in \Omega(U,f)$, we have
	\begin{align*}
	\rho_{x,\pp}=\left(\text{image of }r\text{ under }\Rr(U)_f \to (\Rr_x)_f \to (\Rr_x)_\pp = \Oo_{P,[x,\pp]}\right)\;.
	\end{align*}
	Alternatively, $\Oo_P$ is the sheafification of the presheaf $\Omega(U,f)\mapsto(\Rr(U)_f)_0$ on the above topology base. Note that we have to put $\Rr(U)_f\coloneqq \bigoplus_{i=0}^\infty\Rr_i(U)_f$.\footnote{This is actually relevant, as Professor Franke explains that $\Rr(U)$ is the set of all $(r_i)\in\prod_{i=0}^\infty\Rr_i(U)$ such that for every $x\in U$, the image of $r_i$ in $(\Rr_i)_x$ is non-zero only for finitely many $i$ (that's how infinite coproducts of sheaves of modules work, deal with it). So a priori, $\Rr(U)\neq \bigoplus_{i=0}^\infty\Rr_i(U)$ unless $U$ is quasi-compact, and naive localization may give the wrong result.}
\end{itemize}
One obtains a sheaf of rings on $P=\PROJ_X(\Rr)$ and has a canonical isomorphism $\Oo_{P,(x,\pp)}\isomorphism\Oo_{P,[x,\pp]}$ sending the image of $\rho=(\rho_{y,\qq})\in\Oo_P(\Omega)$ to $\rho_{x,\pp}$.

It follows that $\PROJ_X(\Rr)$ is a locally ringed space. There is a continous map $\PROJ_X(\Rr)\morphism[\pi]X$ defined by $\pi(x,\pp)=x$ ($\pi$ is continuous as $\pi^{-1}(U)=\Omega(U,1)$ for $U\subseteq X$ open). Using $\pi^*\colon \Oo_X\morphism\pi_*\Oo_P$ given by
\begin{align*}
	\pi^*(f)=\Big(\text{image of }f\text{ under }\Oo_X(U)\to\Oo_{X,x}\to(\Rr_0)_x\to((\Rr_x)_\pp)_0\Big)_{(x,\pp)\in\pi^{-1}(U)}
\end{align*}
as the algebraic component one has a morphism of locally ringed spaces.

This construction is base-local. That is, $\PROJ_U(\Rr|_U)\cong \pi^{-1}(U)$ for all open subsets (hence subpreschemes) $U\subseteq X$. When $R$ is a graded ring, $X=\Spec R_0$ and $\Rr=\snake{R}$, then $\PROJ_X(\Rr)\cong \Proj R$ by comparing their definitions. Since the following assertions are all base-local, they follow from the corresponding assertions about $\Proj R$ we proved in Proposition~\reff{prop:FirstProjProperties}.
\begin{fact}
	\begin{alphanumerate}
		\item \lbl{fact:PROJProperties}$\PROJ_X(\Rr)$ is a prescheme. In fact, for any affine open $U\subseteq X$, $\pi^{-1}(U)$ is a scheme (and quasi-compact when $\Rr(U)$ is of finite type over $\Oo_X(U)$).
		\item The morphism $\pi$ is separated. When $\Rr$ is locally of finite type as an $\Oo_X$-algebra, then $\pi$ is of finite type. If $X$ is in addition noetherian (resp.\ locally noetherian), then so is $\PROJ_X(\Rr)$.
		\item When $\Rr$ is generated by $\Rr_0$ and $\Rr_1$ as an $\Oo_X$-algebra, then the $\Oo_{\PROJ_X(\Rr)}$-module $\Oo(k)=\Oo_{\PROJ_X(\Rr)}(k)$ obtained by replacing homogeneous degree $0$ in the definition of the pretender stalk and in the coherence condition\texttrademark\ by homogeneous degree $k$ is a line bundle. 
		
		Moreover, in this case $\Oo(k)^{-1}\cong \Oo(-k)$ (where the \emph{inverse} of a line bundle is defined as in Remark~\reff{rem:LineBundleGroup}\itememph{a}) and there is an isomorphism 
		\begin{align*}
			\Oo(k)\otimes_{\Oo_{\PROJ_X(\Rr)}}\Oo(\ell)\isomorphism\Oo(k+\ell)
		\end{align*}
		defined by the multiplication $\Rr_k\times \Rr_\ell\morphism\Rr_{k+\ell}$.
		\item Finally (regardless of whether $\Rr$ is generated by $\Rr_0$ and $\Rr_1$), we have a canonical morphism $\Rr_k\morphism[\rho_k]\pi_*\Oo(k)$ sending $r\in\Rr_k(U)$ to its images under $\Rr_k(U)\morphism ((\Rr_x)_\pp)_k$ with $(x,\pp)$ running over $\pi^{-1}(U)$.
	\end{alphanumerate}
\end{fact}
\begin{rem}
	\begin{alphanumerate}
		\item\lbl{rem:SheafInverseImage} So far, we have seen three kinds of inverse image functors. Let $f\colon X\morphism Y$ be a continuous map of topological spaces, where for $f^*$ we additionally assume that $X$ and $Y$ are ringed with structure sheaves $\Oo_X,\Oo_Y$. Then we have
		\begin{align*}
		\begin{array}{r c l c}
		f^\flat\colon & \cat{PSh}(Y)\morphism[ ]\cat{PSh}(X)&\text{left-adjoint to } & \cat{PSh}(X)\morphism[f_*]\cat{PSh}(Y)\\
		f^\sharp\colon & \cat{Sh}(Y)\morphism[ ]\cat{Sh}(X) & \text{left-adjoint to } & \cat{Sh}(X)\morphism[f_*]\cat{Sh}(Y)\\
		f^*\colon & \cat{Mod}(\Oo_Y)\morphism[ ]\cat{Mod}(\Oo_X) & \text{left-adjoint to } & \cat{Mod}(\Oo_X)\morphism[f_*]\cat{Mod}(\Oo_Y)
		\end{array}
		\end{align*}
		defined as follows. For a presheaf $\Gg$ on $Y$ define $f^\flat \Gg$ by 
		\begin{align*}
		f^\flat\Gg(U)=\colimit[V\supseteq f(U)\text{ open}]\Gg(V)
		\end{align*}
		for open subsets $U\subseteq X$. This is usually not a sheaf, so we put $f^\sharp\Gg=(f^\flat\Gg)^\sh$. Note that
		\begin{align*}
		(f^\flat\Gg)_x=\colimit[U\ni x]f^\flat\Gg(U)=\colimit[U\ni x]\colimit[V\supseteq f(U)]\Gg(V)=\colimit[V\ni f(x)]\Gg(V)=\Gg_{f(x)}\;,
		\end{align*}
		thus also $(f^\sharp\Gg)_x=\Gg_{f(x)}$ since the stalks of the sheafification are the same (cf.\ \cite[Proposition~1.2.1\itememph{a}]{alggeo1}). In fact, the stalk is an inverse image itself: We have $\Gg_x=i_x^\flat\Gg(\{x\})$, where $i_x\colon\{x\}\morphism X$ is the inclusion of $x\in X$. If $g\colon Y\morphism Z$ is another continuous map, we have canonical functor isomorphisms $(gf)^\flat=f^\flat g^\flat$ and $(gf)^\sharp =f^\sharp g^\sharp$.
		
		Now let $\Mm$ be a sheaf of modules on the ringed space $(Y,\Oo_Y)$. In general, $f^\sharp \Mm$ will only be a $f^\sharp\Oo_Y$-module, so we need to tensor it by $\Oo_X$ to get the pull-back $f^*\Mm$. That is, $f^*\Mm=f^\sharp\Mm\otimes_{f^\sharp\Oo_Y}\Oo_X$. By Remark~\reff{rem:tensorProductSheaves}, its stalks are given by
		\begin{align*}
		(f^*\Mm)_x=\Mm_{f(x)}\otimes_{\Oo_{Y,f(x)}}\Oo_{X,x}
		\end{align*}
		and from this we can describe $f^*\Mm$ by another one of our beautiful coherence condition characterizations for (I won't include this here). In particular, we see that $f^*$ is base-local.
		\item Since $f^*\Oo_Y=\Oo_X$ (this is clear on stalks) and $f^*$ preserves direct sums (in fact, as a left-adjoint functor it preserves arbitrary colimits, cf.\ Remark~\reff{rem:AdjunctionPreservesStuff}), so inverse images of vector bundles (resp.\ line bundles) are vector bundles (resp.\ line bundles) again by base-locality of $f^*$.
		\item Moreover, when $f$ is a morphism between affine schemes $X=\Spec B$ and $Y=\Spec A$ (thus) coming from a ring morphism $A\morphism B$, then $f^*\snake{M}=(B\otimes_AM)^\qcmod$ for all $A$-modules $M$ (which is easily seen stalk-wise). It follows that $f^*$ restricts to a functor $f^*\colon \cat{QCoh}(Y)\morphism\cat{QCoh}(X)$.
		\item Also note that $f^*$ commutes with tensor products, i.e., $f^*(\Mm\otimes_{\Oo_Y}\Nn)=f^*\Mm\otimes_{\Oo_X}f^*\Nn$. Indeed, this can be easily verified by looking at stalks.
	\end{alphanumerate}
\end{rem}
\paragraph{An adjunction for $\PROJ$.} In the lecture the question came up whether $\PROJ$ (or even ordinary $\Proj$) satisfies an adjunction similar to \eqreff{eq:SPECAdjunction}. It turns out that such an adjunction (in an appropriate sense) indeed exists, but it will be way more \sout{ugly} subtle than you might have ever imagined.

Recall the notion of $S$-preschemes from \cite[Definition~1.5.7]{alggeo1}. Let $R$ be an $\IN_0$-graded ring generated by $R_0$ and $R_1$, let $S=\Spec R_0$ and $X=\Spec A\morphism[\xi]S$ be an $S$-prescheme. 
\begin{itemize}
	\item Let $\MM$ be the set of pairs $(\phi,\tau)$ where $X\morphism[\phi]\Proj R$ is a morphism of $S$-preschemes and $\tau\colon \phi^*\Oo_{\Proj R}(1)\isomorphism\Oo_X$ a trivialization of $\phi^*\Oo_{\Proj R}(1)$.
	\item Let $\NN$ be the set of all surjective morphisms $A\otimes_{R_0}R\morphism[\alpha]A[T]$ of $\IN_0$-graded $A$-algebras (where $T$ has degree 1).
\end{itemize}
\begin{lem}\lbl{lem:localPseudoAdjunction}
	In the above situation, we have a bijection $\MM\cong\NN$ which is compatible with restrictions to affine open subsets of $X$ and defined as follows.
	\begin{alphanumerate}
		\item To $\alpha\in\NN$ we associate the morphism $X\cong \IP_A^0\cong\Proj A[T]\morphism\Proj (A\otimes_{R_0}R)\morphism\Proj R$ and the isomorphism $\phi^*\Oo_{\Proj R}(1)\cong \Oo_{\IP_A^0}(1)\cong \Oo_X$.
		\item Let $(\phi,\tau)\in\MM$. Every element $r\in R_k$ defines a global section $r\in\Oo_{\Proj R}(k)(\Proj R)$ and we put $\alpha(a\otimes r)=a\cdot \tau^{\otimes k}(r)\cdot T^k$.
	\end{alphanumerate}
\end{lem}
\begin{proof}[Not quite a proof]
	Let us first justify that the given descriptions are well-defined. The morphism $\Proj A[T]\morphism \Proj(A\otimes_{R_0}R)$ in \itememph{a} comes from the fact that $A\otimes_{R_0}R\morphism[\alpha]A[T]$ is surjective, so the conditions from Remark~\reff{rem:ProjFunctoriality} are clearly satisfied. The other one is the canonical morphism we get from $\Proj(A\otimes_{R_0}R)\cong X\times_S\Proj R$.\footnote{And this behaviour of $\Proj$ is easy to see from $\Proj R\setminus V(f)\cong \Spec (R_f)_0$ for homogeneous $f\in R_+$ (Proposition~\reff{prop:FirstProjProperties}\itememph{c}), since $(A\otimes_{R_0}R)_{1\otimes f})_0=A\otimes_{R_0}(R_f)_0$ and fibre products are base-local.} 
	
	Why is $\phi^*\Oo_{\Proj R}\cong \Oo_{\IP_A^0}(1)$? First of all, we may cover $\Proj R$ by affine open subsets $\Proj R\setminus V(f)$ for $f\in R_1$, by assumption. Moreover, their images $\alpha(1\otimes f)$ in $A[T]_1$ generate the augmentation ideal of $A[T]$ by surjectivity of $\alpha$. On such a subset $\Proj R\setminus V(f)\cong \Spec (R_f)_0$, $\Oo_{\Proj R}(1)$ is given by $((R_f)_1)^\qcmod$ (Proposition~\reff{prop:FirstProjProperties}\itememph{c}). Hence $\phi^*\Oo_{\Proj R}$ restricted to $\Spec \big(A[T]_{\alpha(1\otimes f)}\big)_0$ is given by the $\big(A[T]_{\alpha(1\otimes f)}\big)_0$-module $\big(A[T]_{\alpha(1\otimes f)}\big)_0\otimes_{(R_f)_0}(R_f)_1$ (by Remark~\reff{rem:SheafInverseImage}\itememph{c}) and we get an isomorphism
	\begin{align*}
		\big(A[T]_{\alpha(1\otimes f)}\big)_0\otimes_{(R_f)_0}(R_f)_1&\isomorphism \big(A[T]_{\alpha(1\otimes f)}\big)_1\\
		a \otimes \frac{r}{f^k}&\longmapsto \frac{\alpha(1\otimes r)}{\alpha(1\otimes f)^k}\cdot a\;,
	\end{align*}
	which is ``canonical enough to be easily globalized'' (at least I hope so -- this stuff gives me a headache).
	
	For \itememph{b}, the question we should really ask is why $\alpha$ is surjective, as not all elements of the global section of $\phi^*\Oo_{\Proj R}(k)$ need to come from an element $r\in R_k$. However, we can do the following. Let $f\in R_1$ and $g\in A$ such that $\Spec A_g$ lies in the preimage of $\Proj R\setminus V(f)\cong (R_f)_0$ under $\phi$. By quasi-compactness, we find finitely many such $f_1,\ldots,f_n$ and $g_1,\ldots,g_n$ such that the $\Spec A_{g_i}$ cover $X=\Spec A$. On $\Spec A_{g_i}$, $\phi^*\Oo_{\Proj R}(k)$ is given by the $A_{g_i}$-module $A_{g_i}\otimes_{(R_f)_0}(R_f)_k$ and $\tau^{\otimes k}$ induces an isomorphism
	\begin{align*}
		\tau^{\otimes k}\colon A_{g_i}\otimes_{(R_f)_0}(R_f)_k\isomorphism A_{g_i}\;,
	\end{align*}
	hence there is some preimage $\sum_{j=1}^{n_j}a_j\otimes \rho_j$ of $1\in A_{g_i}$. Since $R$ is generated by $R_0$ and $R_1$, $\rho_j\in (R_f)_k$ can be written as a sum of products of an element of $R_k$ and an element of $(R_f)_0$. The latter can be sucked into the $A_{g_i}$ factor of the tensor product. Multiplying by a suitable power of $g_i$, we find an element of $A\otimes_{R_0}R_k$ which is mapped to some power $g_i^{k_i}$ by $\tau^{\otimes k}$. Since $g_1,\ldots,g_n$ generate $A$, so do $g_1^{k_1},\ldots,g_n^{k_n}$ and the desired surjectivity follows quite easily.
	
	To show that \itememph{a} and \itememph{b} are indeed inverse seems to be a (doable) technical nightmare and I will rely on believing Professor Franke here.
\end{proof}
Having dealt with the local case, we now procede to describe an ``adjunction'' of the desired type in general. 

Let $S$ be any prescheme, $X\morphism[\xi]S$ any $S$-prescheme, $\Ll$ a line bundle on $X$ and $\Rr$ a quasi-coherent graded $\Oo_S$-algebra generated by $\Rr_0$ and $\Rr_1$. Put $\PROJ_S(\Rr)=P$.
\begin{itemize}
	\item Let $\MM(X)$ be the set of pairs $(\phi,\tau)$ where $X\morphism[\phi]P$ is a morphism of $S$-preschemes and $\tau\colon \phi^*\Oo_{P}(1)\isomorphism \Ll$ an isomorphism of line bundles.	
	\item Let $\NN(X)$ be the set of all morphisms of graded $\Oo_X$-algebras\footnote{The multiplication on $\bigoplus_{k=0}^\infty\Ll^{\otimes k}$ is given by the tensor product, clearly making this into a graded $\Oo_X$-algebra.} $\xi^*\Rr\morphism\bigoplus_{k=0}^\infty\Ll^{\otimes k}$ which induce surjections on stalks.
\end{itemize}
Recall that we have a projection $P\morphism[\pi]S$. Let $\pi^*\Rr_k\morphism[\epsilon_k]\Oo_{P}(k)$ be the morphism associated to $\Rr_k\morphism[\rho_k]\pi_*\Oo_{P}(k)$ from Fact~\reff{fact:PROJProperties}\itememph{d} by the $\pi^*$-$\pi_*$ adjunction. 
\begin{prop}\lbl{prop:PROJQuasiAdjunction}	
	We obtain a bijection $\MM(X)\cong \NN(X)$ by associating to $(\phi,\tau)\in\MM(X)$ the morphism 
	\begin{align*}
		\xi^*\Rr_k\cong \phi^*\pi^*\Rr_k\xrightarrow{\phi^*(\epsilon_k)}\phi^*\Oo_{P}(k)\cong \phi^*\Oo_{P}(1)^{\otimes k}\xrightarrow{\tau^{\otimes k}}\Ll\;.
	\end{align*}
\end{prop}
\begin{proof}[Sketch of a proof]
	As $U\mapsto\MM(U)$ and $U\mapsto\NN(U)$ (for $U\subseteq X$ open) are easily seen to be sheaves, it is enough to show this on an appropriate topology base of $X$. We use affine open $U$ such that $\Ll|_U$ is trivial and $\xi(U)$ is contained in an affine open subset of $S$, so that Lemma~\reff{lem:localPseudoAdjunction} may be applied.
\end{proof}
\begin{cor}\lbl{cor:PROJQuasiAdjunction}
	In the situation of Proposition~\reff{prop:PROJQuasiAdjunction}, $\Hom_{\cat{PSch}/S}(X,\PROJ_S(\Rr))$ is in canonical bijection with the set of pairs $(\Ll,\alpha)$, where $\Ll$ is a representative of an isomorphism class of line bundles on $X$ and $\alpha$ a morphism
	\begin{align}\lbl{eq:WhatIsAlpha}
		\alpha\colon\xi^*\Rr\morphism\bigoplus_{k=0}^\infty\Ll^{\otimes k}
	\end{align}
	of graded $\Oo_X$-algebras defining surjections on stalks.
\end{cor}
\begin{proof}
	Choose a representative for all possible isomorphism classes of line bundles on $X$ which $\phi^*\Oo_P(1)$ from Proposition~\reff{prop:PROJQuasiAdjunction} may belong to (and by Remark~\reff{rem:SheafInverseImage}\itememph{b}, $\phi^*\Oo_P(1)$ is indeed a line bundle on $X$), then the assertion follows immediately from Proposition~\reff{prop:PROJQuasiAdjunction}.
\end{proof}
\begin{cor}\lbl{cor:PROJpull-back}
	Under the assumptions of Proposition~\reff{prop:PROJQuasiAdjunction}, let $T\morphism[\tau]S$ be an $S$-prescheme. Then there is a canonical isomorphism 
	\begin{align*}
		\PROJ_T(\tau^*\Rr)\isomorphism \PROJ_S(\Rr)\times_ST\;.
	\end{align*} 
\end{cor}
\begin{proof}[Sketch of a proof]
	As before, put $P=\PROJ_S(\Rr)$ and $P_T=\PROJ_T(\tau^*\Rr)$ for convenience. Let's first see how this canonical isomorphism is defined. We have the canonical projection $P_T\morphism[\pi_T]T$. Also there is a morphism $P_T\morphism P$ (over $S$) defined by Corollary~\reff{cor:PROJQuasiAdjunction} and the morphism
	\begin{align*}
		(\tau\pi_T)^*\Rr_k= \pi_T^*\tau^*\Rr_k\morphism[\epsilon_k]\Oo_{P_T}(k)\;,
	\end{align*}
	where $\epsilon_k$ is the morphism associated to $\tau^*\Rr_k\morphism[\rho_k](\pi_T)_*\Oo_{P_T}(k)$ from Fact~\reff{fact:PROJProperties}\itememph{d} by the $\pi_T^*$-$(\pi_T)_*$ adjunction. Doing this for all $k\geq 0$ gives a morphism
	\begin{align*}
		\epsilon\colon (\tau\pi_T)^*\Rr\morphism\bigoplus_{k=0}^\infty\Oo_{P_T}(k)\cong\bigoplus_{k=0}^\infty\Oo_{P_T}(1)^{\otimes k}
	\end{align*}
	and we have yet to check that $\epsilon$ (resp.\ $\epsilon_k$) induces surjections on stalks, which we do in Lemma~\reff{lem:RkEpi}. By the universal property of fibre products, this induces a morphism $P_T\morphism P\times_ST$.
	
	Now let $X\morphism[t]T$ and $X\morphism[p]P$ be morphisms of preschemes such that $\tau t=\pi p$. By Corollary~\reff{cor:PROJQuasiAdjunction}, $p$ corresponds to a morphism
	\begin{align*}
		\alpha\colon p^*\pi^*\Rr\morphism\bigoplus_{k=0}^\infty\Ll^{\otimes k}\;.
	\end{align*}
	But $p^*\pi^*\Rr=t^*(\tau^*\Rr)$, so $\alpha$ induces a morphism $X\morphism[\xi]P_T$ by Corollary~\reff{cor:PROJQuasiAdjunction} applied to $\tau^*\Rr$ this time. One can show that this gives $P_T$ the required universal property of a fibre product.
\end{proof}
\begin{rem}\lbl{rem:PROJFibreProducts}
	The isomorphism $\PROJ_T(\tau^*\Rr)\isomorphism\PROJ_S(\Rr)\times_ST$ exists in full generality, even when $\Rr$ is not generated by $\Rr_0$ and $\Rr_1$. To prove this, one can reduce this to an affine-local question (as usual) and then use $\Proj (R\otimes_{R_0}A)\cong \Proj R\times_{\Spec R_0}\Spec A$. Also, it seems worth pointing out the similarity to Corollary~\reff{cor.SPECfibreProducts}.
\end{rem}
Let $\Rr$ be an $\IN_0$-graded quasi-coherent $\Oo_S$-algebra, $\Ll$ a line bundle on $S$ and
\begin{align*}
	\Rr^{(\Ll)}=\bigoplus_{k=0}^\infty\Rr_k\otimes_{\Oo_S} \Ll^{\otimes k}
\end{align*}
with the $\Oo_S$-algebra structure defined by $(r\otimes \lambda)\cdot (s\otimes \mu)=(rs)\otimes (\lambda\otimes\mu)$ for $r\in\Rr_k(U)$, $s\in\Rr_{\ell}(U)$, $\lambda\in\Ll^{\otimes k}(U)$, and $\mu\in\Ll^{\otimes \ell}(U)$. We put $P^{(\Ll)}=\PROJ_S\big(\Rr^{(\Ll)}\big)$ and let $\rho$ be the projection $P^{(\Ll)}\morphism S$.
\begin{cor}\lbl{cor:PROJLTwist}
	There is a canonical isomorphism $i\colon P^{(\Ll)}\isomorphism P$ together with an isomorphism 
	\begin{align*}
		\iota\colon i^*\Oo_{P}(1)\otimes_{\Oo_{P}}\rho^*\Ll\isomorphism\Oo_{P^{(\Ll)}}(1)
	\end{align*}
	such that
	\begin{align*}
		\rho^*(\Rr_1\otimes_{\Oo_S}\Ll)\cong \rho^*\Rr_1\otimes_{\Oo_{P}}\rho^*\Ll\xrightarrow{i^*(\epsilon_1)\otimes\id_{\rho^*\Ll}}i^*\Oo_{P}(1)\otimes_{\Oo_{P}}\rho^*\Ll\isomorphism\Oo_{P^{(\Ll)}}(1)
	\end{align*}
	coincides with
	\begin{align*}
		\rho^*(\Rr_1\otimes_{\Oo_S}\Ll)\morphism[\epsilon_1]\Oo_{P^{(\Ll)}}(1)\;.
	\end{align*}
\end{cor}
\begin{proof}[Sketch of a proof (what did you expect)]
	We construct an epimorphism
	\begin{align*}
		\alpha\colon \rho^*\Rr^{(\Ll)}\epimorphism \bigoplus_{k=0}^\infty\Oo_{P^{(\Ll)}}(k)\otimes_{\Oo_{P^{(\Ll)}}}\rho^*\Ll^{\otimes( -k)}\cong \bigoplus_{k=0}^\infty\left(\Oo_{P^{(\Ll)}}(1)\otimes_{\Oo_{P^{(\Ll)}}}\rho^*\Ll^{-1}\right)^{\otimes k}\;.
	\end{align*}
	By Corollary~\reff{cor:PROJQuasiAdjunction}, $\alpha$ induces a morphism $i\colon\PROJ_S(\Rr^{(\Ll)})\morphism\PROJ_S(\Rr)$. Then $i$ is easily seen to be an isomorphism since we can construct an inverse in quite a similar fashion. And the rest of the assertions then follows quite easily.
	
	To construct $\alpha$, note that 
	\begin{align*}
		\rho^*\Rr\cong \rho^*\bigg(\bigoplus_{k=0}^\infty\Rr_k\otimes_{\Oo_S}\Ll^{\otimes k}\otimes_{\Oo_S}\Ll^{\otimes(-k)}\bigg)\cong \bigoplus_{k=0}^\infty\rho^*\Rr_k^{(\Ll)}\otimes_{\Oo_{P^{(\Ll)}}}\rho^*\Ll^{\otimes(-k)}
	\end{align*}
	using that $\rho^*$ commutes with direct sums (arbitary colimits actually, as $\rho^*$ is a left-adjoint functor) and tensor products (by Remark~\reff{rem:SheafInverseImage}\itememph{d}). Now all we need to do is to prove the following Lemma~\reff{lem:RkEpi} (and apply it to $\rho$ and $\Rr^{(\Ll)}$ instead of $\pi$ and $\Rr$).
\end{proof}
\begin{lem}\lbl{lem:RkEpi}
	Let $\Rr$ be generated by $\Rr_0$ and $\Rr_1$. The canonical morphism $\pi^*\Rr_k\morphism[\epsilon_k]\Oo_P(k)$ associated to $\Rr_k\morphism[\rho_k]\pi_*\Oo_P(k)$ from Fact~\reff{fact:PROJProperties}\itememph{d} by the $\pi^*$-$\pi_*$ adjunction is an epimorphism.
\end{lem}
\begin{proof}
	It suffices to show this for affine open subsets $U\subseteq S$. Let $\Rr|_U=\snake{R}$, then $\pi^{-1}(U)=\Proj R$ and we need to show that $\pi^*\snake{R}_k\morphism\Oo(k)$ is an epimorphism. On affine open subsets of the form $\Proj R\setminus V(f)$ for $f\in R_1$ (and $\Proj R$ may be covered by such subsets as $\Rr$ is generated by $\Rr_0$ and $\Rr_1$) we know from Remark~\reff{rem:SheafInverseImage}\itememph{c} that $\pi^*\snake{R}_k$ is given by the $(R_f)_0$-module $R_k\otimes_{\Oo_S(U)}(R_f)_0$ and $\Oo(k)$ by $(R_f)_k$. But since $f$ has homogeneous degree $1$ and $R_k$ is generated by $R_0$ and $R_1$, every element of $x\in (R_f)_k$ can be written as $x=\sum_{i=1}^Nx_i\epsilon_i$ with $x_i\in R_k$ and $\epsilon_i\in (R_f)_0$, so $\epsilon_k$ is easily seen to be surjective on these subsets, hence on stalks and that's all we need.
\end{proof}
Let $\Rr$ and $\Ss$ be $\IN_0$-graded $\Oo_S$-algebras satisfiying the assumptions of Proposition~\reff{prop:PROJQuasiAdjunction} and let $\Tt=\bigoplus_{k=0}^\infty\Tt_k$, where $\Tt_k=\Rr_k\otimes_{\Oo_S}\Ss_k$, equipped with the obvious $\Oo_S$-algebra structure. Let $X=\PROJ_S(\Rr)\morphism[\pi_X]S$, $Y=\PROJ_S(\Ss)\morphism[\pi_Y]S$ and $Z=X\times_SY$. Let $Z\morphism[p_X]X$ and $Z\morphism[p_Y]Y$ be the projections to the two factors and $\zeta=\pi_Xp_X=\pi_Yp_Y$. Finally, let $\Ll=p_X^*\Oo_X(1)\otimes_{\Oo_Z}p_Y^*\Oo_Y(1)$ be a line bundle on $Z$.

We have epimorphisms of $\Oo_Z$-modules
\begin{align*}
	\zeta^*\Tt_k\cong \zeta^*\Rr_k\otimes_{\Oo_Z}\zeta^*\Ss_k\epimorphism p_X^*\Oo_X(k)\otimes_{\Oo_Z}p_Y^*\Oo_Y(k)\cong\Ll^{\otimes k}
\end{align*}
defined by the tensor product of $p_X^*\left(\pi_X^*\Rr_k\morphism[\epsilon_X]\Oo_X(1)\right)$ and $p_Y^*\left(\pi_Y^*\Ss_k\morphism[\epsilon_Y]\Oo_Y(1)\right)$. These epimorphisms intertwine the product $\zeta^*\Tt_k\times \zeta^*\Tt_\ell\morphism \zeta^*\Tt_{k+\ell}$ on $\Tt$ with the tensor multiplication $\Ll^{\otimes \ell}\otimes_{\Oo_S}\Ll^{\otimes k}\morphism\Ll^{\otimes(k+\ell)}$. Application of Proposition~\reff{prop:PROJQuasiAdjunction} gives a morphism $Z\morphism\PROJ_S(\Tt)$ of $S$-preschemes. 
\begin{prop}\lbl{prop:technicalAFIso}
	This morphism is an isomorphism
	\begin{align*}
		\PROJ_S(\Rr)\times_S\PROJ_S(\Ss)\isomorphism\PROJ_S\bigg(\bigoplus_{k=0}^\infty \Rr_k\otimes_{\Oo_S}\Ss_k\bigg)\;.
	\end{align*}
\end{prop}
\begin{example}\lbl{ex:SegreEmbedding}
	For a prescheme $S$, put $\IP_S^n=\PROJ_S\Oo_S[X_0,\ldots,X_n]$ (note that in the special case $S=\Spec R$ this gives $\IP_S^n=\IP_R^n$, as one could expect). We have the closed embedding $\IP_S^m\times\IP_S^n\morphism[\sigma]\IP_S^{m+n+nm}$ defined by 
	\begin{align*}
		\Oo_S[X_0,\ldots,X_m]_k\otimes_{\Oo_S}\Oo_S[Y_0,\ldots,Y_n]_k\lmorphism \Oo_S\left[Z_{i,j}\st 1\leq i\leq m,\ 1\leq j\leq n\right]_k
	\end{align*}
	sending $Z_{i,j}$ to $X_i\otimes Y_j$. This is the so-called \emph{Segre embedding}.
\end{example}
\begin{proof}[Sketch of a proof of Proposition~\reff{prop:technicalAFIso}]
	One confirms that for any morphism of preschemes $T\morphism[\tau]S$, any line bundle $\Ll$ on $T$ and any morphism
	\begin{align*}
		\alpha\colon \tau^*\Tt\epimorphism\bigoplus_{i=0}^\infty\Ll^{\otimes k}
	\end{align*}
	of $\Oo_T$-algebras which is an epimorphism on stalks one has a decomposition $\Ll\cong\Mm\otimes_{\Oo_T}\Nn$ with line bundles $\Mm$ and $\Nn$ on $T$ and epimorphisms 
	\begin{align*}
		\beta\colon \tau^*\Rr\epimorphism\bigoplus_{i=0}^{\infty}\Mm^{\otimes k}\quad\text{and}\quad\gamma\colon\tau^*\Ss\epimorphism\bigoplus_{i=0}^{\infty}\Nn^{\otimes k}
	\end{align*}
	of graded $\Oo_T$-algebras, whose (homogeneous component-wise) tensor product is $\alpha$. This will verify the required universal property for $\PROJ_S(\Tt)$. 
	
	To construct $\Mm$ and $\Nn$, we can do the following. Choose an affine open subset $U\subseteq S$ where $\Ll$ trivializes and let $\Rr|_U=\snake{A}$, $\Ss|_U=\snake{B}$, $\Tt|_U=\snake{C}$, and $\Ll|_U=\snake{L}$ (with $L\cong \Oo_S(U)$). We may take $\Mm|_U=\snake{M}$ where $M\subseteq L$ is the image of $\tau^*\left((A_1\otimes 1)^\qcmod\right)\subseteq \tau^*\snake{C_1}$; and for $\Nn$ we do quite the same. Then $M\otimes_{\Oo_S(U)}N\cong L$, so $M$ and $N$ are invertible $\Oo_S(U)$-modules and thus locally free of rank one\footnote{See \cite[\stackstag{0AFW}]{stacks-project}. Note that the \emph{omitted details} in the proof of Lemma~15.99.2 are basically that $\Hom_R(M,R)_f\cong \Hom_{R_f}(M_f,R_f)$, for which we need that $M$ is finitely presented (compare \cite[p.~9]{homalg}). But this always holds for modules which are locally free of finite rank. Actually, being finitely presented is a local property, cf.\ \cite[\stackstag{00EO}]{stacks-project}.}, i.e., $\Mm|_U$ and $\Nn|_U$ are line bundles.
	
	Now the construction seems ``canonical enough that it can be globalized''.
\end{proof}
%We are finally ready to define what a \emph{projective morphism} is.
\begin{defi}\lbl{def:projectiveMorphism}
	Let $X\morphism[\xi]S$  be a morphism of preschemes.
	\begin{alphanumerate}
		\item The morphism $\xi$ is called \defemph{projective} if there is an $\IN_0$-graded quasi-coherent $\Oo_S$-algebra $\Rr$ generated by $\Rr_0$ and $\Rr_1$; and $\Rr_1$ is a locally finitely generated $\Oo_S$-module, together with an isomorphism $X\isomorphism\PROJ_S(\Rr)$ of $S$-preschemes.
		\item The morphism $\xi$ is called \defemph{strongly projective} if it factors as
		\begin{align*}
			X\morphism[i]\IP_S^n\morphism S\;,
		\end{align*}
		where $i$ is a closed embedding and $\IP_S^n=\PROJ_S\Oo_S[X_0,\ldots,X_n]$.
	\end{alphanumerate}
\end{defi}
\begin{rem*}
	Definition~\reff{def:projectiveMorphism}\itememph{a} (at least in the noetherian case) is the EGA definition while \itememph{b} is Hartshorne's. It turns out that \itememph{b} implies \itememph{a}. In between these two is the class of morphisms $\xi$ which may be factored $X\morphism\IP(\Ee)\morphism S$, where $\Ee$ is a vector bundle and
	\begin{align*}
		\IP(\Ee)=\PROJ_S\bigg(\bigoplus_{k=0}^\infty\Ee^{\otimes k}\bigg)\;.
	\end{align*} 
	Both definitions are in use.
\end{rem*}
\begin{fact}\lbl{fact:ProjectiveStableUnderBaseChange}
	If $X\morphism[\xi]Y$ is projective (or strongly projective) then the base change
	\begin{align*}
		\snake{X}=X\times_Y\snake{Y}\morphism[\snake{\xi}]\snake{Y}
	\end{align*}
	is projective (resp.\ strongly projective) again. If $\snake{Y}\morphism[\upsilon] Y$ is also (strongly) projective, then the same holds for $\snake{X}\morphism Y$.
\end{fact}
\begin{proof}
	First suppose that $\xi$ is projective, i.e., $X\cong \PROJ_Y(\Rr)$ for some suitable $\Rr$ as in Definition~\reff{def:projectiveMorphism}\itememph{a}. By Corollary~\reff{cor:PROJpull-back}, $\snake{X}\cong \PROJ_{\snake{Y}}(\upsilon^*\Rr)$, so $\snake{\xi}$ is projective. Moreover, when $\upsilon$ is projective, we have $\snake{Y}\cong \PROJ_Y(\Ss)$ for some suitable $\Ss$, hence $\snake{X}\cong \PROJ_Y(\Tt)$ with $\Tt$ as in Proposition~\reff{prop:technicalAFIso}.
	
	Now let $\xi$ be strongly projective and $X\morphism[i]\IP_Y^n\morphism Y$ the associated factorization of $\xi$. We obtain a factorization of $\snake{\xi}$ via
	\begin{align*}
		\snake{X}\morphism[\snake{i}]\IP_Y^n\times_Y\snake{Y}\morphism\snake{Y}\;,
	\end{align*}
	in which $\snake{i}$ is a closed immersion (these guys are stable under base change by \cite[Corollary~1.3.3]{alggeo1}) and 
	\begin{align*}
		\IP_Y^n\times_Y\snake{Y}\cong \PROJ_{\snake{Y}}\left(\upsilon^*\Oo_Y[X_0,\ldots,X_n]\right)\cong \PROJ_{\snake{Y}}\Oo_{\snake{Y}}[X_0,\ldots,X_n]\cong \IP_{\vphantom{\widetilde{Y}}\snake{Y}}^n
	\end{align*}
	(using $\upsilon^*\Oo_Y=\Oo_{\snake{Y}}$, cf.\ Remark~\reff{rem:SheafInverseImage}\itememph{b}). This shows that $\snake{\xi}$ is strongly projective again. If moreover $\upsilon$ is strongly projective as well, $\snake{X}\morphism Y$ factors over some 
	\begin{align*}
		\snake{X}\morphism\IP_Y^n\times_Y\IP_Y^m\morphism[\sigma]\IP_Y^{m+n+mn}\morphism Y\;,
	\end{align*}
	in which $\sigma$ is the Segre embedding from Example~\reff{ex:SegreEmbedding}.	
\end{proof}
\begin{prop}\lbl{prop:ClosedImmersionPreservesProjective}
	Let $X\monomorphism[i]Y$ be a closed immersion and $Y\morphism[f]S$ a projective (resp.\ strongly projective) morphism. Then $f i$ is (strongly) projective again.
\end{prop}
\begin{proof}
	For strong projectivity, this is trivial since the class of closed immersions is closed under composition. 
	
	The proof for the projective for the projective case we did in the lecture was quite cumbersome and I don't think that's necessary (I hope I didn't miss the point). The following does pretty much the same, but in simpler words.
	
	Let $f$ be projective and $Y=\PROJ_S(\Rr)$ where $\Rr$ is as in Definition~\reff{def:projectiveMorphism}\itememph{a}. Locally, (i.e., over an affine open subset $U\cong \Spec A$ of $S$) the closed immersion $i$ looks like $\Proj R/I\monomorphism\Proj R$ identifying $\Proj R/I$ with the closed subset $V(I)$ of $\Proj R$, where $R=\Rr(U)$ is a graded $A$-algebra and $I\subseteq R$ a homogeneous ideal. The sheaf of graded ideals $\Ii\subseteq \Rr$ obtained in this way\footnote{Ok, actually we only get a presheaf defined on the topology base of affine open subsets of $S$, and then we need to sheafify.} is quasi-coherent. Indeed, if we replace $\Spec A$ by $\Spec A\setminus V(\lambda)\cong\Spec A_\lambda$, $R$ is replaced by $R_\lambda$ (since $\Rr$ is quasi-coherent) and $V(I)$ by $V(I)\cap\Proj R_\lambda=V(I_\lambda)$. This identifies the closed immersion $i$ with $\PROJ_S(\Rr/\Ii)\monomorphism\PROJ_S(\Rr)$ and we are done.
	%
	%Let $\Jj_X$ be the sheaf of ideals defining the closed subprescheme $X\subseteq Y$ and let $\Ii_n\subseteq \Rr_n$ be the preimage of $f_*\Jj_X(n)\subseteq f_*\Oo_Y(n)$ under the morphism $\Rr_n\morphism f_*\Oo_Y(n)$. Let $\Ii=\bigoplus_{n=0}^\infty \Ii_n$ and put $\snake{\Rr}=\Rr/\Ii$ and $\snake{X}=\PROJ_S(\snake{\Rr})$. 
	%
	%The morphism $\Rr\morphism\snake{\Rr}$ defines a closed embedding $\snake{X}\morphism Y$. Indeed, locally, this looks like $\Proj R/I\morphism\Proj R$, where $I\subseteq R$ is a homogeneous ideal, and $\Proj R/I$ is mapped homeomorphically onto $V(I)\subseteq \Proj R$. Moreover, $((R/I)_{\pp/I})_0\cong (R_{\pp})_0/(I_\pp)_0$ for all homogeneous prime ideals $\pp\supseteq I$, so we get surjections on stalks and thus have all required properties.
	%
	%We claim that $\snake{X}=X$ as closed subpreschemes of $Y$, proving the claim as $\snake{X}\morphism S$ is projective. How can we picture $\snake{X}$? The closed subprescheme $\snake{X}$ is surely cut out by some quasi-coherent sheaf of ideals $\Ii_X\subseteq \Oo_Y$, so the question is how does $\Ii_X$ look and how is it related to $\Ii$ and $\Jj_X$? We may consider this locally and thus assume that $S=\Spec A$ is affine, $Y=\Proj R$ and $\snake{X}=\Proj R/I$ for some homogeneous ideal $I\subseteq R$ in the graded $A$-algebra $R$. On open subsets of the form $U=Y\setminus \lambda$ for homogeneous $\lambda\in R_+$ we have $\Oo_Y(U)=(R_\lambda)_0$ and $\Ii_X(U)=(I_\lambda)_0$. So what we need to show is that $\Jj_X(U)=(I_\lambda)_0$. It is clear that $(I_\lambda)_0\subseteq \Jj_X(U)$ since that's how we constructed $I$ (or rather $\Ii$). The converse is shown in Lemma~\reff{lem:ProjClosedEmbedding} (in somewhat more generality -- here we need the case $n=0$).
\end{proof}
%\begin{lem}\lbl{lem:ProjClosedEmbedding}
%	Let $n\in\IN_0$ be arbitrary and $d>0$. If $\lambda\in R_d$ and $g\in\Jj_X(n)(U)$ for the open subset $U=Y\setminus V(\lambda)$, then there is some $k\in\IN$ and $\gamma\in I_{dk+n}$ such that $g=\gamma \lambda^{-k}$.
%\end{lem}
%\begin{proof}
%	Apply Lemma~\reff{lem:powersOfLl}\itememph{b} to the quasi-coherent $\Oo_Y$-module $\Jj_X$ and the ample line bundle $\Oo(d)$ to see that $g\lambda^k$ can be extended to a global section $\gamma_k\in\Jj_X(dk+n)(Y)$ for $k\gge 0$. We may assume $\gamma_{k+1}=\gamma_k\lambda$. On the other hand, $g$ is an element of $\Oo_Y(n)(U)\cong (R_\lambda)_n$ as well, so $\gamma_k'=g\lambda^k\in R_{dk+n}$ for $k\gge 0$. By Lemma~\reff{lem:powersOfLl}\itememph{a}, $\gamma_k=\gamma_k'$ for $k\gge 0$. But this implies that $\gamma_k=\gamma\in I_{dk+n}$ by definition of $I$ (we just proved that $\gamma$ is in the preimage of $\Jj_X(dk+n)(Y)=f_*\Jj_X(dk+n)(S)$ under $R_{dk+n}\morphism f_*\Oo_Y(n)(S)$ and that's what we need), when $k$ is sufficiently large.
	
%	Note that we can do all this because $R_1$ is finitely generated by Definition~\reff{def:projectiveMorphism}\itememph{a}, hence $\Proj R$ is quasi-compact by the proof of Proposition~\reff{prop:FirstProjProperties}\itememph{e}. Moreover, $\Proj R$ is a scheme, hence (separated and thus) quasi-separated. So all assumptions of Lemma~\reff{lem:powersOfLl} are fulfilled.
%\end{proof}
\begin{cor}
	\begin{alphanumerate}
		\item \lbl{cor:StronglyProjective}Every strongly projective morphism is projective.
		\item If there is an ample line bundle on $S$, then any projective morphism $X\morphism S$ is strongly projective as well.
	\end{alphanumerate}
\end{cor}
\begin{proof}
	Part \itememph{a} follows by applying Proposition~\reff{prop:ClosedImmersionPreservesProjective} to the composition $X\morphism\IP_S^n\morphism S$, where $\IP_S^n=\PROJ_S\Oo_S[X_0,\ldots,X_n]\morphism S$ is projective.
	
	Part \itememph{b}. Let $X=\PROJ_S(\Rr)$. If $\Ll$ is an ample line bundle on $S$, then $\Rr_1\otimes_{\Oo_S}\Ll^{\otimes k}$ is generated by its global sections when $k\gge 0$ (Definition~\reff{def:AmpleLineBundle}\itememph{b}). Replacing $\Rr$ by $\Rr^{(\Ll^{\otimes k})}$ (we can do this by Corollary~\reff{cor:PROJLTwist}) we may assume $\Rr_1$ to be generated by its global sections\footnote{And even finitely many of them since $\Rr_1$ is locally finitely generated by Definition~\reff{def:projectiveMorphism}\itememph{a} and $S$ is quasi-compact, as quasi-compactness is assumed in Definition~\reff{def:AmpleLineBundle}.}, say, $\xi_0,\ldots,\xi_n$. Then $\Oo_S[X_0,\ldots,X_n]\morphism\Rr$, $X_i\mapsto \xi_i$ is an epimorphism of $\IN_0$-graded quasi-coherent $\Oo_S$-algebras, defining a closed embedding $X\morphism\IP_S^n$ of $S$-preschemes. Hence $X\morphism S$ is strongly projective.
\end{proof}
\begin{prop}
	Let $X\morphism[f]Y\morphism[g]Z$ be strongly projective morphisms. Then $gf$ is strongly projective again. If $f$ and $g$ are only projective, we need that $Z$ is quasi-compact and quasi-separated in order to have $gf$ is projective.
\end{prop}
\begin{proof}
	We have closed embeddings $X\morphism\IP_Y^m$ and $Y\morphism\IP_Z^n$, defining
	\begin{align*}
		\IP_Y^m\morphism\IP_{\IP_Z^n}^m\cong \IP_Z^m\times_Z\IP_Z^n\morphism[\sigma]\IP_Z^{m+n+mn}
	\end{align*}
	where $\sigma$ the Segre embedding from Example~\reff{ex:SegreEmbedding}, hence a closed immersion. Thus we find closed immersions 
	\begin{align*}
		X\morphism \IP_Y^m\morphism\IP_{\IP_Z^n}^m\morphism\IP_Z^{m+n+mn}\;.
	\end{align*}	
	The second assertion is harder and Professor Franke refers to EGA.
\end{proof}
\begin{example}\lbl{ex:SPECandPROJ}
	Let $\Aa$ be a quasi-coherent $\Oo_S$-algebra and $\Rr$ the graded $\Oo_S$-algebra defined by
	\begin{align*}
		\Rr_k=\begin{cases}
			\Oo_S\cdot T^0 & \text{if }k=0\\
			\Aa\cdot T^k & \text{if }k>0
		\end{cases}\;,
	\end{align*}
	then $\PROJ_S(\Rr)\cong \SPEC_S(\Aa)$ (indeed, we may check this locally where it amounts to \cite[Example~2.6.2]{alggeo1}).
\end{example}
\begin{cor}
	Finite morphisms are projective.
\end{cor}
\begin{proof}
	Apply Example~\reff{ex:SPECandPROJ} and \cite[Lemma~2.5.1\itememph{c}]{alggeo1}.
\end{proof}
\begin{thm}\lbl{thm:ProjectiveCoherent}
	Let $X\morphism[f]S$ be a projective morphism of locally noetherian preschemes and $\Mm$ a coherent $\Oo_X$-module. Then the $\Oo_S$-modules $R^kf_*\Mm$ are coherent for all $k\in\IN$.
\end{thm}
\begin{proof}
	The assertion is local with respect to $S$, whence we may assume $S=\Spec A$ to be affine, where $A$ is noetherian. Then $X=\Proj R$, where $R$ is some graded $A$-algebra with $R_0=A$ (we may assume this w.l.o.g.\ -- otherwise exchange $R_0$ by $A$ and this doesn't change anything) and $R$ is generated by $R_0$ and $R_1$ and $R_1$ is a finitely generated $R_0$-module. If $\xi_0,\ldots,\xi_n\in R_1$ are such generators, then they define a closed embedding $X\monomorphism[i]\IP_A^n$ of $A$-preschemes as in the proof of Corollary~\reff{cor:StronglyProjective}\itememph{b}. Let $\IP_A^n\morphism[p] \Spec A$ be the canonical projection. Then $f=pi$. Moreover, since $p$ is quasi-compact (by an argument as in the proof of Proposition~\reff{prop:FirstProjProperties}\itememph{e}) and $i$ is affine (as is any closed immersion), we can deduce from Corollary~\reff{cor:AffinePushforwardIso} that $R^kf_*\Mm=R^kp_*(i_*\Mm)$. As $i_*\Mm$ is coherent (this is easy), $H^k(\IP_A^n,i_*\Mm)$ is a finitely generated $A$-module by Theorem~\reff{thm:SerreTwistStuff}, hence $R^kp_*(i_*\Mm)$ is a coherent $\Oo_S$-module.
\end{proof}
\begin{prop}
	Let $X\morphism[f]Y\morphism[g]S$ be morphisms such that $g$ is separated and $gf$ is projective (resp.\ strongly projective). Then $f$ is (strongly) projective as well.
\end{prop}
\begin{proof}
	Using Fact~\reff{fact:ProjectiveStableUnderBaseChange} and Proposition~\reff{prop:ClosedImmersionPreservesProjective}, this follows from the following Lemma~\reff{lem:technicalLemma}.
\end{proof}
\begin{lem}\lbl{lem:technicalLemma}
	Let $\Cc$ be a class of morphisms contained in the class of separated morphisms, stable under base-change and such that $fi\in\Cc$ when $f\in \Cc$ and $i$ is a closed embedding. Then from $gf\in\Cc$ and $g$ separated it follows that $f\in \Cc$.
\end{lem}
\begin{proof}
	Consider the commutative diagram
	\begin{diagram*}
		\node[ob] (X) at (0,0) {$X$};
		\node[ob] (Y) at (3,0) {$Y$};
		\node[ob] (Z) at (1.5,-1.25) {$Z$};
		\node[ob] (XZY) at (1.5,1.25) {$X\times_ZY$};
		\scriptsize
		\draw[dashed,->] (X) -- (Y) node[pos=0.5, above] {$f$};
		\draw[bend left, dotted,->] (X) to node[pos=0.5, above left] {$i$} (XZY);
		\draw[->] (XZY) -- (X) node[pos=0.5, below right] {$\pi_X$};
		\draw[->] (XZY) -- (Y) node[pos=0.5, above right] {$h$};
		\draw[->] (X) -- (Z) node[pos=0.5, below left] {$gf$};
		\draw[->] (Y) -- (Z) node[pos=0.5, below right] {$g$};
	\end{diagram*}
	in which $i=(\id_X,f)$ and $h$ is the base change of $X\morphism[gf]Z$ with respect to $Y\morphism[g]Z$. Then $X\times_ZY\morphism[\pi_X]X$ is separated as it is a base change of the separated morphism $g$ (and the class of separated morphisms is stable under base change by \cite[Fact~1.5.7\itememph{c}]{alggeo1}), hence $i$ is a closed immersion by \cite[Proposition~1.5.5]{alggeo1} as it is a section of $\pi_X$. Since $\Cc$ is closed under base change, we have $h\in \Cc$. It follows that $f=hi\in\Cc$.
\end{proof}
\section{Proper morphisms}
\begin{defi}\lbl{def:proper}
	Let $X\morphism[f]Y$ be a morphism of preschemes, where $Y$ is locally noetherian. We call $f$ \defemph{proper} if it is of finite type, separated and \emph{universally closed}.
\end{defi}
\begin{defi}\lbl{def:universallyClosed}
	A morphism $X\morphism[f]Y$ of preschemes is \defemph{closed} if the image of any closed subset if $X$ is closed in $Y$. It is \defemph{universally closed} if all its base changes 
	\begin{align*}
		\snake{X}=X\times_Y\snake{Y}\morphism[\snake{f}]\snake{Y}
	\end{align*}
	with respect to any $\snake{Y}\morphism Y$ are closed as well.
\end{defi}
\begin{rem}
	Obviously, the classes of closed and universally closed are stable under composition and base-local. The class of universally closed morphisms is also stable under base change. It follows that the class $\Cc$ of proper morphisms is base-local and stable under composition and base change as the other properties involved in Definition also have this property (by \cite[Fact~1.5.7\itememph{c} and Fact~2.2.2]{alggeo1}).
	
	Also, closed immersions are proper, as are any \emph{finite} morphisms (cf.\ Definition~\reff{def:AffineMorphism}\itememph{b}) by \cite[Example~2.6.1]{alggeo1}. Combined with Lemma~\reff{lem:technicalLemma}, this gives
\end{rem}
\begin{prop}\lbl{prop:er}
	The class of proper morphisms is base-local and stable under composition and base change, and if $X\morphism[f]Y\morphism[g]Z$ are morphisms of preschemes such that $gf$ is proper and $g$ separated, then $f$ is proper.
\end{prop}
\begin{prop}
	If $\Rr$ is an $\IN_0$-graded $\Oo_X$-algebra which is locally of finite type, then the morphism $\PROJ_X(\Rr)\morphism X$ is proper. In particular, projective morphisms are proper.
\end{prop}
\begin{proof}
	By Proposition~\reff{prop:er}, the question is local on $X$ and we may assume $X=\Spec A$ and need to show $\Proj R\morphism A$ is proper when $R$ is an $\IN_0$-graded $A$-algebra of finite type. We already know that $\Proj R$ is a scheme of finite type over $\Spec A$ (Proposition~\reff{prop:FirstProjProperties}\itememph{b}, \itememph{e}). Hence only universal closedness has to be shown.
	
	However, morphisms of the form $\PROJ_X(\Rr)\morphism X$ with $\Rr$ as above still have this form when base changed, by Corollary~\reff{cor:PROJpull-back} (or actually Remark~\reff{rem:PROJFibreProducts} since we potentially need to drop the assumption on $\Rr_0$ and $\Rr_1$ here). So it suffices to show closedness. This is again base-local, so it suffices to show that $\Proj R\morphism\Spec A$ is closed. Moreover, using the argument from \cite[Corollary~2.6.1]{alggeo1} it is even enough to show that $\Proj R$ has closed image in $\Spec A$.
	
	We will do this by generalizing (the proof of) \cite[Proposition~2.6.1]{alggeo1}, dropping the assumption that $R$ is generated by $R_0$. Instead, let $R$ be generated by its homogeneous components $R_0,\ldots,R_d$ as an $A$-algebra (we can do this by choosing finitely many generators of $R$ over $A$ and taking $d$ the maximal homogeneous degree where they are supported). Consider the ideals
	\begin{align}\lbl{eq:AnnullatorIdeal}
		I_i=\Ann_A\bigg(\bigoplus_{j\geq i}R_j\bigg)=\bigcap_{j=i}^{i+d}\Ann_A(R_j)\subseteq A
	\end{align}
	(we used that $R$ is generated by $R_0,\ldots,R_d$). Note that $I_1\subseteq I_2\subseteq \ldots$ is an ascending chain of ideals and put $I_\infty=\bigcup_{i=0}^\infty I_i$. We will show that the image of $\Proj R$ in $\Spec A$ equals $V(I_\infty)$.
	
	Let $\pp\in \Spec A$ be a prime ideal. We get $\pp\in V(I_i)$ iff there is an $i\leq j\leq i+d$ such that $R_j\otimes_A\KK(\pp)\neq 0$ by the Nakayama argument from the proof of \cite[Proposition~2.6.1]{alggeo1}. Then $\pp\in V(I_\infty)$ iff $\pp\in V(I_i)$ for all $i\geq 0$ iff $\pp\in V(I_i)$ for infinitely many $i$ (the $I_i$ are ascending) iff $R_j\otimes_A\KK(\pp)\neq 0$ for infinitely many $j$. By \cite[Corollary~1.3.3]{alggeo1}, $\Proj(R\otimes_A\KK(\pp))\cong \Proj R\times_{\Spec A}\Spec \KK(\pp)$ is the \emph{fibre} (i.e., the preimage) of $\pp$ under $\Proj R\morphism\Spec A$. Since we are interested precisely in those $\pp\in\Spec A$ with non-empty fiber, all we need to show is the following
	\begin{claim*}
		If $R$ is an $\IN_0$-graded algebra of finite type over a field $k$, then $\Proj R\neq\emptyset$ iff there are infinitely many $j$ such that $R_j\neq 0$.
	\end{claim*}
	Indeed, if $R_j=0$ for $j\gge 0$, then $R_+\subseteq \sqrt{0}$, implying that $\Proj R=\emptyset$ since every homogeneous prime ideal would contain $R_+$. Conversely, if $\Proj R=\emptyset$ and $R$ is generated over $A$ by $\lambda_1,\ldots,\lambda_N$ which are homogeneous of positive degrees $<d$, then all $\lambda_i$ must be nilpotent, since otherwise $\emptyset\neq\Spec (R_{\lambda_i})_0\subseteq \Proj R$. Choose $e_i$ such that $\lambda_i^{e_i}=0$. Then $R_j=0$ for $j>\sum_{i=1}^Nde_i$.
\end{proof}
\begin{thm}\lbl{thm:ProperRpcoherent}
	Let $X\morphism[f]Y$ be a proper morphism of locally noetherian preschemes. If $\Mm$ is a coherent $\Oo_X$-module and $p\geq 0$, then $R^pf_*\Mm$ is a coherent $\Oo_Y$-module.
\end{thm}
\begin{cor}\lbl{cor:ProperHpFinGen}
	If $A$ is a noetherian ring and $X$ a proper $A$-scheme and $\Mm$ a coherent $\Oo_X$-module, then $H^p(X,\Mm)$ is a finitely generated $A$-module.
\end{cor}
\begin{proof}[Proof of Theorem~\reff{thm:ProperRpcoherent} (and Corollary~\reff{cor:ProperHpFinGen})]
	By Proposition~\reff{prop:HigherDirectImage}\itememph{b} and \itememph{d}, it actually suffices to prove Corollary~\reff{cor:ProperHpFinGen}. To do so, we follow exercise sheet \#10. Before we can do any \emph{dvissage}, we need to collect some facts about the \emph{scheme-theoretic support} of a coherent $\Oo_X$-module.
	\begin{defi}
		Let $(X,\Oo_X)$ be a ringed space and $\Mm$ any $\Oo_X$-module. The \defemph{support} $\supp\Mm$ is the set of all $x\in X$ such that $\Mm_x\neq 0$.
	\end{defi}
	\begin{lem}
		Let $X$ be a locally noetherian prescheme and $\Mm$ a coherent $\Oo_X$-module. Then the support $S=\supp\Mm$ is a closed subset of $X$ and $S\monomorphism[i]X$ can be equipped with a canonical closed subprescheme structure which fulfills the following universal property.
		\begin{quote}
			There is an $\Oo_S$-module $\Nn$ such that $\Mm=i_*\Nn$; and if $S'\monomorphism[i']X$ is another closed embedding for which there is an $\Oo_{S'}$-module $\Nn'$ such that $\Mm=i_*'\Nn'$, then $i$ factors uniquely over $i'$.
		\end{quote}	 
	\end{lem}
	\begin{proof}
		Let $U\subseteq X$ be an affine open subset and $R=\Oo_X(U)$. Let $M$ be an $R$-module such that $\Mm|_U=\snake{M}$. We put $\Aann_{\Oo_X}(\Mm)(U)=\Ann_R(M)$. Then $\Aann_{\Oo_X}(\Mm)$ defines (after sheafifying) a quasi-coherent sheaf of ideals in $\Oo_X$. Indeed, we only need to check that $\Ann_R(M)_f\cong\Ann_{R_f}(M_f)$ for all $f\in R$. Since $M$ is finitely generated ($\Mm$ being coherent) and an element $r\in R$ annullates $M$ iff it annullates the generators, this is easily checked.
		
		From \cite[Lemma~3.4.1]{alg2} we see that -- as a topological space -- $\supp \Mm$ equals the closed subprescheme of $X$ cut out by $\Aann_{\Oo_X}(\Mm)$. Also, the $R$-module structure on $M$ canonically descends to an $R/\Ann_R(M)$ structure; and if $I\subseteq R$ is an ideal such that the $R$-module structure on $M$ descends to an $R/I$-structure, then $I\subseteq \Ann_R(M)$. Globalizing these considerations, we easily deduce the universal property.
	\end{proof}
	We proceed with the proof of Corollary~\reff{cor:ProperHpFinGen}. The plan will be to use \emph{noetherian induction} on $\supp\Mm$. Suppose that Corollary~\reff{cor:ProperHpFinGen} is wrong for some $\Oo_X$-modules. Since $X$ is noetherian (it is of finite type over $\Spec A$ and $A$ is noetherian), the set
	\begin{align*}
		\MM=\left\{\supp\Mm\st\text{the assertion fails for }\Mm\right\}
	\end{align*}
	has a minimal element. Replacing $X$ by a minimal element of $\MM$, we may assume that $\supp\Mm=X$ and the assertion holds for all $\Oo_X$-modules supported on a strictly smaller subprescheme.
	
	The key idea of the proof is to use Chow's lemma (Theorem~\reff{thm:ChowsLemma}) and the Leray spectral sequence to replace $f$ by a projective morphism, for which finitely generatedness of cohomology has already been proved in Theorem~\reff{thm:ProjectiveCoherent}.
	
	By Chow's lemma we find a projective morphism $\snake{X}\morphism[\pi]X$ such that the resulting morphism $\snake{X}\morphism Y$ is projective as well and there is a dense open subset $U\subseteq X$ such that $\pi^{-1}(U)\morphism[\pi]U$ is an isomorphism. Then $\pi^*\Mm$ is a coherent $\Oo_{\snake{X}}$-module; and by Theorem~\reff{thm:ProjectiveCoherent}, $\pi_*\pi^*\Mm$ is coherent as well. We get a short exact sequence
	\begin{align}\lbl{eq:LESChow}
		0\morphism \Kk\morphism\Mm\morphism \pi_*\pi^*\Mm\morphism \Qq\morphism 0\tag{$*$}
	\end{align}
	of coherent $\Oo_X$-modules.
	\begin{claim}\lbl{claim:2bProvedW/Leray}
		For all $p\geq 0$, the cohomology groups $H^p(X,\pi_*\pi^*\Mm)$ are finitely generated $A$-modules.
	\end{claim}
	Believing this for the moment, the proof can be finished as follows. Since $\pi$ is an isomorphism over $U$, $\Mm\morphism\pi_*\pi^*\Mm$ is an isomorphism on $U$, hence $\Kk$ and $\Qq$ have support strictly smaller than $X$. Hence $H^p(X,\Kk)$ and $H^p(X,\Qq)$ are finitely generated for all $p\geq 0$. Split \eqreff{eq:LESChow} into two short exact sequences $0\morphism\Kk\morphism\Mm\morphism\Nn\morphism 0$ and $0\morphism \Nn\morphism\pi_*\pi^*\Mm\morphism \Qq\morphism 0$. By the long exact cohomology sequence associated to the second, we see that the $H^p(X,\Nn)$ are finitely generated $A$-modules for all $p\geq 0$ (this uses noetherianness of $A$). Applying this to the long exact sequence of the first one, this proves that the $H^p(X,\Mm)$ are finitely generated and we are done.
	
	It remains to prove Claim~\reff{claim:2bProvedW/Leray}. We have the Leray spectral sequence (cf.\ Section~\reff{sec:Rp} and exercise sheet \#6)
	\begin{align*}
		E_2^{p,q}=H^p\big(X,R^q\pi_*(\pi^*\Mm)\big)\converge H^{p+q}(\snake{X},\pi^*\Mm)\;.
	\end{align*}
	The $E_2$ page (and thus every other page) of the sequence is supported in the first quadrant. Note that the $E_2^{p,q}$ terms are finitely generated $A$-modules except for $q=0$. Indeed, $\pi$ is an isomorphism over $U$, hence in particular affine over $U$, and Proposition~\reff{prop:AffineMorphism}\itememph{c} gives $R^q\pi_*(\pi^*\Mm)|_U=0$ for $q>0$, so the $R^q\pi_*(\pi^*\Mm)$ have support strictly smaller than $X$ and $H^p\big(X,R^q\pi_*(\pi^*\Mm)\big)$ is finitely generated for $q>0$ by our ``induction hypothesis''.
	
	By \eqreff{eq:eta} and induction on $k$, all $E_k^{p,q}$ terms for $k\geq 2$ and $q>0$ are finitely generated $A$-modules. This is also true for $E_k^{p,0}=E_\infty^{p,0}$ when $k$ is sufficiently large. Indeed, the limit $H^{p+q}(\snake{X},\pi^*\Mm)$ is finitely generated over $A$ by Theorem~\reff{thm:ProjectiveCoherent}, hence so is its limit filtration (using noetherianness). Doing induction backwards, we see that the $E_2^{p,0}$ terms are finitely generated as well. This proves Claim~\reff{claim:2bProvedW/Leray}.
\end{proof}
\begin{thm}
	Let $X\morphism[f]\Spec A$ be a proper morphism. For a line bundle $\Ll$ on $X$, the following conditions are equivalent.
	\begin{alphanumerate}
		\item $\Ll$ is ample.
		\item Some power $\Ll^{\otimes k}$ (with $k\in\IN$) of $\Ll$ is \defemph{very ample} in the sense that $\Ll^{\otimes k}$ is generated by global sections $\ell_0,\ldots,\ell_n$ and the morphism $X\morphism\IP_A^n$ defined by Corollary~\reff{cor:PROJQuasiAdjunction} and the multiplicative epimorphism 
		\begin{align*}
			\Oo_X[X_0,\ldots,X_n]\epimorphism\bigoplus_{j=0}^\infty\Ll^{\otimes kj}
		\end{align*}
		sending $X_i\mapsto \ell_i$, is a closed embedding.
		\item For some $k\in\IN$, $\Ll^{\otimes k}$ is generated by global sections $\ell_0,\ldots,\ell_n$ and the above morphism $X\morphism\IP_A^n$ is finite (or equivalently, affine).
		\item $\Ll$ is a \defemph{cohomology killer}$\skull$ in the following sense. If $\Mm$ is a coherent $\Oo_X$-module and $p>0$, then $H^p(X,\Mm\otimes_{\Oo_X}\Ll^{\otimes k})=0$ for $k\gge 0$.
	\end{alphanumerate}
\end{thm}

\chapter{Cohomology of curves}
In this chapter, we will use the cohomology of proper morphisms to prove two famous results (in the case of curves over algebraically closed fields): \emph{Serre duality} (Theorem~\reff{thm:CurvesSerreDuality}) and the \emph{Theorem of Riemann--Roch} (Theorem~\reff{thm:RiemannRoch}). But before we can get into stating any results, we need to establish the connection between \emph{divisors} and \emph{line bundles} on curves.

Let $X$ be a quasi-compact connected one-dimensional regular scheme. 
\begin{con}\lbl{con:untoldStuff}
	In particular, $X$ is locally noetherian since \cite[Definition~2.4.5]{alggeo1} assumes this implicitly; hence even noetherian by quasi-compactness (usually, our curves will be proper -- and thus of finite type -- over some field $k$, so noetherianness is automatically satisfied). Then $X$ is even an integral scheme. Indeed, the underlying space of $X$ is noetherian (by properness) and the local rings $\Oo_{X,x}$ for all $x\in X$ are regular, hence domains (cf.\ \cite[Corollary~3.4.9\itememph{b}]{alg2}), so all assumptions required for \cite[Proposition~2.1.4\itememph{d}]{alggeo1} are fulfilled. Therefore, $X$ is irreducible and has a unique generic point $\eta$ by \cite[Fact~2.1.9]{alggeo1}. The local ring $K=\Oo_{X,\eta}$ there is a zero-dimensional regular local ring, hence a field.
	
	Keep these considerations in mind! We will use them quite often, and we might do so implicitly.
\end{con}
\begin{defi}\lbl{def:divisorLineBundle}
	Let $X$ be  a quasi-compact connected one-dimensional regular scheme and denote by $X_1$ its set of codimension $1$ (i.e., closed) points.
	\begin{alphanumerate}
		\item The \defemph{divisor group} $\Div(X)=\bigoplus_{x\in X_1}\IZ$ is the free abelian group generated by $X_1$ (which we already encountered on page~\pageref{par:Divisors}).
		\item For $D\in\Div(X)$, the associated line bundle $\Oo_X(D)$ is defined by
		\begin{align*}
		\Oo_X(D)(U)=\left\{f\in K\st v_x(f)\geq -D(x)\ \forall x\in U\cap X_1\right\}
		\end{align*}
		when $U\neq \emptyset$ (and $\Oo_X(\emptyset)=0$ of course). Here, $v_x\colon \Oo_{X,x}\morphism\IZ$ for $x\in X_1$ denotes the valuation of the DVR $\Oo_{X,x}$
	\end{alphanumerate}
\end{defi}
Note that $\Oo_{X,x}$ is a one-dimensional regular local ring if $x$ has codimension $1$, hence indeed a DVR by \cite[Theorem~21\itememph{e}]{alg2}. The following fact about the $\Oo_X(D)$ was briefly mentioned in the lecture, but I think it deserves to be a proposition -- and more importantly, to be proved.
\begin{prop}\lbl{prop:EverythingIsOXD}
	Let $X$ be a quasi-compact connected one-dimensional regular scheme.
	\begin{alphanumerate}
		\item The $\Oo_X(D)$ from Definition~\reff{def:divisorLineBundle}\itememph{b} is indeed a line bundle.
		\item Every line bundle $\Ll$ on $X$ is isomorphic to a line bundle of the form $\Oo_X(D)$. Moreover, the \defemph{divisor class} of $D$, i.e., its coset modulo $\left\{\div(f)=\sum_{x\in X_1}v_x(f)\cdot x\st f\in K^\times\right\}$, is uniquely determined. 
	\end{alphanumerate}
\end{prop}
\begin{proof}
	Part \itememph{a}. It suffices to show that $\Oo_X(D)(U)$ is an invertible $\Oo_X(U)$-module when $U\subseteq X$ is affine. Let $U\cong \Spec R$ where $R$ is a \emph{Dedekind domain} (well, it is a one-dimensional regular ring, cf.\ \cite[Theorem~22]{alg2}). The points $U\cap X_1$ are precisely the non-zero prime ideals of $R$ and $K=\Oo_{X,\eta}$ is the quotient field of $R$. Then it is easy to see that
	\begin{align*}
		\Oo_X(U)=\prod_{\pp\neq 0}\pp^{-D(\pp)}\subseteq K\;,
	\end{align*}
	which is a \emph{fractional ideal} of $R$ (cf.\ \cite[Definition~3.5.3]{alg2}). One particularly nice thing about Dedekind domains is that fractional ideals are always invertible, whence we are done.
	
	Part \itememph{b}. The stalk $\Ll_\eta$ at the generic point is a one-dimensional $K$-vector space. Fix an isomorphism $\phi\colon \Ll_\eta\isomorphism K$. If $\Spec R\cong U\subseteq X$ is affine open, the canonical morphism $\psi\colon \Ll(U)\morphism \Ll_\eta$ is obtained by tensoring the $R$-module $\Ll(U)$ with the quotient field $K=\Oo_{X,\eta}$ of $R$ (and sending $\lambda$ to $\lambda\otimes 1$). Since $\Ll(U)$ is projective (as a line bundle, $\Ll$ is locally free), it is torsion-free and thus $\psi$ is injective. Composing with $\phi$ identifies $\Ll(U)$ with a fractional ideal $I$ of $R$. Decomposing $I$ into prime factors (and doing this for all affine open $U\subseteq X$) provides us with a divisor $D$ such that $\Ll\cong\Oo_X(D)$ (just reverse what was done in \itememph{a}). This shows existence.
	
	Now about uniqueness of divisor classes. Let $D_1,D_2\in\Div(X)$ such that $\Oo_X(D_1)\cong \Oo_X(D_2)$. Using the upcoming Proposition~\reff{prop:OC(D)tensor}, we may tensor by $\Oo_X(-D_2)$ to obtain $\Oo_X\cong \Oo_X(D)$ for $D=D_1-D_2$. Take an isomorphism $\phi\colon \Oo_X\isomorphism\Oo_X(D)$ and let $f\in K$ be the image of $1\in K$ under $\phi$. Then for every affine open subset $\Spec R\cong U\subseteq X$, $f$ generates the fractional ideal of $R$ given by $\Oo_X(D)(U)$ which proves $v_\pp(f)=-D(\pp)$ for all $\pp\in\Spec R$. Covering $X$ by affine open subsets, this proves $\div(f)=-D=D_2-D_1$ and we are done.
\end{proof}
\begin{prop}\lbl{prop:OC(D)tensor}
	Let $X$ be a quasi-compact connected one-dimensional regular scheme. If $D_1,D_2\in\Div(X)$ are divisors, then 
	\begin{align*}
		\Oo_X(D_1)\otimes_{\Oo_X}\Oo_X(D_2)\cong\Oo_X(D_1+D_2)\;.
	\end{align*}
\end{prop}
\begin{proof}
	The isomorphism is given by $f\otimes g\mapsto fg$ for $f,g\in K=\Oo_{X,\eta}$. This is a well-defined morphism of line bundles (we use $v_x(fg)=v_x(f)+v_x(g)$ in Definition~\reff{def:divisorLineBundle}\itememph{b}). That it is an isomorphism can be checked on stalks. Actually, it suffices to check this on stalks at closed points. Indeed, restricting to an affine open subset $\Spec R$ a morphism of $R$-modules being an isomorphism can be checked at the maximal ideals, i.e., the closed points, i.e., the codimension-one points since $X$ is one-dimensional. If $x\in X$ is closed and $\Oo_{X,x}$ thus a DVR, we have 
	\begin{align*}
	\Oo_X(D_1)_x=\left\{f\in K\st v_x(f)\geq -D_1(x)\right\}=\pi_x^{-D_1(x)}\Oo_{X,x}\;,
	\end{align*}
	where $\pi_x$ is a uniformizer of $\Oo_{X,x}$ (the first equality may be easily checked and the second is obvious). Similarly, $\Oo_X(D_2)_x=\pi_x^{D_2(x)}\Oo_{X,x}$ and multiplication gives
	\begin{align*}
	\pi_x^{-D_1(x)}\Oo_{X,x}\otimes_{\Oo_{X,x}}\pi_x^{-D_2(x)}\Oo_{X,x}\isomorphism \pi_x^{-(D_1(x)+D_2(x))}\Oo_{X,x}\;,
	\end{align*}
	thus we get the required isomorphisms on stalks.
\end{proof}

Let us assume that $X$ is a $k$-scheme where $k$ is a field. We have seen that there are bijections
\begin{diagram*}
	\node[ob] (a) at (0,0) {$\left\{\begin{array}{c}
	\text{isomorphism classes}\\
	\text{of line bundles on }X
	\end{array}\right\}$};
	\node[ob] (b) at (6,0) {$\left\{\begin{array}{c}
	\text{isomorphism classes}\\
	\text{of }\Oo_X^\times\text{-torsors}
	\end{array}\right\}$};
	\node [left=-0.5em of a] {$\Pic(X)\coloneqq$};
	\node[ob] (c) at (6,-2.25) {$\displaystyle H^1(X,\Oo_X^\times )$};
	\node [right =-0.5em of c] {$\coloneqq\colimit[\Uu]\check{H}^1(\Uu,\Oo_X^\times)$};
	\node[ob] (d) at (0,-2.25) {$H^1(X,\Omega_{X/k})$};
	\scriptsize
	\draw[->] (a) -- (b) node[pos=0.5, above=-0.25ex] {$\sim$};
	\draw[->] (b) -- (c) node[pos=0.5, sloped, above=-0.25ex] {$\sim$};
	\draw[->] (c) -- (d) node[pos=0.5, above] {$d_{X/k}\log$};
	\draw[->, dashed] (a) -- (d) node[pos=0.5, left] {$c_1$};
\end{diagram*}
and denoted this composition by $c_1$. Also recall the \emph{Picard group} $\Pic(X)$ from Remark~\reff{rem:LineBundleGroup}\itememph{a}.
\section{Formulation of results}
Let $k$ be algebraically closed. All schemes to appear are supposed to be $k$-schemes and $\Omega_X\coloneqq\Omega_{X/\Spec k}$. Also, we use the term \emph{curve} instead of \emph{one-dimensional scheme}.
\begin{thm}\lbl{thm:CurvesSerreDuality}
	Let $C\morphism\Spec k$ be a proper morphism where $C$ is a regular curve.
	\begin{alphanumerate}
		\item There is a homomorphism $\deg\colon \Pic(C)\morphism\IZ$ such that 
		\begin{align*}
			\deg \Oo_C(D)\eqqcolon\deg D=\sum_{x\in C_1}D(x)\;.
		\end{align*}
		\item $H^1(C,\Omega_C)$ is a one-dimensional $k$-vector space and there is a unique isomorphism 
		\begin{align}\lbl{eq:H1isok}
			\tau\colon H^1(C,\Omega_C)\isomorphism k 
		\end{align}such that the diagram
		\begin{diagram}[baseline=0.75cm-0.5ex][\lbl{diag:H1PicAndStuff}]
			\node[ob] (a) at (0,1.5) {$\Pic(C)$};
			\node[ob] (b) at (3,1.5) {$H^1(C,\Omega_C)$};
			\node[ob] (c) at (3,0) {$k$};
			\node[ob] (d) at (0,0) {$\IZ$};
			\scriptsize
			\draw[->] (a) -- (b) node[pos=0.5, above] {$c_1$};
			\draw[->] (b) -- (c) node[pos=0.5, above=-0.25ex, sloped] {$\sim$} node[pos=0.5, left] {$\tau$};
			\draw[->] (d) -- (c) node[pos=0.5, above] {$\cdot 1$};
			\draw[->] (a) -- (d) node[pos=0.5, left] {$\deg$};
		\end{diagram}
		commutes.
		\item For every vector bundle $\Vv$ on $C$, there is a perfect pairing
		\begin{align*}
			H^0(C,\Vv)\times H^1(C,\Omega_C\otimes_{\Oo_C}\Vv^*)\morphism[m]H^1(C,\Omega_C)\isomorphism k
		\end{align*}
		of finite-dimensional vector spaces. Here, $\Vv^*\coloneqq\Hhom_{\Oo_C}(\Vv,\Oo_C)$ denotes the \defemph{dual bundle} and the pairing $m$ is given by $(v,\omega\otimes\ell)\mapsto \ell(v)\cdot \omega$.
	\end{alphanumerate}
\end{thm}
\begin{rem*}
	\begin{alphanumerate}
		\item Theorem~\reff{thm:CurvesSerreDuality}\itememph{b} and \itememph{c} are called \emph{Serre duality}. They still hold when $C$ is replaced by a \emph{smooth} scheme $X$ over an arbitrary field $k$ and $\Omega_C$ by $\omega_X=\bigwedge^{\dim X}\Omega_X$.
		\item When $n=\dim X\geq 2$, Theorem~\reff{thm:CurvesSerreDuality}\itememph{a} will no longer deal with line bundles and $c_1$ is replaced by $c_n$.
		\item When $k$ is not algebraically closed, the Theorem~\reff{thm:CurvesSerreDuality} still holds as stated as long as $C$ is \emph{smooth} over $k$, and we need to define
		\begin{align*}
			\deg D=\sum_{x\in C_1} D(x)\cdot [\KK(x):k]\;.
		\end{align*}
	\end{alphanumerate}
\end{rem*}
\begin{thm}[Riemann--Roch]\lbl{thm:RiemannRoch}
	Let $k$ be algebraically closed. Let $C\morphism\Spec k$ be a proper curve let $g=\dim_k\Omega_C(C)$ denote the \defemph{genus} of $C$. Let $\Vv$ be a $d$-dimensional vector bundle on $C$. Then
	\begin{align}\lbl{eq:RiemannRoch1}
		\chi(C,\Vv)\coloneqq\dim_k\Vv(C)-\dim_k H^1(C,\Vv)=\deg(\det\Vv)+d(1-g)\;,
	\end{align}
	where $\det \Vv=\bigwedge^d\Vv$ is a line-bundle with a alternating $d$-linear form $\Vv^d\morphism\det\Vv$ having the universal property for alternating $d$-linear forms $\Vv^d\morphism\Mm$ for $\Oo_C$-modules $\Mm$.
	
	By Serre duality, we also have
	\begin{align}\lbl{eq:RiemannRoch2}
		\dim_k\Vv(C)-\dim_k\Hom_{\Oo_C}(\Vv,\Omega_C)=\deg(\det\Vv)+d(1-g)\;.
	\end{align}
\end{thm}
\begin{rem*}
	\begin{alphanumerate}
		\item The $\chi(C,\Vv)$ occurring in Theorem~\reff{thm:RiemannRoch} is a special case of the \emph{Euler--Poincar characteristic}
		\begin{align*}
			\chi(X,\Mm)=\sum_{p=0}^{\dim X}(-1)^p\dim_kH^p(X,\Mm)\;,
		\end{align*}
		which we also encountered in Proposition~\reff{prop:SerreAgain}.
		\item Professor Franke sketched how to construct $\det\Vv$ and prove its universal property, but this is really just taking exterior products (which, it seems, he doesn't like), the construction of which is locally just taking ordinary  exterior products of modules.
		
		The $\Oo_C^\times$-torsor defined by $\det\Vv$ is the image of the $\GL_d(\Oo_C)$-torsor defined by $\Vv$ under $\GL_d(\Oo_C)\morphism[\det]\Oo_C^\times$.
	\end{alphanumerate}
\end{rem*}
\begin{cor}\lbl{cor:famous}
	For a divisor $D\in\Div(C)$, put $\ell(D)=\dim_k\Oo_C(D)(C)$. Also let $K\in\Div(C)$ be a \defemph{canonical divisor}, i.e., a divisor such that $\Oo_C(K)\cong\Omega_C$.\footnote{Why is $\Omega_C$ a line bundle? Locally, $C$ looks like $\Spec R$, where $R$ is a $k$-algebra of finite type and also one-dimensional noetherian regular. Hence \cite[Proposition~1.6.3]{alg2} gives that $\Omega_{R/k}$ is locally free of rank one -- that is, $\Omega_C$ is a line bundle.} Then we get the famous equation
	\begin{align}\lbl{eq:RiemannRoch3}
		\ell(D)-\ell(K-D)=\deg D+1-g\;.
	\end{align}
\end{cor}
\begin{proof}
	For a line bundle $\Vv=\Ll$, equation~\eqreff{eq:RiemannRoch2} becomes 
	\begin{align*}
		\dim_k\Ll(C)-\dim_k\Hom_{\Oo_C}(\Ll,\Omega_C)=\deg\Ll+1-g\;.
	\end{align*}
	Note that $\omega\otimes\ell\mapsto \omega\cdot \ell(-)$ gives an isomorphism $\Omega_C\otimes_{\Oo_C}\Ll^*\cong\Hhom_{\Oo_C}(\Ll,\Omega_C)$ (this is easy to check on stalks). Hence $\ell(K-D)$ is precisely the $k$-dimension of the global section of 
	\begin{align*}
		\Oo_C(K-D)\cong\Oo_C(K)\otimes_{\Oo_C}\Oo_C(-D)\cong \Omega_C\otimes_{\Oo_C}\Oo_C(D)^*\cong \Hhom_{\Oo_C}\big(\Oo_C(D),\Omega_C\big)
	\end{align*}
	(for the first isomorphism we used Proposition~\reff{prop:OC(D)tensor}), i.e.,
	\begin{align*}
		\ell(K-D)=\dim_k\Hom_{\Oo_C}(\Oo_C(D),\Omega_C)
	\end{align*}
	and we are done.
\end{proof}
\begin{cor}\lbl{cor:GenusOmega}
	We have $\deg K=\deg\Omega_C=2g-2$.
\end{cor}
\begin{proof}
	Taking $D=0$ in \eqreff{eq:RiemannRoch3} gives $\ell(0)=1$. Then taking $D=K$ gives $\deg K=2g-1-\ell(0)=2g-2$, as required.
\end{proof}
\begin{cor}
	If $D\in\Div(C)$ is a divisor, it fulfills Riemann's inequality $\ell(D)\geq \deg D+1-g$.
\end{cor}
\begin{proof}
	In \eqreff{eq:RiemannRoch3} we have $\ell(K-D)\geq 0$ (since this is a dimension of a vector space).
\end{proof}
\begin{example}
	If $C\morphism[i]\IP^2_k$ is a regular curve of \emph{degree} $d$ (this is defined in \cite[Definition~3.1.5]{alg2}, but we used the variety setting there) in $\IP_k^2$ it is given as the vanishing scheme of an irreducible homogeneous polynomial $P\in k[X,Y,Z]$ of degree $d$ and multiplication with $P$ gives an isomorphism $\Oo_{\IP_k^2}(-d)\isomorphism\Jj$, where $\Jj$ is the sheaf of ideals defining $C$. That is, $\Jj$ is given by the short exact sequence
	\begin{align*}
		0\morphism \Jj\morphism\Oo_{\IP_k^2}\morphism i_*\Oo_C\morphism 0\;.
	\end{align*}
	As $i$ is an affine morphism (it is a closed embedding), we have $H^p(C,\Oo_C)\cong H^p(\IP_k^n,i_*\Oo_C)$ by Corollary~\reff{cor:AffinePushforwardIso}, hence $\chi(C,\Oo_C)=\chi(\IP_k^2,i_*\Oo_C)$ and 
	\begin{align*}
		1-g&=\chi(C,\Oo_C)=\chi\big(\IP_k^2,i_*\Oo_C\big)=\chi\big(\IP_k^2,\Oo_{\IP_k^2}\big)-\chi(C,\Jj)=\chi\big(\IP_k^2,\Oo_{\IP_k^2}\big)-\chi\big(\IP_k^2,\Oo(-d)\big)\\
		&=1-\frac{(d-1)(d-2)}{2}
	\end{align*}
	using Proposition~\reff{prop:SerreAgain}\itememph{b} and the fact that the Hilbert polynomial of $R=k[X,Y,Z]$ as a graded module over itself (which gives $\Oo_{\IP_k^2}$) is given by $P_R(\ell)=\binom{\ell+2}{2}$ (cf.\ \cite[Lemma~3.0.1]{alg2}).
\end{example}
\section{First proofs}\lbl{sec:FirstProofs}
\subsection[Proof of Theorem\texorpdfstring{~\getrefnumber{thm:CurvesSerreDuality}\itememph{a}}{ 7(a)}]{Proof of Theorem\texorpdfstring{~\reff{thm:CurvesSerreDuality}\itememph{a}}{ 7(a)}}
In the following, all curves are assumed to be connected, regular, and proper over $k$ (don't forget our Convention~\reff{con:untoldStuff}).
\begin{lem}\lbl{lem:chiD}
	For any divisor $D\in\Div(C)$ we have
	\begin{align}\lbl{eq:RiemannRoch4}
	\chi(C,\Oo_C(D))=\deg D+\chi(C,\Oo_C)\;.
	\end{align}
\end{lem}
\begin{proof}
	For $D=0$, this is trivial. Using induction on $\sum_{x\in C_1}|D(x)|$, the general case reduces to the next Lemma~\reff{lem:Ll(pmx)} .
\end{proof}
\begin{lem}\lbl{lem:Ll(pmx)}
	Let $D$ denote the divisor defined by the closed point $x$ of $C$. For $\Ll$ a line bundle on $C$, put $\Ll(\pm D)=\Ll\otimes_{\Oo_C}\Oo_C(\pm D)$. Then
	\begin{align*}
	\chi(C,\Ll(\pm D))=\chi(C,\Ll)\pm 1\;,
	\end{align*}
	hence \eqreff{eq:RiemannRoch4} holds for $\Ll(\pm D)$ iff it holds for $\Ll$.
\end{lem}
\begin{proof}
	We only need to show this for $\Ll(-D)$ as $\Oo_C(D)\otimes_{\Oo_C}\Oo_C(-D)\cong \Oo_C$ by Proposition~\reff{prop:OC(D)tensor}, so the roles of $\Ll$ and $\Ll(-D)$ may  be switched to show the other assertion.
	
	The residue field $\KK(x)$ of the local ring $\Oo_{C,x}$ is a $k$-algebra of finite type, hence $\KK(x)\cong k$ by the Nullstellensatz and the fact that $k$ is algebraically closed. We thus get a closed embedding $\Spec k\cong\{x\}\morphism[i]C$. Let $\pi$ be a uniformizer of the DVR $\Oo_{C,x}$ (that is, $v_x(\pi)=1$, so $\pi$ generates the maximal ideal of $\Oo_{C,x}$). Let $\lambda\in\Ll_x$ be a generator of this free $\Oo_{C,x}$-module of rank $1$. We get a short exact sequence
	\begin{align*}
	0\morphism\Ll(-D)\morphism\Ll\morphism[p]i_*\Oo_{\Spec k}\morphism 0\;,
	\end{align*}
	in which $p$ is given as follows. Let $\ell\in\Ll(U)$, where $U\subseteq C$ is open and $x\in U$ (otherwise $p$ is just the zero morphism). Let $r\in\Oo_{C,x}$ be the unique element such that $\ell=\lambda r$ in $\Ll_x$. Then $p(\ell)=r\bmod \pi\in\Oo_{C,x}/\pi\Oo_{C,x}\cong k$. The morphism $\Ll(-D)\morphism\Ll$ comes from the fact that $\Oo_C(-D)$ is a subsheaf of $\Oo_C(0)\cong \Oo_C$ in a canonical way (just look at Definition~\reff{def:divisorLineBundle}\itememph{b}). Exactness can be easily checked on stalks, using the description of the stalks of $\Oo_C(-D)$ given in the proof of Proposition~\reff{prop:OC(D)tensor}. 
	
	By additivity of the Euler--Poincar characteristic (Claim~\reff{claim:chiAdditive}), 
	\begin{align*}
	\chi(C,\Ll(-D))=\chi(C,\Ll)-\chi(C,i_*\Oo_{\Spec k})\;.
	\end{align*}
	But $i$ is a closed embedding, hence affine, so $\chi(C,i_*\Oo_{\Spec k})=\chi(\Spec k,\Oo_{\Spec k})=1$ by Corollary~\reff{cor:AffinePushforwardIso}.
\end{proof}
\begin{proof}[Proof of Theorem~\reff{thm:CurvesSerreDuality}\itememph{a}]
	It is clear that sending $D$ to $\deg D$ defines a group homomorphism $\Div(C)\morphism\IZ$. By Proposition~\reff{prop:EverythingIsOXD}\itememph{b}, every line bundle on $C$ is isomorphic to some $\Oo_C(D)$, hence the map $\deg$ from Theorem~\reff{thm:CurvesSerreDuality}\itememph{a} is defined on all of $\Pic(C)$. Still we have to check well-definedness and whether it is a group homomorphism.
	
	For well-definedness, note that by Lemma~\reff{lem:chiD}, $\deg D=\chi(C,\Oo_C(D))-\chi(C,\Oo_C)$ only depends on the isomorphism class of $\Oo_C(D)$, as required. For $\deg$ being a group homomorphism, what we need to check is 
	\begin{align*}
	\deg\left(\Oo_C(D_1)\otimes_{\Oo_C}\Oo_C(D_2)\right)=\deg D_1+\deg D_2\;.
	\end{align*}
	This follows from Proposition~\reff{prop:OC(D)tensor}.
\end{proof}
Before we proceed, we will use the group homomorphism $\deg\colon \Pic(\IP_k^1)\morphism\IZ$ to see how line bundles $\Oo_{\IP_k^1}(D)$ defined by divisors can be expressed in terms of the line bundles $\Oo(d)$ on $\IP_k^1$ for $d\in\IZ$. This wasn't mentioned in the lecture, but it's perhaps worthwhile to know and Franke will probably use it anyway.
\begin{cor}\lbl{cor:O(D)=O(degD)}
	Let $D\in\Div(\IP_k^1)$ be a divisor. Then $\Oo_{\IP_k^1}(D)\cong \Oo(\deg D)$.
\end{cor}
\begin{proof}
	Since $\Pic(\IP_k^1)\cong \IZ$ is generated by (the isomorphism class of) $\Oo(1)$ (we prove this in Corollary~\reff{cor:Pic(Pn)}) and $\deg$ is clearly surjective, it must be an isomorphism. Hence $\deg \Oo(1)=\pm 1$. We will show that it is actually $+1$. Indeed, assume $\deg\Oo(1)=-1$ and let $D$ be a divisor which vanishes at all closed points $x\in \IP_k^1$ except for $x_0$, where $D(x_0)=1$. Then $\deg D=1$ and $\deg (-D)=-1$, so $\Oo(1)\cong \Oo_{\IP_k^1}(-D)$ and $\Oo(-1)\cong \Oo_{\IP_k^1}(D)$ (using that $\deg$ is an isomorphism). From Definition~\reff{def:divisorLineBundle}\itememph{b} it is clear that $\Oo_{\IP_k^1}(-D)$ is naturally a subsheaf of $\Oo_{\IP_k^1}(D)$. However, there is no non-zero morphism of sheaves $\Oo(1)\morphism\Oo(-1)$. Indeed, 
	\begin{align*}
	\Hhom_{\Oo_{\IP_k^1}}(\Oo(1),\Oo(-1))\cong \Oo(1)^{-1}\otimes_{\Oo_{\IP_k^1}}\Oo(-1)\cong \Oo(-2)
	\end{align*}
	has vanishing global section by Theorem~\reff{thm:CohoOfIP^n}\itememph{a}. This is a contradiction.
	
	Now let $D\in\Div(\IP_k^1)$ be any divisor and $\Oo_{\IP_k^1}(D)\cong\Oo(d)$, then
	\begin{align*}
	\deg D=\deg\Oo(d)=d\cdot \deg\Oo(1)=d\;,
	\end{align*}
	and we are done.
\end{proof}
\subsection{Proof of Riemann--Roch}
The following proof will require Serre duality, the proof of which then covers the rest of the chapter.

\emph{Step 1.}\lbl{par:WTFSerreDuality} Let us first argue why \eqreff{eq:RiemannRoch1} and \eqreff{eq:RiemannRoch2} are actually equivalent. The perfect pairing from Theorem~\reff{thm:CurvesSerreDuality}\itememph{c} gives, by definition, an isomorphism
\begin{align*}
H^1(C,\Omega_C\otimes_{\Oo_C}\Vv^*)\isomorphism\Hom_k\left(H^0(C,\Vv),k\right)\;.
\end{align*}
Replacing $\Vv$ by $\Omega_C\otimes_{\Oo_C}\Vv^*$ precisely switches the roles of $\Vv$ and $\Omega_C\otimes_{\Oo_C}\Vv^*$ (this is easy to see). Also, sending $\omega\otimes\ell\mapsto \omega\cdot \ell(-)$ gives an isomorphism $\Omega_C\otimes_{\Oo_C}\Vv^*\cong\Hhom_{\Oo_C}(\Vv,\Omega_C)$ (this is easy to check on stalks). Thus Serre duality together with our considerations gives
\begin{align*}
\dim_k\Hom_{\Oo_C}(\Vv,\Omega_C)&=\dim_kH^0(C,\Hhom_{\Oo_C}(\Vv,\Omega_C))\\
&=\dim_kH^0(C,\Omega_C\otimes_{\Oo_C}\Vv^*)\\
&=\dim_k\Hom_k(H^1(C,\Vv),k)\\
&=\dim_kH^1(C,\Vv)\;.
\end{align*}
Thus $\dim_kH^1(C,\Vv)$ in the Euler--Poincar characteristic $\chi(C,\Vv)$ may indeed be replaced by $\dim_k\Hom_{\Oo_C}(\Vv,\Omega_C)$ (and $\dim_kH^0(C,\Vv)$ clearly by $\dim_k\Vv(C)$).

\emph{Step 2.} Now we show Riemann--Roch for line bundles. That is, we need to show that $\chi(C,\Oo_C(D))=\deg D+1-g$ for all $D\in\Div(C)$. By Lemma~\reff{lem:chiD}, we only need to consider the case $D=0$. Since we already know that \eqreff{eq:RiemannRoch1} and \eqreff{eq:RiemannRoch2} are equivalent, it suffices to show Corollary~\reff{cor:famous} for $D=0$. As $\ell(K)=g$ by definition, all we need to do is showing $\ell(0)=1$, i.e., $\dim_k\Oo_C(C)=1$.

By Corollary~\reff{cor:ProperHpFinGen}, $\Oo_C(C)=H^0(C,\Oo_C)$ is a $k$-algebra of finite dimension, hence an integral ring extension of $k$. Since $C$ is integral, $\Oo_C(C)$ is a domain (cf.\ \cite[Proposition~2.1.4]{alggeo1}), so $\Oo_C(C)$ is actually a finite field extension of $k$ (which is easily seen from Noether normalization). In particular, $\Oo_C(C)\cong k$, since $k$ is algebraically closed.

\emph{Step 3.} We prove Riemann--Roch for arbitrary vector bundles. Every vector bundle $\Vv$ on a regular curve has a filtration $0=\Vv_0\subseteq \Vv_1\subseteq\ldots\subseteq \Vv_d=\Vv$, whose quotients are line bundles (that's an easy application of Lemma~\reff{lem:UsefulBundleLemma}).  By induction on $d=\dim\Vv$, all that remains to check is that both sides of \eqreff{eq:RiemannRoch1} are additive for short exact sequences $0\morphism\Uu\morphism\Vv\morphism\Ww\morphism 0$ of vector bundles.

Indeed, $\chi(C,\Vv)=\chi(C,\Uu)+\chi(C,\Ww)$ is something we proved in Claim~\reff{claim:chiAdditive}. Also $\dim\Vv=\dim \Uu+\dim\Ww$ is obvious. We are left with $\det\Vv\cong \det\Uu\otimes_{\Oo_C}\det\Ww$. This can be checked locally, where it amounts to showing that $\det M=\det M'\otimes_R\det M''$ whenever 
\begin{align*}
	0\morphism M'\morphism[\alpha] M\morphism[\beta] M''\morphism 0
\end{align*}
is a short exact sequence of free (or just projective) $R$-modules. If $M'$ has rank $n$ and $M''$ rank $\ell$, this isomorphism is given by
\begin{align*}
(m_1'\wedge\cdots \wedge m_n')\otimes (m_1''\wedge\cdots\wedge m_\ell'')\longmapsto \alpha(m_1')\wedge\cdots\wedge\alpha(m_n')\wedge m_1\wedge\cdots \wedge m_\ell
\end{align*}
for $m_i'\in M'$, $m_j''\in M''$ and the $m_j$ are preimages of the $m_j''$ under $\beta$. It's easy to see that this is well-defined and indeed an isomorphism. We are done.\qed

\subsection{Serre duality on \texorpdfstring{$\IP_k^1$}{P}}
We will prove Serre duality in the special case $C=\IP_k^1$ first.

The battle plan is the following: For Theorem~\reff{thm:CurvesSerreDuality}\itememph{b}, it suffices to provide an identification of $\Omega_{\IP_k^1}$ with $\Oo(-2)$ and to show that $c_1(\Oo(1))$ has a non-zero image in the one-dimensional $k$-vector space $H^1(\IP_k^1,\Oo(-2))$ (for one-dimensionality we use Theorem~\reff{thm:CohoOfIP^n}\itememph{d}).\footnote{Where does $c_1(\Oo(1))$ come from? In Corollary~\reff{cor:Pic(Pn)} we see that $\Pic(\IP_k^n)\cong \IZ$ with $\Oo(1)$ a generator.} Once we have $\Omega_{\IP_k^1}\cong\Oo(-2)$, Theorem~\reff{thm:CurvesSerreDuality}\itememph{c} follows in the special case $\Vv=\Oo(d)$ by the duality assertion from Theorem~\reff{thm:CohoOfIP^n}\itememph{e}. By Theorem~\reff{thm:GrothendieckBirkhoff}, any vector bundle $\Vv$ on $\IP_k^1$ is isomorphic to a direct sum of line bundles $\Oo(d)$, showing Theorem~\reff{thm:CurvesSerreDuality} for $C=\IP_k^1$.

To check $\Omega_{\IP_k^1}\cong\Oo(-2)$, we get a derivation $d\colon \Oo_{\IP_k^1}\morphism\Oo(-2)$ as follows. For $U\subseteq \IP_k^1$ open and $f\in\Oo_{\IP_k^1}(U)$ put
\begin{align*}
d(f)=\begin{cases}
\frac{1}{Y}\cdot\frac{\partial f}{\partial X} & \text{on }U\setminus V(Y)\\
-\frac{1}{X}\cdot\frac{\partial f}{\partial Y} & \text{on }U\setminus V(X)
\end{cases}\;.
\end{align*}
All derivatives are considered as formal derivatives of rational functions in $X$ and $Y$. Since $f$ is a homogeneous rational function of degree $0$, the two terms for $d(f)$ coincide on $U\setminus V(XY)$ (we leave it to the reader to push around $X$ and $Y$ until this comes out). On $\IP_k^1\setminus V(Y)\cong \Spec k\left[t\right]$ (for $t=\frac{X}{Y}$) we have $f(X,Y)=\phi\left(t\right)$ for some polynomial $\phi$, and $d(f)=Y^{-2}\cdot \phi'\left(t\right)$. Hence $d$ is a universal derivation there, and similar arguments apply to $\IP_k^1\setminus V(X)$. Thus $\Omega_{\IP_k^1}\cong \Oo(-2)$, as claimed.

It remains to determine the image of $c_1(\Oo(1))$ under this identification followed by the isomorphism $H^1(\IP_k^1,\Oo(-2))\isomorphism k$ from Theorem~\reff{thm:CohoOfIP^n}\itememph{d}. Let $U_0=\IP_k^1\setminus V(X)$, $U_1=\IP_k^1\setminus V(Y)$, then $\Oo(1)$ is trivialized by $X$ on $U_0$ and by $Y$ on $U_1$. Let $\Uu\colon \IP_k^1=U_0\cup U_1$ denote this affine open cover. Reading carefully through the construction before Proposition~\reff{prop:torsorsH1Bij} again, we find that the element of $\check{H}_\alt^1(\Uu,\Oo_{\IP_k^1}^\times)$ which gives the $\Oo_{\IP_k^1}^\times$-torsor $\Oo(1)^\times$ is given by $\frac{X}{Y}=t\in\Oo_{\IP_k^1}^\times(U_{0,1})$.

The image of $f=t$ under $f\mapsto d(f)f^{-1}$ equals $(XY)^{-1}\neq 0$ and this element is sent to $1$ under the isomorphism $H^1(\IP_k^1,\Oo(-2))\isomorphism k$ from Theorem~\reff{thm:CohoOfIP^n}\itememph{d}. Hence $c_1(\Oo(1))=1$. As pointed out, this implies Theorem~\reff{thm:CurvesSerreDuality}\itememph{b} and Theorem~\reff{thm:CurvesSerreDuality}\itememph{c} for $C=\IP_k^1$.\qed
\paragraph{Strategy for arbitrary $C$.}\lbl{par:StrategyForSD} We will use a finite separable morphism $C\morphism[f]\IP_k^1$ (that is, a morphism inducing separable extensions of fields of rational functions). Then $H^\bullet(C,\Vv)\cong H^\bullet (\IP_k^1,f_*\Vv)$ for every vector bundle $\Vv$ on $C$ (by Corollary~\reff{cor:AffinePushforwardIso} -- note that $f$ is finite, thus in particular affine). Also $f_*\Vv$ is a coherent $\Oo_{\IP_k^1}$-module and torsion-free (because $\Vv$ is), hence a vector bundle by the classification of modules over PIDs. Thus 
\begin{align*}
H^1(C,\Vv)^*\cong H^1\big(\IP_k^1,f_*\Vv\big)^*\cong \Hom_{\Oo_{\IP_k^1}}\big(f_*\Vv,\Omega_{\IP_k^1}\big)\cong \Hom_{\Oo_C}\big(\Vv,f^!\Omega_{\IP_k^1}\big)
\end{align*}
(this is the Serre duality calculation from Remark~\reff{par:WTFSerreDuality} again), where $f^!$ is (hopefully) a right-adjoint functor for $f_*$. Then if (hopefully again) one has a canonical isomorphism $f^!\Omega_{\IP_k^1}\cong \Omega_C$, Serre duality for $C$ follows. The fact that the resulting isomorphism $H^1(C,\Omega_C)\isomorphism k$ sends $c_1(\Oo_C(D))$ to the image of $\deg D$ in $k$ has to be checked separately.

\section{The functor \texorpdfstring{$f^!$}{f}}\lbl{sec:f^!}
Let $C\morphism[f]D$ be a finite separable morphism of regular connected curves of finite type over the algebraically closed field $k$. We want to construct a \emph{right-adjoint} $f^!\colon\cat{Mod}(\Oo_D)\morphism\cat{Mod}(\Oo_C)$ to the functor $f_*$. For this, Professor Franke assumes familiarity with extensions of Dedekind domains, \emph{differents}, and the \emph{trace form}. We refer to \cite[Ch.~III, \S 2]{NEUKIRCH} for an introduction.

Let $R$ be a Dedekind domain with field of fractions $K$, $L/K$ a finite separable field extension, $S$ the algebraic closure of $R$ in $L$ and $\Tr_{L/K}\colon L\morphism K$ the \emph{trace}. Put
\begin{align*}
	S^*=\left\{\sigma\in L\st \Tr_{L/K}(\sigma s)\in R\text{ for all }s\in S\right\}\;.
\end{align*}
Then $S^*$ is a fractional ideal of $S$ and thus has an inverse, the \defemph{Dedekind different} $\DD_{S/R}\coloneqq (S^*)^{-1}$. The construction of $\DD_{S/R}$ commutes with localization (cf.\ \cite[Ch.\ III, (2.2)]{NEUKIRCH}). Also, if $U\subseteq D$ is an affine open subset, then $R=\Oo_D(U)$ and $S=\Oo_C(f^{-1}U)$ form an extension of Dedekind domains as in the above situation (indeed, $R$ and $S$ are one-dimensional regular noetherian rings, hence Dedekind domains). Hence we obtain
\begin{fact}
	If $f$ is a morphism as above, there is a unique sheaf of ideals $\DD_f\subseteq \Oo_C$ such that 
	\begin{align*}
		\DD_f(f^{-1}U)=\DD_{\Oo_C(f^{-1}U)/\Oo_D(U)}
	\end{align*}
	for all affine open $U\subseteq D$.
\end{fact}
We may view $\DD_f^{-1}$ (the inverse of the line bundle $\DD_f$) as a subsheaf of $\Kk_C$, the (constant) sheaf of rational functions on $C$. Define $\Kk_D$ in a similar way and let $L,K$ be the fields of rational functions on $C,D$ respectively. By definition, $\Tr_{L/K}\colon L\morphism K$ defines morphisms
\begin{align*}
	\Tr\colon f_*\Kk_C\morphism\Kk_D\quad\text{and}\quad\Tr_{C/D}\colon f_*\DD_f^{-1}\morphism \Oo_D\;.
\end{align*}
If $\Mm$ is a quasi-coherent $\Oo_D$-module, we denote the composition
\begin{align*}
	f_*\left(f^*\Mm\otimes_{\Oo_C}\DD_f^{-1}\right)\cong \Mm\otimes_{\Oo_D}f_*\DD_f^{-1}\xrightarrow{\id_\Mm\otimes \Tr_{C/D}}\Mm\otimes_{\Oo_D}\Oo_D\cong \Mm
\end{align*}
by $\Tr_f=\Tr_{C/D}$ as well.\footnote{Ehm \ldots\ why is $f_*\left(f^*\Mm\otimes_{\Oo_C}\Nn\right)\cong \Mm\otimes_{\Oo_D}f_*\Nn$ for quasi-coherent $\Oo_D$-modules $\Mm$ and $\Oo_C$-modules $\Nn$? We discussed a similar question in Remark~\reff{rem:WhatIsO_X(k)}\itememph{d} for closed embeddings, and like there, we can construct a canonical map between them and only need to verify that it is an isomorphism on stalks, but the way we do this is somewhat different. Let $d\in D$ and choose an affine open neighbourhood $U\cong \Spec R$ of $d$. Its preimage $f^{-1}U$ is affine as well (since $f$ is finite), say, $f^{-1}U\cong \Spec S$. Then $S$ is a finite Dedekind extension of $R$, $\Mm$ is given by an $R$-module $M$ on $U$ and $\Nn$ by an $S$-module $N$ on $f^{-1}U$. Then $f_*\Nn$ is given by $S$ as an $R$-module on $U$ and the required isomorphism reduces to
\begin{align*}
	((M\otimes_RS)\otimes_SN)_\pp\cong \big((M\otimes_RS)\otimes_SN\big)\otimes_RR_\pp\cong M_\pp\otimes_R(N\otimes_RR_\pp)\cong M_\pp\otimes_RN_\pp\;,
\end{align*}
when $\pp\in\Spec R$ is the prime ideal corresponding to $d$.} As $\Tr_{L/K}\colon S\times S^*\morphism R$ is a perfect duality pairing in the above situation of Dedekind domains, one obtains
\begin{prop}\lbl{prop:f^!Adjunction}
	For every quasi-coherent $\Oo_C$-module $\Nn$, the map
	\begin{align}\lbl{eq:f^!adjunction}
		\begin{split}
			\Hom_{\Oo_C}\left(\Nn,f^*\Mm\otimes_{\Oo_C}\DD_f^{-1}\right)&\morphism\Hom_{\Oo_D}(f_*\Nn,\Mm)\\
			\phi&\longmapsto\Tr_f\circ f_*(\phi)
		\end{split}
	\end{align}
	is bijective. Thus, the functor $f^!\colon\cat{QCoh}(D)\morphism\cat{QCoh}(C)$ given by $f^!\Mm=f^*\Mm\otimes_{\Oo_C}\DD_f^{-1}$ is right-adjoint to $f_*$.
\end{prop}
\begin{proof}[Sketch of a proof]
	Affine-locally, this reduces to proving the adjunction 
	\begin{align}\lbl{eq:localAdjunction}
		\Hom_S(N,M\otimes_RS^*)\isomorphism\Hom_R(N,M)\;,\tag{$*$}
	\end{align}
	when $R\subseteq S$ is an extension of Dedekind domains such that $S$ is a finite $R$-module and the corresponding extension $L/K$ of quotient fields is separable (in particular, $S$ is the integral over $R$ and thus the integral closure of $R$ in $L$). We would still need to prove that \eqreff{eq:localAdjunction} is compatible with localizations, but the direction from \eqreff{eq:f^!adjunction} surely is, so the other one better be!
	
	To prove \eqreff{eq:localAdjunction}, we use the adjunction $\Hom_R(N,M)\cong \Hom_S(N,\Hom_R(S,M))$. Indeed, the tensor-hom adjunction gives $\Hom_R(N\otimes_SS,M)\cong \Hom_S(N,\Hom_R(S,M))$ and since $N$ is already an $S$-module, $N\otimes_SS$ is canonically isomorphic to $N$. It thus remains to show that $m\otimes \sigma\mapsto \Tr(\sigma\cdot (-))$ defines an isomorphism $M\otimes_RS^*\isomorphism\Hom_R(S,M)$. Clearly, we may replace $M\otimes_RS^*$ by $\Hom_R(R,M\otimes_RS^*)$. Note that $S$ is a projective $R$-module. Indeed, since $R_\pp$ is a DVR for all $\pp\in\Spec R$, \cite[Ch.~I, (2.10)]{NEUKIRCH} gives that $S_\pp$ is a free $R_\pp$-module of rank $n=[L:K]$. Since $R$ is projective over itself, we can argue like after Definition~\reff{def:PerfectPairing} to show that $\Hom_R(S,M)$ and $\Hom_R(R,M\otimes_RS^*)$ commute with localization at $f\in R$. The isomorphism we need to prove can also be checked locally. Hence replacing $R$, $S$, and $M$ by $R_f$, $S_f$, $M_f$ respectively we may assume that $S$ is free of rank $n$. 
	
	Choose a basis $e_1,\ldots, e_n$ of $S$ and the dual basis $e_1^*,\ldots,e_n^*$ of $S^*$. Define a map $R\morphism[\eta]S^*\otimes_RS$ via $\eta(1)=\sum_{i=1}^ne_i^*\otimes e_i$. This looks super non-canonical, but it actually is: When $f_1,\ldots,f_n$ form another basis of $S$, then there is an invertible $R$-matrix $A$ such that $f_i=Ae_i$. The correponding dual basis is given by $f_i^*=(A^{-1})^Te_i^*$ and since $-\otimes_R-$ behaves like expanding bilinear forms, $\sum_{i=1}^nf_i^*\otimes f_i=\sum_{i=1}^ne_i^*\otimes e_i$ is easily deduced. 
	
	Now consider the canonical map $\Phi\colon \Hom_R(S,M)\morphism\Hom_R(R,M\otimes_RS^*)$ assigning to $S\morphism[\phi]M$ the composite
	\begin{align*}
		R\morphism[\eta]S^*\otimes_RS\xrightarrow{\id_{S^*}\otimes \phi} S^*\otimes_RM\cong M\otimes_RS^*
	\end{align*}
	and the map $\Psi\colon \Hom_R(R,M\otimes_RS^*)\morphism\Hom_R(S,M)$ assigning to $R\morphism[\psi]M\otimes_RS^*$ the composite
	\begin{align*}
		S\cong R\otimes_RS\xrightarrow{\psi\otimes\id_S}M\otimes_RS^*\otimes_RS\xrightarrow{\id_M\otimes \Tr_{L/K}}M\otimes_RR\cong M\;.
	\end{align*}
	It's a straightforward check that $\Phi$ and $\Psi$ are mutually inverse and that $\Psi$ corresponds to the map $M\otimes_RS^*\morphism\Hom_R(S,M)$ sending $m\otimes\sigma\mapsto \Tr(\sigma\cdot(-))$. We are done.	
\end{proof}
We will now work towards $f^!\Omega_D\cong \Omega_C$. To prove this, we will formulate a lemma first, and to do this, we need to justify that with $f$ as above, a point $d\in D$ has only finitely many preimages in $C$. Indeed, on an affine open neighbourhood $U\subseteq D$ of $d$ the situation looks like a finite extension of (one-dimensional regular noetherian rings and hence) Dedekind domains. $R=\Oo_D(U)$ and $S=\Oo_C(f^{-1}U)$, where $d$ corresponds to a prime ideal $\pp\in\Spec R$. The preimages of $d$ correspond to the prime ideals of $S$ lying above $\pp$, and it's well-known that there is a finite number $\PP_1,\ldots,\PP_N$ of them (the finitely many prime ideal factors of $\pp S$, cf.\ \cite[Ch.~I, \S 8]{NEUKIRCH}).

However, for future use we prove a slightly stronger result.
\begin{lem}\lbl{lem:finitelyManyPreimages}
	Let $C\morphism[g] D$ be a morphism of noetherian one-dimensional regular connected curves such that the induced extension of fraction fields $L/K$ is finite. Then every $d\in D$ has only finitely many preimages $c_1,\ldots,c_N$ in $C$.
\end{lem}
\begin{proof}
	Let $U\cong \Spec A$ be an affine open neighbourhood of $d$ and $\pp\in\Spec A$ the prime ideal corresponding to $d$. Since $C$ is noetherian, every open subset is quasi-compact and we may cover $g^{-1}U$ by finitely many affine open subsets $V_i\cong \Spec B_i$, $i=1,\ldots,n$. Then $A\subseteq B_i$ is an extension of Dedekind domains. Then the prime ideals of $B_i$ over $\pp$ are precisely the prime ideal divisors of $\pp B_i$ in $B_i$. Since $B_i$ is a Dedekind domain, there are finitely many of them. Hence $d$ has finitely many preimages in $V_i$ and thus also in $C$.
\end{proof}

Now let $C\morphism[f]D$ be a finite separable morphism of regular connected curves of finite type over the algebraically closed field $k$ again. For $\xi\in\Oo_C(V)$ for some open $V\subseteq C$ let $\xi(c)$ denote the image of $\xi$ in the residue field $\KK(c)$ of $\Oo_{C,c}$.
\begin{lem}\lbl{lem:interpolation}
	Let $f$ be as above, $d\in D$ any closed point and $c_1,\ldots,c_N$ its preimages in $C$.
	\begin{alphanumerate}
		\item There are an affine open neighbourhood $U$ of $D$ and $\xi\in\Oo_C(f^{-1}U)$ such that $\xi(c_i)\neq\xi(c_j)$ and such that $\xi-\xi(c_i)\notin\mm_{C,c_i}^2\subseteq\Oo_{C,c_i}$ for $i=1,\ldots,N$.
		\item If $\xi$ has this property, after shrinking $U$ to some smaller affine open neighbourhood of $d$ we may assume that $\Oo_C(f^{-1}U)$ is generated by $\xi$ as an $\Oo_D(U)$-algebra.
	\end{alphanumerate}
\end{lem}
\begin{rem*}
	 Why does $\xi-\xi(c_i)$ even make sense? This is a legitimate question since $\xi\in\Oo_C(f^{-1}U)$, $\xi(c_i)\in\KK(c_i)$, and neither is an element of $\Oo_{C,c_i}$. Surely, $\xi$ can be interpreted as its image in $\Oo_{C,c_i}$, but what about $\xi(c_i)$? Note that all rings we are considering here are $k$-algebras. In particular, there is an embedding $k\monomorphism\Oo_{C,c}$ for every $c\in C$ and $k\monomorphism\KK(c)$ is even an isomorphism by Hilbert's Nullstellensatz and algebraic closedness of $k$. Thus $\xi(c_i)$ may be regarded as an element of $\Oo_{C,c_i}$ as well.
\end{rem*}
\begin{proof}[Proof of Lemma~\reff{lem:interpolation}]
	The existence of $\xi$ is easy. There are $\phi_i\in\Oo_C(f^{-1}U)$ such that $\phi_i(c_j)=1$ if $i=j$ and $=0$ else (this is just the Chinese remainder theorem). Also, for all $i$ let $\pi_i\in\Oo_C(f^{-1}U)$ be an element whose image in $\Oo_{C,c_i}$ is a uniformizer. Let $\epsilon_i\in\Oo_{C,c_i}$ such that $\phi_i^2\equiv 1+\epsilon_i\pi_i\bmod\pi_i^2$. We put
	\begin{align*}
		\xi=\sum_{i=1}^N\phi_i^2(\alpha_i+\beta_i\pi_i)\;,
	\end{align*}
	with yet-to-define parameters $\alpha_i,\beta_i$. When we consider the image of the above sum in $\Oo_{C,c_i}$, all summands except the $i\ordinalth$ are $\equiv 0\bmod \pi_i^2$, while $\phi_i^2(\alpha_i+\beta_i\pi_i)\cong \alpha_i+\alpha_i\epsilon_i\pi_i+\beta_i\pi_i$. We then may choose $\alpha_1,\ldots,\alpha_N$ such that $\xi(c_1),\ldots,\xi(c_N)$ are distinct. Choosing $\beta_1,\ldots,\beta_N$ appropriately, we can moreover achieve $\xi\not\equiv\xi(c_i)\bmod \pi_i^2$ for all $i$. This shows \itememph{a}.
	
	For \itememph{b}, let $R=\Oo_D(U)$ and $S=\Oo_C(f^{-1}U)$. Let $\pp$ and $\PP_1,\ldots,\PP_N$ be the prime ideals corresponding to $d$ and $c_1,\ldots,c_N$. It suffices to show that $S_\pp$ is generated by the powers of $\xi$ as an $R_\pp$-module. Indeed, \cite[Lemma~1.5.1]{alg2} shows that there is a $\lambda\in R\setminus\pp$ such that $S_\lambda$ is already generated by the powers of $\xi$ as an $R_\lambda$-module, and replacing $U$ by $U\setminus V(\lambda)$ does the required shrinking.
	
	Let $L$ and $K$ be the fraction fields of $S$, $R$ respectively. Then $L/K$ is separable by assumption on $f$. Let $n=[L:K]$. Since $R_\pp$ is a DVR (and thus a PID), $S_\pp$ is a free $R_\pp$-module of rank $n$ by \cite[Ch.~I, (2.10)]{NEUKIRCH}. Let $\pp S=\PP_1^{e_1}\cdots \PP_N^{e_N}$ be the prime factorization of $\pp S$ (the $e_i$ are called \emph{ramification indices}). By \cite[Ch.~I, (8.2)]{NEUKIRCH} we have $\sum_{i=1}^Ne_i=n$ (note that all \emph{inertia degrees} equal $1$ since $[\KK(\PP_i):\KK(\pp)]=[k:k]=1$). 
	\begin{claim}\lbl{claim:GeneratorsOfS}
		 The $\sum_{i=1}^Ne_i=n$ elements
		 \begin{align*}
			 \psi_{i,r}\coloneqq\prod_{j\neq i}\left(\xi-\xi(c_j)\right)^{e_j}\cdot \left(\xi-\xi(c_i)\right)^r
		 \end{align*}
		 for $i=1,\ldots,N$ and $r=0,\ldots,e_j-1$ are $k$-linearly independent in $S_\pp/\pp S_\pp$.
	\end{claim}
	Believing this for the moment, a comparison of dimension and Nakayama's lemma show that the $\psi_{i,r}$ actually generate $S_\pp$ as an $R_\pp$-module. Since they are polynomials in $\xi$ (with some coefficients from $k$ coming from the $\xi(c_i)$), we are done.
	
	It remains to prove Claim~\reff{claim:GeneratorsOfS}. Suppose that $\sum_{i,r}\lambda_{i,r}\psi_{i,r}=0$ in $S_\pp/\pp S_\pp$ for some coefficients $\lambda_{i,r}\in k$. Let us localize at $\PP_i$. Then all $\psi_{j,r}$ with $j\neq i$ vanish in $S_{\PP_i}/\pp S_{\PP_i}$ as the contain the factor $(\xi-\xi(c_i))^{e_i}$ whose $\PP_i$-adic valuation equals $e_i$ (and we have $\pp S_{\PP_i}=(\pi_i^{e_i})$). We thus get
	\begin{align*}
		\sum_{r=0}^{e_i-1}\lambda_{i,r}\psi_{i,r}=0\quad\text{ in }S_{\PP_i}/\pp S_{\PP_i}\;.
	\end{align*}
	Note that $v_{\PP_i}(\psi_{i,r})=r$. Indeed, the construction from \itememph{a} was chosen in such a way to guarantee $v_{\PP_i}(\xi-\xi(c_j))=0$ for $j\neq i$ and $v_{\PP_i}(\xi-\xi(c_i))=1$. From this we deduce $\lambda_{i,r}=0$ for $r=0,\ldots,e_i-1$. Doing this for the other $\PP_j$ as well, we obtain $\lambda_{i,r}=0$ for all $i,r$. This shows the required linear independence.
\end{proof}
Recall the following well-known fact about extensions of Dedekind domains (actually this is \cite[Ch.\ III, (2.4)]{NEUKIRCH} and we follow the proof given there).
\begin{prop}\lbl{prop:principalDifferent}
	Let $R$ be a Dedekind domain, $L/K$ a finite separable extension of its quotient field $K$ and $S$ the integral closure of $R$ in $L$. Suppose that $S$ is generated by $\xi\in S$ as an $R$-algebra and let $p\in R[T]$ be its minimal polynomial. Then $\DD_{S/R}=(p'(\xi))$ is the principal ideal generated by $p'(\xi)$.
\end{prop}
\begin{lem}\lbl{lem:NeukirchDualBasis}
	Let $n$ be the degree of $p$ and
	\begin{align*}
		\frac{p(T)}{T-\xi}=b_0+b_1T+\ldots+b_{n-1}T^{n-1}\;.
	\end{align*}
	Then the dual basis of $1,\xi,\ldots,\xi^{n-1}$ with respect to the trace form $\Tr_{L/K}(xy)$ is given by
	\begin{align*}
		\frac{b_0}{p'(\xi)},\ldots,\frac{b_{n-1}}{p'(\xi)}\;.
	\end{align*}
\end{lem}
\begin{proof}
	Let $\xi_1,\ldots,\xi_n$ be the roots of $p$ in some algebraic closure of $K$ and $\sigma_1,\ldots,\sigma_n\colon L\monomorphism\ov{K}$ the corresponding $K$-linear embeddings. Then
	\begin{align*}
		\sum_{i=1}^{n}\frac{p(T)}{T-\xi_i}\cdot\frac{\xi_i^r}{p'(\xi_i)}=T^r\quad\text{for all }r=0,\ldots,n-1\;.
	\end{align*}
	Indeed, for fixed $r$ both sides are polynomials of degree $\leq n-1$ which coincide when $T=\xi_i$ for $i=1,\ldots,n$. We can write this in the form
	\begin{align*}
		\Tr_{L/K}\left(\frac{p(T)}{T-\xi}\cdot\frac{\xi^r}{p'(\xi)}\right)=\sum_{i=1}^n\sigma_i\left(\frac{p(T)}{T-\xi}\cdot\frac{\xi^r}{p'(\xi)}\right)=T^r\;.
	\end{align*}
	Comparing coefficients of each power of $T$, we get
	\begin{align*}
		\Tr_{L/K}\left(\xi^i\frac{b_j}{p'(\xi)}\right)=\delta_{i,j}
	\end{align*}
	(with $\delta_{i,j}$ the Kronecker symbol), hence the assertion.
\end{proof}
\begin{proof}[Proof of Proposition~\reff{prop:principalDifferent}]
	From Lemma~\reff{lem:NeukirchDualBasis} we know that $S^*=p'(\xi)^{-1}(b_0R+\ldots+b_{n-1}R)$. We show that the second factor equals $S$. Indeed, from $(T-\xi)(b_0+b_1T+\ldots+b_{n-1}T^{n-1})=p(T)$ we obtain the recursive relations
	\begin{align*}
		b_{n-1}&=1\\
		 b_{n-2}-\xi b_{n-1}&=p_{n-1}\\
		 &\vdots
	\end{align*}
	(in which $p_i$ are the coefficients of $p$ and $p_n=1$ since $p$ is the minimal polynomial of $\xi$), from which we deduce
	\begin{align*}
		b_{n-i}=\xi^{i-1}+p_{n-1}\xi^{i-2}+\ldots+p_{n-i+1}\;.
	\end{align*}
	Thus $b_0R+\ldots+b_{n-1}R=R[\xi]=S$ and therefore $\DD_{S/R}=(S^*)^{-1}=(p'(\xi))$.
\end{proof}
Using this in the situation of Lemma~\reff{lem:interpolation} with $R=\Oo_D(U)$, $S=\Oo_C(f^{-1}U)$ and the appropriate $\xi$, we obtain
\begin{prop}\lbl{prop:f!OmegaIso}
	If $C\morphism[f]D$ is a finite separable morphism between regular curves over the algebraically closed field $k$, then $f^*\Omega_D\morphism\Omega_C$ can be extended\footnote{Since $\DD_f$ is a sheaf of ideals in $\Oo_C$, there is a canonical inclusion $\Oo_C\monomorphism\DD_f^{-1}$ which we tensor with $f^*\Omega_D$.} to a unique isomorphism
	\begin{align*}
		f^!\Omega_D=f^*\Omega_D\otimes_{\Oo_C}\DD_f^{-1}\isomorphism\Omega_C
	\end{align*}
\end{prop}
\begin{proof}
	Of course, this is a local question. By Lemma~\reff{lem:interpolation} and Proposition~\reff{prop:principalDifferent} we may reduce this to the case where $R$ is a Dedekind domain with quotient field $K$ and the integral closure $S$ of $R$ in $L$ is generated by a single element $\xi\in S$; and what we need to show is that $(\Omega_{R/k}\otimes_RS)\otimes_R\DD_{S/R}^{-1}$ is isomorphic to $\Omega_{S/k}$ (up to verifying that the isomorphism is the correct one).
	
	Since $\DD_{S/R}^{-1}=p'(\xi)^{-1}S$, it suffices to show that $\Omega_{R/k}\otimes_RS$ is isomorphic to $p'(\xi)\Omega_{S/k}$.\footnote{\lbl{footnote:OmegaLocFree}Indeed, $R$ and $S$ are Dedekind domains, hence regular of dimension $1$. By \cite[Proposition~1.6.3]{alg2} (which can be applied here since $R$ and $S$ are of finite type over $k$, which is algebraically closed, hence perfect), $\Omega_{R/k}$ and $\Omega_{S/k}$ are locally free $R$- resp.\ $S$-modules of rank $1$ -- in particular, they are projective over their respective ground ring and tensoring with $\DD_{S/R}^{-1}=p'(\xi)^{-1}S$ behaves nicely.} We show surjectivity first. To do this, it suffices to prove this locally. That is, for $\PP\in\Spec S$ and its preimage $\pp=\PP\cap R\in\Spec R$ we need to show that $\Omega_{R_\pp/k}\otimes_{R_\pp}S_\PP\morphism p'(\xi)\Omega_{S_\PP/k}$ is surjective (here we use compatibility of Khler differentials with localization, cf.\ \cite[Corollary~1.4.1a\itememph{d}]{alg2}). That is, replacing $R$ by $R_\pp$ and $S$ by $S_\PP$ we may reduce to the case where $S$ and $R$ are PIDs (DVRs even) and $\Omega_{S/k}\cong S$ (as $\Omega_{S/k}$ is locally free of rank $1$ at $\PP$ by Footnote~\ref{footnote:OmegaLocFree}). By \cite[Corollary~1.4.1\itememph{b}]{alg2}, we have a short exact sequence
	\begin{align*}
		\Omega_{R/k}\otimes_RS\morphism\Omega_{S/k}\morphism\Omega_{S/R}\morphism 0\;.
	\end{align*}
	By the classification of finitely generated modules over PIDs and unique prime factorization and stuff it suffices to prove $\Omega_{S/R}\cong S/p'(\xi)S$. We have $S=R[\xi]$, hence $S=R[T]/(p)$. From \cite[Corollary~1.4.1\itememph{a}]{alg2} we get a short exact sequence
	\begin{align*}
		(p)/(p^2)\morphism\Omega_{R[T]/k}\otimes_RS\morphism\Omega_{S/k}\morphism 0\;,
	\end{align*}
	in which $\Omega_{R[T]/k}\otimes_RS\cong S$ since $\Omega_{R[T]/k}$ is the free $R$-module generated by $dT$ and the morphism on the left is given by $p\bmod p^2\mapsto (p'\bmod p)dT=p'(\xi)dT$. This shows that $\Omega_{S/R}\cong S/p'(\xi)S$ indeed.
	
	Let's prove injectivity of  $\Omega_{R/k}\otimes_RS\morphism p'(\xi)\Omega_{S/k}$. Let $P$ be the kernel. Tensoring with $L$ we obtain an exact sequence
	\begin{align*}
		\Tor_1^S\left(p'(\xi)\Omega_{S/k},L\right)\morphism P\otimes_SL\morphism \left(\Omega_{R/k}\otimes_RS\right)\otimes_SL\morphism p'(\xi)\Omega_{S/k}\otimes_SL\morphism 0\;.
	\end{align*}
	Since $\Omega_{S/k}$ is (locally free and thus) a projective $S$-module, so is its submodule $p'(\xi)\Omega_{S/k}$ since torsion-freeness suffices over Dedekind domains (cf.\ \cite[Corollary~1.1.6]{homalg}). We see that the $\Tor$ term vanishes. Also $p'(\xi)\Omega_{S/k}\otimes_SL\cong p'(\xi)\Omega_{L/k}\cong \Omega_{L/k}$ since tensoring with $L$ is the same as localizing the multiplicative subset $S\setminus \{0\}$ and Khler differentials are compatible with localizations (and moreover $p'(\xi)\neq 0$ as $L/K$ is separable). By a similar argument, $(\Omega_{R/k}\otimes_RS)\otimes_SL\cong \Omega_{K/k}\otimes_KL$. But the canonical map\footnote{We should actually check that we indeed obtain the canonical map. Let' see why this is plausible: Actually, nothing we do is non-canonical except for $p'(\xi)\Omega_{S/k}$ -- however, we could instead consider $\Omega_{R/k}\otimes_RS\morphism\Omega_{S/k}$ and tensor this guy with $L$, since we are only interested in injectivity.} $\Omega_{K/k}\otimes L\morphism\Omega_{L/k}$ is an isomorphism by \cite[Lemma~16.15]{eisenbudCommAlg}, so $P\otimes_SL=0$. Since $P$ is torsion-free as a submodule of the projective $S$-module $\Omega_{R/k}\otimes_RS$ (local freeness is inherited from $\Omega_{R/k}$), hence this implies $P=0$. We are done.
\end{proof}
Having proved $f^!\Omega_D\cong\Omega_C$, we now show that the first Chern classes on $C$ and $D$ commute with the push-forward $f_*$.
\begin{prop}
	For the isomorphism $f^!\Omega_D\cong \Omega_C$ defined in Proposition~\reff{prop:f!OmegaIso}, the following diagram commutes.
	\begin{diagram*}
		\node[ob] (a) at (0,1.5) {$f_*\Oo_C^\times$};
		\node[ob] (b) at (4,1.5) {$f_*\Omega_C\cong f_*f^!\Omega_D$};
		\node[ob] (c) at (4,0) {$\Omega_D$};
		\node[ob] (d) at (0,0) {$\Oo_D^\times$};
		\scriptsize
		\draw[->] (a) -- (b) node[pos=0.5, above]{$f_*(d_C\log)$};
		\draw[->] (d) -- (c) node[pos=0.5, above]{$d_D\log$};
		\draw[->] (b) -- (c) node[pos=0.5, right]{$\Tr_f$};
		\draw[->] (a) -- (d) node[pos=0.5, left]{$N_{L/K}$};
	\end{diagram*}
	where $\Oo_C\morphism[d_C]\Omega_C$ and $\Oo_D\morphism[d_D]\Omega_D$ are the respective universal derivations.
\end{prop}
\begin{proof}
	Because all involved sheaves are vector bundles on $C$ (ehm \ldots\ not really, but we can replace $f_*\Oo_C^\times$ and $\Oo_D^\times$ by $f_*\Oo_C$, $\Oo_D$), sections on an open subset $U\neq\emptyset$ injectively map to the stalks at the generic point $\eta_C$ of $C$. Therefore, it suffices to show the following.
	\begin{claim}
		Let $L/K$ be a finite separable field extension and $k\subseteq K$ a subfield. We consider
		\begin{align*}
			\Omega_{L/k}\cong\Omega_{K/k}\otimes_KL\xrightarrow{\Tr_{L/K}}\Omega_{K/k}
		\end{align*}
		(the $\Tr_{L/K}$ here is abuse of notation and should actually be $\id_{\Omega_{K/k}}\otimes \Tr_{L/K}$). Then for $\ell\in L^\times$ we have $\Tr_{L/K}(d_{L/k}\log \ell)=d_{K/k}\log N_{L/K}(\ell)$.
	\end{claim}
	Note that the isomorphism $\Omega_{L/k}\cong \Omega_{K/k}\otimes_KL$ is \cite[Lemma~16.15]{eisenbudCommAlg}. Let $M$ be the normal hull of $L/K$. Then $M/K$ is still separable, hence $\Omega_{M/k}\cong \Omega_{K/k}\otimes_KM$ and there are $n=[L:K]$ $K$-linear embeddings $\sigma_1,\ldots,\sigma_n\colon L\monomorphism M$.  They satisfy $N_{L/K}(x)=\prod_{i=1}^n\sigma_i(x)$ and $\Tr_{L/K}(x)=\sum_{i=1}^n\sigma_i(x)$ for all $x$. Hence
	\begin{align*}
	d_{K/k}\log N_{L/K}(\ell)=\frac{d_{K/k}N_{L/K}(\ell)}{N_{L/K}(\ell)}=\frac{1}{N_{L/K}(\ell)}d_{K/k}\left(\prod_{i=1}^n\sigma_i(\ell)\right)\;.
	\end{align*}
	Since $L/K$ and $M/K$ are separable extensions, $d_{K/k}$ extends uniquely to $d_{L/k}$ and $d_{M/k}$ (this is quite easy to see and we proved it on exercise sheet \#5 of Algebra II)  -- in particular, $d_{M/k}$ extends $d_{L/k}$. Using the Leibniz rule, the above term thus simplifies to
	\begin{align*}
		\frac{1}{N_{L/K}(\ell)}\sum_{i=1}^nd_{M/k}\sigma_i(\ell)\prod_{j\neq i}\sigma_i(\ell)&=\sum_{i=1}^n\frac{d_{M/K}\sigma_i(\ell)}{\sigma_i(\ell)}=\sum_{i=1}^n\sigma_i\left(\frac{d_{M/K}(\ell)}{\ell}\right)=\sum_{i=1}^n\sigma_i(d_{M/k}\log \ell)\\
		&=\Tr_{L/K}\left(d_{L/k}\log\ell\right)\;,
	\end{align*}
	where the automorphism of $M/K$ induced by $\sigma_i$ was denoted by $\sigma_i$ as well, and the action of $\sigma_i$ on $\Omega_{M/k}$ is actually given by $\id_{\Omega_{K/k}}\otimes \sigma_i$ in the representation $\Omega_{M/k}\cong \Omega_{K/k}\otimes_KM$. We are done.
\end{proof}
\section{Proof of Serre duality for curves}
Let $C$ always be a proper regular curve over the algebraically closed field $k$.
\begin{prop}
	Let $\eta_C$ be the generic point of $C$ and $f\in\Oo_{C,\eta_C}$ a rational function on $C$ such that $d_Cf\neq 0$. Let $P$ be the set of poles of $f$. Then the morphism $C\setminus P\morphism\IA_k^1=\Spec k[T]$ (defined by $k[T]\morphism\Oo_C(C\setminus P)$ sending $T$ to $f$) extends to a unique finite separable morphism $C\morphism\IP_k^1$.
\end{prop}
\begin{rem}
	\begin{alphanumerate}
		\item \lbl{rem:d_Cfnot0}Why do we find such an $f$? Let $L=\Oo_{C,\eta_C}$ be the field of rational functions on $C$. Then the universal derivation $d_C\colon\Oo_C\morphism\Omega_C$ descends to $d_{L/k}\colon L\morphism\Omega_{L/k}$ on the stalk at $\eta$. If $d_{L/k}$ is the zero map, then $\Omega_{L/k}=0$ by the universal property. But locally, $C$ looks like $\Spec R$ for $R$ a Dedekind domain, and $R$ is of finite type over $k$ by properness. Hence $1=\dim R=\trdeg (L/k)$ by \cite[Theorem~10]{alg1} and $\dim_L\Omega_{L/k}\geq\trdeg(L/k)=1$ by \cite[Corollary~16.17]{eisenbudCommAlg}, contradicting $\Omega_{L/k}=0$.
		\item Actually, we have $\dim_L\Omega_{L/k}=1$. Indeed, equality in the above inequality holds iff $L/k$ is separable \cite[Corollary~16.17]{eisenbudCommAlg}. But $k$ is algebraically closed, hence perfect and extensions (even transcendental ones) of perfect fields are always separable. The generalized notion of separability required here together with a proof can be found in \cite[Proposition~1.6.2\itememph{b}]{alg2}.
	\end{alphanumerate}
\end{rem}
\begin{proof}
	Denote the above morphism by $C\setminus P\morphism[f]\IA_k^1$ (this is actually abuse of notation) and let $K=k(T)=\Oo_{\IA_k^1,\eta}$, where $\eta$ is the generic point of $\IA_k^1$. The morphism induced on stalks at the generic points is $K\monomorphism L$. Composing with $d_{L/k}\colon L\morphism\Omega_{L/k}$ is a $k$-linear derivation of $K$, hence induces a morphism $\Omega_{K/k}\morphism \Omega_{L/k}$ of $K$-vector spaces. We obtain a commutative diagram
	\begin{diagram*}
		\node[ob] (a) at (0,1.5) {$K$};
		\node[ob] (b) at (2.5,1.5) {$L$};
		\node[ob] (c) at (2.5,0) {$\Omega_{L/k}$};
		\node[ob] (d) at (0,0) {$\Omega_{K/k}$};
		\scriptsize
		\draw[right hook->] (a) -- (b);
		\draw[->] (d) -- (c) node[pos=0.5, above]{$\phi$};
		\draw[->] (b) -- (c) node[pos=0.5, right]{$d_{L/k}$};
		\draw[->] (a) -- (d) node[pos=0.5, left]{$d_{K/k}$};
	\end{diagram*}
	of $K$-vector spaces.
	
	The image of $T\in K$ under $\phi d_{K/k}$ is $d_{L/k}f\neq 0$. Thus, in the short exact sequence
	\begin{align*}
		\Omega_{K/k}\otimes_KL\morphism\Omega_{L/k}\morphism\Omega_{L/K}\morphism 0
	\end{align*}
	the left arrow is non-zero. Since $\Omega_{K/k}\otimes_KL$ and $\Omega_{L/k}$ are one-dimensional $L$-vector spaces (compare the argument from Remark~\reff{rem:d_Cfnot0}), this shows $\Omega_{L/K}=0$ and thus $L/K$ is separable by \cite[Corollary~16.17]{eisenbudCommAlg}.
	
	Let $N\subseteq C$ denote the (finite) set of zeros of $f$. An extension of $f|_{C\setminus (N\cup P)}\colon C\setminus (N\cup P)\morphism \IA_k^1$ to a morphism $C\setminus N\morphism\IP_k^1$ is given by
	\begin{align*}
		C\setminus N\morphism[1/f]\IA_k^1\morphism\IP_k^1\;.
	\end{align*}
	By construction of $\IP_k^1$ as gluing $\Spec k[t]$ and $\Spec k[t^{-1}]$ along $\Spec k[t,t^{-1}]$, we see that $C\setminus N\morphism\IP_k^1$ and $C\setminus P\morphism\IA_k^1\morphism\IP_k^1$ can be glued together. Thus, extistence of $f$ is shown.
	
	Uniqueness follows from the fact that $C\setminus P$ is dense in $C$, which is separated. Thus, for any other extension $g$ the equalizer $\Eq(f,g)\subseteq C$ must be closed, but it contains $C\setminus P$, hence $\Eq(f,g)=C$ (where we use that $C$ is integral, hence reduced).
	
	Finiteness of the resulting morphism is usually deduced from \emph{Zariski's main theorem} (Corollary~\reff{cor:ZariskisMainTheorem} is our friend here).\footnote{By the way, why is $f$ even proper (and we definitely need this for Corollary~\reff{cor:ZariskisMainTheorem})? We know that $C$ is proper over $k$ and $\IP_k^1\morphism \Spec k$ is separable, hence $f$ being proper follows from the cancellation property from Proposition~\reff{prop:er}.} Alternatively, assuming that $C$ is projective such that any finite subset of $C$ is contained in an affine open subset, this can be shown as follows. Let $d\in\IP_k^1$ and $c_1,\ldots,c_N$ be its preimages in $C$ (kinda convenient we walked the extra mile to prove Lemma~\reff{lem:finitelyManyPreimages}, hm?). Let $U\subseteq C$ be an affine open neighbourhood of $\{c_1,\ldots,c_N\}$ whose image in $\IP_k^1$ is not $\IP_k^1$. Since $k$ is algebraically closed, an appropriate affine transformation (potentially followed by exchanging $t$ and $t^{-1}$) assures that the image of $U$ in $\IP_k^1$ is contained in $\IA_k^1=\Spec k[t]$. 
	\begin{claim}
		$C\setminus U$ consists of finitely many points.
	\end{claim}
	Indeed, $C\setminus U$ is a closed subprescheme, hence given by a sheaf of ideals $\Jj\subseteq \Oo_C$. Locally, $\Oo_C$ is given by a Dedekind domain $R$ and $\Jj$ by an ideal $I\subseteq R$. Since $R$ has unique prime ideal decomposition, $V(I)=\Spec R\setminus U$ consists of finitely many points -- the finitely many prime ideal factors of $I$. Now $C$ can be covered by finitely many affine open subsets (quasi-compactness of $C$ holds since $C$ is proper over $k$) and we are done.
	
	Consequently, $f(C\setminus U)$ is finite and we can choose an enumeration $t_1,\ldots,t_n$ of $f(C\setminus U)\cap \IA_k^1$. Then $d$ is different from all $t_i$, $V=\IA_k^1\setminus\{t_1,\ldots,t_n\}=\IA_k^1\setminus V\left(\prod_{i=1}^n(T-t_i)\right)$ is affine and so is $f^{-1}V=U\setminus V\left(f^*\prod_{i=1}^n(T-t_i)\right)$. Hence the affine open subsets $V\subseteq \IP_k^1$ such that $f^{-1}V$ is affine cover $\IP_k^1$, showing that $f$ is affine, hence finite when we take into account that $f_*\Oo_C$ is a coherent $\Oo_{\IP_k^1}$-module by Theorem~\reff{thm:ProperRpcoherent}.
\end{proof}
We are now able to apply the results of Section~\reff{sec:f^!} to $C\morphism[f]\IP_k^1$, thus finally proving Serre duality.
\begin{proof}[Proof of Theorem~\reff{thm:CurvesSerreDuality}\itememph{b} and \itememph{c}]
	As pointed out on page \pageref{par:StrategyForSD}, Serre duality for $\IP_k^1$ together with Proposition~\reff{prop:f^!Adjunction} and Proposition~\reff{prop:f!OmegaIso} provides isomorphisms (depending on $f$, but otherwise canonical)
	\begin{align*}
	H^1(C,\Vv)^*\cong H^1\big(\IP_k^1,f_*\Vv\big)^*\cong \Hom_{\Oo_{\IP_k^1}}\big(f_*\Vv,\Omega_{\IP_k^1}\big)\cong \Hom_{\Oo_C}\big(\Vv,f^!\Omega_{\IP_k^1}\big)\cong \Hom_{\Oo_C}\big(\Vv,\Omega_C\big)
	\end{align*}
	(as usual, asterisks denote duals as long as they are clearly no push-forwards/pull-backs), proving a duality like Theorem~\reff{thm:CurvesSerreDuality}\itememph{c}. In particular, for $\Vv=\Omega_C$ we get $H^1(C,\Omega_C)\cong k$ and it is sufficient to show that this isomorphism is the one from Theorem~\reff{thm:CurvesSerreDuality}\itememph{b}. 

	But this is not too hard to check: The isomorphism 
	\begin{align*}
	H^1(C,\Omega_C)\isomorphism k\isomorphism H^1(\IP_k^1,\Omega_{\IP_k^1})
	\end{align*}
	obtained by these identifications is the one given by $\Tr_f\colon f_*\Omega_C\morphism\Omega_{\IP_k^1}$ from Proposition~\reff{prop:f!OmegaIso}. Also, if $D$ is any divisor on $C$, define its push-forward $f_*D$ by $f_*D(x)=\sum_{f(y)=x}D(y)$.\footnote{If $k$ was not algebraically closed, we would need to multiply $D(y)$ by the inertia degree $[\KK(y)\colon \KK(x)]$. As explained in \cite[Ch.\ I, \S 12]{NEUKIRCH}, affine-locally divisors correspond to ideals in a Dedekind domain; and the push-forward of a divisor (in the more general version explained here) corresponds to the \emph{norm map} $N_{L/K}$ on ideals from \cite[p.\ 197]{NEUKIRCH} -- which is pretty much what we show.} Then $\deg(f_*D)=\deg(D)$ and the image of the $\Oo_C^\times$-torsor $\Oo_C(D)^\times$ under $N_{L/K}\colon f_*\Oo_C^\times\morphism\Oo_{\IP_k^1}^\times$ is $\Oo_{\IP_k^1}(f_*D)^\times$.
\end{proof}
\begin{rem*}
	Let $C\morphism[f]D$ be a finite separable morphism between regular connected curves over the algebraically closed field $k$. For a proper closed subprescheme $Z\subseteq D$ and $d\in D_1$ let $\Jj_Z$ be the sheaf of ideals defining $Z$ and let $\Div(Z)=\sum_{d\in D_1}c_d\cdot d$, where $c_d=v_d(\Jj_{Z,d})$. Then $\Oo_D(-\Div(Z))=\Jj_Z$ by definition. If the \emph{pull-back} of divisors is defined by
	\begin{align*}
		f^*\Delta=\sum_{c\in C_1}e_{(c| f(c))}\Delta(f(c))\;,
	\end{align*}
	where $e_{(c| f(c))}$ is the \emph{ramification index} of the corresponding primes in the local rings $\Oo_{C,c}$ and $\Oo_{D,f(c)}$. That is, $e_{(c|f(c))}=v_c(f^*\pi)$, where $\pi$ is a uniformizer of the DVR $\Oo_{D,f(c)}$. Then $f^*\Oo_D(\Delta)=\Oo_C(f^*\Delta)$. From Proposition~\reff{prop:f!OmegaIso} and Corollary~\reff{cor:GenusOmega} we obtain that
	\begin{align*}
		2g_C-2&=\deg\Omega_C=\deg f^!\Omega_D=\deg\left(f^*\Omega_D\otimes_{\Oo_C}\DD_f^{-1}\right)=\deg \DD_f^{-1}+\deg(f)\deg\Omega_C\\
		&=\deg \DD_f^{-1}+\deg(f)(2g_D-2)=\sum_{c\in C_1}v_c(\DD_f)+\deg(f)(2g_D-2)
	\end{align*}
	which is called the \emph{Hurwitz formula}. Here $\deg(f)$ is the rank of $f_*\Oo_C$ as an $\Oo_D$-vector bundle. The equation $\deg(f^*\Delta)=\deg(f)\deg\Delta$ (which we used to derive $\deg(f^*\Omega_D)=\deg(f)\deg\Omega_D$) follows from $\sum_{f(c)=d}e_{(c| d)}=\deg(f)$ (which is \cite[Ch.\ I, (8.2)]{NEUKIRCH}; note that the inertia degrees $[\KK(c):\KK(d)]$ equal $1$ since $k$ is algebraically closed, as always).
	
	In the case where the ramification is \emph{tame} -- i.e., no $e_{(c| d)}$ is divisible by the characteristic of the residue fields and $\KK(c)/\KK(d)$ is separable (the latter is automatically true in our case) -- we have $v_c(\DD_f)=e_{(c| d)}-1$ by a theorem of Dedekind (cf.\ \cite[Ch.\ III, (2.6)]{NEUKIRCH}) and the above equation becomes
	\begin{align*}
		2g_C-2=\deg(f)(2g_D-2)+\sum_{c\in C_1}\left(e_{(c| d)}-1\right)\;.
	\end{align*}
\end{rem*}
\chapter{Cohomology and base change}
\section{Base change by a flat morphism}
Recall that a module $M$ over a ring $R$ is called \emph{flat} if $M\otimes_R-$ is exact as a functor from $\cat{Mod}(R)$ to itself, and an $R$-algebra $S$ is called \emph{flat} if it is flat as an $R$-module.
\begin{fact}\lbl{fact:flatBaseChange}
	Let $A$ be any ring, $B$ a flat $A$-algebra, $X\morphism\Spec A$ a quasi-compact $A$-scheme, $\Mm$ a quasi-coherent $\Oo_X$-module and $Y=X\times_{\Spec A}\Spec B\morphism[\pi]X$. Then
	\begin{align*}
		H^\bullet\left(Y,\pi^*\Mm\right)\cong H^\bullet(X,\Mm)\otimes_AB
	\end{align*}
\end{fact}
\begin{proof}
	If $X=\Spec R$, then $Y=\Spec (R\otimes_AB)$ is also affine and $\pi^*\Mm=(M\otimes_AB)^\qcmod$ if $\Mm\cong \snake{M}$ for some $R$-module $M$. Thus $\pi^*\Mm(Y)\cong \Mm(X)\otimes_AB$ in this situation. Applying this to the $U_{i_0,\ldots,i_p}$ of a finite affine open cover $\Uu\colon X=\bigcup_{i=0}^nU_i$ of $X$ we obtain 
	\begin{align*}
		\check{C}^\bullet\left(\pi^{-1}\Uu,\pi^*\Mm\right)\cong\check{C}^\bullet(\Uu,\Mm)\otimes_AB
	\end{align*}
	and the result follows from exactness of $-\otimes_AB$.
\end{proof}
\begin{rem}
	\begin{alphanumerate}
		\item\lbl{rem:flatBaseChange} Flatness is only needed in the last step. If flatness of $f$ is not provided, but $\Mm$ is \emph{flat} over $\Oo_Y$ we only obtain a spectral sequence\footnote{Which I'm \emph{not} going to abbreviate SS.} 
		\begin{align*}
		E_2^{p,q}=\Tor_{-p}^A(B,H^q(X,\Mm))\converge H^{p+q}(Y,\pi^*\Mm)
		\end{align*}
		(see \cite[Proposition~1.4.1a]{jacobians} for an explanation and a proof).
		\item More generally, assume that $X\morphism[f]Y$ is quasi-compact and quasi-separated and $\snake{Y}\morphism[\pi] Y$ flat (in the sense that $\Oo_{\snake{Y},y}$ is a flat $\Oo_{Y,\pi(y)}$-module for all $y\in \snake{Y}$). Consider the pull-back
		\begin{diagram*}
			\node[ob] (a) at (0,1.5) {\llap{$\snake{X}=\:$}$\snake{Y}\times_YX$};
			\node[ob] (b) at (2.5,1.5) {$\snake{Y}$};
			\node[ob] (c) at (0,0) {$X$};
			\node[ob] (d) at (2.5,0) {$Y$};
			\scriptsize
			\draw[->] (a) -- (b) node[pos=0.5, above] {$\snake{f}$};
			\draw[->] (c) -- (d) node[pos=0.5, above] {$f$};
			\draw[->] (a) -- (c) node[pos=0.5, left] {$\snake{\pi}$};
			\draw[->] (b) -- (d) node[pos=0.5, right] {$\pi$};
		\end{diagram*}
		Then we have
		\begin{align*}
			\pi^*R^pf_*\Mm\cong R^p\snake{f}_*(\snake{\pi}^*\Mm)\;.
		\end{align*}
		Indeed, since the question is local with respect to $\snake{Y}$ and $Y$, we may assume $Y=\Spec A$ and $\snake{Y}=\Spec B$, where $B$ is a flat $A$-algebra -- and \emph{voil}, where are in the situation of Fact~\reff{fact:flatBaseChange}.
	\end{alphanumerate}
\end{rem}
\section{The theorem about formal functions}
Let $R$ be a noetherian local ring and denote $\roof{\phantom{x}}$ the completion with respect to the maximal ideal $\mm$. Completion is well-known to be an exact functor on finitely generated $R$-modules, which is a consequence of the Artin--Rees lemma. Let $X\morphism[f]\Spec R$ be a proper morphism and $\Mm$ a coherent $\Oo_X$-module. Let $X_0=X\times_{\Spec R}\Spec \KK(\mm)$ and $X_n=X\times_{\Spec R}\Spec (R/\mm^{n+1})$ its \emph{$n\ordinalth$ infinitesimal thickening}. Then $X_0\morphism X_n$ and $X_n\morphism X_{n+1}$ are closed embeddings defined by a nilpotent sheaf of ideals, hence (topologically) homeomorphisms. Similarly, $i_n\colon X_n\morphism X$ is a closed embedding.
\begin{thm}\lbl{thm:formalFunctions1}
	In the above situation, we have
	\begin{align*}
		H^p(X,\Mm)^\complete \cong\limit[n\in\IN]H^p(X_n,i_n^*\Mm)\;.
	\end{align*}
\end{thm}
We will postpone the proof to see some corollaries first.
\begin{varthm}{thm}[Grothendieck, Theorem about formal functions]\lbl{thm:formalFunctions2}
	More generally, let $X\morphism[f]Y$ be a proper morphism of locally noetherian schemes, $\Mm$ a coherent $\Oo_X$-module, and $y\in Y$. Let $\mm_{Y,y}\subseteq \Oo_{Y,y}$ be the maximal ideal of the local ring at $y$. Denote $X_n=X\times_Y\Spec \Oo_{Y,y}/\mm_{Y,y}^{n+1}$ the $n\ordinalth$ infinitesimal thickening of the fibre of $f$ at $y$ and $i_n\colon X_n\morphism X$ the canonical morphisms. Then
	\begin{align*}
		(R^pf_*\Mm)_y^\complete\cong \limit[n\in \IN]H^p(X_n,i_n^*\Mm)
	\end{align*}
\end{varthm}
\begin{proof}
	This is easily reduced to Theorem~\reff{thm:formalFunctions1}. By Remark~\reff{rem:flatBaseChange}\itememph{b} applied to the flat morphism $\Spec \Oo_{Y,y}\morphism[\pi]Y$ we have $\pi^*R^pf_*\Mm\cong R^p\snake{f}_*(\snake{\pi}^*\Mm)$ (using the notation given there). In particular, comparing stalks at $y$ (considered both as a point of $Y$ and the unique closed point of $\Spec \Oo_{Y,y}$) we obtain
	\begin{align*}
		(R^pf_*\Mm)_y\cong \Oo_{Y,y}\otimes_{\Oo_{Y,y}}(R^pf_*\Mm)_y\cong \big(R^p\snake{f}_*(\snake{\pi}^*\Mm)\big)_y\;.
	\end{align*}
	That is, the right-hand side of the assertion doesn't change when $X$ and $Y$ are replaced by $X\times_Y\Spec\Oo_{Y,y}$ and $\Spec \Oo_{Y,y}$ respectively. Since $\Spec \Oo_{Y,y}/\mm_{Y,y}^{n+1}\morphism Y$ factors over $\Spec \Oo_{Y,y}$ for every $n\in\IN$, the $X_n$ also don't change when $X$ and $Y$ are replaced in that way. Therefore we may assume that we are in the situation of Theorem~\reff{thm:formalFunctions1}.
	
	Then $R=\Oo_{Y,y}$ is local with maximal ideal $\mm=\mm_{Y,y}$. We have $(R^pf_*\Mm)_y\cong R^pf_*\Mm(Y)$ since the latter is already an $R_\mm$-module. By Proposition~\reff{prop:HigherDirectImage}\itememph{d}, $R^pf_*\Mm(Y)\cong H^p(X,\Mm)$ and we are done.
\end{proof}
\begin{cor}\lbl{cor:RpfVanishes}
	When $p$ is larger than the dimension of the fibers of $f$, $R^pf_*\Mm$ vanishes.
\end{cor}
\begin{proof}
	By Proposition~\reff{prop:CohoDimension} and Theorem~\reff{thm:formalFunctions2}, $(R^pf_*\Mm)_y^\complete=0$ for all $y\in Y$. All we need to show is that this implies $(R^pf_*\Mm)_y=0$ as well. By Theorem~\reff{thm:ProperRpcoherent}, $M=(R^pf_*\Mm)_y$ is a finitely generated module over the noetherian local ring $R=\Oo_{Y,y}$. By \cite[Theorem~7.2a]{eisenbudCommAlg}, $\roof{M}\cong M\otimes_R\roof{R}$ and also $\roof{R}$ is a faithfully flat $R$-algebra by \cite[\stackstag{00MC}]{stacks-project} so that $\roof{M}=0$ if and only if $M=0$.
\end{proof}
\begin{cor}[Very nice version of Zariski's main theorem]\lbl{cor:ZariskisMainTheorem}
	When $X\morphism[f]Y$ is a proper morphism between locally noetherian schemes whose fibers are zero-dimensional (e.g., finite), then $f$ is finite.
\end{cor}
\begin{proof}
	One is tempted to use Proposition~\reff{prop:AffineMorphism} here, but somehow the fact that we can only use coherent modules needs to be circumvented. Which we do now. Let $U\subseteq Y$ be affine open. Since properness is base-local (Proposition~\reff{prop:er}), $f^{-1}(U)\morphism U$ is still proper and (abusing notation) we denote it by $f$ again. If $\Jj$ is a sheaf of ideals in $\Oo_{f^{-1}(U)}$, then it is a coherent $\Oo_{f^{-1}(U)}$-module since $X$ is locally noetherian. By Corollary~\reff{cor:RpfVanishes}, $R^1f_*\Jj$ vanishes, hence $H^1\big(f^{-1}(U),\Jj\big)=0$. By Serre's affinity criterion (Proposition~\reff{prop:serreAffinity}), $f^{-1}(U)$ is affine.
	
	Hence $f$ (the original unrestricted $f$ is back!) is affine. Since $f_*\Oo_X$ is a coherent $\Oo_Y$-module by Theorem~\reff{thm:ProperRpcoherent}, $f$ is finite.
\end{proof}
\begin{rem*}
	There are other versions where $X\morphism[f]Y$ is \emph{quasi-finite} and one obtains factorizations $X\monomorphism[j]\ov{X}\morphism[\pi]Y$ where $\pi$ is finite and $j$ an open embedding. See SGA1 for a proof of this form, and Mumford's \emph{The red book of varieties and schemes}\footnote{For which Springer went out of their usual way and published it with a red cover, as Professor Franke would like to point out.} for a discussion of various versions of Zariski's main theorem.
\end{rem*}
\begin{proof}[Proof of Theorem~\reff{thm:formalFunctions1}]
	The proof we give here is essentially the one given in \cite[(4.1.7)]{egaIII} which is the best in Professor Franke's opinion. Let us first see where the canonical morphism $H^p(X,\Mm)^\complete \morphism\limit H^p(X_n,i_n^*\Mm)$ (which is to be an isomorphism) comes from. Even if $R/\mm^{n+1}$ is usually not a flat $R$-algebra, Fact~\reff{fact:flatBaseChange} still provides a canonical morphism
	\begin{align}\lbl{eq:canMorphismFF}
		H^p(X,\Mm)\otimes_RR/\mm^{n+1}\morphism H^p(X_n,i_n^*\Mm)\;.\tag{\$}
	\end{align}
	Taking inverse limits on both sides gives the desired morphism.
	
	Let $\Mm_n=(i_n)_*i_n^*\Mm\cong\Mm/\mm^{n+1}\Mm$ (the last isomorphism is easily checked affine-locally). Since $i_n$ is a closed immersion and thus affine, Corollary~\reff{cor:AffinePushforwardIso} gives $H^p(X,\Mm_n)\cong H^p(X_n,i_n^*\Mm)$, which is nice since we can forget about $X_n$ now. Moreover, we get a short exact sequence
	\begin{align}\lbl{eq:lesFormalFunctions}
		0\morphism \mm^{n+1}\Mm\morphism\Mm\morphism\Mm_n\morphism 0\tag{$*$}
	\end{align}
	of coherent $\Oo_X$-modules. Of course we will exploit the associated long exact cohomology sequence. Let $H=H^p(X,\Mm)$ for short and $H_n=H^p(X,\Mm_n)$. Put $K_n=\ker\left(H\morphism H_n\right)$ and $Q_n=\Im\left(H_n\morphism H^{p+1}(X,\mm^{n+1}\Mm)\right)$. The idea of the proof is now the following. We get short exact sequences
	\begin{align*}
		0\morphism H/K_n\morphism H_n\morphism Q_n\morphism 0\;.
	\end{align*}
	Taking inverse limits\footnote{And using left-exactness of the inverse limit functor -- this is because kernels are inverse limits themselves and limits commute with limits, cf.\ (the dual of) Corollary~\reff{cor:ColimitsCommute}.} gives an exact sequence
	\begin{align*}
		0\morphism\limit H/K_n\morphism\limit H_n\morphism\limit Q_n\;.
	\end{align*}
	So we're done once we prove $\limit H/K_n=\roof{H}$ and $\limit Q_n=0$.
	
	\emph{Step 1.} Let's prove $\limit H/K_n=\roof{H}$ first. Consider the \emph{Rees algebra} $S=\bigoplus_{n\geq 0}\mm^n$. Our preliminary goal is to show that $K=\bigoplus_{n\geq 0}K_n$ is a finitely generated graded $S$-module. Let's first talk about the $S$-module structure of $K$. Let $x\in\mm$. Multiplication by $x$ gives a commutative diagram with exact rows
	\begin{diagram*}
		\node[ob] (a) at (0,1.5) {$\mm^n\Mm$};
		\node[ob] (b) at (0,0) {$\mm^{n+1}\Mm$};
		\node[ob] (c) at (2.5,1.5) {$\Mm$};
		\node[ob] (d) at (2.5,0) {$\Mm$};
		\node[ob] (e) at (5,1.5) {$\Mm_n$};
		\node[ob] (f) at (5,0) {$\Mm_{n+1}$};
		\scriptsize
		\draw[->] (a) -- (b) node[pos=0.5, left] {$x\cdot$};
		\draw[->] (c) -- (d) node[pos=0.5, left] {$x\cdot$};
		\draw[->] (e) -- (f) node[pos=0.5, left] {$x\cdot$};
		\draw[->] (a) -- (c);
		\draw[->] (b) -- (d);
		\draw[->] (c) -- (e);
		\draw[->] (d) -- (f);
	\end{diagram*}
	Applying the long exact cohomology sequence associated to \eqreff{eq:lesFormalFunctions}, we get
	\begin{diagram*}
		\node[ob] (a) at (0,1.5) {$H^p(X,\mm^n\Mm)$};
		\node[ob] (b) at (0,0) {$H^p(X,\mm^{n+1}\Mm)$};
		\node[ob] (c) at (3.5,1.5) {$H^p(X,\Mm)$};
		\node[ob] (d) at (3.5,0) {$H^p(X,\Mm)$};
		\node[ob] (e) at (7,1.5) {$H^p(X,\Mm_n)$};
		\node[ob] (f) at (7,0) {$H^p(X,\Mm_{n+1})$};
		\scriptsize
		\draw[->] (a) -- (b);
		\draw[->] (c) -- (d) node[pos=0.5, left] {$x\cdot$};
		\draw[->] (e) -- (f);
		\draw[->] (a) -- (c);
		\draw[->] (b) -- (d);
		\draw[->] (c) -- (e);
		\draw[->] (d) -- (f);
	\end{diagram*}
	(and this diagram still has exact rows). From this, we easily see that $x K_n\subseteq K_{n+1}$, hence $\mm K_n\subseteq K_{n+1}$ and $K$ is indeed a graded $S$-module. And we get even more: $K$ is a quotient of the graded $S$-module $M=\bigoplus_{n\geq 0}H^p(X,\mm^{n+1}\Mm)$. We prove in Lemma~\reff{lem:gradedCohomologyStuff} that $M$ is finitely generated over $S$, hence so is $K$.
	
	Choose homogeneous generators $k_1,\ldots,k_r$ and let $n_0$ be their maximal degree. Since $S$ is generated by $S_1=\mm$ as an $R$-algebra, we see that $K_{n+1}=\mm K_n$ for $n\geq n_0$. Since $K_{n_0}\subseteq H$, this gives $K_n\subseteq \mm^{n-n_0}H$ for $n\geq n_0$. On the other hand, $H\morphism H_n$ factors over \eqreff{eq:canMorphismFF}, hence $\mm^{n+1}H\subseteq K_n\subseteq \mm^{n-n_0}H$. This shows $\limit H/K_n=\roof{H}$.
	
	\emph{Step 2.} We show $\limit Q_n=0$. Put $Q=\bigoplus_{n\geq 0}Q_n$. Similar to what we did with $K$ before, $Q$ is an $S$-submodule of $N=\bigoplus_{n\geq 0}H^{p+1}(X,\mm^{n+1}\Mm)$, which is finitely generated by Lemma~\reff{lem:gradedCohomologyStuff}. Since $S$ is noetherian ($\mm$ is finitely generated, hence $S$ is of finite type over $R$), this shows that $Q$ is finitely generated as well.
	
	Let's make the following convention: Whenever we write $\mm^kQ_n$ in the following, this means multiplication as an $R$-module and the result is contained in $Q_n$ again, whereas $S_kQ_n$ means multiplication as a homogeneous component of the graded $S$-module $Q$, i.e., the result is in $Q_{k+n}$. Since $H_n=H^p(X_n,i_n^*\Mm)$ is an $R/\mm^{n+1}$-module and $Q_n$ is the image of $H_n$ in $H^{p+1}(X,\mm^{n+1}\Mm)$, we get $\mm^{n+1}Q_n=0$. Since $Q$ is finitely generated over $S$ and each generator has only finitely many non-zero homogeneous components, there is a $k_0$ such that $\mm^kQ=0$ for $k\geq k_0$. Moreover, by the same argument we used for $K$ we find some $n_0\in\IN$ such that $Q_{n+1}=S_1Q_n$ for $n\geq n_0$.
	
	Let $v_k\colon Q_{k+n}\morphism Q_n$ be the canonical morphisms over which the limit $\limit Q_n$ is taken. They can be described as follows. We have a canonical inclusion $\mm^{k+n+1}\Mm\subseteq \mm^{n+1}\Mm$, inducing $H^{p+1}(X,\mm^{k+n+1}\Mm)\morphism H^{p+1}(X,\mm^{n+1}\Mm)$ on cohomology. Restricting to $Q_{k+n}$ and $Q_n$, this is precisely $v_k$. Note that $v_k(S_kQ_n)=\mm^kQ_n$. For $n\geq n_0$ and $k\geq k_0$ we thus have
	\begin{align*}
		v_k(Q_{k+n})=v_k(S_kQ_n)=\mm^kQ_n=0\;.
	\end{align*}
	This shows that the $v_k$ are $0$ if $k$ and $n$ are sufficiently large, proving $\limit Q_n=0$. As pointed out before, we are done.
\end{proof}
And now for the missing lemma (you will find a way more general version in \cite[(2.4.1)]{egaIII}, but I only need this special case).
\begin{lem}\lbl{lem:gradedCohomologyStuff}
	Let $R$ be a noetherian ring. Let $X\morphism[f]\Spec R$ be a proper morphism and $\Mm$ a coherent $\Oo_X$-module. Then for any ideal $I\subseteq R$, the module $M=\bigoplus_{n\geq 0}H^p(X,I^n\Mm)$ is finitely generated over the Rees algebra $S=\bigoplus_{n\geq 0}I^n$.
\end{lem}
\begin{proof}
	Consider
	\begin{align*}
		\snake{X}=X\times_Y\Spec S\cong \SPEC_X\bigg(\bigoplus_{n\geq 0}I^n\Oo_X\bigg)\;.
	\end{align*}
	We get a cartesian diagram
	\begin{diagram*}
		\node[ob] (a) at (0,1.5) {$\snake{X}$};
		\node[ob] (b) at (2.5,1.5) {$\Spec S$};
		\node[ob] (c) at (0,0) {$X$};
		\node[ob] (d) at (2.5,0) {$\Spec R$};
		\scriptsize
		\draw[->] (a) -- (b) node[pos=0.5, above] {$\snake{f}$};
		\draw[->] (c) -- (d) node[pos=0.5, above] {$f$};
		\draw[->] (a) -- (c) node[pos=0.5, left] {$\snake{\pi}$};
		\draw[->] (b) -- (d) node[pos=0.5, right] {$\pi$};
	\end{diagram*}
	in which $\snake{f}$ is proper again by Proposition~\reff{prop:er} and $\snake{\pi}$ is affine by construction. Since the Rees algebra $S$ is of finite type over $R$, the morphism $\pi$ is of finite type. So is $\snake{f}$ since it is proper. Thus $\snake{X}$ is of finite type over $\Spec R$ and thus noetherian.
	
	Consider the $\Oo_{\snake{X}}$-module $\snake{\Mm}=\bigoplus_{n\geq 0}I^n\Mm$. It is clearly coherent and since $\snake{\pi}$ is affine, Corollary~\reff{cor:AffinePushforwardIso} gives
	\begin{align*}
		H^p\left(\snake{X},\snake{\Mm}\right)\cong H^p\left(X,\snake{\pi}_*\snake{\Mm}\right)\cong H^p\bigg(X,\bigoplus_{n\geq 0}I^n\Mm\bigg)\cong\bigoplus_{n\geq 0}H^p(X,I^n\Mm)\;.
	\end{align*}
	The reason why we can swap $H^p$ and the direct sum is that $X$ is quasi-compact, so the \vC ech cohomology may be computed from a finite affine open cover and then products occurring in the \vC ech complex are finite, hence direct sums as well. Also direct sums commutes with taking global sections for sheaves on quasi-compact spaces, so in the end this comes down to direct sums commuting with direct sums, which is clearly fulfilled.
	
	Now $S$ is noetherian ($I$ is finitely generated over $R$, hence $S$ is an $R$-algebra of finite type) and $\snake{f}$ is proper, so Theorem~\reff{thm:ProperRpcoherent} implies that $H^p\left(\snake{X},\snake{\Mm}\right)$ is a finitely generated $S$-module. We are done.
\end{proof}

Another approach to prove Theorem~\reff{thm:formalFunctions1} (e.g.\ in Hartshorne) would be to use our calculations from Theorem~\reff{thm:CohoOfIP^n} when $X=\IP_R^n$ and $\Mm=\Oo(k)$, then using exactness of $\roof{\phantom{x}}$ (and/or Mittag-Leffler type results) to obtain the result for other coherent $\Oo_{\IP_R^n}$-modules, then (not done by Hartshorne) using Chow's lemma to deduce the proper case from the projective one.

\section{Base change for flat morphisms}
If $X\morphism[f]\Spec A$ is a flat proper morphisms, $A$ a noetherian ring, and $\Vv$ a vector bundle on $X$, one obtains a finite complex $\Gg^\bullet$ of locally free $A$-modules such that 
\begin{align*}
	H^p\left(X\times_{\Spec A}\Spec B,\pi^*\Vv\right)\cong H^p(\Gg^\bullet\otimes_AB)\;.
\end{align*}
For instance, if $\Vv$ is a vector bundle on $X$ and the cohomology of the fibres vanishes in cohomological degrees $\neq p$, then $R^qf_*\Vv=0$ when $q\neq p$ and $R^pf_*\Vv$ is a vector bundle compatible with base-change to any $A$-algebra $B$.


\Appendix
\chapter{Appendix}
\section{Towards abelian categories}
\begin{defi}
	\begin{alphanumerate}
		\item \lbl{def:additiveCategory}A \defemph{pointed} category is a category with initial and final objects, such that the canonical (unique) morphism from the initial to the final object is an isomorphism.
		\item An \defemph{additive} category ${\cat A}$ is a pointed category which has a product $X\times Y$ (i.e., a fibre product over the final object $*$) and coproduct $X\amalg Y$ (i.e., a dual fibre product with respect to the initial object $*$) such that the canonical morphism $X\amalg Y\morphism X\times Y$ is an isomorphism for all objects $X,Y\in\Ob({\cat A})$ and such that the resulting addition law on $\Hom_{\cat A}(X,Y)$ defines a group structure for all $X,Y\in\Ob({\cat A})$.
	\end{alphanumerate}
\end{defi}
\begin{rem*}
	 \begin{alphanumerate}
	 	\item When ${\cat A}$ is a pointed category and $X,Y\in\Ob({\cat A})$, let the \emph{zero morphism} (which we denote $0$) $X\morphism[0]Y$ be defined by $X\morphism *\morphism Y$, where $*$ is the both initial and final object.
	 	\item We will construct the canonical morphism $X\amalg Y\morphism[c]X\times Y$ from Definition~\reff{def:additiveCategory}\itememph{b}. The product $X\times Y$ comes with canonical projections $X\lmorphism[p_1]X\times Y\morphism[p_2]Y$ such that given morphisms $T\morphism[\xi]X$ and $T\morphism[\upsilon]Y$ there is a unique $T\xrightarrow{\xi\times\upsilon}X\times Y$ such that
	 	\begin{diagram*}
	 		\node[ob] (XY) at (0,0) {$X\times Y$};
	 		\node[ob] (X) at (-1,1.25) {$X$};
	 		\node[ob] (Y) at (-1,-1.25) {$Y$};
	 		\node[ob] (T) at (2.5,0) {$T$};
	 		\scriptsize
	 		\draw[->] (XY) -- (X) node[pos=0.5, above right] {$p_1$};
	 		\draw[->] (XY) -- (Y) node[pos=0.5, below right] {$p_2$};
	 		\draw[->, dashed] (T) -- (XY) node[pos = 0.5, above] {$\exists!\ \xi\times \upsilon$};
	 		\draw[->, bend right] (T) to node[pos=0.5,below left] {$\xi$} (X);
	 		\draw[->, bend left] (T) to node[pos=0.5,above left] {$\upsilon$} (Y);
	 	\end{diagram*}
	 	commutes.
	 	
	 	Similarly, the coproduct $X\amalg Y$ has morphisms $X\morphism[i_1]X\amalg Y\lmorphism[i_2]Y$ such that given morphisms $X\morphism[\xi]T$ and $Y\morphism[\upsilon]T$ there is a unique morphism $X\amalg Y\xrightarrow{\xi\amalg\upsilon}T$ such that
	 	\begin{diagram*}
	 		\node[ob] (XY) at (0,0) {$X\amalg Y$};
	 		\node[ob] (X) at (-1,1.25) {$X$};
	 		\node[ob] (Y) at (-1,-1.25) {$Y$};
	 		\node[ob] (T) at (2.5,0) {$T$};
	 		\scriptsize
	 		\draw[<-] (XY) -- (X) node[pos=0.5, above right] {$i_1$};
	 		\draw[<-] (XY) -- (Y) node[pos=0.5, below right] {$i_2$};
	 		\draw[->, dashed] (XY) -- (T) node[pos = 0.5, above] {$\exists!\ \xi\amalg \upsilon$};
	 		\draw[<-, bend right] (T) to node[pos=0.5,below left] {$\xi$} (X);
	 		\draw[<-, bend left] (T) to node[pos=0.5,above left] {$\upsilon$} (Y);
	 	\end{diagram*}
	 	commutes.
	 	
	 	Using the universal property of $X\times Y$, we get a unique morphism $X\morphism[\alpha]X\times Y$ such that $p_1\alpha=\id_X$, $p_2\alpha=0$ and a unique morphism $Y\morphism[\beta]X\times Y$ such that $p_1\beta=0$ and $p_2\beta=\id_Y$. Then 
	 	\begin{align*}
	 		c\colon X\amalg Y\xrightarrow{\alpha\amalg\beta}X\times Y
	 	\end{align*}
	 	is the morphism we are looking for. It is unique with the property that $p_1 c i_1=\id_X$, $p_1 c i_2=0$, $p_2 c i_1=0$, and $p_2 c i_2=\id_Y$.
	 	\item For abelian groups and modules over a ring, both $X\amalg Y$ and $X\times Y$ are given by $\left\{(x,y)\st x\in X,\ y\in Y\right\}$ with component-wise operations and $p_1(x,y)=x$, $p_2(x,y)=y$, $i_1(x)=(x,0)$, and $i_2(y)=(0,y)$.
	 	\item For an additive category ${\cat A}$, it follows that finite products $\prod_{i=1}^nX_i$ and coproducts $\coprod_{i=1}^nX_i$ (of some objects $X_1,\ldots,X_n\in\Ob({\cat A})$) exist and are canonically isomorphic. We typically denote both by $\bigoplus_{i=1}^nX_i$ in that case.
	 	\item We would like to describe the addition on $\Hom_{\cat A}(X,Y)$. For a pair of morphisms $X\doublemorphism[a][b]Y$ we denote the composition
	 	\begin{align*}
	 		X\xrightarrow{\id_X\times\id_X}X\oplus X\xrightarrow{a\amalg b}Y
	 	\end{align*}
	 	by $a+b$. Then $0$ is a neutral element and associativity holds, but the existence of inverse elements needs to be imposed to obtain indeed a group structure.
	 	
	 	One can show that this is the only possible group structure behaving bilinearly under composition.
	 	\item It is, however, automatically abelian. What we need to show is $(a\amalg b)\circ\Delta=(b\amalg a)\circ\Delta$ with $\Delta=\id_X\times \id_X$. The universal property of coproducts gives a unique $X\oplus X\morphism[\sigma]X\oplus X$ such that
	 	\begin{diagram*}
	 		\node[ob] (XX2) at (0,0) {$X\oplus X$};
	 		\node[ob] (X1) at (-1,1.25) {$X$};
	 		\node[ob] (X2) at (-1,-1.25) {$X$};
	 		\node[ob] (XX1) at (-2,0) {$X\oplus X$};
	 		\node[ob] (Y) at (2.5,0) {$Y$};
	 		\scriptsize
	 		\draw[<-] (XX2) -- (X1) node[pos=0.5, above right] {$i_1$};
	 		\draw[<-] (XX2) -- (X2) node[pos=0.5, below right] {$i_2$};
	 		\draw[->] (XX2) -- (Y) node[pos = 0.5, above] {$a\amalg b$};
	 		\draw[<-, bend right] (Y) to node[pos=0.5,below left] {$a$} (X1);
	 		\draw[<-, bend left] (Y) to node[pos=0.5,above left] {$b$} (X2);
	 		\draw[<-] (XX1) -- (X1) node[pos=0.5, above left] {$i_2$};
	 		\draw[<-] (XX1) -- (X2) node[pos=0.5, below left] {$i_1$};
	 		\draw[->, dashed] (XX1) -- (XX2) node[pos=0.5, above] {$\exists!\ \sigma$};
	 	\end{diagram*}
	 	commutes. Then $\sigma$ is easily seen to be an isomorphism and $b\amalg a=(a\amalg b)\circ \sigma$ by the uniqueness of $b\amalg a$. It thus suffices to show $\sigma\Delta=\Delta$. By the uniqueness of $\Delta$, this is equivalent to $p_1\sigma\Delta=\id_X$ and $p_2\sigma\Delta=\id_X$. We claim that $p_1\sigma=p_2$ and vice versa, which would finish the proof. To see this, note that $p_1\sigma=p_2$ is equivalent to $p_1\sigma i_1=p_2i_1=0$ and $p_1\sigma i_2=p_2i_2=\id_X$ by the universal property of the coproduct $X\oplus X$. This follows from $\sigma i_1=i_2$ and $\sigma i_2=i_1$ by definition of $\sigma$.
	 \end{alphanumerate}
\end{rem*}
\begin{example*} The following are additive categories.
	\begin{alphanumerate}
		\item Modules over a given ring $R$ (in particular, abelian groups).
		\item Sheaves of modules (as we will see).
		\item Banach spaces with bounded linear maps as morphisms. The common initial and final object is the zero space and $A\oplus B=\left\{(a,b)\st a\in A,\ b\in B\right\} $ with $\max\{\|a\|,\|b\|\}$ or $\|a\|+\|b\|$ as norm (this category will turn out not to be abelian).
		\item Free or projective modules over a ring $R$.
	\end{alphanumerate}
\end{example*}
\begin{defi}\lbl{def:Kernel}
	Let $A\morphism[\alpha]B$ be a morphism in an additive category ${\cat A}$. The \defemph{kernel} $\ker(A\morphism[\alpha]B)$ of $\alpha$ (if it exists) comes with a morphism $\ker(\alpha)\morphism[\iota]A$ satisfying the universal property
	\begin{align*}
	\Hom_{\cat A}\left(T,\ker\Big(A\morphism[\alpha]B\Big)\right)&\isomorphism \left\{f\in \Hom_{\cat A}\st \alpha f=0\right\}\\
	\left(T\morphism[\tau]A\right)&\longmapsto f=\iota\tau
	\end{align*}
	for any test object $T\in\Ob({\cat A})$. 
\end{defi}
\begin{varthm}{defi}\lbl{def:Cokernel}
	Similarly, the \defemph{cokernel} of $\alpha$ (if existent) comes with a morphism $B\morphism[\pi]\coker(\alpha)$ and satisfies
	\begin{align*}
	\Hom_{\cat A}\left(\coker\Big(A\morphism[\alpha]B\Big),T\right)&\isomorphism \left\{g\in\Hom_{\cat A}(B,T)\st g\alpha=0\right\}\\
	\left(\coker(\alpha)\morphism[\tau]T\right)&\longmapsto g=\tau\pi
	\end{align*}
	for any test object $T\in\Ob({\cat A})$.
\end{varthm}
	
	
\begin{rem}\lbl{rem:KernelCokernel}
	Kernels and cokernels in an additive category ${\cat A}$ are special cases of \emph{equalizers} and \emph{coequalizers} (cf.\ \cite[Definition~A.3.2 and Definition~A.3.4]{alggeo1}), respectively. Indeed, we have
	\begin{align*}
		\ker\Big(A\morphism[\alpha]B\Big)=\Eq\Big(A\doublemorphism[\alpha][0]B\Big)\quad\text{and}\quad\coker\Big(A\morphism[\alpha]B\Big)=\Coeq\Big(A\doublemorphism[\alpha][0]B\Big)\;. 
	\end{align*}
	But we can reconstruct equalizers and coequalizers from kernels and cokernels via
	\begin{align*}
		\Eq\Big(A\doublemorphism[\alpha][\beta]B\Big)=\ker\Big(A\xrightarrow{\alpha-\beta}B\Big)\quad\text{and}\quad \Coeq\Big(A\doublemorphism[\alpha][\beta]B\Big)=\coker\Big(A\xrightarrow{\alpha-\beta}B\Big)
	\end{align*}
	(the minus here is the one obtained from additivity of ${\cat A}$). 
\end{rem}
	
	\begin{defi}\lbl{def:EffectiveMono}
		A morphism $A\morphism[i]B$ is an \defemph{effective monomorphism}, if the following equivalent conditions hold.
		\begin{alphanumerate}
			\item (In any category) We have a bijection
			\begin{align*}
			\Hom_{\cat A}(T,A)&\isomorphism\left\{f\in\Hom_{\cat A}(T,B)\st 
			\begin{array}{c}
			\alpha f=\beta f\text{ if }B\doublemorphism[\alpha][\beta]S\text{ is any pair of}\\ 
			\text{morphisms such that }\alpha i=\beta i
			\end{array}
			\right\}\\
			t\in\Hom_{\cat A}(T,A) &\longmapsto f=it\;.
			\end{align*}
			\item (If the category has finite colimits) $i$ is an equalizer of something.
			\item (In additive categories with kernels and cokernels) $i$ is the kernel of an appropriate morphism.
			\item (In additive categories with kernels and cokernels) $i$ is the kernel of its cokernel.
		\end{alphanumerate}
	\end{defi}
	\begin{varthm}{defi}\lbl{def:EffectiveEpi}
		Dually, $A\morphism[p]B$ is an \defemph{effective epimorphism} if the following equivalent conditions hold.
		\begin{alphanumerate}
			\item (In any category) We have a bijection
			\begin{align*}
			\Hom_{\cat A}(B,T)&\isomorphism\left\{f\in\Hom_{\cat A}(A,T)\st 
			\begin{array}{c}
			f\alpha =f\beta\text{ if }S\doublemorphism[\alpha][\beta]A\text{ is any pair of}\\
			\text{morphisms such that }p\alpha =p\beta 
			\end{array}
			\right\}\\
			t\in\Hom_{\cat A}(B,T) &\longmapsto f=tp\;.
			\end{align*}
			\item (If the category has finite limits) $p$ is a coequalizer of something.
			\item (In additive categories with kernels and cokernels) $p$ is the cokernel of an appropriate morphism.
			\item (In additive categories with kernels and cokernels) $p$ is the cokernel of its kernel.
			\item $B^\op\morphism[p^\op]A^\op$ is an effective monomorphism in the dual category ${\cat A}^\op$.
		\end{alphanumerate}
	\end{varthm}
	In any category, a morphism which is mono and effectively epi (or epi and effectively mono) is an isomorphism, but there are examples of morphisms which are simultaneously mono and epi but not an isomorphism (e.g.\ $\IZ\monomorphism\IQ$ in the category of rings). This needs to be ruled out by a definition, and that's what is happening now!
\begin{defi}
	A category ${\cat A}$ is \defemph{abelian}, if it is additive, has kernels and cokernels and such that every monomorphism is effectively mono, every epimorphism is effectively epi, and (thus) any morphism which is both a mono- and an epimorphism is an isomorphism.
\end{defi}
\begin{rem*}
	\begin{alphanumerate}
		\item The three conditions on mono- and epimorphisms are not independent. The last condition, i.e.\ that every morphism which is both a mono- and an epimorphism is an isomorphism, follows from either of the former two.
		\item Since equalizers and coequalizers in an abelian category ${\cat A}$ can be constructed from kernels and cokernels (cf.\ Remark~\reff{rem:KernelCokernel}) and we already have finite products and coproducts from additivity of ${\cat A}$, we deduce that ${\cat A}$ has arbitrary finite limits and colimits. Indeed, we proved on exercise sheet \#7 from Algebraic Geometry~I that finite limits can be constructed from equalizers and finite products, and, given coequalizers and finite coproducts instead, it's just the same for finite colimits.
		
		Conversely, the existence of finite limits and colimits guarantees that ${\cat A}$ has equalizers, coequalizers, finite products, and finite coproducts, all of them being special cases of finite limits and colimits.
	\end{alphanumerate}
	
\end{rem*}
The category of modules (over a ring $R$) or sheaves of modules are abelian categories (as we are going to prove in a moment), but not Banach spaces or projective modules over most rings.
\begin{prop}\lbl{prop:RmodAbelian}
	The category $\cat{Mod}(\Rr)$ of sheaves of modules (over a sheaf of rings $\Rr$ on some topological space $X$) is abelian.
\end{prop}
For clarity (and to better distinguish between the proof and Professor Franke's remarks about it), we will chop the proof into some lemmas.
\begin{lem}
	The category $\cat{Mod}(\Rr)$ is additive.
\end{lem}
\begin{proof}
	First note that the zero sheaf $0$ is a common initial and final object. A direct sum of $\Mm,\Nn\in\Ob(\cat{Mod}(\Rr))$ is given by
	\begin{align*}
	(\Mm\oplus\Nn)(U)=\left\{(m,n)\st m\in\Mm(U), n\in\Nn(U)\right\}\quad\text{for all }U\subseteq X\text{ open}
	\end{align*}
	(it's clear that this is a presheaf and it inherits the sheaf axiom from ${\cat A}$ and $\Nn$) with component-wise module operations and with $\Mm\lmorphism[p]\Mm\oplus\Nn\morphism[q]\Nn$ and $\Mm\morphism[i]\Mm\oplus\Nn\lmorphism[j]\Nn$ given by $p(m,n)=m$, $q(m,n)=n$, $i(m)=(m,0)$, and $j(n)=(0,n)$ on open subsets $U\subseteq X$ and $m\in\Mm(U)$, $n\in\Nn(U)$.
	
	If $\Mm\morphism[\mu]\Tt\lmorphism[\nu]\Nn$ are given, $\Mm\oplus\Nn\morphism[\mu\amalg\nu]\Tt$ sending $(m,n)\in(\Mm\oplus\Nn)(U)$ to $\mu(m)+\nu(n)$ verifies the universal property of the coproduct for $\Mm\oplus\Nn$. Similarly, $\Tt\morphism[\mu\times\nu]\Mm\oplus\Nn$ given by $(\mu\times\nu)(t)=(\mu(t),\nu(t))$ for $t\in\Tt(U)$ confirms the universal property of the product for $\Mm\oplus\Nn$. Also, $c=\id_{\Mm\oplus\Nn}$ is the unique endomorphism $c$ of that object such that $pci=\id_\Mm$, $qcj=\id_\Nn$, $pcj=0$, and $qci=0$. Thus, $\cat{Mod}(\Rr)$ is additive (the group structure on $\Hom$ sets being easily verified).
\end{proof}
\begin{lem}\lbl{lem:RModHasKernels}
	The category $\cat{Mod}(\Rr)$ has kernels.
\end{lem}
\begin{proof}
	Let $\Mm\morphism[f]\Nn$ be a morphism of sheaves of $\Rr$-modules and $\Kk$ be the sheaf given by 
	\begin{align*}
		\Kk(U)=\ker\Big(\Mm\morphism[f]\Nn\Big)(U)\coloneqq\ker\Big(\Mm(U)\morphism[f]\Nn(U)\Big)
	\end{align*}
	(you should convince yourself that this indeed satisfies the sheaf axiom). Then the inclusion $\Kk\morphism[\kappa]\Mm$ is a monomorphism as $\Kk(U)\monomorphism\Mm(U)$ is injective for every open subset $U\subseteq X$. 
	
	If $\Tt\morphism[\tau]\Mm$ is a morphism of $\Rr$-modules such that $f\tau=0$, then, for every $t\in\Tt(U)$, we have $f(\tau(t))=0$, hence $\snake{\tau}(t)\coloneqq\tau(t)\in\ker\Big(\Mm(U)\morphism[f]\Nn(U)\Big)=\Kk(U)$ and $\tau$ factors over 
	\begin{diagram*}
		\node[ob](R) at (0,1.25) {$\Tt$};
		\node[ob](A) at (2.5,1.25) {$\Mm$};
		\node[ob](RS) at (1.25,0) {$\Kk$};
		\scriptsize
		\draw[->] (R) -- (A) node[pos=0.5, above] {$\tau$};
		\draw[->, dashed] (R) -- (RS) node[pos=0.5, below left] {$\exists!\ \snake\tau$};
		\draw[right hook->] (RS) -- (A) node[pos=0.5, below right] {$\kappa$};
	\end{diagram*}
	This proves that $\Kk$ is indeed a kernel of $f$ in the category $\cat{Mod}(\Rr)$.
\end{proof}
\begin{rem}
	\begin{alphanumerate}
		\item \lbl{rem:SheafMonomorphism}It is a consequence of the exactness of the $\colimit$ functor (for filtered systems of abelian groups; exactness of $\colimit$ does \emph{not} hold in general, not even for filtered colimits in abelian categories), that 
		\begin{align*}
		\Kk_x=\colimit[U\ni x]\ker\Big(\Mm(U)\morphism[f]\Nn(U)\Big)\cong\ker\Big(\Mm_x\morphism[f]\Nn_x\Big)\;.
		\end{align*}
		This isomorphism can also be seen in a straightforward way.
		
		\item One may check that in any additive category (with kernels), a morphism $i$ is a monomorphism iff $\ker(i)=0$. Thus, in our example we have the equivalent conditions
		\begin{alphanumerate}
			\item[\itememph{\alpha}] $\Mm\morphism[f]\Nn$ is a monomorphism.
			\item[\itememph{\beta}] $\Mm(U)\morphism[f]\Nn(U)$ is injective for all open subsets $U\subseteq X$.
			\item[\itememph{\gamma}] $\ker(f)=0$ (the zero sheaf).
			\item[\itememph{\delta}] $\Mm_x\morphism[f]\Nn_x$ is injective for all $x\in X$.
		\end{alphanumerate}
	\end{alphanumerate}
	The construction of cokernels won't be that straightforward (duh!), related to the fact that epimorphisms in categories of sheaves aren't as simple as you might think. If $\Gg$ and $\Hh$ are sheaves on some topological space $X$ and $f$ is a morphism between them such that $\Gg(U)\morphism[f]\Hh(U)$ is surjective for all open $U$, then $f$ is an epimorphism, but there are epimorphisms $f$ for which this fails. 
	
	However, it follows from the fact that a sheaf $\Gg$ is canonically isomorphic to its sheafification $\Gg^\sh$ (cf.\ \cite[Proposition~1.2.1\itememph{d}]{alggeo1}) that a morphism between sheaves (of sets, groups, \ldots) is uniquely determined by the maps it induces on stalks. Thus, $\Gg\morphism\Hh$ is an epimorphism if $\Gg_x\morphism\Hh_x$ is an epimorphism in the respective target category for all $x\in X$.
\end{rem}
\begin{lem}\lbl{lem:RmodHasCokernels}
	The category $\cat{Mod}(\Rr)$ has cokernels.
\end{lem}
\begin{proof}
	For a morphism $\Mm\morphism[f]\Nn$ of sheaves of $\Rr$-modules, the map 
	\begin{align*}
		U\mapsto \coker\Big(\Mm(U)\morphism[f]\Nn(U)\Big)=\Mm(U)/\Nn(U)\quad\text{for }U\subseteq X\text{ open}
	\end{align*}
	defines a presheaf $\Ff$ of $\Rr$-modules, but in general, $\Ff$ will fail to be a sheaf. We put $\Cc=\Ff^\sh$ (the \emph{sheafification} of $\Ff$, cf.\ \cite[Definition~1.2.3]{alggeo1}) and claim that $\Nn\morphism\Cc$ is a cokernel of $f$.
	
	Our first goal is to show that
	\begin{align}\lbl{eq:SheafCokernel}
		\Cc_x\cong\coker\Big(\Mm_x\morphism[f]\Nn_x\Big)\;.\tag{$*$}
	\end{align}
	In the lecture, we did a direct proof, which was somewhat ugly and (in my opinion) lacking the essential step. From \cite[Proposition~1.2.1\itememph{a}]{alggeo1}, we get that $\Cc_x\cong\Ff_x$ (which is basically what we proved in the lecture for this particular special case), so we need to show that
	\begin{align*}
		\Ff_x=\colimit[U\ni x]\coker\Big(\Mm(U)\morphism[f]\Nn(U)\Big)\cong \coker\Big(\Mm_x\morphism[f]\Nn_x\Big)\;.
	\end{align*}
	Since $\Mm_x=\colimit[U\ni x]\Mm(U)$ and similar for $\Nn_x$, this amounts to showing that cokernels and certain colimits commute. But by Remark~\reff{rem:KernelCokernel}, cokernels are just a special case of colimits, so what we are actually going to show is that \emph{colimits commute with colimits}.
	
	The following approach was suggested by Willem and is conceptionally way nicer than what I came up with myself. Let ${\cat A}$ be a category. A \defemph{diagram} (naively, some objects of ${\cat A}$ with arrows between them such that everything that should commute actually does so) is nothing else but a functor $F\colon \cat J\morphism{\cat A}$ from some small category $\cat J$ into ${\cat A}$. We can form the corresponding \defemph{diagram category} which is just the functor category ${\cat D}=\Funct(\cat J,{\cat A})$. Taking colimits then is a functor 
	\begin{align*}
		\colimit[\cat J]\colon {\cat D}\morphism{\cat A}
	\end{align*}
	(perhaps we need to restrict ${\cat D}$ to the class of $\cat J$-indexed diagrams whose colimit exists). We also have the \emph{diagonal functor} $\Delta\colon{\cat A}\morphism{\cat D}$ assigning to $X\in\Ob({\cat A})$ the diagram with all objects $X$ and all arrows the identity $\id_X$ (and for morphisms, $\Delta$ does the obvious thing).
	
	\begin{lem}\lbl{lem:ColimitsCommute}
		The functors $\colimit[\cat J]$ and $\Delta$ form an adjoint pair (cf.\ Definition~\reff{def:AdjointFunctors}).
	\end{lem}
	\begin{proof}
		With this new terminology at hand, look at the definition of a colimit as a colimiting cocone again and find out that this is obvious.
	\end{proof}
	By Remark~\reff{rem:AdjunctionPreservesStuff}, left-adjoint functors preserve colimits. In particular, Lemma~\reff{lem:ColimitsCommute} gives
	\begin{cor}\lbl{cor:ColimitsCommute}
		The functor $\colimit[\cat J]$ preserves colimits.
	\end{cor}
	\ldots\ and if you think about it, that's precisely the kind of commutativity of colimits with colimits we wanted to have. Of course, all of this works for limits quite as well.
	
	Having thus proved \eqreff{eq:SheafCokernel}, we now proceed with the proof of Lemma~\reff{lem:RmodHasCokernels}. We have a morphism $\Nn\morphism\Cc$ sending $n\in \Nn(U)$ to
	\begin{align*}
	\bigg(\text{image of }n\text{ under }\Nn(U)\morphism\Nn_x\morphism\coker\Big(\Mm_x\morphism[f]\Nn_x\Big)\bigg)_{x\in U}\;.
	\end{align*}
	Since $\Cc_x\cong\coker\Big(\Mm_x\morphism[f]\Nn_x\Big)$, this morphism $\Nn\morphism\Cc$ induces surjections on stalks, hence is an epimorphism of sheaves. We show that the morphism $\Nn\morphism\Cc$ satisfies the universal property of the cokernel.
	
	Let $\Nn\morphism[\tau]\Tt$ be a morphism of sheaves of $\Rr$-modules such that $\tau f=0$. Let $U\subseteq X$ be open. For 
	\begin{align*}
		\nu=(\nu_x)_{x\in U}\in\Cc(U)\subseteq\prod_{x\in U}\coker\Big(\Mm_x\morphism[f]\Nn_x\Big)
	\end{align*}
	we define $\tau_1(\nu)\in\prod_{x\in U}\Tt_x$ by selecting $n\in\Nn_x$ whose image in $\coker\Big(\Mm_x\morphism[f]\Nn_x\Big)$ equals $\nu_x$, then put $\tau_1(\nu)_x=\tau(n)_x$ which is independent of the choice of $n$ as $\tau f=0$. It follows from the coherence condition for $\Cc$ that $\tau_1(\nu)$ satisfies the coherence condition for $\Tt^\sh$, i.e.\ $\tau_1(\nu)\in\Tt^\sh(U)\subseteq\prod_{x\in U}\Tt_x$. Hence there is $\Cc\morphism[\tau_2]\Tt$ such that $\tau_1=\Big(\Tt\isomorphism\Tt^\sh\Big)\circ\tau_2$ and $\tau_2$ makes
	\begin{diagram*}
		\node[ob](R) at (0,1.25) {$\Nn$};
		\node[ob](A) at (2.5,1.25) {$\Tt$};
		\node[ob](RS) at (1.25,0) {$\Cc$};
		\scriptsize
		\draw[->] (R) -- (A) node[pos=0.5, above] {$\tau$};
		\draw[->, dashed] (R) -- (RS) node[pos=0.5, below left] {$\exists!\ \tau_2$};
		\draw[->] (RS) -- (A);
	\end{diagram*}
	commutative. Uniqueness of $\tau_2$ is easy to see stalk-wise. It follows that $\Nn\morphism\Cc$ is ineed a cokernel of $f$.
\end{proof}
\begin{rem}\lbl{rem:SheafEpimorphism}
	One may check that in any additive category (with cokernels) a morphism $f$ is an epimorphism if $\coker(f)=0$. By our previous construction of cokernels and the description of stalks, we have equivalent conditions
	\begin{alphanumerate}
		\item $\Mm\morphism[f]\Nn$ is an epimorphism of sheaves of $\Rr$-modules.
		\item $\Mm_x\morphism[f]\Nn_x$ is surjective for all $x\in X$.
		\item For every open $U\subseteq X$ and $n\in\Nn(U)$ there are an open covering $U=\bigcup_{\lambda\in\Lambda}U_\lambda$ and $m_\lambda\in\Mm(U_\lambda)$ such that $n|_{U_\lambda}=f(m_\lambda)$
	\end{alphanumerate}
	\ldots but \itememph{c} does \emph{not} imply the surjectivity of $\Mm(U)\morphism[f]\Nn(U)$, unless, e.g., $f$ is also a monomorphism.
\end{rem}
\begin{proof}[Proof of Proposition~\reff{prop:RmodAbelian}]
	We verify the rest of the abelianness conditions. First, let $\Mm\morphism[f]\Nn$ be a mono- and epimorphism. Then it induces isomorphisms on stalks (by Remark~\reff{rem:SheafMonomorphism}\itememph{b} and Remark~\reff{rem:SheafEpimorphism}), hence is an isomorphism itself.
	
	Let $\Mm\morphism[i]\Nn$ be a monomorphism and $\Nn\morphism\Cc$ be its cokernel. Then 
	\begin{align*}
		\ker\left(\Nn\morphism\Cc\right)_x=\ker\left(\Nn_x\morphism\Cc_x\right)=\ker\left(\Nn_x\morphism\coker\Big(\Mm_x\morphism[i]\Nn_x\Big)\right)\cong\Mm_x
	\end{align*}
	as $\Mm_x\morphism[i]\Nn_x$ is injective. Hence $\Mm\morphism\ker\left(\Nn\morphism\Cc\right)$ induces isomorphisms on stalks and thus is an isomorphism itself. It follows by Definition~\reff{def:EffectiveMono}\itememph{d} that any monomorphism is an effective monomorphism.
	
	Similar arguments apply to epimorphisms.	
\end{proof}
Recall the definition of an adjoint pair of functors.
\begin{defi}[{\cite[Definition~A.2.3]{alggeo1}}]\lbl{def:AdjointFunctors}
	Let ${\cat A},{\cat B}$ be categories. A pair ${\cat A}\doublelrmorphism[L][\smash{R}]{\cat B}$ of (covariant) functors is called \defemph{adjoint}, if there is a canonical bijection
	\begin{align*}
		\Hom_{\cat A}(X,RY)\isomorphism\Hom_{\cat B}(LX,Y)
	\end{align*}
	which is functorial in both $X\in\Ob({\cat A})$ and $Y\in\Ob({\cat B})$.
\end{defi}
\begin{rem}\lbl{rem:AdjunctionPreservesStuff}
	It can be easily seen that $L$ preserves colimits (in particular, coproducts, and in particular again, initial objects) and $R$ preserves limits (in particular, products, and in particular again, final objects). When ${\cat A}$ and ${\cat B}$ are additive, it follows that both $L$ and $R$ map $0$ to $0$ and are compatible with finite direct sums. Moreover, $L$ preserves cokernels and $R$ preserves kernels since these are special cases of colimits and limits, respectively (in particular, I have no idea what the purpose of Franke's extra calculation was).%We don't need this.%Because of
	%\begin{align*}
	%	\Hom_{\cat A}\left(T,R\Big[\ker\Big(X\morphism[f]Y\Big)\Big]\right)&\cong \Hom_{\cat B}\left(LT,\ker\Big(X\morphism[f]Y\Big)\right)\\
	%	&\cong\ker\left(\Hom_{\cat B}(LT,X)\morphism[f\circ]\Hom_{\cat B}(LT,Y)\right)\\
	%	&\cong\ker\left(\Hom_{\cat A}(T,RX)\morphism[Rf\circ]\Hom_{\cat A}(T,RY)\right)\\
	%	&\cong\Hom_{\cat A}\left(T,\ker\Big(RX\morphism[Rf]RY\Big)\right)\;,
	%\end{align*}
\end{rem}
\section{Vector bundles on \texorpdfstring{$\IP_k^1$}{P}}
In this section, I would like to include a proof of the Grothendieck--Birkhoff structure theorem\footnote{Though Franke likes to attribute it to Dedekind/Weber and Plemelj as well.} for vector bundles on $\IP_k^1$, which says the following.
\begin{thm}[Grothendieck--Birkhoff]\lbl{thm:GrothendieckBirkhoff}
	Let $k$ be a field and $\Vv$ be a vector bundle of rank $n$ on $X=\IP_k^1$. Then there is a decomposition
	\begin{align*}
		\Vv\cong\bigoplus_{i=1}^n\Oo(d_i)
	\end{align*}
	for some $d_i\in \IZ$, which are unique up to order.
\end{thm}
For this, I'm roughly following exercise sheet \#8, but nevertheless this section is fanfic rather than canon.

We start by proving the $n=1$ case, which actually holds in more generality.
\begin{prop}\lbl{prop:LineBundlesPn}
	Let $\Ll$ be a line bundle on $\IP_k^m$. Then $\Ll\cong\Oo(d)$ for some $d\in\IZ$.
\end{prop}
\begin{proof}
	Let $R=k[X_0,\ldots,X_m]$ and $U_i=\IP_k^m\setminus V(X_i)$ the standard affine opens. On $U_i$, $\Ll$ is given by $\snake{L}_i$ for some $(R_{X_i})_0$-module $L_i$. Giving a line bundle, $L_i$ is invertible and it can be shown that any invertible module over a UFD is trivial, cf.\ \cite[\stackstag{0BCH}]{stacks-project}. Hence $L_i\cong(R_{X_i})_0$. Let $\ell_i\in L_i$ be a generator. Then both $\ell_i$ and $\ell_j$ are generators of $\Ll|_{U_{i,j}}$, hence the differ by a unit in $\Oo_{\IP_k^m}(U_{i,j})=(R_{X_iX_j})_0$. That is, there are $d_{i,j}\in\IZ$ and $\alpha_{i,j}\in k$ such that
	\begin{align*}
		\ell_i=\alpha_{i,j} \left(\frac{X_j}{X_i}\right)^{d_{i,j}} \ell_j\;.
	\end{align*}
	Multiplying all $\ell_i$ except for $\ell_0$ by suitable factors from $k$, we may assume $\alpha_{i,j}=1$ for all $i,j$. Also, we have
	\begin{align*}
		\left(\frac{X_l}{X_i}\right)^{d_{i,l}}\ell_l=\ell_i=\left(\frac{X_j}{X_i}\right)^{d_{i,j}}\ell_j=\left(\frac{X_j}{X_i}\right)^{d_{i,j}}\left(\frac{X_j}{X_l}\right)^{d_{l,j}}\ell_l
	\end{align*}
	in $(R_{X_iX_jX_l})_0$ for distinct $i,j,l$. This implies $d_{i,j}=d_{j,l}$ and we see that actually all the $d_{i,j}$ equal $d$ for some $d\in\IZ$. Then it's easy to give an isomorphism $\Ll\isomorphism\Oo(d)$.
\end{proof}
\begin{cor}\lbl{cor:Pic(Pn)}
	We have $\Pic(\IP_k^m)\cong \IZ$ with $\Oo(1)$ a generator.
\end{cor}
\begin{proof}
	By Proposition~\reff{prop:LineBundlesPn}, $\Oo(1)$ is a generator of $\Pic(\IP_k^m)$, so it suffices to show that there is no torsion. But in Theorem~\reff{thm:CohoOfIP^n}\itememph{a} we proved that $\Oo(d)$ has a global section iff $d\geq 0$, hence the powers of $\Oo(1)$ can't become periodic.
\end{proof}
Now we prove a pretty useful lemma, enabling us to do all kinds of induction on the rank.
\begin{lem}\lbl{lem:UsefulBundleLemma}
	Let $X$ be a regular one-dimensional connected noetherian scheme, $\eta$ its generic point, and $K=\Oo_{X,\eta}$ the stalk of the structure sheaf there.\footnote{As Professor Franke points out, $K$ is a zero-dimensional regular local ring, hence a field. Also, $X$ is automatically integral; compare the argument at the beginning of Section~\reff{sec:FirstProofs}.} Let $\Vv$ be a vector bundle on $X$, let $V$ be the $K$-vector space $\Vv_\eta$ and $W\subseteq V$ a subspace. Let $\Ww$ be the sheaf defined by
	\begin{align*}
		\Ww(U)=\left\{v\in\Vv(U)\st\text{the image of }v\text{ in }V=\Vv_\eta\text{ lands in }W\right\}\;.
	\end{align*}
	Then $\Ww$ and $\Vv/\Ww$ are vector bundles.
\end{lem}
\begin{proof}[Sketch of a proof]
	Since $X$ is integral, regular and one-dimensional noetherian, it is locally Dedekind. But finitely generated modules over Dedekind domains are projective (and that's what we need for a vector bundle) iff they are torsion-free (we proved this, e.g., in \cite[Corollary~1.1.6]{homalg}). Torsion-freeness for $\Ww$ and $\Vv/\Ww$ is easily checked.
\end{proof}
\begin{lem}\lbl{lem:LineBundleMono}
	Let $X$ be a regular connected one-dimensional noetherian scheme, $\Ll$ a line bundle on $X$ and $\Vv$ a vector bundle. If $\Ll\morphism[f]\Vv$ is a non-zero morphism of $\Oo_X$-modules, then $f$ is a monomorphism.
\end{lem}
\begin{proof}
	Let $K=\Oo_{X,\eta}$ be the stalk at the generic point $\eta$ of $X$. As $f\neq 0$, $\Ll_\eta\morphism\Vv_\eta$ is non-zero and thus a monomorphism, since $\Ll_\eta$ is a one-dimensional $K$-vector space. Now if $x\in X$ is any point, consider the diagram
	\begin{diagram*}
		\node[ob] (a) at (0,1.5) {$\Ll_x$};
		\node[ob] (b) at (2,1.5) {$\Ll_\eta$};
		\node[ob] (c) at (0,0) {$\Vv_x$};
		\node[ob] (d) at (2,0) {$\Vv_\eta$};
		\scriptsize
		\draw[right hook->] (a) -- (b);
		\draw[right hook->] (c) -- (d);
		\draw[->] (a) -- (c) node[pos=0.5, left] {$f$};
		\draw[->] (b) -- (d) node[pos=0.5, right] {$f$};
	\end{diagram*}
	The right vertical arrow is injective, hence so is the left one. Therefore $f$ induces injections on stalks, hence it is a monomorphism.
\end{proof}
\begin{lem}
	Let $\Vv$ be a vector bundle on $X=\IP_k^1$. Then the set $\LL_\Vv$ of integers $d\in\IZ$ for which there is a non-zero morphism $\Oo(d)\morphism\Vv$ is bounded from above.
\end{lem}
\begin{proof}
	Note that $\Hhom_{\Oo_X}(\Oo(d),\Vv)\cong \Oo(-d)\otimes_{\Oo_X}\Vv=\Vv(-d)$, so we need to show that $\Vv(-d)$ has vanishing global section for $d\gge 0$. We use induction on the rank of $\Vv$. If the rank is $0$, there is nothing to show and when $\dim\Vv=1$, then $\Vv\cong \Oo(\ell)$ for some $\ell\in\IZ$ by Proposition~\reff{prop:LineBundlesPn} and $\Oo(\ell-d)$ has vanishing global section. 
	
	Now let $\dim \Vv\geq 2$ and assume that the assertion is true for vector bundles of smaller rank. Choose a one-dimensional subspace $L\subseteq V=\Vv_\eta$ (we keep the notation from previous lemmas) and let $\Ll$ and $\Ww=\Vv/\Ll$ be the vector bundles constructed in Lemma~\reff{lem:UsefulBundleLemma}. Note that $\Ll$ and $\Ww$ have strictly smaller rank than $\Vv$ (since $\dim_KL\leq\dim_KV$ and same for $V/L$). From the short exact sequence $0\morphism \Ll(-d)\morphism\Vv(-d)\morphism\Ww(-d)\morphism 0$ we get
	\begin{align*}
		H^0\big(X,\Ll(-d)\big)\morphism H^0\big(X,\Vv(-d)\big)\morphism H^0\big(X,\Ww(-d)\big)
	\end{align*}
	in which the outer terms vanish for sufficiently large $d$ by the induction assumption, hence $0=H^0(C,\Vv(-d))=\Vv(-d)(C)$ for $d\gge 0$.
\end{proof}
\begin{lem}\lbl{lem:O(-1)toV}
	Let $\Vv$ be a vector bundle on $X=\IP_k^1$ for which $-1$ is the largest element of $\LL_\Vv$. Let $\Oo(-1)\morphism \Vv$ be a non-zero morphism. 
	\begin{alphanumerate}
		\item Its image $\Ll$ is a line bundle and $\Ww=\Vv/\Ll$ is a vector bundle.
		\item $\LL_\Ww$ is bounded from above by $-1$ as well.
	\end{alphanumerate}
\end{lem}
\begin{proof}
	Part \itememph{a}. Note that $\Oo(-1)\morphism\Vv$ is a monomorphism by Lemma~\reff{lem:LineBundleMono}, so $\Ll$ is indeed a line bundle. As in the proof of Lemma~\reff{lem:UsefulBundleLemma}, all we need to check is torsion-freeness of $\Ww=\Vv/\Ll$. Let $R=k[X_0,X_1]$ and $U_i=X\setminus V(X_i)$ for $i=0,1$. Let $\Vv|_{U_i}=\snake{V}_i$ and $\Vv|_{U_{0,1}}=\snake{V}_{0,1}$. For $\Ll$ and $\Ww$ we will use the analogous notation. Assume that $V_0/L_0\cong W_0$ has torsion at a prime $p_0\in\Spec k[t]$ (for $t=\frac{X_1}{X_0}$) and let $x\in X$ be the corresponding point (by a linear transformation, we may achieve that $x$ corresponds to neither of the homogeneous prime ideals $(X_0),(X_1)\subseteq R$). Since $L_0$ is a free $k[t]$-module of rank $1$, we must have $L_0\subseteq p_0V_0$. 
	
	Also $V_{0,1}/L_{0,1}\cong W_{0,1}$ has torsion at $x$ as well, hence so has $V_1/L_1\cong W_1$ (all of this is easy to see by the classification of finitely generated modules over PIDs). Then $L_1\subseteq p_1V_1$ where $p_1\in\Spec k[t^{-1}]$ is the prime corresponding to $x$.
	
	Thus, the image $\Ll$ of $\Oo(-1)$ is actually contained in $\Oo_X(-D)\otimes_{\Oo_X}\Vv$, where $D\in\Div(X)$ is the divisor satisfying $D(x)=1$ and $D(y)=0$ for all $y\neq x$ and we regard $\Oo_X(-D)\otimes_{\Oo_X}\Vv$ as a subsheaf of $\Vv$ via the natural inclusion $\Oo_X(-D)\subseteq \Oo_X$. Tensoring with $\Oo_X(D)$ gives a non-zero morphism $\Oo_X(D)\otimes_{\Oo_X}\Oo(-1)\morphism\Vv$. But $\Oo_X(D)\cong \Oo(\deg D)=\Oo(1)$ by Corollary~\reff{cor:O(D)=O(degD)} and we get a non-zero morphism $\Oo(0)\morphism\Vv$, contradiction!
	
	Part \itememph{b}. It suffices that there is no morphism $\Oo(0)\morphism\Ww$. Indeed, any nonzero morphism $\Oo(d)\morphism\Ww$ for $d\geq 0$ is a monomorphism by Lemma~\reff{lem:LineBundleMono}, hence composing it with a non-zero morphism $\Oo(0)\morphism\Oo(d)$ (which exists as the global section of $\Oo(-0)\otimes_{\Oo_X}\Oo(d)\cong \Oo(d)$ doesn't vanish by Theorem~\reff{thm:CohoOfIP^n}\itememph{a}) gives a non-zero morphism $\Oo(0)\morphism\Ww$. 
	
	As before, we may equivalently show that the global section of $\Ww$ vanishes, or $H^0(X,\Ww)=0$. We already know $H^0(X,\Vv)=0$ (since there is no non-zero $\Oo(0)\morphism\Vv$) and $H^1(X,\Ll)\cong H^1(X,\Oo(-1))=0$ by Theorem~\reff{thm:CohoOfIP^n}\itememph{b}. From the long exact cohomology sequence associated to $0\morphism \Ll\morphism\Vv\morphism\Ww\morphism 0$ we get
	\begin{align*}
		0=H^0(X,\Vv)\morphism H^0(X,\Ww)\morphism H^1(X,\Ll)=0\;,
	\end{align*}
	hence $H^0(X,\Ww)=0$ as well.
\end{proof}
\begin{proof}[Proof of Theorem~\reff{thm:GrothendieckBirkhoff}]
	We show existence first. For this, we use induction on $n=\dim\Vv$ (duh!). The case $n=0$ is trivial and $n=1$ was done in Proposition~\reff{prop:LineBundlesPn}. Now let $n\geq 2$ and the assertion be true for smaller ranks. We may assume that the largest element of $\LL_\Vv$ is $-1$ by twisting $\Vv$ appropriately.\footnote{Note that $\LL_\Vv$ is always non-empty. Indeed, the construction from Lemma~\reff{lem:UsefulBundleLemma} always gives a non-zero morphism $\Ll\morphism\Vv$ for some line bundle $\Ll$ on $\IP_k^1$, and $\Ll\cong\Oo(d)$ for some $d\in\IZ$ by Proposition~\reff{prop:LineBundlesPn}.} By Lemma~\reff{lem:O(-1)toV}\itememph{a} we get a short exact sequence
	\begin{align}\lbl{eq:ExactSeq}
		0\morphism\Oo(-1)\morphism\Vv\morphism\Ww\morphism 0\tag{$*$}
	\end{align}
	of vector bundles on $X=\IP_k^1$. By the induction hypothesis, we have $\Ww\cong\bigoplus_{i=1}^{n-1}\Oo(d_i)$ for some $d_i\in\IZ$. We will show that \eqreff{eq:ExactSeq} splits. To do this, by Proposition~\reff{prop:TorsorsExtensions} and Proposition~\reff{prop:torsorsH1Bij}\itememph{b} it suffices to show 
	\begin{align*}
		H^1\big(X,\Hhom_{\Oo_X}(\Ww,\Oo(-1))\big)=0\;. 
	\end{align*}
	We have 
	\begin{align*}
		\Hhom_{\Oo_X}(\Ww,\Oo(-1))&\cong\bigoplus_{i=1}^{n-1}\Hhom_{\Oo_X}\left(\Oo(d_i),\Oo(-1)\right)\\
		&\cong \bigoplus_{i=1}^{n-1}\Oo(-d_i)\otimes_{\Oo_X}\Oo(-1)\\&\cong \bigoplus_{i=1}^{n-1}\Oo(-d_i-1)\;.
	\end{align*}
	Note that all $d_i$ are $\leq -1$ by Lemma~\reff{lem:O(-1)toV}\itememph{b}. Hence
	\begin{align*}
		H^1\bigg(X,\bigoplus_{i=1}^{n-1}\Oo(-d_i-1)\bigg)\cong \bigoplus_{i=1}^{n-1}H^1\left(X,\Oo(-d_i-1)\right)=0
	\end{align*}
	by Theorem~\reff{thm:CohoOfIP^n}\itememph{b}. We are done.
	
	It remains to show uniqueness. For this, note that an $\Oo(d_i)$ summand of $\Vv$ contributes to $\dim_kH^0(X,\Vv(d))$ iff $d\geq -d_i$ (by Theorem~\reff{thm:CohoOfIP^n}\itememph{a}). Hence by computing $\dim_kH^0(X,\Vv(d))$ for all $d\in\IZ$ we can filter out the number of $\Oo(d_i)$ summands, which means it is unique.
\end{proof}
\section{Chow's lemma}
Chow's lemma is the key to prove results that hold for projective morphisms in the case of proper morphisms as well. We will see a slightly more general version of Chow's lemma than the one given on exercise sheet \#9, but the proof will still mostly be the same.
\begin{thm}[Chow's lemma]\lbl{thm:ChowsLemma}
	Let $R$ be a noetherian ring and $X\morphism[f]Y=\Spec R$ a proper morphism. Then there exists a projective morphism $\snake{X}\morphism[\pi]X$ such that the resulting morphism $\snake{X}\morphism Y$ is projective as well and moreover there is a dense open subset $U\subseteq X$ such that $\pi^{-1}(U)\morphism[\pi]U$ is an isomorphism.
\end{thm}
\begin{proof}
	\emph{Step 1.} We first reduce to the case where $X$ is irreducible. Since $R$ is noetherian and $f$ of finite type (and separated), $X$ is a noetherian scheme and thus has finitely many irreducible components $Z_1,\ldots, Z_n$. Let $\eta_i$ be the generic point of $Z_i$ (cf.\ \cite[Fact~2.1.9]{alggeo1}). Then $\eta_i\notin Z_j$ for $i\neq j$, and since irreducible components are closed (and there are only finitely many of them), we find  a neighbourhood $U_i\ni \eta_i$ not intersecting any $Z_j$ for $i\neq j$. Then the canonical morphism $\coprod_{i=1}^nZ_i\morphism X$ is an isomorphism over the open subset $U=\bigcup_{i=1}^n U_i\subseteq X$ and $U$ is dense (well, it contains $\eta_1,\ldots,\eta_n$), hence we may prove the theorem for each irreducible component and then take the disjoint union of the resulting $\snake{Z}_i$.
	
	\emph{Step 2.} We assume $X$ to be irreducible from now on. The next step is to construct $\snake{X}$. Choose an open cover $X=\bigcup_{i=1}^mU_i$ by affine open subsets. Since $X$ is irreducible, the intersection $U=\bigcup_{i=1}^mU_i$ is dense in $X$. Since $f$ is of finite type, each $\Oo_X(U_i)$ is an $R$-algebra of finite type and thus may be written as $\Oo_X(U_i)\cong R[X_1,\ldots,X_{n_i}]/J_i$ where $J_i\subseteq R[X_1,\ldots,X_{n_i}]$ is some ideal. This gives a closed embedding $U_i\monomorphism[k_i]\IA_Y^{n_i}$.\footnote{If $S$ is any prescheme, $\IA_S^n$ is defined as $\SPEC_S\Oo_S[X_1,\ldots,X_n]$. Since $Y=\Spec R$ in our case, we have $\IA_Y^n\cong\IA_R^n$ but we will write the former to maintain a more consistent notation.}
	
	Let $U\monomorphism[\iota]X$ and $U_i\monomorphism[\iota_i]X$ be the inclusions of $U$, $U_i$ respectively. We denote the composition $U_i\monomorphism[\iota_i] \IA_Y^{n_i}\monomorphism\IP_Y^{n_i}$ by $k_i$ as well. Consider the morphism
	\begin{align*}
		k\colon U\xrightarrow{(\iota,k_1,\ldots,k_m)}P=X\times_Y\fprod{Y}_{i=1}^m\IP_Y^{n_i}\;,
	\end{align*}
	where $\prod_{Y}$ indicates a big fibre product taken over $Y$. Take $\snake{X}$ to be the \emph{scheme-theoretic image} of $k$. This probably needs some explanation.
	\begin{defi}\lbl{def:schemeTheoreticImage}
		Let $X\morphism[f]Y$ be a morphism of preschemes. The \defemph{scheme-theoretic image} of $f$ is the unique closed subprescheme $Z\monomorphism Y$ satisfying the following universal property:
		\begin{quote}
			The morphism $f$ factors over $Z\monomorphism Y$, and whenever $f$ factors over a closed subprescheme $Z'\monomorphism Y$, then $Z\monomorphism Y$ factors over $Z'\monomorphism Y$.
		\end{quote}
	\end{defi}
	\begin{rem}
		\begin{alphanumerate}
			\item\lbl{rem:schemeTheoreticImage} It can be shown that the scheme-theoretic image exists in general (cf.\ \cite[\stackstag{01R6}]{stacks-project}). However, if the $f$ in Definition~\reff{def:schemeTheoreticImage} is quasi-compact and quasi-separated\footnote{Actually, we only need quasi-compactness, but this requires a bit more work; cf.\ \cite[\stackstag{01R8}]{stacks-project}.}, the situation becomes particularly easy. In this case, $f_*\Oo_X$ is a quasi-coherent $\Oo_Y$-module by \cite[Proposition~1.5.2]{alggeo1}, thus $\Jj=\ker\left(\Oo_Y\morphism f_*\Oo_X\right)$ is quasi-coherent as well and it is an easy exercise to check that the scheme-theoretic image of $f$ is given by the closed subprescheme cut out by $\Jj$.
			
			\item In particular, in the quasi-compact and quasi-separated case, the scheme theoretic image is \emph{local on the target} in the sense that if $Z$ is the scheme-theoretic image of $f$ and $U\subseteq Y$ open, then $Z\cap U$ is the scheme-theoretic image of $f^{-1}(U)\morphism[f]U$.
			
			\item Both \itememph{a} and \itememph{b} apply to the above $k$. Indeed, $X$ and the $\IP_Y^{n_i}$ are schemes of finite type over the noetherian base $Y=\Spec R$, hence noetherian as well. Since being of finite type is base-local and closed under composition and base-change by \cite[Fact~2.2.2]{alggeo1}, the same holds for $U$ and $P$, so $k$ is automatically quasi-compact (since open subsets of noetherian spaces are always quasi-compact) and separated (as a morphism between schemes).
		\end{alphanumerate}
	\end{rem}
	Let $\pi$ be the restriction of the canonical projection $P\morphism[p]X$ to $\snake{X}$. We will show that $\snake{X}$ and $\pi$ have the required properties.
	
	\emph{Step 3.} We show that $\pi$ is projective and an isomorphism over $U$. To show projectivity, note that
	\begin{align*}
		P=X\times_Y\fprod{Y}_{i=1}^m\IP_Y^{n_i}\cong\fprod{X}_{i=1}^m\IP_X^{n_i}\;.
	\end{align*}
	Indeed, we have $X\times_Y\IP_Y^{n_i}\cong \IP_X^{n_i}$, and together with a bit abstract nonsense this gives the desired isomorphism. Now $\prod_{X}\IP_X^{n_i}$ has a closed embedding into some $\IP_X^{N}$ by applying the Segre embedding (Example~\reff{ex:SegreEmbedding}) quite a lot of times. Thus $\pi$ factors over $\snake{X}\monomorphism\IP_X^N\morphism X$, in which the left arrow is a closed embedding, so $\pi$ is even strongly projective in the sense of Definition~\reff{def:projectiveMorphism}\itememph{b}.
	
	Let's prove that $\pi^{-1}(U)\morphism[\pi]U$ is an isomorphism. It is clear that $k$ maps $U$ into $\pi^{-1}(U)$ and $\pi k$ is the identity on $U$ (by construction of $k$). To show that $k\pi$ is the identity on $\pi^{-1}(U)$, consider the equalizer 
	\begin{align*}
		E=\Eq\Big(\pi^{-1}(U)\doublemorphism[k\pi][\id]\pi^{-1}(U)\Big)\;.
	\end{align*}
	Since we have a bunch of schemes here, $E$ is a closed subprescheme of $\pi^{-1}(U)$. Also the morphism $k$ factors over $E$ by definition of the equalizer. Thus $E=\pi^{-1}(U)$ since $\pi^{-1}(U)$ is the scheme theoretic image of $U\morphism[k]\pi^{-1}(U)$ by definition of $\snake{X}$ and the target-locality property explained in Remark~\reff{rem:schemeTheoreticImage}\itememph{b}.
	
	\emph{Step 4.} We prove that $\snake{X}\morphism Y$ is projective. This will be the most complicated step and we will split it up in several lemmas. Let $Q=\prod_{Y}\IP_Y^{n_i}$ and $P=X\times_YQ\morphism[q]Q$ the canonical projection. Our goal is to show that the resulting composition $\snake{X}\morphism[\snake{q}] Q$ is a closed embedding. Once we have that, a Segre embedding argument as in Step~3 will show that $\snake{X}\morphism Y$ is (even strongly) projective.
	
	Our strategy to prove that $\snake{q}$ is a closed embedding will be to check this on a suitable open cover of $Q$. For $i=1,\ldots,m$ let 
	\begin{align*}
		V_i=\fprod{Y}_{r=1}^{i-1}\IP_Y^{n_r}\times_Y\IA_Y^{n_i}\times_Y\fprod{Y}_{r=i+1}^{m}\IP_Y^{n_r}\subseteq Q
	\end{align*}
	and put $V_0=Q\setminus \snake{q}(\snake{X})$.
	\begin{lem}\lbl{lem:ChowClosedEmbedding}
		The morphism $j_1=\big(\iota_1,k_1,\id_{\IP_Y^{n_2}},\ldots,\id_{\IP_Y^{n_m}}\big)$ is a closed embedding
		\begin{align*}
			U_1\times_Y\fprod{Y}_{i=2}^m\IP_Y^{n_i}\morphism[j_1]X\times_Y\IA_Y^{n_1}\times_Y\fprod{Y}_{i=2}^m\IP_Y^{n_i}=q^{-1}(V_1)\;.
		\end{align*}
	\end{lem}
	\begin{proof}
		Since closed embeddings are preserved under base change (cf.\ \cite[Corollary~1.3.2]{alggeo1}) it suffices to show that $U_1\xrightarrow{(\iota_1,k_1)}X\times_Y\IA_Y^{n_1}$ is a closed embedding. Its composition with the canonical projection $X\times_Y\IA_Y^{n_1}\morphism\IA_Y^{n_1}$ surely is, since it equals $k_1$. Because all involved preschemes are schemes and the class $\Cc$ of closed embeddings clearly satisfies the conditions of Lemma~\reff{lem:technicalLemma}, we are done.
	\end{proof}
	\begin{lem}\lbl{lem:ChowPreimages}
		For $i=1,\ldots,n$ we have $\pi^{-1}(U_i)=\snake{q}^{-1}(V_i)$.
	\end{lem}
	\begin{proof}
		It suffices to prove this for $i=1$. We first show that $\pi^{-1}(U_1)\subseteq \snake{q}^{-1}(V_1)$. That is, we need to show that the immersion $\pi^{-1}(U_1)\monomorphism[i_1] P$ factors over $q^{-1}(V_1)$. Clearly, $i_1$ factors over the open subscheme
		\begin{align*}
			p^{-1}(U_1)=U_1\times_Y\fprod{Y}_{i=1}^m\IP_Y^{n_i}\subseteq P\;.
		\end{align*}
		We claim that the composition
		\begin{align*}
			\ell_1\colon\pi^{-1}(U_1)\morphism U_1\times_Y\fprod{Y}_{i=1}^m\IP_Y^{n_i}\morphism U_1\times_Y\fprod{Y}_{i=2}^m\IP_Y^{n_i}\morphism[j_1]X\times_Y\IA_Y^{n_1}\times_Y\fprod{Y}_{i=2}^m\IP_Y^{n_i}\monomorphism P
		\end{align*}
		equals $i_1$. Indeed, let $E=\Eq(i_1,\ell_1)$. It is easy to see that $U\morphism[k]\pi^{-1}(U_1)$ equalizes $i_1$ and $\ell_1$ (just look at the component-wise definitions of the involved maps), hence $k$ factors over $E$, which is a closed subscheme of $\pi^{-1}(U_1)$ since everyone hanging around here is in the scheme club. But the scheme-theoretic image of $U\morphism[k]\pi^{-1}(U_1)$ is $\pi^{-1}(U_1)$ by the same argument as in Step~3, hence $E=\pi^{-1}(U_1)$ which shows $i_1=\ell_1$. In particular, $i_1$ factors over $q^{-1}(V_1)$, as required.
		
		Now we show that $\pi^{-1}(U_1)\supseteq \snake{q}^{-1}(V_1)$. We have (as topological spaces) $\snake{q}^{-1}(V_1)=q^{-1}(V_1)\cap\snake{X}$, and by the target-locality property from Remark~\reff{rem:schemeTheoreticImage}\itememph{b} we find that $\snake{q}^{-1}(V_1)$ is the scheme-theoretic image of $U\morphism[k]q^{-1}(V_1)$. But $k$ factors over the composition
		\begin{align*}
			U\xrightarrow{(\id_U,k_2,\ldots,k_m)}U\times_Y\fprod{Y}_{i=2}^m\IP_Y^{n_i}\monomorphism U_1\times_Y\fprod{Y}_{i=2}^m\IP_Y^{n_i}\morphism[j_1]q^{-1}(V_1)
		\end{align*}
		in which $j_1$ is a closed embedding by Lemma~\reff{lem:ChowClosedEmbedding}, hence $\snake{q}^{-1}(V_1)\monomorphism q^{-1}(V_1)$ factors over $j_1$. Thus projecting $\snake{q}^{-1}(V_1)$ to its $X$ component has image in $U_1$ and we conclude $\pi^{-1}(U_1)\supseteq \snake{q}^{-1}(V_1)$, as required.
	\end{proof}
	We are now ready to finish the proof. Since base changes of open immersions are open immersions again by \cite[Corollary~1.3.2]{alggeo1}, $V_1,\ldots,V_n$ are open subsets of $Q$. Note that this is also true for $V_0=Q\setminus \snake{q}(\snake{X})$. Indeed, we have a cartesian diagram 
	\begin{diagram*}
		\node[ob] (a) at (0,1.5) {\llap{$P=\:$}$X\times_YQ$};
		\node[ob] (b) at (2.5,1.5) {$Q$};
		\node[ob] (c) at (0,0) {$X$};
		\node[ob] (d) at (2.5,0) {$Y$};
		\scriptsize
		\draw[->] (a) -- (b) node[pos=0.5, above] {$q$};
		\draw[->] (c) -- (d) node[pos=0.5, above] {$f$};
		\draw[->] (a) -- (c);
		\draw[->] (b) -- (d);
	\end{diagram*}
	and since $f$ is universally closed, $\snake{q}(\snake{X})\subseteq Q$ is closed, as required.
	Since the $\pi^{-1}(U_i)$ for $i=1,\ldots,n$ cover $\snake{X}$, Lemma~\reff{lem:ChowPreimages} implies that $\snake{q}(\snake{X})\subseteq V_1\cup\ldots\cup V_m$. Thus $V_0\cup\ldots\cup V_m$ is an open cover of $Q$.
	
	To prove that $\snake{q}$ is a closed embedding, all we need to do is to check this for all $\snake{q}^{-1}(V_i)\morphism[\snake{q}] V_i$. For $i=0$, this is trivial as $\snake{q}^{-1}(V_0)=\emptyset$. For $i\geq 1$, it suffices to do the case $i=1$. We have seen in the proof of Lemma~\reff{lem:ChowPreimages} that $\snake{q}^{-1}(V_1)\monomorphism q^{-1}(V_1)$ factors over $j_1$. We thus obtain a commutative diagram
	\begin{diagram*}
		\node[ob](a) at (0,2) {$\snake{q}^{-1}(V_1)$};
		\node[ob](c) at (0,0) {$\displaystyle U_1\times_Y\prod\limits_{i=2}^m\IP_Y^{n_i}$};
		\node[ob](b) at (6.5,2) {$V_1$};
		\node[ob](d) at (6.5,0) {$\displaystyle\IA_Y^{n_1}\times_Y\prod\limits_{i=2}^m\IP_Y^{n_i}$};
		\scriptsize
		\draw[->] (a) -- (b) node[pos=0.5, above] {$\snake{q}$};
		\draw[right hook->] (a) -- (c);
		\draw[->] (c) -- (d) node[pos=0.5, above] {$\big(k_1,\id_{\IP_Y^{n_2}},\ldots,\id_{\IP_Y^{n_m}}\big)$};
		\draw[transform canvas={xshift=1pt}] (b) -- (d);
		\draw[transform canvas={xshift=-1pt}] (b) -- (d);
	\end{diagram*}
	from which it is clear that $\snake{q}^{-1}(V_i)\morphism[\snake{q}] V_i$ is immersive. We have already seen that $\snake{q}(\snake{X})\subseteq Q$ is closed, which proves that this immersion is indeed a closed one. We are done.
\end{proof}

\printbibliography

\end{document}          

