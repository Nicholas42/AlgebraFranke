\documentclass[a4paper,parskip=half,numbers=enddot, DIV=12]{scrreprt}
\usepackage[utf8]{inputenc}

\usepackage{../header}
\usepackage{../frankenumbering2}
\usepackage{../shortcuts2}

\usepackage{csquotes}
%\usepackage{tikz-cd}%I cannot draw diagrams without it - Felix. %well, I can - Ferdinand
\usepackage[backend=biber,style=alphabetic]{biblatex}
\setcounter{biburlnumpenalty}{7000}
\setcounter{biburllcpenalty}{7000}
\setcounter{biburlucpenalty}{8000}
\addbibresource{../literatur.bib}

% Title Page
\title{Algebraic Geometry I}
\author{\textsc{Lecturer:} Jens Franke\\
	\textsc{Notes:} Nicholas Schwab \& Ferdinand Wagner}
\date{Wintersemester 2017/18}

\displaywidowpenalty=8000
%\postdisplaypenalty=8000
\widowpenalty=8000
\clubpenalty=8000

\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}

\begin{document}
\pagenumbering{Alph}
\maketitle
\pagenumbering{roman}

\thispagestyle{plain}
This text consists of notes on the lecture Algebraic Geometry I, taught at the University of Bonn by Professor Jens Franke in the winter term (Wintersemester) 2017/18. 

Please report bugs, typos etc. through the \emph{Issues} feature of github.

\tableofcontents

\addchap{Introduction}
\pagenumbering{arabic}
The lecture will be an introduction to the language of \emph{schemes}. The topics include but are not limited to the category of (pre-)schemes, properties of schemes, morphisms of schemes, sheaves of $\Oo_X$-modules and cohomology of quasi-coherent sheaves.

Professor Franke said the lecture requires a firm knowledge of commutative algebra and affine and projective varieties. If you are not familiar with this terms you may want to think again about visiting this lecture. If you want to brush up your knowledge about these topics the following literature is recommended:
\begin{itemize}
 \item Matsumura, H.: \emph{Commutative Ring Theory},
 \item Hartshorne, R.: \emph{Algebraic Geometry},
 \item Mumford, D.: \emph{The Red Book of Varieties and Schemes},
 \item Schwab, N. \& Wagner, F.: \href{https://github.com/Nicholas42/AlgebraFranke/tree/master/AlgebraI}{\emph{Algebra I by Jens Franke}} \cite{alg1}. \textbf{Warning!} Somewhere in the middle of this text, the term \emph{irreducible} is redefined as irreducible \emph{and closed} when referring to subsets of a topological space. So don't let yourself get confused.
\end{itemize}
Let it be said that the first three recommendations are from Professor Franke while the last one is from the (not so) humble authors of these notes.

\chapter{Varieties and Schemes}\lbl{ch:varietiesAndSchemes}
\section{Prevarieties and varieties}
\begin{defi}[Sheaf and presheaf]\lbl{def:preSheaf}
    A \defemph{presheaf $\Ff$ of groups/rings/sets} on a topological space $X$ associates 
    \begin{itemize}
    	\item to any open subset $U\subseteq X$ a group/ring/set $\Ff(U)$ called the \emph{group/ring/set of sections} of $\Ff$ on $U$
    	\item and to any inclusion of open subsets $V\subseteq U$ a group/ring homomorphism resp.\ a map of sets
    	\begin{align*}
	    	(-)|_V\colon \Ff(U) &\longto \Ff(V)
    	\end{align*}
    	such that $f|_V = f$ for all $f\in\Ff(V)$ and $(f|_V)|_W = f|_W$ for any inclusion $W\subseteq V\subseteq U$ of open subsets.
    \end{itemize}  Note that while this notation (intentionally) reminds of the restriction of functions, behaves similarly and often the restriction is indeed used for this homomorphism, the elements of $\Ff(U)$ are not always functions. 
    
    A so defined presheaf is furthermore a \defemph{sheaf} if additionally, the following condition, called \emph{sheaf axiom}, holds:
    \begin{quote}\lbl{sheafAxiom}
     For every open cover $U = \bigcup_{i\in I} U_i$ of an open subset $U\subseteq X$ the map
        \begin{align*}
			\Ff(U) &\longto \left\{(f_i)_{i\in I}\in \prod_{i\in I} \Ff (U_i)\st f_i|_{U_i\cap U_j} = f_j|_{U_i\cap U_j} \text{ for }i,j\in I\right\}\\
			f &\longmapsto \left(f|_{U_i}\right)_{i\in I}
        \end{align*}
        is bijective. 
    \end{quote}
    Elements of $\Ff(U)$ are called \defemph{sections}, elements of $\Rr(X)$ are called \defemph{global sections}.
\end{defi}

\begin{rem}
    For sheaves of groups/rings and $U=\emptyset$ one can take $I=\emptyset$ and obtains $\Ff(\emptyset) = 0$ (the respective zero object). If $\Ff$ is a sheaf of sets, $\Ff(\emptyset)=*$ is a singleton by similar reasons.
\end{rem}
\begin{rem}
    Sheaves of groups, sets, etc. are defined in a similar way. A sheaf of rings $\Rr$ on $X$ defines two sheaves of groups on $X$, namely $U\mapsto (\Rr(U), +)$ and $U\mapsto (\Rr(U)^\times, \cdot)$.
\end{rem}
\begin{example}
	    Let $R$ be a ring. The sheaf $\Ff_X$ of $R$-valued functions on $X$ associates to any open subset $U\subseteq X$ the ring of $R$-valued functions $f\colon U \to R$ with the inclusion morphism being the restriction of functions to subsets.
\end{example}
\begin{rem*}
	  If $\Gg$ is any (pre)sheaf on $X$ and $U\subseteq X$ an open subset, we get a a sheaf $\Gg|_U$ on $U$ by $\Gg|_U(V) = \Gg(V)$ for the open subsets $V\subseteq U$ equipped with the same restriction morphisms.
\end{rem*}
\begin{defi}[Algebraic prevarieties] \lbl{def:preVarieties}
	    Let $k$ be an algebraically closed field. An \defemph{algebraic prevariety} over $k$ is a pair $(X,\Oo_X)$, where $X$ is an irreducible noetherian topological space together with a sheaf $\Oo_X$ of rings on $X$ such that the following property is satisfied.
	    \begin{quote}
	        Any $x\in X$ has an open neighbourhood $U$ such that there is a homeomorphism $U\isomorphism[\phi] V$ where $V\subseteq k^n$ is a Zariski-closed subset such that $\phi$ identifies $\Oo_X|_U$ with the structure sheaf $\Oo_V$ of $V$. That is, if $W \subseteq V$ is open then any $k$-valued function $f\colon W\to k$ is regular (i.e., an element of $\Oo_V(W)$) if and only if 
	        \begin{align*}
	            g\colon \phi^{-1}(W) &\longto k\\
	            x&\longmapsto f(\phi(x))
	        \end{align*}
	        is an element of $\Oo_X(\phi^{-1}(W))$. One denotes $g=\phi^*f$ in this case.
	    \end{quote}
	    A \defemph{morphism of prevarieties} $(X,\Oo_X) \to (Y,\Oo_Y)$ is a continuous map $X\morphism[\phi] Y$ such that for all $U\subseteq Y$ and $\lambda \in \Oo_Y(U)$ we have $\phi^\ast \lambda \in \Oo_X(\phi^{-1}(U))$. As above, $\phi^\ast\lambda$ is defined as $(\phi^\ast\lambda)(x) = \lambda(\phi(x))$. In particular, $\phi^*$ induces a \emph{morphism of sheaves} $\phi^*\colon \Oo_Y\to\phi_*\Oo_X$ (cf.\ Definition~\reff{def:morphismOfPresheaves} and Definition~\reff{def:directImage}).
	\end{defi}
	\begin{rem*}
		\begin{alphanumerate}
			\item In fact, the $V\subseteq k^n$ in the above definition of varieties is even \emph{irreducible}, as $V$ is homeomorphic to an open (and hence irreducible) subset $U$ of the irreducible space $X$. In particular, $V$ is an \emph{affine algebraic variety} (in the sense of \cite[Definition~2.2.1]{alg1}) and one can think of varieties as irreducible spaces which are locally isomorphic to (or glued together from) affine varieties.
			\item The $n$ in the above definition is \emph{not} required to be constant, not even for a single $x\in X$. In fact, this wouldn't be a sensible thing to ask for, as e.g., $k\subseteq k^1$ and $k\times\{0\}\subseteq k^2$ are isomorphic affine varieties. However, the \emph{Krull dimension} $\dim X$ (in the sense of \cite[Definition~2.1.4]{alg1}) is a well-defined thing and one can show that $\dim X=\dim V$ in the above situation (this is a consequence of \cite[Theorem~6]{alg1} and the \emph{locality of codimension}, cf.\ \cite[Remark~2.1.3]{alg1}).
		\end{alphanumerate}
	\end{rem*}
	\begin{example}
		    Let $V\subseteq k^n$ be Zariski-closed, $W\subseteq V$ open. The ring $\Oo_V(W)$ of \emph{regular functions} on $W$ is the ring of functions $\lambda\colon W\to k$ such that for any $x\in W$ there is an open neighbourhood $\Omega$ of $x$ and polynomials $p,q\in R= k[X_1,\ldots,X_n]$ such that $q$ does not vanish on $\Omega\cap W$ and such that we have $\lambda(y) = \frac{p(y)}{q(y)}$ for every $y\in \Omega\cap W$. (cf.\ \cite[Definition 2.2.2]{alg1}).
		     
		     The sheaf $\Oo_V$ defined by $W\mapsto \Oo_V(W)$ is called the \emph{structure sheaf} on $V$. If $W=V$ it can be shown that any $f\in \Oo_V(V)$ can be written as $f=p|_V$ where $p\in R$ (cf.\ \cite[Proposition 2.2.2]{alg1}).
	\end{example}
	    
	\begin{example}
	    The \emph{projective space} $\IP(V)$, where $V$ is a $k$-vector space, is the set of one-dimensional subspaces of $V$. Let $\IP^n(k) = \IP(k^{n+1})$. If $(x_0,\ldots,x_n)\in k^{n+1}\setminus\{0\}$, let $[x_0,\ldots,x_n]$ denote the subspace generated by $(x_1,\ldots, x_n)$.
	     
	     Recall that an ideal $I\subseteq R=k[X_0,\ldots,X_n]$ is called \emph{homogeneous} if it is generated by homogeneous elements (i.e., polynomials in which every monomial has the same total degree). Let $I$ be homogeneous, let $V(I)\subseteq \IP^n(k)$ be the set of all $[x_0, \ldots, x_n]\in\IP^n(k)$ such that $f(x_0,\ldots, x_n)$ vanishes for all $f\in I$. Call a subset $A\subseteq\IP^n(k)$ \emph{Zariski-closed} if there is a homogeneous ideal $I$ such that $A= V(I)$. This turns $\IP^n(k)$ into an irreducible, $n$-dimensional, noetherian topological space.
	     
	     Let $V\subseteq \IP^n(k)$ be closed, $W\subseteq V$ open and $\lambda\colon W\to k$ any function. We call $\lambda$ \emph{regular} on $W$, or $\lambda \in \Oo_V(W)$, if any $x\in W$ has an open neighbourhood $\Omega$ such that there are two polynomials $p,q\in k[X_0,\ldots,X_n]$ homogeneous of the same degree such that $q(y_0,\ldots,y_n) \neq 0$ and 
	     \begin{align*}
	     	\lambda([y_0,\ldots,y_n]) = \frac{p(y_0,\ldots,y_n)}{q(y_0,\ldots,y_n)}
	     \end{align*}
	     for all $[y_0,\ldots,y_n]\in W\cap \Omega$.
	     
	     The \emph{affine space} $\IA^n(k)$ is just good old $k^n$ equipped with its Zariski topology. Consider the map
	     \begin{align*}
	        \IP^n(k)\setminus V(X_i) &\isomorphism \IA^n(k)\\
	        [x_0,\ldots, x_n]&\longmapsto \left(\frac{x_0}{x_i}, \ldots, 
	        \frac{x_{i-1}}{x_i},\frac{x_{i+1}}{x_i},\ldots,\frac{x_n}{x_i}\right)\;.
	    \end{align*}
	    This is a homeomorphism and identifies the structure sheaves with each other. Hence, for any irreducible closed subset $A\subseteq \IP^n(k)$ such that $Y\coloneqq A\cap(\IP^n(k)\setminus V(X_i)) \neq \emptyset$, $(Y, \Oo_A|_Y) $ is isomorphic to an affine algebraic variety. Thus, quasi-projective algebraic varieties (i.e., $(U,\Oo_U)$ where $U\subseteq \IP^n(k)$ is a non-empty open subset of an irreducible closed subset) are algebraic prevarieties in the sense of Definition~\reff{def:preVarieties}.
	    
	    For more about projective spaces and projective varieties, check out our \href{https://github.com/Nicholas42/AlgebraFranke/tree/master/AlgebraII}{\emph{Algebra II lecture notes}} \cite[Chapter 2]{alg2}.
\end{example}
\begin{varthm}{example}\lbl{ex:openSubsetsArePrevarieties}
 When $X$ is prevariety in the sense of Definition~\reff{def:preVarieties} and $U\subseteq X$ is open and $U\neq \emptyset$, then $(U,\Oo_X|_U)$ is a prevariety. Note that any non-empty open subset of an irreducible set is necessarily irreducible as well, so irreducibility of $U$ is not required as an extra condition.
\end{varthm}
\begin{varthm}[b]{example}\lbl{ex:irreducibleSubsetsArePrevarieties}
 Let $X$ be a prevariety, $A\subseteq X$ irreducible and closed. Then $(A,\Oo_A)$ is a prevariety, wherein the structure sheaf $\Oo_A$ is defined as follows: If $W\subseteq A$ is open, let
 \begin{align*}
    \Oo_A(W) = \left\{ f\colon W\to k \st 
    \begin{array}{c}
	    \text{every } x\in W\text{ has an open neighbourhood } x\in U\subseteq X  \\
	    \text{and } \phi\in \Oo_X(U)\text{ such that } f(y) = \phi(y)\ \forall y\in U\cap W
    \end{array}\right\}\;.
 \end{align*}
 Then one may check that $(A,\Oo_A)$ is a prevariety. Note that $\Oo_A$ is \emph{not} given by the restriction $\Oo_X|_A$ (which is only defined for open subsets $U\subseteq X$ anyway). Instead, there is a \emph{sheaf of ideals} $\Ii\subseteq \Oo_X$ (we will encounter this notion in Definition~\reff{def:sheafOfModules}) such that $\Oo_{A,a}=\Oo_{X,a}/\Ii_a$ for all $a\in A$ (the \emph{stalks} $\Oo_{A,a}$, $\Oo_{X,a}$, and $\Ii_a$ are defined in \cite[Definition 2.2.5]{alg1} or, for arbitrary presheaves, in Definition~\reff{def:stalk}). This also foreshadows Corollary~\reff{cor:closedSubpreschemes}.
\end{varthm}

\begin{rem*}
 Recall that the following conditions on a topological space $X$ are equivalent (this should be well-known for \itememph{a} and \itememph{b} and easy to see for \itememph{c}):
 \begin{alphanumerate}
  \item
    If $x\neq y$ are points of $X$, there are open neighbourhoods $V,W\subseteq X$ separating them, i.e., $x\in V$, $y\in W$ and $V\cap W= \emptyset$. This is the usual definition for $X$ being \emph{Hausdorff}.
  \item
    The diagonal $\Delta = \left\{(x,x)\st x\in X\right\}\subseteq X\times X$ is a closed subset.
  \item 
    If $a$ and $b$ are continuous maps $T\to X$, then their \emph{equalizer} $K = \left\{t\in T\st a(t) = b(t)\right\}$ is closed in $T$.
 \end{alphanumerate}
This motivates the following definition of an \emph{algebraic variety} being a prevariety with some kind of Hausdorff property.
\end{rem*}


\begin{defi}[Variety]\lbl{def:variety}
    Let $X$ be a prevariety over $k$ in the sense of Definitions \reff{def:preVarieties}. We call $X$ \defemph{separated} or a \defemph{variety} over $k$ if and only if $\left\{t\in T\st a(t)=b(t)\right\}$ is closed in $T$ whenever $a$ and $b$ are a pair of \emph{morphisms of prevarieties} $T\doublemorphism[a][b] X$. 
\end{defi}

\begin{example}[Line with two origins]
    Let $n>0$ and $X = \left( \IA^n(k) \setminus\{0\}\right) \cup \{0_+\} \cup \{0_-\}$. Consider two morphisms $\iota_+,\iota_-\colon \IA^n(k) \to X$ defined by
    \begin{align*}
	\iota_\pm(x) = \begin{cases} x &\text{if }x\neq 0\\
			0_\pm &\text{if } x = 0
		    \end{cases}
    \end{align*}
    Let $U\subseteq X$ be open iff both $\iota_+^{-1} (U)$ and $\iota_-^{-1}(U)$ are both open in $\IA^n(k)$, and let 
    \begin{align*}
        \Oo_X(U) = \left\{f\colon U\to k\st \iota_\pm^* f = f \iota_\pm \in \Oo_{\IA^n(k)} \left(\iota_\pm^{-1}(U)\right)\right\}.
    \end{align*}
    Then $U_\pm = \iota_\pm\big(\IA^n(k)\big)$ are both open and $\IA^n(k)\morphism[\iota_\pm] U_\pm$ is a homeomorphism identifying the respective structure sheaves. Thus, $X$ is a prevariety, but not a variety in the sense of Definition~\reff{def:variety} as we may take $T=\IA^n(k) \morphism[\iota_\pm] X$ in Definition \reff{def:variety} and obtain $K = \left\{x\in \IA^n(k)\st \iota_+(x) = \iota_-(x)\right\} = \IA^n\setminus\{0\}$, which is not closed.
\end{example}
\begin{example}
    \begin{alphanumerate}
    \item \lbl{ex:affineIsVariety}
        Any affine algebraic variety is a variety in the sense of Definition \reff{def:variety}.
    \item
        In particular, $\IA^0(k) = \{0\}$ is a variety, as is any one-point prevariety.
    \item 
        Non-empty open and irreducible closed subsets $Y$ of varieties $X$ are varieties 
    \end{alphanumerate}
\end{example}
\begin{proof}
		For part \itememph{c} note that the inclusion $Y\monomorphism[\iota] X$ (together with $\iota^*\colon \Oo_X\to\iota_*\Oo_Y$) is a morphism of prevarieties, and for a pair $a,b\colon T\to Y$ of morphisms of prevarieties we have $\left\{t\in T\st a(t) = b(t) \right\} = \left\{t \in T\st(\iota a)(t) = (\iota b)(t) \right\}$. The latter is closed in $T$ because $X$ is a variety.
	
        For part \itememph{a} let $X\subseteq k^n$ be closed and irreducible, $a,b\colon T\to X$ be morphisms of prevarieties and $K= \left\{t\in T\st a(t) = b(t)\right\}$. To show that $K$ is closed in $T$, it is sufficient to show that any $t\in T$ has a neighbourhood $\Omega$ such that $K\cap \Omega$ is closed in $\Omega$. Choosing $\Omega$ such that it is isomorphic to an affine algebraic variety, which is possible because $T$ is a prevariety, we may assume without loss of generality that $T\subseteq k^m$ is an affine algebraic variety in (i.e.,  an irreducible subset of) $k^m$. Let 
	        \begin{align*}
		    X_i\colon X&\longrightarrow k\\
		    (x_1,\ldots,x_n)&\longmapsto x_i
		\end{align*}
		denote the projection to the $i\ordinalth$ coordinate. Then $X_i\in\Oo_X(X)$, hence $\alpha_i = a^\ast X_i$ and $\beta_i = b^\ast X_i$ are in $\Oo_T(T)$ and 
		\begin{align}
		    K= \left\{ t\in T\st \alpha_i(t) = \beta_i(t)\ \forall i\right\} = \bigcap_{i=1}^n V(\alpha_i-\beta_i)\;.
		\end{align}
		But we proved in Algebra I that $V(\phi)$ is closed in $T$ whenever $T$ is an affine algebraic variety and $\phi\in  \Oo_T(T)$ (cf.\ \cite[Proposition 2.2.1]{alg1}).
		
		Part \itememph{b} is trivial from \itememph{a}.	
\end{proof}
\begin{rem}
    \begin{alphanumerate}
    \item \lbl{rem:localClosedness}
        $K\subseteq T$ is closed iff for all $t\in T$ there is an open neighbourhood $\Omega_t$ such that $\Omega_t\cap K$ is closed in $\Omega_t$, since 
        \begin{align*}
            T\setminus K = \bigcup_{t\in T} \big(\Omega_t\setminus (K\cap \Omega_t)\big)
        \end{align*}
        is open as a union of open subsets. It is even sufficient to have $\Omega_t$ a neighbourhood of $t$ (that is, not necessarily open) as in that case $\Omega_t$ contains a suitable open neighbourhood.
    \item
        It is \emph{not} sufficient to require this just for all $t\in K$. If only this holds, $K$ is called \emph{locally closed}
    \end{alphanumerate}
\end{rem}
\begin{prop}\lbl{prop:commonNeighbourhoodVariety}
    Let $X$ be any prevariety such that for arbitrary $x,y\in X$ there is a common open neighbourhood $U$ of $x$ and $y$ which is affine (that is, isomorphic as a prevariety to an affine variety in some $k^n$). Then $X$ is a variety.
\end{prop}
\begin{proof}
    Let $a,b\colon T\to X$ as in Definition \reff{def:variety} and $t\in T$ and let $U\subseteq X$ be an affine open subset of $X$ containing both $a(t)$ and $b(t)$. Let $V = a^{-1}(U) \cap b^{-1}(U)\subseteq T$. This is an open subset of $T$ containing $t$. It is easily seen that $a|_V$ and $b|_V$ are morphisms $V\to U$. By the previous Example~\reff{ex:affineIsVariety}\itememph{a}, $K\cap V = \left\{t\in U\st a(t) = b(t)\right\}$ is closed in $V$. Because such a neighbourhood can be found for any $t\in T$, $K$ is closed in $T$ by Remark~\reff{rem:localClosedness}\itememph{a}.
\end{proof}
\begin{cor}
    Quasi-projective and quasi-affine algebraic varieties are varieties.
\end{cor}
\begin{proof}
	\emph{Step 1.} Let $X\subseteq k^n$ be irreducible and closed. Recall that for any $f\in \Oo_X(X)\setminus\{0\}$, $X\setminus V(f)$ is affine: Let $X=V(\pp)$ for some prime ideal $\pp\in R=k[X_1,\ldots,X_n]$. We identify $f\in \Oo_X(X)=R/\pp$ with an arbitrary representative $f\in R$. Now consider the ideal $\qq\subseteq k[X_1,\ldots,X_n,T]$ generated by $\pp$ and $1-T\cdot f$. One can show that
	\begin{align*}
		V(\qq) &\isomorphism X\setminus V(f)\\
		(x,t) &\longmapsto x \\
		(x,f(x)^{-1}) &\longmapsfrom x
	\end{align*}
	is a homeomorphism topological spaces. Then $V(\qq)$ is irreducible (as $X\setminus V(f)$ is), hence an affine variety and the above map turns into an isomorphism of quasi-affine varieties, which proves that $X\setminus V(f)$ must be affine as well (cf.\ \cite[Proposition~2.2.4]{alg1}).
	
	Let $U\subseteq X$ be open and $F\subseteq U$ be finite. Let $X\setminus U = V(I)$ with $I\subseteq R$ an ideal. If $n=0$, $U = \{0\}$ is affine and we have nothing to prove. Let $n\geq 1$. Because $k$ is infinite, the $k$-vector space $I$ cannot be the union of its finitely many codimension one subspaces $I_x=\left\{p\in I\st p(x) = 0\right\}$ for $x\in F$ (indeed, $I/I_x\isomorphism k$ via $p\mapsto p(x)$). Therefore, there is $p\in I$ such that $F\subseteq X\setminus V(p)$. By our initial remark, $X\setminus V(p)$ is affine and a neighbourhood of $F$. As $p\in I$, $X\setminus V(p)\subseteq U$ and the claim follows from Proposition~\reff{prop:commonNeighbourhoodVariety}.
	
	\emph{Step 2.} Let $X\subseteq \IP^n(k)$ be quasi-projective and let $F\subseteq X$ be finite. We can write 
	\begin{align*}
		F=\left\{\big[f_0^{(i)},\ldots, f_n^{(i)}\big]\st 1\leq i \leq N\right\}\;.
	\end{align*} 
	As $k^{n+1}$ is larger than the union of the $N$ codimension one subspaces \begin{align*}
		V_i=\left\{(\xi_j)_{j=0}^n\st \sum_{j=0}^n \xi_j f_j^{(i)} = 0\right\}\quad\text{for }i=1,\ldots,N\;,
	\end{align*} 
	there is a homogeneous polynomial $p\neq 0$ of degree 1 such that $p\big(f_0^{(i)},\ldots, f_n^{(i)}\big) \neq 0$ for all $1\leq i\leq N$. Then $F\subseteq X\setminus V(p)$. But $\IP^n(k)\setminus V(p)$ is isomorphic to $k^n$ as this is the case when $p= X_0$ and $\GL_{n+1}(k)$ acts transitively on $k^{n+1}\setminus\{0\}$. Thus, $F\subseteq X\setminus V(p)$ and $X\setminus V(p)$ is isomorphic to a quasi-affine variety. The assertion now follows from Step~1.
\end{proof}
    \begin{rem*}
        \begin{alphanumerate}
          \item 
            Let $X$ be a prevariety. If two arbitrary points have a common neighbourhood which is a variety, then $X$ is a variety.
          \item 
            We have actually seen that arbitrary finite subsets of quasi-projective algebraic varieties have open neighbourhoods which are affine. This is useful, e.g., when forming quotients by finite groups.
          \item
            Hironaka (see Hartshorne for examples of a non-quasi-projective variety) has an example of a variety where there are two points without a common affine neighbourhood.
        \end{alphanumerate}
        
    \end{rem*}
\section{General properties and sheaf constructions}\lbl{sec:SheafConstructions}
\begin{defi}[Stalk]\lbl{def:stalk}
    Let $\Gg$ be a presheaf on the topological space $X$ and $x\in X$. Let $\Gg_x = \colimit[U] \Gg(U)$ denote the \defemph{stalk} of $\Gg$ at $x$, where $\colimit$ is taken over the open neighbourhoods $U$ of $x$.
\end{defi}
\begin{rem*}
    In general, $\colimit$ is the colimit in the target category. For the target categories of abelian groups, sets or rings we have
    \begin{align*}
        \Gg_x = \left\{(U,g) \st x\in U \text{ open, } g\in \Gg(U)\right\}/_\sim\;,
    \end{align*}
    where $(U,g)\sim (V,h)$ iff there is an open neighbourhood $W\subseteq U\cap V$ of $x$ such that $g|_W = h|_W$. 
\end{rem*}
\begin{example}
    The stalk at $x$ of the structure sheaf of a prevariety $X$ is called the local ring $\Oo_{X,x}$ of $X$ at $x$.
\end{example}
\begin{rem*}
    A set $\Bb$ of open subsets of a topological space $X$ is called a \emph{base} of the topology if every open subset of $X$ may be written as a union of elements of $\Bb$. A set of subsets of some set $X$ is the base of a (uniquely determined) topology on $X$ iff the intersection of two arbitrary elements of $\Bb$ can be written as the union of elements of $\Bb$ and $\Bb$ covers $X$.
\end{rem*}
\begin{defi}[Presheaves defined on a topology base]\lbl{def:presheafOnBase}
    Let $\Bb$ be a base of the topology on $X$. A \defemph{presheaf} on $\Bb$ associates
    \begin{itemize}
    	\item a set (group, ring, \ldots) $\Gg(U)$ to any $U\in \Bb$
    	\item and to each inclusion of elements of $\Bb$ a \emph{restriction morphism}  		$(-)|_V\colon\Gg(U) \morphism \Gg(V)$
    	such that $\Gg(U) \morphism[(-)|_U]\Gg(U)$ equals $\id_{\Gg(U)}$ and $f|_W = (f|_V)|_W$ for all $f\in \Gg(U)$ if $W\subseteq V\subseteq U$ is a inclusion of elements of $\Bb$. 
    \end{itemize}
	 If $\Gg$ is a presheaf on $\Bb$ and $x\in X$ we put $\Gg_x = \colimit[U] \Gg(U)$ where the direct limit (\emph{direct limit} means the same as \emph{colimit}) is taken over all $U\in \Bb$ containing $x$.
\end{defi}
\begin{rem*}
    Equip $\Bb$ with partial order $\preceq$ where $V\preceq U$ iff $V\supseteq U$. Any partially ordered set $(\XX, \preceq)$ defines a category in which there is a morphism $X\to Y$ precisely if $X\preceq Y$. Then, a presheaf on $\Bb$ is a functor from (the category made out of) $\Bb$ and the target category.
\end{rem*}
\begin{varthm}{defi}\lbl{def:morphismOfPresheaves}
    A morphism $\Gg\morphism[f] \Hh$ of presheaves on $\Bb$ is a collection $\Gg(U)\morphism[f_U] \Hh(U)$ of morphisms in the target category such that
    \begin{diagram*}
    	\node[ob](a) at (0,1.5) {$\Gg(U)$};
    	\node[ob](c) at (0,0) {$\Hh(U)$};
    	\node[ob](b) at (2.5,1.5) {$\Gg(V)$};
    	\node[ob](d) at (2.5,0) {$\Hh(V)$};
    	\scriptsize
    	\draw[->] (a) -- (b) node[pos=0.5, above] {$(-)|_V$};
    	\draw[->] (a) -- (c) node[pos=0.5, left] {$f_U$};
    	\draw[->] (c) -- (d) node[pos=0.5, above] {$(-)|_V$};
    	\draw[->] (b) -- (d) node[pos=0.5, right] {$f_V$};
    \end{diagram*}
    commutes. We will often write $\Gg(U) \morphism[f] \Hh(U)$ instead of $\Gg(U)\morphism[f_U] \Hh(U)$.
\end{varthm}
\begin{fact}\lbl{fact:smallerBaseSheaf}
    If $\snake \Bb \subseteq \Bb$ is a smaller base of the same topology there is an obvious restriction $\snake \Gg = \Gg|_{\snake \Bb}$. We have a canonical isomorphism
    \begin{align*}
    	\snake \Gg_x \isomorphism \Gg_x
    \end{align*}
    sending $(U,g)/_\sim \in \snake \Gg_x$ (where $U\in \snake \Bb$, $g\in\Gg(U)$, $x\in U$) to $(U,g)/_\sim\in \Gg_x$. It is easy to see that this is well-defined and an isomorphism.
\end{fact}
\begin{defi}[Sheafification]\lbl{def:sheafification}
    Let $\Bb$ be a topology base on $X$, $\Gg$ a presheaf on $\Bb$. We define the \defemph{sheafification} (German: \defemph{Garbifizierung}) $\Gg^{\sh}$ (Professor Franke uses the notation $\Sheaf(\Gg)$) of $\Gg$ as follows:
    \begin{align}\lbl{eq:sheafification}
        \Gg^ \sh(U) = \left\{ (g_x)\in \prod_{x\in U}\Gg_x\st 
        \begin{array}{c}
	        \text{for all }y\in U\text{ there are an open neighbourhood }V\in\Bb\\
	        \text{and }\gamma\in\Gg(V)\text{ such that }g_x=(V,\gamma)/_\sim\ \forall x\in U\cap V
        \end{array}\right\}\tag{$*$}
    \end{align}
    Moreover, we define the restriction morphisms via $(g_x)_{x\in U}|_V = (g_x)_{x\in V}$.
\end{defi}
\begin{rem*}    
    \begin{alphanumerate}
      \item 
        The definition \eqreff{eq:sheafification} obviously does not change if the coherence condition on its right-hand side is replaced by 
        \begin{quote}
            for every $y\in U$, there are an open neighbourhood $V$ of $y$ in $X$ and $\gamma\in \Gg(V)$ such that $V\subseteq U$ and $V\in\Bb$ and such that $g_x =(V,\gamma)/_\sim$ for all $x\in V$.
        \end{quote}
      \item 
        It is easy to see that $\Hh=\Gg^\sh$ satisfies the sheaf axiom: If $U = \bigcup_{i\in I} U_i$ is an open cover and $g^{(i)} = (g^{(i)}_x)_{x\in U_i}\in \Hh(U_i)$ as on the right-hand side of the sheaf axiom, define $g\in \Hh(U)$ by $g_x = g_x^{(i)}$ where $i$ is chosen such that $x\in U_i$. This depends on $x$ only. It is easy to see that indeed $g\in \Hh(U)$ and that this $g$ is the only element of $\Hh(U)$ with $g|_{U_i} = g_i$ for all $i\in I$.
      \item
        It is easy to see that for every $x\in X$, $\Gg\to \Gg_x$ is a functor from the category of presheaves to the respective target category, provided that the colimits occurring in the definition of $\Gg_x$ exist in that category. Moreover $(-)^\sh$ is a functor from the category of presheaves with values in sets, groups, or rings to the respective category of sheaves.
    \end{alphanumerate}
\end{rem*}
We define a \emph{canonical morphism} (cf.\ Definition~\reff{def:canonicalMorphism})
\begin{align*}
    \Gamma_\Gg\colon\Gg&\morphism \Gg^\sh|_\Bb\\
    g\in \Gg(U) &\longmapsto (g_x)_{x\in U}
\end{align*}
of presheaves on $\Bb$.

\begin{prop}\lbl{prop:sheafificationMorphisms}
    We consider (pre-)sheaves of sets, (abelian) groups or rings.
    \begin{alphanumerate}
      \item 
        The morphism $\Gg_x \morphism \Gg^\sh_x$ induced by $\Gamma_\Gg$ is an isomorphism, for arbitrary $x\in X$.
      \item
        If $\Gg$ and $\Hh$ are presheaves on $\Bb$ and $\Gg\morphism[\phi] \Hh$ is a morphism between them such that the induced morphism $\Gg_x\morphism[\phi_x] \Hh_x$ is injective (respectively bijective) for arbitrary $x\in X$, then  
        \begin{align*}
            \Gg^\sh(U) \xrightarrow{\phi_U^\sh} \Hh^\sh(U)
        \end{align*}
        is injective (respectively bijective) for every open subset $U$ of $X$.
      \item 
        If $\snake \Bb \subseteq \Bb$ is a topology base then the canonical morphism 
        \begin{align*}
        	\big(\Gg|_{\snake\Bb}\big) ^\sh\morphism \Gg^\sh
        \end{align*}
        (defined using $\big(\Gg|_{\snake\Bb}\big)_x \isomorphism \Gg_x$)  is an isomorphism.
      \item 
        If $\Bb$ is closed under intersections and $\Gg$ satisfies the sheaf axiom for covers of elements of $\Bb$ by elements of $\Bb$, then 
        \begin{align*}
        	\Gamma_\Gg\colon \Gg\isomorphism \Gg^\sh|_\Bb\;.
        \end{align*}
    \end{alphanumerate}
\end{prop}
\begin{proof}
	\itememph{c} If you think about it for a while, this becomes rather obvious from the definitions.\lbl{thisIsNotAProofCozWeAreLazy}
	
	For part \itememph{a}, we prove surjectivity first: Let $g\in\Gg^\sh(U)$ and $x\in U$, we need to find an open neighbourhood $V\in \Bb$ of $x$ and $\gamma\in \Gg(V)$ such that the images in $\Gg^\sh_x$ of $\Gamma_\Gg(\gamma)\in \Gg^\sh(V)$ and of $g$ coincide. We chose $V$ and $\gamma$ as on the right-hand side of \eqreff{eq:sheafification}. As $\Bb$ is a topology base there is $W\in\Bb$ such that $x\in W\subseteq U\cap V$. It follows from the definition of $\Gamma_\Gg$ and the coherence condition that $g|_W = \Gamma_\Gg(\gamma)|_W$. Consequently, their images in the stalk at $x$ coincide, as asserted.
	
	To show injectivity define
	\begin{align*}
	    \iota_x\colon \Gg^\sh_x &\morphism \Gg_x\\
	    \bigg(\begin{array}{c}
		    \text{image of}\\
		    (g_y)_{y\in U} \in \Gg^\sh(U) \text{ in } \Gg^\sh_x 
	    \end{array}\bigg) &\longmapsto g_x\;.
	\end{align*}
	It is easy to see that this is well-defined and that it is a left inverse to the map $\Gg_x\morphism[(\Gamma_{\Gg})_x] \Gg^\sh_x$ studied. Therefore, $(\Gamma_\Gg)_x$  is also injective.
	
	Let's prove \itememph{b}. The assertion about injectivity is trivial. Let us assume that $\Gg_x\morphism[\phi_x]\Hh_x$ is an isomorphism for arbitrary $x\in X$ and let $h=(h_x)_{x\in U}\in \Hh^\sh(U)$. We put $g=(g_x)_{x\in U} \in \prod_{x\in U}\Gg_x$ where $g_x = \phi_x^{-1} (h_x)$. If $g\in \Gg^\sh(U)$ then it is obvious from the definitions that $\phi_U^\sh(g) = h$, proving the bijectivity of $\Gg^\sh(U) \morphism[\phi_U^\sh] \Hh^\sh(U)$.
	
	To verify the coherence condition for $g$, fix $x\in U$. As $h$ satisfies the coherence condition there are an open neighbourhood $V\in\Bb$ of $x$ and $\eta\in\Hh(V)$ such that $h_y$ equals the image of $\eta$ in $\Hh_y$ for all $y\in U\cap V$. As the image of $\eta$ in $\Hh_x$ is in the image of $\Gg_x\morphism[\phi_x]\Hh_x$, there are a neighbourhood $W\in\Bb$ of $x$ and $\gamma\in\Gg(W)$ such that $\phi_x$ maps the image $(W,\gamma)/_\sim$ of $\gamma$ in $\Gg_x$ to the image $(V,\eta)/_\sim$ of $\eta$ in $\Hh_x$. By definition of stalks and $\phi_x$, this means that there is an open neighbourhood $\Omega\in\Bb$ of $x$ such that $\Omega\subseteq V\cap W$ and $ \phi_W(\gamma)|_\Omega = \eta|_\Omega$. Replacing $V$ by $\Omega$ and $\gamma$ and $\eta$ by their restrictions to $V$ (which equals $\Omega$ now), we may assume that there is $\gamma\in\Gg(V)$ such that $\phi(\gamma) = \eta$. For $y\in V$, \begin{align*}
		\phi_y(g_y) = h_y=(V,\eta)/_\sim = \big(V,\phi(\gamma)\big)/_\sim = \phi_y\big((V,\gamma)/_\sim\big)\;.
	\end{align*}
	Since $\phi_y$ is an isomorphism, this implies $g_y = (V,\gamma)/_\sim$. Thus $g\in \Gg^\sh(U)$.
	
	And finally part \itememph{d}. We first show injectivity of $\Gg(U)\morphism[\Gamma_\Gg] \Gg^\sh(U)$, for $U\in \Bb$. Let $g,g'\in \Gg(U)$ have the same image in $\Gg^\sh(U)$, i.e., for every $x\in U$ their images $g_x$ and $g'_x$ in $\Gg_x$ coincide. By definition of $\Gg_x$, this means that for every $x\in U$ there is an open neighbourhood $V_x\in\Bb$ of $x$, such that $g|_{V_x}=g'|_{V_x}$. As the $V_x$ cover $U$, this implies $g=g'$ by the sheaf axiom.
	
	For surjectivity, let $g=(g_x)_{x\in U}\in \Gg^\sh(U)$. For every $x\in U$ there are, by the coherence condition on the right-hand side of \eqreff{eq:sheafification}, an open neighbourhood $V_x\in\Bb$ and $\gamma^{(x)}\in \Gg(V_x)$ such that $g_y$ equals the image of $\gamma^{(x)}$ in $\Gg_y$ for all $y\in U\cap V_x$. Replacing $V_x$ by $U\cap V_x$ and $\gamma^{(x)}$ by its restriction we may assume $V_x\subseteq U$. If $x,\xi\in U$ and $y\in V_x\cap V_\xi$, then the images of $\gamma^{(x)}$ and $\gamma^{(\xi)}$ in $\Gg_y$ coincide (they are $g_y$). Thus, the images of $\gamma^{(x)}|_{V_x\cap V_\xi}$ and $ \gamma^{(\xi)}|_{V_x\cap V_\xi}$ under $\Gg(V_x\cap V_\xi ) \morphism[\Gamma_\Gg] \Gg^\sh(V_x\cap V_\xi)$ coincide. Consequently,  $\gamma^{(x)}|_{V_x\cap V_\xi} = \gamma^{(\xi)}|_{V_x\cap V_\xi}$, as injectivity has already been shown. By the sheaf axiom for $\Gg$, there is $\gamma\in \Gg(U)$ such that $\gamma^{(x)}=\gamma|_{V_x}$ simultaneously for all $x\in U$ (note that in all of this we silently used that $\Bb$ is closed under intersections). Then 
	\begin{align*}
		g_x=\big(V_x, \gamma^{(x)}\big)/_\sim = \big(V_x,\gamma|_{V_x}\big)/_\sim = \big(U,\gamma\big)/_\sim\quad\text{for all }x\in U\;. 
	\end{align*}
	Thus, $\Gamma_\Gg(\gamma) = g$.
\end{proof}
\begin{cor}\lbl{cor:sheafDefinedByStalks}
    The following assertions hold in the categories of sets, (abelian) groups or rings.
    \begin{alphanumerate}
      \item 
        If $\Ff$ is a sheaf of the given type, then any $f\in\Ff(U)$ is uniquely determined by the family of its images in $\Ff_x$ for $x\in U$, that is, 
        \begin{align}\lbl{eq:sheafDefinedByStalks}
            \Ff(U) \morphism \prod_{x\in U} \Ff_x
        \end{align}
        is injective. The image of $\Ff(U)$ under this map is the set of all $(f_x)_{x\in U}\in\prod_{x\in U}\Ff_x$ such that for every $x\in U$ there are an open neighbourhood $V$ of $x$ and $\phi\in \Ff(V)$ such that $f_y$ equals the image $\phi_y$ of $\phi$ under $\Ff(U)\morphism \Ff_y$ for all $y\in U\cap V$. %This is proven by Proposition \reff{prop:sheafificationMorphisms}(d).
      \item 
        A morphism of sheaves inducing isomorphisms (respectively injective maps) on stalks defines isomorphisms (respectively injective maps) on sections of open subsets. %This follows from Proposition \reff{prop:sheafificationMorphisms}(b) as 
      \item 
        If two morphism $\Ff \doublemorphism[\alpha][\beta] \Gg$ define identical maps $\Ff_x \doublemorphism[\alpha_x][\beta_x] \Gg_x$ for each $x\in X$, then $\alpha= \beta$.
      \item
        If $\Gg\morphism[\alpha] \Hh$ is a morphism of sheaves such that $\Gg_x\morphism[\alpha_x] \Hh_x$ is injective (respectively surjective) for all $x$, then $\alpha$ is a monomorphism (respectively an epimorphism). %This follows from Proposition \reff{prop:sheafificationMorphisms}.
      \item
        Let $\Rr$ be a sheaf of rings on $x$ and $\rho\in\Rr(U)$, then $\rho\in \Rr(U)^\times$ iff for each $x\in U$ the image $\rho_x$ of $\rho$ in $\Rr_x$ is in $\Rr_x^\times$.
    \end{alphanumerate}
\end{cor}
    \begin{proof}
    	\itememph{a} is an immediate consequence of Proposition~\reff{prop:sheafificationMorphisms}\itememph{d}.
    	
    	Part \itememph{b} follows from Proposition~\reff{prop:sheafificationMorphisms}\itememph{b} as
    	\begin{diagram*}
    		\node[ob](a) at (0,1.5) {$\Ff(U)$};
    		\node[ob](c) at (0,0) {$\Ff^\sh(U)$};
    		\node[ob](b) at (2.5,1.5) {$\Gg(U)$};
    		\node[ob](d) at (2.5,0) {$\Gg^\sh(U)$};
    		\scriptsize
    		\draw[->] (a) -- (b) node[pos=0.5, above] {$\alpha$};
    		\draw[->] (a) -- (c) node[pos=0.5, sloped, above=-0.25ex] {$\sim$} node[pos=0.5, left] {$\Gamma_\Ff$};
    		\draw[->] (c) -- (d) node[pos=0.5, above] {$\alpha$};
    		\draw[->] (b) -- (d) node[pos=0.5, sloped, above=-0.25ex] {$\sim$} node[pos=0.5, left] {$\Gamma_\Gg$};
    	\end{diagram*}        
    	commutes. Here the vertical arrows are isomorphisms by Proposition~\reff{prop:sheafificationMorphisms}\itememph{d}.
    	
    	Part \itememph{c} immediately follows from \itememph{a}.
    	
    	Part \itememph{d} is quite obvious. Let $\alpha_x$ be injective for arbitrary $x\in X$, and let $\Tt\doublemorphism[\tau][\smash{\theta}] \Ff$ be morphisms such that $\alpha \tau= \alpha \theta$. Then $\alpha_x \tau_x = \alpha_x \theta_x$ for all $x\in X$. As $\alpha_x$ is an injective map this implies $\tau_x = \theta_x$. By \itememph{c} we have $\tau = \theta$. Hence $\alpha$ is a monomorphism.
    	
    	Let $\alpha_x$ be surjective for arbitrary $x\in X$, and let $\Ff\doublemorphism[\tau][\smash{\theta}] \Tt$ be morphisms such that $ \tau\alpha=  \theta\alpha$. Then $\tau_x\alpha_x = \theta_x\alpha_x$ for all $x\in X$. As $\alpha_x$ is a surjective map this implies $\tau_x = \theta_x$. By \itememph{c} we have $\tau = \theta$. Hence $\alpha$ is a epimorphism.
    	
    	%However, in fancyspeak (and for the sake of a rigid argument), one can consider the \emph{functor} $F\colon\cat{PSh}(X)\morphism\cat{Set}$ from the category of presheaves on $X$ to the category of sets given by
    	%\begin{align*}
    	%	F(\Gg)=\prod_{U\subseteq X\text{ open}}\Gg(U)
    	%\end{align*}
    	%(we regard the $\Gg(U)$ as sets). Then $F$ is faithful. Hence, if $\alpha$ is stalk-wise injective then also section-wise (by \itememph{b}), hence $F(\alpha)$ is injective. Faithfulness of $F$ finally shows that $\alpha$ must be a monomorphism.
    	
    	Proving the \emph{only if} part of \itememph{e} is quite trivial since $\Rr(U) \morphism \Rr_x$ is a ring homomorphism, thus maps units to units. Conversely, let $\rho_x$ be a unit for every $x\in U$. We consider the morphism $\Rr|_U \morphism[\rho\cdot]\Rr|_U$ (of sheaves of \emph{sets}, multiplying by $\rho$ is no ring homomorphism!). On stalks it defines the map $\Rr_x \morphism[\rho_x\cdot] \Rr_x$, which is bijective. By \itememph{b} it is an isomorphism, hence there is $\sigma \in \Rr(U)$ such that $\rho \sigma = 1$ and $\rho\in \Rr(U)^\times$.
    \end{proof}
    \begin{fact}\lbl{fact:smallerBaseSheafification}
        If $\Ff$ is a presheaf on $\Bb$ and $\snake{\Bb}\subseteq \Bb$ is another topology base, then $\big(\Ff|_{\snake \Bb}\big)^\sh\cong \Ff^\sh$.
    \end{fact}
    \begin{proof}
    	 This is Proposition~\reff{prop:sheafificationMorphisms}\itememph{c} and we proved it there. Ok, \hyperref[thisIsNotAProofCozWeAreLazy]{this} arguably doesn't count as a proof, so let's do it now.
    	
        By Fact~\reff{fact:smallerBaseSheaf}, $\big(\Ff|_{\snake \Bb}\big)_x \isomorphism \Ff_x$ is an isomorphism for all $x\in X$. It is clear that 
        \begin{align*}
        	f=(f_x)\in \prod_{x\in U} \Ff_x \cong \prod_{x\in U} (\Ff|_{\snake\Bb})_x
        \end{align*}
        satisfying the coherence condition for $(\Ff|_{\snake \Bb})^\sh$ also satisfies it for $\Ff^\sh$. Conversely, let $f$ satisfy the coherence condition for $\Ff^\sh$. For every $x\in U$, this means that there is $V\in \Bb$ and $\phi\in \Ff(V)$ such that $\phi_y = f_y$ for $y\in U\cap V$. As $\snake\Bb$ is a topology base there is $W\in \snake \Bb$ such that $x\in W\subseteq V$. Let $\snake\phi = \phi|_W$, then $\snake\phi_y = f_y$ when $y\in U\cap W$. Hence $f\in (\Ff|_{\snake\Bb})^\sh(U)$.
    \end{proof}
    \begin{prop}\lbl{prop:sheafificationAdjointFunctor}
        The following holds for sheaves of sets, rings and (abelian) groups. Let $\Bb$ be a topology base and $\Ff$ a presheaf on $\Bb$. Any morphism $\Ff\morphism[\alpha] \Gg|_\Bb$, where $\Gg$ is a sheaf on $X$, has the form 
        \begin{diagram*}
        	\node[ob](F) at (0,1.25) {$\Ff$};
        	\node[ob](FB) at (1.25,0) {$\Ff^\sh|_\Bb$};
        	\node[ob](GB) at (2.5,1.25) {$\Gg|_\Bb$};
        	\scriptsize
        	\draw[->] (F) -- (FB) node[pos=0.5,below left] {$\Gamma_\Ff$};
        	\draw[->] (F) -- (GB) node[pos=0.5,above] {$\alpha$};
        	\draw[->,dashed] (FB) -- (GB) node[pos=0.5,below right] {$\exists!\ \beta|_\Bb$};
        \end{diagram*}
        in which $\Ff^\sh\morphism[\beta] \Gg$ is a uniquely determined morphism of sheaves.
    \end{prop}
    \begin{proof}
        If $\beta$ is as above then $\alpha_x$ equals 
        \begin{diagram*}
	       	\node[ob](F) at (0,1.5) {$\Ff$};
	       	\node[ob](FB) at (1.5,0) {$\big(\Ff^\sh|_\Bb\big)_x$};
	       	\node[ob](Fsh) at (3.5,0) {$\Ff^\sh_x$};
	       	\node[ob](GB) at (3,1.5) {$\big(\Gg|_\Bb\big)_x$};
	       	\node[ob](G) at (5, 1.5) {$\Gg_x$};
	       	%\path (FB) -- (Fsh) node[pos=0.5] {$\cong$};	       	
	       	%\path (GB) -- (G) node[pos=0.5] {$\cong$};
	       	\scriptsize
	       	\draw[->] (F) -- (FB) node[pos=0.5,below left] {$(\Gamma_\Ff)_x$};
	       	\draw[->] (F) -- (GB) node[pos=0.5,above] {$\alpha_x$};
	       	\draw[->] (FB) -- (GB) node[pos=0.5,below right] {$(\beta|_\Bb)_x$};
	       	\draw[->] (Fsh) -- (G) node[pos=0.5, below right] {$\beta_x$};
	       	\draw[->] (FB) -- (Fsh) node[pos=0.5, above=-0.25ex] {$\sim$};
	       	\draw[->] (GB) -- (G) node[pos=0.5, above=-0.25ex] {$\sim$};
        \end{diagram*}
        in which also $(\Gamma_\Ff)_x$ is an isomorphism by Proposition~\reff{prop:sheafificationMorphisms}\itememph{a}.  It follows that $\beta_x$ is uniquely determined by $\alpha_x$, hence by $\alpha$. By Corollary~\reff{cor:sheafDefinedByStalks}\itememph{c} this means that $\beta$ is uniquely determined by $\alpha$, showing uniqueness.
        
        To show existence of $\beta$ we construct it as 
        \begin{align*}
            \Ff^\sh \morphism[\alpha^\sh] (\Gg|_\Bb)^\sh \isomorphism \Gg^\sh  \cong \Gg
        \end{align*}
        (the first isomorphism follows from Fact~\reff{fact:smallerBaseSheafification} and the latter from Proposition~\reff{prop:sheafificationMorphisms}\itememph{d}). It is easily verified that this has the required properties.
    \end{proof}
    \begin{rem}
        By the usual Yoneda-type argument, it is clear that the above universal property characterizes $\Ff^\sh$ uniquely up to unique isomorphism. For other target categories the above universal property should be taken as the definition of $\Ff^\sh$. It may or may not exist, but is unique if it does.
    \end{rem}
    \begin{rem}
        Proposition~\reff{prop:sheafificationAdjointFunctor} essentially says, that, for $\Ff$ a presheaf and $\Gg$ a sheaf of sets, (commutative) rings or (abelian) groups, we have a bijection
        \begin{align*}
        	\Hom_{\cat{Sh}(X)}(\Ff^\sh,\Gg)\cong\Hom_{\cat{PSh}(\Bb)}(\Ff,\Gg|_\Bb)\;.
        \end{align*}
        In other words, $L=(-)^\sh\colon \cat{PSh}(\Bb) \to \cat{Sh}(X)$ and $R=(-)|_\Bb\colon \cat{Sh}(X) \to \cat{PSh}(\Bb)$ is an \emph{adjoint pair of functors} (cf.\ Definition~\reff{def:adjointFunctors}).
    \end{rem}
    \begin{defi}[Direct image] \lbl{def:directImage}
        Let $X\morphism[f] Y$ be a continuous map.  The \defemph{direct image} $f_*\Gg$ of a presheaf $\Gg$ on $X$  is the presheaf on $Y$ defined by 
        \begin{align*}
            f_*\Gg(W) = \Gg(f^{-1}(W))
        \end{align*}
        for open subsets $W\subseteq Y$, where the restriction $(-)|_V$ in $f_*\Gg$ is defined as $(-)|_{f^{-1}(V)}$ in $\Gg$. If $\Ff\morphism[\alpha] \Gg$ is a morphism of presheaves on $X$, we define $f_*\alpha\colon f_*\Ff\morphism f_*\Gg$ by 
        \begin{align*}
        	f_*\Ff(W) = \Ff(f^{-1}(W)) \morphism[\alpha] \Gg(f^{-1}(W)) = f_*\Gg(W)\;.
        \end{align*}
    \end{defi}
    \begin{fact}
    	It is easy to see that the axioms of a presheaf hold for $f_*\Gg$ that $f_*\alpha$ is indeed a morphism of presheaves, that $f_*$ is a functor and $g_*f_* = (gf)_*$. Also, $\id_*$ is the identity functor.
    \end{fact}
    \begin{varthm}{defi}
        If $\Bb_Y$ is a topology base for $Y$ and $\Bb_X\supseteq f^{-1}(\Bb_Y) = \left\{f^{-1}(U) \st U\in\Bb\right\}$ a topology base of $X$ (we possibly need to extend $f^{-1}(\Bb_Y)$ to obtain a topology base of $X$), then we have $\cat{PSh}(\Bb_X) \morphism[f_*]\cat{PSh}(\Bb_Y)$ defined in the same way and with similar properties.
    \end{varthm}
    \begin{rem}\lbl{rem:pullbackthingyAtStalks}
        Obviously we have a morphism
        \begin{align} \lbl{eq:four}
	        \begin{split}
		        f_x^*\colon (f_* \Ff)_{f(x)} &\morphism \Ff_x\\
		        \left(
		        \begin{array}{c}
			        \text{image of }(W,\phi)\text{, where}\\
			        \phi\in f_*\Ff(W)\text{, in }(f_*\Ff)_{f(x)}
		        \end{array}\right)&\longmapsto\left(
		        \begin{array}{c}
			        \text{image of}\\
			        \big(f^{-1}(W),\phi\big)\text{ in }\Ff_x
		        \end{array}\right)
	        \end{split}            
        \end{align}
        defined by mapping the image of $(W,\phi(f_*\Ff)(W))$ in $(f_* \Ff)(W)$ to the image of $(f^{-1}(W),\phi)$ in $\Ff_x$. This is a natural transformation, since
        \begin{diagram*}
        	\node[ob](f*F) at (0,1.5) {$(f_*\Ff)_{f(x)}$};
        	\node[ob](Fx) at (0,0) {$\Ff_x$};
        	\node[ob](f*G) at (3,1.5) {$(f_*\Gg)$\rlap{$_{f(x)}$}};
        	\node[ob](Gx) at (3,0) {$\Gg_x$};
        	\scriptsize
        	\draw[->] (f*F) -- (Fx) node[pos=0.5, left] {$f_x^*$};
        	\draw[->] (f*F) -- (f*G) node[pos=0.5, above] {$(f_*\alpha)_{f(x)}$};
        	\draw[->] (f*G) -- (Gx) node[pos=0.5, right] {$f_x^*$};
        	\draw[->] (Fx) -- (Gx) node[pos=0.5, above] {$\alpha_x$};
        \end{diagram*}
        commutes for any morphism $\Ff\morphism[\alpha] \Gg$ of presheaves. Also, the diagram
        \begin{diagram*}
        	\node[ob](f*F) at (0,1.5) {$(g_*f_*\Ff)_{g(f(x))}$};
        	\node[ob](Fx) at (0,0) {$(f_*\Ff)_{f(x)}$};
        	\node[ob](f*G) at (3,1.5) {$\big((gf)_*\Ff\big)$\rlap{$_{(gf)(x)}$}};
        	\node[ob](Gx) at (3,0) {$\Ff_x$};
        	\scriptsize
        	\draw[transform canvas={yshift=1pt}] (f*F) -- (f*G);
        	\draw[transform canvas={yshift=-1pt}] (f*F) -- (f*G);
        	\draw[->] (f*F) -- (Fx) node[pos=0.5, left] {$g_{f(x)}^*$};
        	\draw[->] (f*G) -- (Gx) node[pos=0.5, right] {$(gf)_x^*$};
        	\draw[->] (Fx) -- (Gx) node[pos=0.5, above] {$f_x^*$};
        \end{diagram*}
        commutes. And $(f_*\Ff)_{f(x)} \morphism[f^*] \Ff_x$ equals $\id_{\Ff_x}$ when $f=\id_X$.
    \end{rem}
    \begin{rem}[about $f^\flat/f^\sharp$]
        If $X\morphism[f] Y$ is continuous and $\Gg$ a presheaf (of sets, (abelian) groups, (commutative) rings) on $Y$ one defines
        \begin{align*}
            f^\flat\Gg(U) = \colimit[W\supseteq f(U)] \Gg(W)=\left\{(W,\gamma)/_\sim\st
            \begin{array}{c}
	            W\subseteq Y\text{ open, }W\supseteq f(U)\text{, }\gamma\in \Gg(W)\\
	            \text{and }(W,\gamma)\sim (V,\eta)\text{ iff there's an open set }\Omega\\
	            \text{such that }f(U)\subseteq \Omega\subseteq V\cap W\text{ and }\gamma|_\Omega=\eta|_\Omega
            \end{array}\right\}
        \end{align*}
        Restriction to $V\subseteq U$ maps $(W,\gamma)/_\sim$ to $(W,\gamma)/_\approx$ where $\approx$ is the equivalence relation for the definition of $f^\flat \Gg(V)$. 
        
        Let $f^\sharp \Gg=(f^\flat\Gg)^\sh$. If turns out that $\cat{PSh}(Y)  \morphism[f^\flat] \cat{PSh}(X)$ is left-adjoint to $\cat{PSh}(X) \morphism[f_*] \cat{PSh}(Y)$ and $\cat{Sh}(Y)  \xrightarrow{f^\sharp = f^\flat(-)^\sh} \cat{Sh}(X)$ is a left-adjoint functor to $\cat{Sh}(X) \morphism[f_*] \cat{Sh}(Y)$.
    \end{rem}
    \begin{example}
        \begin{alphanumerate}
          \item 
            If $f(U)$ is open in $Y$, then $(f^\flat\Gg)(U) = \Gg(f(U))$.
          \item 
            If $f(U)$ is open for any open subset $U$ (i.e., if $f$ is an open map) then \itememph{a} is a complete description of $f^\flat$.
          \item 
            If $f\colon X\to \{*\}$ is the projection to the one-point space and the category $\cat{Sh}(\{*\})$ of sheaves on $\{*\}$ with values in the category ${\cat A}$ of sets, abelian groups, rings, etc, is identified with ${\cat A}$ and $A\in\Ob({\cat A})$, then 
            \begin{align*}
                \big(f^\flat(A)\big)(U) &= \begin{cases} A &\text{if }U\neq\emptyset\\ 0 &\text{if } U= \emptyset \end{cases}\\
                \big(f^\sharp(A)\big)(U) &= \left\{f\colon U \to \{0,A\}\st f \text{ is locally constant}\right\}\;.
            \end{align*}
          \item 
            If $V\morphism[f] Y$ is the embedding of an open subset then $f^\flat \Gg(U) = \Gg(U)$ for open $U\subseteq V$. In other words, $f^\flat \Gg = \Gg|_V$ and the sheaf property is preserved. Thus, $f^\sharp \Gg = \Gg|_V$ if $\Gg$ is a sheaf.
          \item 
            If $\{x\} \morphism[\iota] X$ is the inclusion of a point then 
            \begin{align*}
                \iota^\flat\Gg(U) = \begin{cases} \Gg(\emptyset) & \text{if }U = \emptyset \\ \Gg_x&\text{if }U = \{x\}\end{cases}
            \end{align*}
            which is a sheaf if $\Gg$ is. Thus, $\iota^\sharp\Gg$ can be identified, under the identification of $\cat{Sh}(\{x\})$ with ${\cat A}$ made in \itememph{c}, with $\Gg_x$.
        \end{alphanumerate}
    \end{example}

\section{Locally ringed spaces}\lbl{sec:locRingedSpaces}
\subsection{Definition and basic properties}
\begin{defi}[Ringed space]\lbl{def:ringedSpace}
    A \defemph{ringed space} is a pair $(X,\Oo_X)$ consisting of a topological space $X$ and a \emph{structure sheaf} which is a sheaf of rings. A \defemph{locally ringed space} is ringed space $(X,\Oo_X)$ such that for any $x\in X$, the stalk $\Oo_{X,x}$ is a local ring, called the \emph{local ring of $X$ at} $x$. Its maximal ideal is denoted $\mm_{X,x}\subseteq \Oo_{X,x}$, or sometimes just $\mm_x$. Finally, let $\KK(x) = \Oo_{X,x}/\mm_x$ be the residue field.
\end{defi}
\begin{rem}
    Obviously, prevarieties (in the sense of Definition \reff{def:preVarieties}) are locally ringed spaces, $\Oo_{X,x}$ is the ring of germs of regular functions at $x$ and $\mm_x = \left\{f\in \Oo_{X,x} \st f(x) = 0 \right\}$.
\end{rem}
\begin{defi}[Morphism of ringed spaces] \lbl{def:ringedSpaceMorphism}
    A \defemph{morphism of ringed spaces} $X\morphism[f] Y$ is a pair $(f_{\mathrm{Top}}, f^*)$ where $X\xrightarrow{f_{\mathrm{Top}}} Y$ is a continuous map and $\Oo_Y \morphism[f^*] (f_{\mathrm{Top}})_*\Oo_X$ is a morphism of sheaves of rings (the index $_{\mathrm{Top}}$ will be dropped very soon so that $(f_{\mathrm{Top}})_*$ becomes only $f_*$). We call $f_{\mathrm{Top}}$ the \emph{topological} and $f^*$ the \emph{algebraic component} of $f$. 
    
    The identity on $(X,\Oo_X)$ is $\id_{(X,\Oo_X)} = (\id_X, \id_{\Oo_X})$. If $Y\morphism[g]Z$ is another morphism of ringed spaces, the composition $gf$ is given by $(gf)_{\mathrm{Top}} = g_{\mathrm{Top}} f_{\mathrm{Top}}$ and $(gf)^*$ is the composition 
    \begin{align*}
        \Oo_Z \morphism[g^*] g_*\Oo_Y \xrightarrow{g_*(f^*)} g_*f_*\Oo_X = (gf)_*\Oo_X
    \end{align*} 
    It is easy to see that this defines a \emph{category of ringed spaces}.
\end{defi}

\begin{rem*}
    Locally ringed spaces will be a subcategory of it, but not a \emph{full} subcategory (cf.\ Definition~\reff{def:subcategory}\itememph{b}).
\end{rem*}
\begin{rem*}
    As $f^\sharp$ is left-adjoint to $f_*$ (to be precise, we're actually considering  $(f_{\mathrm{Top}})_*$ and $(f_{\mathrm{Top}})^\sharp$), giving $f^*\colon \Oo_Y\to f_*\Oo_X$ is equivalent to giving a morphism $f^\sharp \Oo_Y \to \Oo_X$ which is also denoted by $f^*$. Using this type of $f^*$ we would still arrive at the same category, up to unique isomorphism of the sets of morphisms. In particular, we have 
    \begin{align*}
    	\Oo_{Y,f_{\mathrm{Top}}(x)} \cong \iota_{\{f_{\mathrm{Top}}(x)\}}^\sharp \Oo_Y = \iota_{\{x\}}^\sharp \big(f^\sharp \Oo_Y\big)  \xrightarrow{i^\sharp_{\{x\}}f^*} \iota^\sharp_{\{x\}} \Oo_X \cong \Oo_{X,x}\;. 
    \end{align*}
    This yields a morphism $\Oo_{Y,f_{\mathrm{Top}}(x)} \morphism[f^*] \Oo_{X,x}$. Herein, $\iota_{\{x\}}$ and $\iota_{\{f_{\mathrm{Top}}(x)\}}$ denote the inclusions $\{x\}\monomorphism X$ respectively $\{f_{\mathrm{Top}}(x)\}\monomorphism Y$. The equality $\iota_{\{f_{\mathrm{Top}}(x)\}}^\sharp \Oo_Y = \iota_{\{x\}}^\sharp \big(f^\sharp \Oo_Y\big)$ follows from the fact that $\Oo_Y$ and $f^\sharp\Oo_Y$ have the same stalk at $f_{\mathrm{Top}}(x)$, namely $\Oo_{Y,f_{\mathrm{Top}}(x)}$ (quite easy to check). The arrow $\iota_{\{x\}}^\sharp f^*$ should be read as the functor $\iota_{\{x\}}^\sharp\colon\cat{Sh}(X)\morphism\cat{Sh}(\{x\})$ applied to the morphism $f^*\colon f^\sharp\Oo_Y\morphism\Oo_X$.
    
    This may be described directly in terms of structures occurring in Definition~\reff{def:ringedSpace}:
\end{rem*}
\begin{varthm}{defi}\lbl{def:f*onStalks}
    For $f\colon X\to Y$ a morphism of ringed spaces, we define $\Oo_{Y,f_{\mathrm{Top}}(x)} \morphism[f^*]\Oo_{X,x}$ as the unique morphism such that
    \begin{diagram*}
    	\node[ob](a) at (0,1.5) {$\Oo_Y(U)$};
    	\node[ob](c) at (0,0) {$\Oo_{Y,f_{\mathrm{Top}}(x)}$};
    	\node[ob](b) at (2.5,1.5) {$f_*\Oo_X(U)\ \rlap{$\left(=\Oo_X\big(f^{-1}U\big)\right)$}$};
    	\node[ob](d) at (2.5,0) {$\Oo_{X,x}$};
    	\scriptsize
    	\draw[->] (a) -- (b) node[pos=0.5, above] {$f^*$};
    	\draw[->] (a) -- (c);
    	\draw[->] (c) -- (d) node[pos=0.5, above] {$f^*$};
    	\draw[->] (b) -- (d);
    \end{diagram*}  
    commutes. We can characterize $\Oo_{Y,f_{\mathrm{Top}}(x)} \morphism[f^*]\Oo_{X,x}$ explicitly as the composition
    \begin{align*}
        \Oo_{Y,f_{\mathrm{Top}}(x)} \xrightarrow{(f^*)_{f_{\mathrm{Top}}(x)}} (f_*\Oo_X)_{f_{\mathrm{Top}}(x)}\xrightarrow{(f_{\mathrm{Top}})_x^*} \Oo_{X,x}\;.
    \end{align*}
    As you might have noticed, the symbol $*$ is \emph{massively} overloaded and deserves a careful explanation: The left arrow in the above composition means the stalk at $f_{\mathrm{Top}}(x)$ of the \emph{algebraic component} $f^*$ of $f$. The right arrow is the kind of morphism of stalks we defined in Remark~\reff{rem:pullbackthingyAtStalks}, \eqreff{eq:four}.
    
    The symbol $*$ in the index, however, always means the \emph{direct image} from Definition~\reff{def:directImage}.
\end{varthm}
\begin{defi}[Vanishing set]\lbl{def:vanishingSet}
    Let $X$ be a locally ringed space, $f\in \Oo_X(U)$, then we define its \defemph{vanishing set} by 
    \begin{align*}
        V(f) = \left\{x\in U\st \text{image of } f \text{ under } \Oo_X(U) \to \Oo_{X,x} \text{ is in } \mm_x\right\}.
    \end{align*}
\end{defi}
\begin{rem}
    \begin{alphanumerate}
      \item \lbl{rem:stuffAboutV(f)}
        In view of what was recalled for prevarieties, this extends our previous definition of $V(f)$ in that case.
      \item 
        $V(f)\cap V(g) \subseteq V(f+g)$ (as $\mm_x\subseteq \Oo_{X,x}$ is an ideal) and $V(fg)= V(f) \cup V(g)$ (as $\mm_x$ is a prime ideal) and $V(f|_W)=V(f)\cap W$ if $W\subseteq U$ is open (pretty obvious). 
    \end{alphanumerate}
\end{rem}
\begin{fact}
    For $f\in\Oo_X(U)$, $V(f)\subseteq U$ is closed. When $f$ is nilpotent, $V(f) = U$.
\end{fact}
\begin{proof}
    Let $x\in U\setminus V(f)$. The image of $\phi$ of $f$ in $\Oo_{X,x}$ has an inverse $\psi$ which is the image of $g\in \Oo_X(W)$ where $W$ is an open neighbourhood of $x$. Replacing $W$ by $W\cap U$ and $g$ by $g|_{W\cap U}$  we may assume $W\subseteq U$, and shrinking $W$ further (using the definition of stalk) we may assume $f|_W\cdot g = 1$ in $\Oo_X(W)$. For $y\in W$ the image of $f$ in $\Oo_{X,y}$ has an inverse given by $g$, hence it is not in $\mm_y$. Thus, $W\cap V(f) = \emptyset$. Since such $W$ may be found for any $x\in U\setminus V(f)$, $U\setminus V(f)$ is open.
    
    If $f$ is nilpotent, say, $f^n=0$, then $U=V(0)=V(f^n)=\bigcup_{i=1}^nV(f)=V(f)$ by Remark~\reff{rem:stuffAboutV(f)}\itememph{b}.
\end{proof}
\begin{defi}
    \begin{alphanumerate}
        \item \lbl{def:localMorphisms}
            Let $(R,\mm_R)$ and $(S,\mm_S)$ be local rings with their respective maximal ideals. A ring homomorphism $R\morphism[\phi] S$ is \defemph{local} iff $\phi^{-1}(\mm_S) = \mm_R$.
        \item 
            A \defemph{morphism of locally ringed spaces} is a morphism $X\morphism[f] Y$ of ringed spaces such that $X$ and $Y$ are locally ringed spaces and such that the following equivalent conditions hold
            \begin{itemize}
              \item[\itememph{\alpha}]
                For any open subset $U\subseteq Y$ and $\lambda\in \Oo_Y(U)$ we have $V(f^*\lambda) = f^{-1}\big(V(\lambda)\big)$.
              \item[\itememph{\beta}]
                For arbitrary $x\in X$, the ring morphism $\Oo_{Y,f(x)} \morphism[f^*]\Oo_{X,x}$ is local in the sense of \itememph{a}.
            \end{itemize}

    \end{alphanumerate}
\end{defi}
\begin{rem}
    \begin{alphanumerate}
      \item \lbl{rem:localMorphismStuff}
        A composition of local ring morphisms is local.
      \item 
        Note that for a ring morphism $R\morphism[\phi]S$ where $R$ and $S$ are local, we automatically have that $\phi^{-1}(\mm_S) \subseteq \mm_R$ as $\phi$ maps $R^\times = R\setminus \mm_R$ to $S^\times = S\setminus \mm_S$. Thus, to verify that $\phi$ is local it is only necessary to show $\phi(\mm_R) \subseteq \mm_S$.
      \item 
        It is obvious that a composition of morphisms of locally ringed spaces is a morphism of locally ringed spaces. Also, $\id_X$ is a morphism of locally ringed spaces. Thus, locally ringed spaces form a subcategory (but not a full subcategory) of the category of ringed spaces.
    \end{alphanumerate}
\end{rem}
\begin{proof}[Proof of Definition~\reff{def:localMorphisms}]
	We first prove \itememph{\beta} $\Rightarrow$ \itememph{\alpha}.  Let \itememph{\beta} hold for given $X\morphism[f] Y$ of ringed spaces, with $X$ and $Y$ locally ringed, then in the situation of \itememph{\alpha} we have
	\begin{align*}
		V(f^*\lambda) &\overset{\hphantom{\text{Def.~\reff{def:f*onStalks}}}}{=} \left\{x\in f^{-1}(U) \st (\text{image of } f^*\lambda \text{ in } \Oo_{X,x}) \in \mm_{X,x}\right\}\\
		&\overset{\text{Def.~\reff{def:f*onStalks}}}{=} \left\{x\in f^{-1}(U) \st f^*(\text{image of }\lambda \text{ in } \Oo_{X,x})  \in \mm_{X,x}\right\}\\
		&\overset{\hphantom{\text{Def.~\reff{def:f*onStalks}}}}{\overset{\text{\itememph{\beta}}}{=}}\left\{x\in f^{-1}(U) \st (\text{image of }\lambda \text{ in } \Oo_{Y,f(x)})  \in \mm_{Y,f(x)}\right\}\\
		&\overset{\hphantom{\text{Def.~\reff{def:f*onStalks}}}}{=} \left\{x\in f^{-1}(U)\st f(x)\in V(\lambda) \right\}\\
		&\overset{\hphantom{\text{Def.~\reff{def:f*onStalks}}}}{=} f^{-1}(V(\lambda))\;.              
	\end{align*}
	To prove \itememph{\alpha} $\Rightarrow$ \itememph{\beta}, let $x\in X$, $y=f(x)$, $\ell\in\mm_{Y,y}$. We need to show $f^*\ell\in\mm_{X,x}$. There are an open neighbourhood $U$ of $y$ and $\lambda\in \Oo_Y(U)$ such that $\ell$ is the image of $\lambda$ in $\Oo_{Y,y}$. Then $y\in V(\lambda)$, hence $x\in f^{-1}(V(\lambda)) = V(f^*\lambda)$. Thus $f^*\ell$ is in $\mm_{X,x}$ as it is the image of $f^*\lambda$ in $\Oo_{X,x}$.
\end{proof}
\begin{fact}
    \begin{alphanumerate}
        \item \lbl{fact:localMorphisms}
            We have $f^{-1}(V(\lambda)) = V(f^*\lambda)$ when $f$ is a morphism of locally ringed spaces.
        \item 
            Let $f\colon X\morphism Y$ be a morphism in $\cat{LRS}$ (the category of locally ringed spaces), $x\in X$, $y=f(x)$. Since $f^*(\mm_{Y,y})\subseteq \mm_{X,x}$, we have a ring morphism of the residue fields 
            \begin{align*}
            	\KK(y) \morphism[f^*]\KK(x)
            \end{align*}
            induced by $\Oo_{Y,y}\morphism[f^*] \Oo_{X,x}$. If $Y\morphism[g] Z$ is another morphism in $\cat{LRS}$ and $z=g(y)$, then 
            \begin{diagram*}
            	\node[ob](kz) at (0,1.25) {$\KK(z)$};
            	\node[ob](kx) at (1.25,0) {$\KK(x)$};
            	\node[ob](ky) at (2.5,1.25) {$\KK(y)$};
            	\scriptsize
            	\draw[->] (kz) -- (kx) node[pos=0.5,below left] {$(gf)^*$};
            	\draw[->] (kz) -- (ky) node[pos=0.5,above] {$g^*$};
            	\draw[->] (ky) -- (kx) node[pos=0.5,below right] {$f^*$};
            \end{diagram*}
            commutes.
            \item Let $R,S,T$ be local rings with maximal ideals $\mm_R,\mm_S,\mm_T$ and $R\morphism[\rho]S\morphism[\sigma]T$ (not necessarily local) morphism of rings.
            \begin{rmnumerate}
            	\item If $\rho$ and $\sigma$ are local, then so is $\sigma\rho$.
            	\item If $\sigma\rho$ is local, then so is $\rho$. Note that in the lecture we made the additional but \emph{unnecessary} assumption that $\sigma$ must be local as well.
            	\item If $\sigma\rho$ is local and $\rho$ is surjective, then $\sigma$ is local.
            \end{rmnumerate}
            \item Let $X\morphism[f]Y\morphism[g]Z$ be morphisms in the category of ringed spaces, where $X,Y,Z$ are locally ringed.
            \begin{rmnumerate}
            	\item If $f$ and $g$ are morphisms of locally ringed spaces, then so is $gf$.
            	\item If $gf$ is a morphism of locally ringed spaces and $X\morphism[f_{\mathrm{Top}}] Y$ is surjective, then $g$ is a morphism of locally ringed spaces. As in \itememph{c}, in the lecture we made the unnecessary assumption that $f$ is a morphism of locally ringed spaces as well.
            	\item If $gf$ is a morphism of locally ringed spaces and $g^*\colon\Oo_{Z,z}\morphism\Oo_{Y,y}$ is surjective for all $y\in Y$ and $z=g(y)$, then $f$ is a morphism of locally ringed spaces.
            \end{rmnumerate}
    \end{alphanumerate}
\end{fact}
\begin{proof}
	Part \itememph{a} is just \itememph{\alpha} from Definition~\reff{def:localMorphisms}\itememph{b}, in case you didn't notice. And \itememph{b} immediately follows from the fact that $\Oo_{Z,z}\morphism[g^*]\Oo_{Y,y}\morphism[f^*]\Oo_{X,x}$ equals $\Oo_{Z,z}\morphism[(gf)^*]\Oo_{X,x}$ by Remark~\reff{rem:pullbackthingyAtStalks}.
	
	Now about part \itememph{c}. Point (i) is trivial. For (ii), note that $\sigma^{-1}(\mm_T)\subseteq\mm_S$ by Remark~\reff{rem:localMorphismStuff}\itememph{b}, hence
	\begin{align*}
		\rho^{-1}(\mm_S) \supseteq \rho^{-1}\big(\sigma^{-1}(\mm_T)\big) = (\sigma\rho)^{-1} (\mm_T) = \mm_R
	\end{align*}
	since $\sigma\rho$ is local. On the other hand, $\rho^{-1}(\mm_S)\subseteq \mm_R$ (again by Remark~\reff{rem:localMorphismStuff}\itememph{b}), proving $\rho^{-1}(\mm_S)=\mm_R$, that is, $\rho$ is local.
	
	For point (iii), we may assume that $S=R/I$ for some proper ideal $I\subseteq R$. Then $I\subseteq\mm_R$, hence $\mm_R\morphism \mm_S=\mm_R/I$ is surjective. We thus obtain
	\begin{align*}
		\sigma(\mm_S)=\sigma\big(\rho(\mm_R)\big)\subseteq\mm_T\;,
	\end{align*}
	the inclusion due to the fact that $\sigma\rho$ is local. This shows that $\sigma$ is local as well.
	
	Part \itememph{e} now reduces to \itememph{d} by considering $\Oo_{Z,z}\morphism[g^*]\Oo_{Y,y}\morphism[f^*]\Oo_{X,x}$, where $y=f(x)$, $z=g(y)$. Note that for (ii) we do need the extra condition that $X\morphism[\smash{f}_{\mathrm{Top}}]Y$ is surjective, otherwise we wouldn't know anything about the $y\not\in f_{\mathrm{Top}}(X)$.
\end{proof}
\begin{fact}\lbl{fact:surjectiveImpliesLocal}
    If $R\morphism[\phi]S$ is a surjective ring homomorphism where $(R,\mm_R)$ and $(S,\mm_S)$ are local rings, then $\phi$ is local.
\end{fact}
\begin{proof}
	Since $\phi$ is surjective, it induces an isomorphism $\ov{\phi}\colon R/\ker\phi\isomorphism S$. As local rings are forbidden to be the zero ring, $\ker\phi$ must be a proper ideal of $R$ and hence contained in $\mm_R$. Then $\phi$ maps $\mm_R$ to $\mm_R/\ker\phi=\mm_S$.
\end{proof}
\begin{example}
    Let $U\subseteq X$ be an open subset, let $\iota\colon U\morphism X$ its embedding, where $(X,\Oo_X)$ is a locally ringed space, and let $\Oo_U = \Oo_X|_U$. Let $\iota^*\colon \Oo_X(V)\morphism \Oo_X(U\cap V) = \Oo_X(\iota^{-1}(V))$ be given by $(-)|_{U\cap V}\colon \Oo_X(V) \morphism \Oo_X(U\cap V)$. It follows that $\Oo_{X,x}\morphism[\iota^*]\Oo_{U,x}$, for $x\in U$, is an isomorphism (the canonical isomorphism $(\Oo_X|_U)_x \isomorphism \Oo_{X,x}$), hence local. Hence $\iota$ is a morphism in $\cat{LRS}$, and
    \begin{align}\lbl{eq:fact5}
	    \begin{split}
		    \Hom_{\cat{LRS}}(T,U)  &\isomorphism\left\{g\in \Hom_{\cat{LRS}} (T,X) \st g(T)\subseteq U\right\}\\
		    f&\longmapsto g=\iota f
	    \end{split}\tag{Fact 5}
    \end{align}
\end{example}
\begin{fact}
    If $X\morphism[\iota] Y$ is a morphism in $\cat{LRS}$ such that $\iota_{\mathrm{Top}}$ is an injective map and such that for any $x\in X$, $\iota_x^*\colon \Oo_{Y,\iota(x)} \morphism \Oo_{X,x}$ is surjective, then $\iota$ is a monomorphism in $\cat{LRS}$.
\end{fact}
\begin{proof}
	It suffices to note that $\iota_{\mathrm{Top}}$ is a monomorphism of topological spaces and $\iota^*$ an epimorphism of sheaves on $Y$ (since it stalk-wise an epimorphism).
\end{proof}
\subsection{Construction of equalizers}
\begin{prop}\lbl{prop:equalizerLRS}
    Let $X\doublemorphism[a][\smash{b}] Y$ be morphisms in $\cat{LRS}$. Then an equalizer of these morphisms is given as follows
    \begin{itemize}
      \item 
        Let 
        \begin{align*}
        	K = \left\{ x\in X\st 
        	\begin{array}{c}
	        	a(x) = b(x) \text{ and }\KK(y) \doublemorphism[a^*][b^*] \KK(x)\text{ (the morphisms induced}\\
	        	\text{on the residue fields) coincide, where }y\coloneqq a(x)=b(x)
        	\end{array}\right\}\;,
        \end{align*}
        equipped with the subspace topology induced from $X$.
      \item 
        Let $\Oo_{K,[k]} = \Coeq\Big(\Oo_{Y,y} \doublemorphism[a^*][b^*] \Oo_{X,k}\Big)$ where $y=a(k) = b(k)$. The square brackets are to indicate that we do not yet know if the pretender stalk $\Oo_{K,[k]}$ is really the stalk at $k$ of the yet-to-define structure sheaf $\Oo_K$ (spoiler: it is).
      \item 
        Let for open $U\subseteq K$ 
        \begin{align*}
            \Oo_K(U) = \left\{(f_k)\in \prod_{k\in U} \Oo_{K,[k]} \st \begin{array}{c}
                \text{for every } \ell\in U, \text{ there are an open neighbourhood } \\
                \ell\in V \subseteq X \text{ and } \phi\in\Oo_X(V) \text{ such that for every } \\
                k\in U\cap V, f_k \text{ is equal to the image of }\phi\text{ under }\\
                \Oo_X(V) \morphism \Oo_{X,k} \morphism\Oo_{K,[k]}
            \end{array}
            \right\}\;.
        \end{align*}
        The ring operations $*\in\{+,\cdot\}$ on $\Oo_K(U)$ are defined component-wise via  
        \begin{align*}
            (f_x)_{x\in U} * (g_x)_{x\in U} = (f_x* g_x)_{x\in U}\;.
        \end{align*}        
        \item The morphism $K\morphism[\kappa] X$ is given by the inclusion $K\subseteq X$ and $\kappa^*\colon \Oo_X\morphism\kappa_*\Oo_K$ is defined as follows: For $\phi\in\Oo_X(U)$, define
       \begin{align*}
       	\kappa^*(\phi)=\left(
       	\begin{array}{c}
	       	\text{image of }\phi\text{ under the composition}\\
	       	\Oo_X(U) \morphism \prod_{x\in U\cap K} \Oo_{X,x} \morphism \prod_{x\in (U\cap K)} \Oo_{K,[x]}
       	\end{array}\right)\in\Oo_K(K\cap U)=\kappa_*\Oo_K(U)\;.
       \end{align*} 
    \end{itemize}
    Moreover, we have an isomorphism
    \begin{align*}
    \Oo_{K,k} &\isomorphism \Oo_{K,[k]}\\
    (U,(f_\ell)_{\ell\in U})/_\sim &\longmapsto f_k
    \end{align*}
\end{prop}
\begin{proof}
    The following steps are rather trivial:
    \begin{itemize}
      \item 
        $K$ is a topological space, $\kappa$ is continuous, $\Oo_{K,[k]}$ is a local ring (by Fact~\reff{fact:coequalizerOfRings} about coequalizers of local ring morphisms, also see exercise sheet \#5), and $\Oo_{X,k} \morphism \Oo_{K,[k]}$ is local (it is, in fact, a quotient projection, i.e., surjective).
      \item 
        $\Oo_K$ is a sheaf of rings and $\kappa^*\colon \Oo_X \morphism \kappa_*\Oo_K$ is a morphism of sheaves of rings.
    \end{itemize} 
	We divide the non-trivial part of the proof into several steps.\newpage

    \emph{Step 1.} We start proving that $\Oo_{K,k}\isomorphism\Oo_{K,[k]}$ is indeed an isomorphism. 
    
    To show injectivity of $\Oo_{K,k}\morphism\Oo_{K,[k]}$, let $U\subseteq K$ be an open neighbourhood of $k$ and let $f= (f_\ell)_{\ell\in U} \in \Oo_K(U) \subseteq \prod_{\ell\in U} \Oo_{K,[\ell]}$ be such that $f_k$ vanishes. We have to show that the image if $f$ in $\Oo_{K,k}$ vanishes. By the coherence condition for sections of $\Oo_K$, there are an open neighbourhood $V$ of $k$ in $X$ and $\phi\in \Oo_X(V)$ such that 
    \begin{align*}
    	f_\ell=\left(
    	\begin{array}{c}
	    	\text{image of }\phi\text{ under }\\
	    	\Oo_X(V) \morphism\Oo_{X,\ell} \morphism\Oo_{K,[\ell]} 
    	\end{array}\right)\quad\text{for }\ell\in U\cap V\;.
    \end{align*}
    Shrinking $U$ if necessary, we may assume $V\cap K \supseteq U$. Let $\phi_k$ be the image of $\phi$ in $\Oo_{X,k}$ and  $y=a(k)=b(k)$. By  Fact~\reff{fact:coequalizerOfRings} we have $\Oo_{K,[k]}=\Oo_{X,k}/I$, where $I$ is the ideal $I=\left(a^*(v)-b^*(v)\st v\in \Oo_{Y,y}\right)\subseteq\Oo_{X,k}$. As we assume that $f_k$ vanishes,
    \begin{align*}
    	0 = f_k=(\phi_k\bmod I)\in\Oo_{K,[k]}=\Oo_{X,k}/I\;, 
    \end{align*}
    hence we have $\rho_1,\ldots,\rho_N\in \Oo_{X,k}$ and $v_1,\ldots,v_N\in \Oo_{Y,y}$ such that
    \begin{align*}
        \phi_k = \sum_{i=1}^N \rho_i\big(a^*(v_i) -b^*(v_i)\big)\;.
    \end{align*}
    By the definitions of $\Oo_{X,k}$ and $\Oo_{Y,y}$ there are open neighbourhoods $W$ and $\Omega_1,\ldots,\Omega_N$ of $k$ in $X$ and $r_i \in \Oo_X(\Omega_i)$ such that $\rho_i = (r_i)_k$. Moreover, there are open neighbourhoods $\Theta_1,\ldots,\Theta_N$ of $y$ in $Y$ and $y_i \in \Oo_Y(\Theta_i)$ satisfying $(y_i)_y = v_i$, such that 
    \begin{align*}
        W\subseteq V\cap \bigcap_{i=1}^N \Omega_i \cap\bigcap_{i=1}^N \left(a^{-1}(\Theta_i) \cap b^{-1}(\Theta_i)\right)
    \end{align*}
    and finally
    \begin{align*}
        \phi|_W = \sum_{i=1}^N r_i|_W \cdot \left(a^*(y_i)|_W -b^*(y_i)|_W\right).
    \end{align*}
    For $\ell\in W\cap K$, $\phi_\ell$ is the image of the above expression in $\Oo_{X,\ell}$, hence 
    \begin{align*}
        \phi_\ell\in \left(a^*(v) -b^*(v)\st v\in \Oo_{Y,a(\ell)} = \Oo_{Y,b(\ell)}\right)_{\Oo_{X,\ell}}
    \end{align*}
    and $f_\ell =0$ as $\Oo_{K,[\ell]}$ is the quotient of $\Oo_{X,\ell}$ by the ideal on the right-hand side. Thus, $f|_{U\cap W} =0$, proving the injectivity claim.
	
	Surjectivity is somewhat easier. Let $\gamma\in\Oo_{K,[k]}$, and choose a preimage $\gamma'\in\Oo_{X,k}$ of $\gamma$ under the quotient projection $\Oo_{X,k}\morphism\Oo_{K,[k]}=\Oo_{X,k}/I$. There are an open neighbourhood $k\in V\subseteq X$ and $\phi\in\Oo_X(V)$ such that $\gamma'$ is the image of $\phi$ in $\Oo_{X,k}$. Let $U=V\cap K$ and $f=\kappa^*\phi\in\kappa_*\Oo_K(V)=\Oo_K(V\cap K)=\Oo_K(U)$, then the component $f_k$ of $f$ at $k$ equals
	\begin{align*}
		f_k=\left(
		\begin{array}{c}
			\text{image of }\phi\text{ under}\\
			\Oo_X(V)\morphism\Oo_{X,k}\morphism\Oo_{K,[k]}
		\end{array}\right)=\left(
		\begin{array}{c}
			\text{image of }\gamma'\text{ under}\\
			\Oo_{X,k}\morphism\Oo_{K,[k]}
		\end{array}\right)=\gamma\;,
	\end{align*}
	proving surjectivity.
	
	Hence, $(K,\Oo_K)$ is a locally ringed space and $\kappa$ is a morphism of locally ringed spaces. Indeed, $\kappa$ is a morphism of ringed spaces and $\Oo_{X,k}\morphism[\kappa^*]\Oo_{K,k}\cong\Oo_{X,k}/I$ is surjective and thus local by Fact~\reff{fact:surjectiveImpliesLocal}.
	
	\emph{Step 2.} We check that $K\morphism[\kappa]X$ equalizes $X\doublemorphism[a][\smash{b}]Y$.
	
	The fact that $a\kappa=b\kappa$ is a trivial consequence of the definition of $K$ as far as only the topological component is concerned. For the algebraic component, let $V\subseteq Y$ be open, $U=a^{-1}(V)\cap K=b^{-1}(V)\cap K$ and let $\lambda\in\Oo_K(V)$. We need to show that $\kappa^*a^*\lambda=\kappa^*b^*\lambda$. Indeed, let $y=a(k)=b(k)$. Using that
	\begin{diagram*}
		\node[ob](a) at (0,1.5) {$\Oo_Y(V)$};
		\node[ob](c) at (0,0) {$\Oo_{Y,y}$};
		\node[ob](b) at (2.5,1.5) {$\Oo_X(a^{-1}V)\:\rlap{$=a_*\Oo_X(V)$}$};
		\node[ob](d) at (2.5,0) {$\Oo_{X,k}$};
		\scriptsize
		\draw[->] (a) -- (b) node[pos=0.5, above] {$a^*$};
		\draw[->] (a) -- (c);
		\draw[->] (c) -- (d) node[pos=0.5, above] {$a^*$};
		\draw[->] (b) -- (d);
	\end{diagram*}  
	commutes (analogously for $b$) and the fact that $\Oo_{Y,y}\doublemorphism[\smash{a^*}][\smash{b^*}]\Oo_{X,k}$ is coequalized by $\Oo_{X,k}\morphism\Oo_{K,[k]}$ we get
	\begin{align*}
		\kappa^*a^*\lambda&=\left(
		\begin{array}{c}
			\text{image of }a^*\lambda\text{ under}\\
			\Oo_X(a^{-1}V)\morphism\Oo_{X,k}\morphism\Oo_{K,[k]}
		\end{array}\right)_{k\in U}=\left(
		\begin{array}{c}
		\text{image of }\lambda\text{ under}\\
			\Oo_Y(V)\morphism\Oo_{Y,y}\morphism[a^*]\Oo_{X,k}\morphism\Oo_{K,[k]}
		\end{array}\right)_{k\in U}\\
		&=\left(
		\begin{array}{c}
		\text{image of }\lambda\text{ under}\\
		\Oo_Y(V)\morphism\Oo_{Y,y}\morphism[b^*]\Oo_{X,k}\morphism\Oo_{K,[k]}
		\end{array}\right)_{k\in U}=\left(
		\begin{array}{c}
		\text{image of }b^*\lambda\text{ under}\\
		\Oo_X(b^{-1}V)\morphism\Oo_{X,k}\morphism\Oo_{K,[k]}
		\end{array}\right)_{k\in U}\\
		&=\kappa^*b^*\lambda\;.
	\end{align*}
	
	\emph{Step 3.} The last thing to check is the universal property.
	
	Let $T\morphism[\tau]X$ be a morphism in the category of locally ringed spaces such that $a\tau=b\tau$. For $t\in T$ put $k=\tau(t)$ and we have $a(k)=b(k)\eqqcolon y$. Moreover, the compositions of pull-backs on residue fields
	\begin{align*}
		\KK(y)\doublemorphism[\smash{a^*}][\smash{b^*}]\KK(k)\morphism[\tau^*]\KK(t)
	\end{align*}
	must coincide with
	\begin{align*}
		\KK(y)\xrightarrow{(a\tau)^*=(b\tau)^*}\KK(t)\;.
	\end{align*}
	As $\KK(k)\morphism[\tau^*]\KK(t)$ is injective (any ring morphism between fields is injective), it follows that $\KK(y)\doublemorphism[a^*][b^*]\KK(k)$ coincide. Thus $k\in K$ by definition of $K$ and we obtain a map $T\morphism[\vartheta]K$ such that $\kappa(\vartheta(t))=\tau(t)$ and $a(\vartheta(t))=b(\vartheta(t))$ for $t\in T$. This map is continuous because $K$ carries the induced topology with respect to $X$ and for open subsets $V\subseteq X$, $\theta^{-1}(V\cap K)=\tau^{-1}(V)$ is open in $T$.
	
	Let $U\subseteq K$ be an open subset and $\lambda=(\lambda_k)_{k\in U}\in\Oo_K(U)\subseteq\prod_{k\in U}\Oo_{K,[k]}$. For $t\in T$ and $y=a(\vartheta(t))=b(\vartheta(t))$, the morphism $\Oo_{X,\vartheta(t)}\morphism[\tau^*]\Oo_{T,t}$ coequalizes the pair $\Oo_{Y,y}\doublemorphism[\smash{a^*}][\smash{b^*}]\Oo_{X,\vartheta(t)}$, hence factors over
	\begin{align*}
		\Oo_{X,\vartheta(t)}\morphism\Oo_{K,[\vartheta(t)]}\morphism[\vartheta^*_t]\Oo_{T,t}\;.
	\end{align*}
	We claim that
	\begin{align}\lbl{eq:bruteForcePullback}
		\vartheta^*\lambda=\left(\vartheta^*_t\left(\lambda_{\vartheta(t)}\right)\right)_{t\in\vartheta^{-1}U}\in\prod_{t\in\vartheta^{-1}U}\Oo_{T,t}\tag{$*$}
	\end{align}
	belongs to the image of $\Oo_T(\vartheta^{-1}U)$ in $\prod_{t\in\vartheta^{-1}U}\Oo_{T,t}$. Believing this for the moment, we finish the rest of the proof. From \eqreff{eq:bruteForcePullback} we obtain a morphism $\vartheta^*\colon\Oo_K(U)\morphism\Oo_T(\vartheta^{-1}U)$ such that the image of $\vartheta^*\lambda$ in $\prod_{t\in\vartheta^{-1}U}\Oo_{T,t}$ equals $\vartheta^*\lambda$. It is rather easy to show that $\vartheta^*\colon\Oo_K\morphism\vartheta_*\Oo_T$ is a morphism of sheaves of rings, thus turning $\vartheta$ into a morphism of ringed spaces satisfying $\tau=\kappa\vartheta$ (which may be easily checked on stalks). Since $\Oo_{X,k}\morphism[\kappa^*]\Oo_{K,k}\cong\Oo_{X,k}/I$ is surjective, Fact~\reff{fact:localMorphisms}\itememph{d}(iii) tells us that $\vartheta$ is indeed a morphism of locally ringed spaces.
	
	We need to show that $\vartheta$ is unique. As before, the topological component is easy: As $K\morphism[\kappa_{\mathrm{Top}}]X$ is injective, it follows that $\vartheta_{\mathrm{Top}}$ is uniquely determined by $\tau=\kappa\vartheta$. Now for the algebraic component. As $\Oo_{X,\kappa(\vartheta(t))}\morphism[\smash{\kappa^*}]\Oo_{K,\vartheta(t)}=\Oo_{K,\tau(t)}$ is surjective, it follows that $\vartheta^*\colon \Oo_{K,\vartheta(t)}\morphism\Oo_{T,t}$ is uniquely determined by $\tau$ and the commutativity of
	\begin{diagram*}
	   	\node[ob](kz) at (0,1.25) {$\Oo_{X,\kappa(\vartheta(t))}$};
	   	\node[ob](kx) at (1.25,0) {$\Oo_{T,t}$};
	   	\node[ob](ky) at (2.5,1.25) {$\Oo_{K,\tau(t)}$};
	   	\scriptsize
	   	\draw[->] (kz) -- (kx) node[pos=0.5,below left] {$\tau^*$};
	   	\draw[->] (kz) -- (ky) node[pos=0.5,above] {$\kappa^*$};
	   	\draw[->] (ky) -- (kx) node[pos=0.5,below right] {$\vartheta^*$};
	\end{diagram*}
	which again follows from $\tau=\kappa\vartheta$. As 
	\begin{diagram*}
		\node[ob](a) at (0,1.5) {$\Oo_K(U)$};
		\node[ob](c) at (0,0) {$\displaystyle\vphantom{\prod}\smash{\prod\limits_{k\in U}}\Oo_{K,k}$};
		\node[ob](b) at (3,1.5) {$\Oo_T(\vartheta^{-1}U)$};
		\node[ob](d) at (3,0) {$\displaystyle\vphantom{\prod}\smash{\prod\limits_{t\in \vartheta^{-1}U}}\Oo_{T,t}$};
		\scriptsize
		\draw[->] (a) -- (b) node[pos=0.5, above] {$\vartheta^*$};
		\draw[->] (a) -- (c);
		\draw[->] (c) -- (d) node[pos=0.5, above] {$\vartheta^*$};
		\draw[->] (b) -- (d);
	\end{diagram*}  
	commutes, it follows that $\vartheta^*\colon\Oo_K(U)\morphism\Oo_T(\vartheta^{-1}U)$ is also uniquely determined by this condition. Therefore, the algebraic component $\vartheta^*\colon\Oo_K\morphism\vartheta_*\Oo_T$ is also uniquely determined, which proves the universal property.
	
	\emph{Step 4.} It remains to verify \eqreff{eq:bruteForcePullback}, i.e., that the coherence condition characterizing the image of $\Oo_T(\vartheta^{-1}U)$ in $\prod_{t\in\vartheta^{-1}U}\Oo_{T,t}$ is satisfied. For this purpose let $z\in\vartheta^{-1}U$. By the coherence condition for $\lambda\in\Oo_K(U)$, there are an open neighbourhood $V$ of $\kappa(\vartheta(z))=\tau(z)$ in $X$ and $\ell\in\Oo_X(V)$ such that
	\begin{align*}
		\lambda_k=\left(
		\begin{array}{c}
			\text{image of }\ell\text{ under}\\
			\Oo_X(V)\morphism\Oo_{X,k}\morphism\Oo_{K,[k]}
		\end{array}\right)\quad\text{for all }k\in U\cap V\;.
	\end{align*}
	When $t\in\vartheta^{-1}U\cap\tau^{-1}V\eqqcolon W$ (which is an open neighbourhood of $z$ in $T$), this may be applied to $k=\vartheta(t)=\tau(t)$ and gives
	\begin{align*}
		\vartheta^*_t(\lambda_k)=\left(
		\begin{array}{c}
			\text{image of }\tau^*\ell\text{ under}\\
			\Oo_T(\tau^{-1}V)\morphism\Oo_T(W)\morphism\Oo_{T,t}
		\end{array}\right)
	\end{align*}
	by commutativity of
	\begin{diagram*}
		\node[ob](kz) at (0,0) {$\Oo_{X,k}$};
		\node[ob](kx) at (2.5,0) {$\Oo_{T,t}$};
		\node[ob](ky) at (1.25,-1.25) {$\Oo_{K,k}$};
		\node[ob](OX) at (0,1.25) {$\Oo_X(V)$};
		\node[ob](OT) at (2.5,1.25) {$\Oo_T(\tau^{-1}V)$\rlap{$\:=\tau_*\Oo_T(V)$}};
		\scriptsize
		\draw[->] (kz) -- (kx) node[pos=0.5, above] {$\tau^*$};
		\draw[->] (kz) -- (ky) node[pos=0.5, below left] {$\kappa^*$};
		\draw[->] (ky) -- (kx) node[pos=0.5,below right] {$\vartheta^*_k$};
		\draw[->] (OX) -- (OT) node[pos=0.5, above] {$\tau^*$};
		\draw[->] (OX) -- (kz);
		\draw[->] (OT) -- (kx);
	\end{diagram*}
	It follows that
	\begin{align*}
		\vartheta^*\lambda|_W=\left(
		\begin{array}{c}
			\text{image of }\tau^*\ell\text{ under}\\
			\Oo_T(\tau^{-1}V)\morphism\Oo_T(W)\morphism\prod_{t\in W}\Oo_{T,t}
		\end{array}\right)\;.
	\end{align*}
	Since such a neighbourhood $W$ may be found for any $z\in\vartheta^{-1}U$, $\vartheta^*\lambda$ desires the satisfied coherence condition.
\end{proof}
\begin{cor}
    Let $X\doublemorphism[f][\smash{g}] Y$ be a pair of morphisms of locally ringed spaces and $K\morphism[\kappa] X$ be an equalizer of that pair:
    \begin{alphanumerate}
      \item 
        $\kappa$ is a homeomorphism of $K$ onto a subset of $X$ which is equipped with the induced topology.
      \item 
        $\kappa^*\colon \Oo_{X,\kappa(k)} \morphism \Oo_{K,k}$ is surjective for all $k\in K$.
      \item 
        If $U\subseteq X$ is open, then $\kappa^{-1} (U) \morphism[\kappa|_U] U$ is an equalizer of $U \doublemorphism[f|_U][g|_U] Y$.
    \end{alphanumerate}
\end{cor}
\begin{proof}
	All of this is rather trivial.
\end{proof}
\begin{rem*}
    If $Y\morphism[j] Z$ is a monomorphism, then the equalizers of $jf$ with $jg$ and of $f$ with $g$ are canonically isomorphic. This holds in any category as the equalizer represents
    \begin{align*}
        \left\{\tau \in \Hom(T,X) \st  f\tau =  g\tau \right\} = \left\{\tau \in \Hom(T,X) \st jf\tau = jg\tau\right\}.
    \end{align*}
\end{rem*}
\subsection{Construction of fibre products}
Our goal now is to characterize fibre products of locally ringed spaces. Let $X\morphism[\xi]S\lmorphism[\upsilon]Y$ be morphisms of locally ringed spaces.  For $U\subseteq X$, $V\subseteq Y$, $W\subseteq S$ open subsets in their respective spaces such that $\xi(U) \cup \upsilon(V)\subseteq W$ we put 
\begin{align*}
	\Rr(U,V;W) \coloneqq \Oo_X(U)\otimes_{\Oo_S(W)}\Oo_Y(V)\quad\text{and also}\quad \Rr(U,V) \coloneqq  \Rr(U,V;S)\;. 
\end{align*}
For open subsets $\snake{U}\subseteq U$, $\snake{V}\subseteq V$, and  $\snake{W}\subseteq W$ we have a ring homomorphism
\begin{align*}
	\Rr(U,V;W)=\Oo_X\otimes_{\Oo_S(W)}\Oo_Y(V)&\morphism\Oo_X(\snake{U})\otimes_{\Oo_S(\snake{W})}\Oo_Y(\snake{V})=\Rr(\snake{U},\snake{V};\snake{W})\\
	f\otimes g&\longmapsto \big(f|_{\snake{U}}\big)\otimes\big(g|_{\snake{V}}\big)
\end{align*}
denoted $(-)|_{\snake{U},\snake{V};\snake{W}}$ or $(-)|_{\snake{U},\snake{V}}$.
\begin{rem*}
	If $U=\snake U$, $V= \snake V$ then $(-)|_{U,V;\snake W}\colon\Rr(U,V;W)\morphism \Rr(U,V;\snake{W})$ is surjective and $\colimit \Rr(U,V;W) = \Oo_{X,x}\otimes_{\Oo_{S,s}} \Oo_{Y,y}$ where we take the colimit over all triples $(U,V;W)$ such that $x\in U$, $y\in V$ and $s\in W$.
\end{rem*}

We're now prepared to describe the fibre product $F=X\times_SY$:
\begin{itemize}
	\item \emph{Underlying set.} Set-theoretically, $F=X\times_SY$ is given by
	\begin{align*}
	F=X\times_S Y = \left\{(x,y,\pp)\st 
	\begin{array}{c}
		x\in X\text{, }y\in Y\text{ such that }\xi(x)=\upsilon(y)\eqqcolon s\text{ and the}\\
		\text{ prime ideal }\pp\in \Spec\left(\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}\right)\text{ satisfies}\\
		\alpha^{-1}(\pp) = \mm_{X,x}\text{ and }\beta^{-1}(\pp) = \mm_{Y,y}
	\end{array}\right\}
	\end{align*}
	Herein, as usual $\mm_{X,x}$ and $\mm_{Y,y}$ denote the maximal ideals of $\Oo_{X,x}$ respectively $\Oo_{Y,y}$ and the morphisms $\alpha,\beta$ are given by $\alpha(\lambda)=\lambda\otimes 1$ for $\lambda\in\Oo_{X,x}$ and $\beta(\vartheta)=1\otimes\vartheta$ for $\vartheta\in\Oo_{Y,y}$.
	\item \emph{Topology.}
	The sets of the form
	\begin{align*}
		\Omega(U,V,\theta)\coloneqq\left\{(x,y,\pp)\st
		\begin{array}{c}
			x\in U\text{, }y\in V\text{ and }\pp\text{ doesn't contain the}\\
			\text{image of }\theta\text{ under }\Rr(U,V) \morphism \Oo_{X,x}\otimes_{\Oo_{S,s}} \Oo_{Y,y}
		\end{array}\right\}
	\end{align*}
	form a topology base of $F$ (in view of the above-mentioned surjectivity we only need to consider $\Rr(U,V)$ rather than all $\Rr(U,V;W)$).
	\item \emph{Structure sheaf.} Let $\Oo_{F,[x,y,\pp]} = (\Oo_{X,x}\otimes_{\Oo_{S,s}} \Oo_{Y,y})_\pp$. This \emph{pretender stalk} eventually will turn out to be the actual stalk of $\Oo_F$ at $(x,y,\pp)$. For $\Omega\subseteq F$ open the section of $\Oo_F$ on $\Omega$ is
	\begin{align*}
		\Oo_F(\Omega)=\left\{\lambda=\left(\lambda_{(x,y,\pp)}\right)_{(x,y,\pp)\in\Omega}\in\prod_{(x,y,\pp)\in\Omega}\Oo_{F,[x,y,\pp]}\st
		\begin{array}{c}			
			\lambda\text{ fulfills the}\\
			\text{\emph{coherence condition}}
		\end{array}\right\}\;.
	\end{align*}
	The \emph{coherence condition} says that every $\omega\in\Omega$ has an open neighbourhood $\Omega(U,V,\theta)$ together with an $\ell\in\Rr(U,V)_{\theta}$ such that for $(x,y,\pp)\in\Omega\cap\Omega(U,V,\theta)$ we have
	\begin{align*}
		\lambda_{(x,y,\pp)}=\left(
		\begin{array}{c}
			\text{image of }\ell\text{ under }\Rr(U,V)_\theta=\left(\Oo_X(U)\otimes_{\Oo_S(S)}\Oo_Y(V)\right)_\theta\\
			\morphism\left(\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}\right)_\theta\morphism\left(\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}\right)_\pp
		\end{array}\right)\;.
	\end{align*}
	\item \emph{Projections.} We obtain projections $X\lmorphism[p]F\morphism[p] Y$ by $p(x,y,\pp) = x$ and $q(x,y,\pp) = y$. Let $s=\xi(x)=\upsilon(y)$. The maps $p$ and $q$ are continuous, e.g., $p^{-1}(U)=\Omega(U,Y,1)$. For $f\in\Oo_X(U)$, $g\in \Oo_Y(V)$ we define the pullbacks $p^*$, $q^*$ via
	\begin{align*}
        p^*f&= \left(
        \begin{array}{c}
	        \text{image of } f\text{ under}\\
	         \Oo_X(U) \morphism\Oo_{X,x} \morphism[\alpha] \Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y} \morphism (\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y})_\pp
        \end{array}\right)_{(x,y,\pp) \in p^{-1}(U)}\\
        q^*g&=  \left(
        \begin{array}{c}
	        \text{image of } g\text{ under}\\
	         \Oo_Y(V) \morphism\Oo_{Y,y} \morphism[\beta] \Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y} \morphism (\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y})_\pp
	         \end{array}\right)_{(x,y,\pp) \in q^{-1}(V)}
	\end{align*}
\end{itemize}
\begin{prop}
    The above is the correct description of a fibre product $F=X\times_SY$ of $X\morphism[\xi]S\lmorphism[\upsilon]Y$. Moreover, the morphism
    \begin{align*}
        \Oo_{F,(x,y,\pp)} &\morphism \Oo_{F,[x,y,\pp]}\\
        \text{image of }(\lambda_\omega)\in\prod_{\omega\in\Omega}\Oo_{F,[\omega]}&\longmapsto\lambda_{(x,y,\pp)}\in\Oo_{F,[x,y,\pp]}
    \end{align*}
    is an isomorphism.
\end{prop}
\begin{proof}
    \emph{Step 1.} First we show that the $\Omega(U,V,\theta)$ form a base of a topology. We have $F = \Omega(X,Y,1)$ and $\emptyset=\Omega(X,Y,0)$ and $\Omega(U,V,\theta)\cap \Omega(\snake U, \snake V, \snake \theta) = \Omega(U\cap \snake U, V\cap \snake V, (\theta|_\Gamma)\cdot (\snake \theta_\Gamma))$ where $\Gamma = (U\cap \snake U, V\cap \snake V)$ for short. This suffices.
    
    \emph{Step 2.} Furthermore, $\Oo_F$ is a sheaf of rings. Let $\lambda=(\lambda_\omega)$ and $\snake{\lambda}=(\snake{\lambda}_\omega)$ be sections in $\Oo_F(\Omega)$. We have to show that $\lambda *\snake{\lambda}\in\Oo_F(\Omega)$ for $*\in\{+,\cdot\}$. If $\ell\in \Rr(U,V)_\theta$ and $\snake \ell \in \Rr(\snake U, \snake V)_{\snake\theta}$ verify the coherence condition for $\lambda$ respectively $\smash{\snake{\lambda}}$ at $\omega\in \Omega$, then 
    \begin{align*}
	   \left(
	   \begin{array}{c}
		    \text{image of }\ell|_\Gamma\text{ under }\\
		    \Rr(\Gamma)_{\theta|_\Gamma}\morphism\Rr(\Gamma)_{\theta|_\Gamma\cdot\snake{\theta}|_\Gamma}
	    \end{array}\right)*\left(
	    \begin{array}{c}
		    \text{image of }\snake{\ell}|_\Gamma\text{ under }\\
		    \Rr(\Gamma)_{\theta|_\Gamma}\morphism\Rr(\Gamma)_{\theta|_\Gamma\cdot\snake{\theta}|_\Gamma}
	    \end{array}\right)    	
    \end{align*}
    verifies the coherence condition for $\lambda*\snake{\lambda}$ at $\omega$. Again, $\Gamma$ denotes $(U\cap\snake{U},V\cap\snake{V})$.
    
    \emph{Step 3.} We prove that the pretender stalks are isomorphic to the actual ones. This time, surjectivity first. Let $\lambda \in \Oo_{F,[x,y,\pp]} = (\Oo_{X,x}\otimes_{\Oo_{S,s}} \Oo_{Y,y})_\pp$ be given as $\frac{\phi}{\sigma}$ where $\phi$ and $\sigma$ are elements of this tensor product and $\sigma\not\in \pp$. Then there exist open neighbourhoods $U$ of $x$ and $V$ of $y$ as well as elements $f\in \Rr(U,V)$ and $t\in \Rr(U,V)$ such that the images of $f$ and $t$ in $\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}$ equal $\phi$ and $\sigma$. Then $\frac{f}{t}$ defines an element of $\Oo_F(\Omega(U,V,t))$ whose image in $\Oo_{F,(x,y,\pp)}$ is mapped to $\lambda=\frac{\phi}{\sigma}\in\Oo_{F,[x,y,\pp]}$. 
    
    For injectivity, let $\lambda = (\lambda_\omega)\in \Oo_F(\Omega) \subseteq \prod_{\omega\in \Omega}\Oo_{F,[\omega]}$ and let $(x,y,\pp)\in \Omega$ such that $\lambda_{x,y,\pp}$ vanishes in $\Oo_{F,[x,y,\pp]}$. We must show that $\lambda$ vanishes in some neighbourhood of $(x,y,\pp)$. By the coherence condition there is an open neighbourhood $\Omega(U,V,\theta)$ of $(x,y,\pp)$ together with $\ell\in \Rr(U,V)_\theta$ such that the image of $\ell$ under $\Rr(U,V)_\theta\morphism \Oo_F(\Omega(U,V,\theta)) \morphism \Oo_F(\Omega \cap \Omega(U,V,\theta))$ equals the restriction $\lambda|_{\Omega\cap\Omega(U,V,\theta)}$ of $\lambda$ to $\Omega\cap\Omega(U,V,\theta)$. Replacing $\Omega$ by $\Omega \cap \Omega(U,V, \theta)$ and $\lambda$ by its restriction, we achieve that $\lambda$ itself equals this image. Let $\ell=\frac{n}{\theta}$ with $n\in\Rr(U,V)$ (we may w.l.o.g. assume the denominator is $\theta$ because localizing at an arbitrary power of $\theta$ still gives the same localization). Now $0=\lambda_{(x,y,\pp)}$ equals the image of $\ell$ under
    \begin{align*}
        \Rr(U,V)_\theta = (\Oo_{X}(U)\otimes_{\Oo_S(S)}\Oo_{Y}(V)) \morphism (\Oo_{X,x}\otimes_{\Oo_{S,s}} \Oo_{Y,y})_\pp\;.
    \end{align*}
    Since $\lambda_{(x,y,\pp)}=0$, there is $h\in (\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y})\setminus \pp$ such that 
    \begin{align*}
    	n \cdot h = 0\quad\text{in}\quad\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y} \cong \colimit \Oo_{X}(\snake U) \otimes_{\Oo_S(W)}\Oo_{Y}(\snake V)\;. 
    \end{align*}
    We may assume that $h$ is the image of $\eta\in \Rr(\snake U, \snake V)$ in $\Oo_{X,x}\otimes_{\Oo_{S,s}} \Oo_{Y,y}$ and that $n\cdot \eta = 0$ in $\Rr\smash{(\snake U, \snake V};W)$. Replacing both $\eta$ and $\theta$ by $\eta\cdot \theta$ as well as $U$ by $\snake U$ and $V$ by $\snake V$, we may assume $U=\snake U$, $V=\snake V$ and $\eta = \theta$. Then the image of $\ell = \frac{n}{\theta}$ under $\Rr(U,V)_\theta \morphism \Rr(U,V;W)_\theta$ vanishes. But the map $\Rr(U,V)_\theta\morphism \Oo_F(\Omega(U,V,\theta))$ factors over $\Rr(U,V;W)_\theta$ as this is the case for the maps
    \begin{diagram*}
    	\node[ob](a) at (0,1.5) {$\left(\Oo_X(U)\otimes_{\Oo_S(S)}\Oo_Y(V)\right)_\theta$};
    	\node[ob](c) at (2.5,0) {$\Big(\Oo_X(U)\otimes_{\Oo_S(W)}\Oo_Y(V)\Big)_{\theta|_{\Rr(U,V;W)}}$};
    	\node[ob](b) at (5,1.5) {$\left(\Oo_{X,x'}\otimes_{\Oo_{S,s'}}\Oo_{Y,y'}\right)_\theta$};
    	\node[ob](d) at (8.5,1.5) {$\Oo_{F,\left[x',y',\pp'\right]}$};
    	\scriptsize
    	\draw[->] (a) -- (b);
    	\draw[->] (a) -- (c);
    	\draw[->] (c) -- (b);
    	\draw[->] (b) -- (d);
    \end{diagram*}  
    (where $s'=\xi(x')=\upsilon(y')$) from which it is made up. It follows that the image of $\ell$ under this map vanishes and $\lambda$ also vanishes.
    
    \emph{Step 4.} We have to show that $p$ and $q$ are morphisms of locally ringed spaces. Only the locality of $\Oo_{X,x}\morphism[p^*] \Oo_{F,(x,y,p)}$ (and $q^*$ likewise) is questionable. By the previous step, $p^*$ can be identified with 
    \begin{align*}
    	 \Oo_{X,x}\morphism[\alpha]\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y} \morphism \Oo_{F,[x,y,p]} = (\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y})_\pp
    \end{align*}
   and this is local since the preimage of the maximal ideal $\pp (\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y})_\pp$ in $\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}$ equals $\pp$ and that of $\pp$ under $\alpha$ equals $\alpha^{-1}(\pp)=\mm_{X,x}$ by our definition of $F$ as a set. For $q^*$ it's just the same.

%The following was written by Felix, so probably not maches perfectly with the conventions of the other script.
\emph{Step 5.} We show $\xi p = \upsilon q$. On the level of points, $\xi(p(x,y,\pp)) = \xi(x) = s = \upsilon(y) = \upsilon(q(x,y,\pp))$, hence the topological components of the involved morphisms have the desired property.

Before we continue, recall the following
\begin{fact*}\lbl{fact:O_X(U)Localization}
If $X$ is a locally ringed space, $U\subseteq X$ and $f\in \Oo_X(U)$, then there is a unique dotted arrow making the following diagram commute:
\begin{diagram*}
	\node[ob](OXU) at (0,1.25) {$\Oo_X(U)$};
	\node[ob](OXUV) at (3,1.25) {$\Oo_X(U\setminus V(f))$};
	\node[ob](OXUf) at (1.5, 0) {$\Oo_X(U)_f$};
	\scriptsize
	\draw [->] (OXU) -- (OXUV);
	\draw [->] (OXU) -- (OXUf);
	\draw [->, dashed] (OXUf) -- (OXUV) node[pos=0.5, below right] {$\exists!$};
\end{diagram*}
\end{fact*}
\begin{proof}[Sketch of a proof]
	This basically comes down to proving that $f$ is invertible in $\Oo_X(U\setminus V(f))$. For any $x\in U\setminus V(f)$, the image of $x$ in $\Oo_{X,x}$ is not in $\mm_{X,x}$, hence invertible. Consequently, there is an open neighbourhood $U_x$ of $x$ (of which we may assume $U_x\subseteq U\setminus V(f)$) and some $g_x\in\Oo_X(U_x)$ such that $f|_{U_x} \cdot g_x=1$. Denote $U_{xy}=U_x\cap U_y$, then $g_x|_{U_{xy}}=g_y|_{U_{xy}}$ since $f|_{U_{xy}}$ has a unique inverse in $\Oo_X(U_{xy})$ if it has any. Now the sheaf axiom does the rest.
\end{proof}
Now we show that $\xi p = \upsilon q$ holds for the algebraic components: If $W\subseteq S$ is open and $\sigma\in \Oo_S(W)$, then
\begin{align*}
p^\ast \xi^\ast \sigma &= \left(
\begin{array}{c}
	\text{image of }\xi^*\sigma\text{ under}\\
	\Oo_X(\xi^{-1}W)\morphism\Oo_{X,x}\morphism[\alpha] \Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}\morphism\Oo_{F,[x,y,\pp]}
\end{array}\right)_{(x,y,\pp)\in F\text{ s.t. }x\in \xi^{-1}(W)}\\\\
&=\left(
\begin{array}{c}
	\text{image of }\sigma\text{ under}\\
	\Oo_S(W)\morphism\Oo_{S,s}\morphism[\xi^*]\Oo_{X,x}\morphism[\alpha]\Oo_{X,x}\otimes_{\Oo_{S,s}}
	\Oo_{Y,y}\morphism\Oo_{F,[x,y,\pp]}
\end{array}
\right)_{(x,y,\pp)\in (\xi p)^{-1}W}\;,
\end{align*}
because $\alpha(\xi^\ast t) = \xi^\ast(t)\otimes 1$ for all $t\in\Oo_{S,s}$ be definition of $\alpha$. Moreover, we have $\xi^\ast(t)\otimes 1 = 1\otimes \upsilon^\ast(t)$ by the $\Oo_{S,s}$-bilinearity of $-\otimes_{\Oo_{S,s}}-$ (note that the $\Oo_{S,s}$-algebra structure on $\Oo_{X,x}$ and $\Oo_{Y,y}$ is given by $\xi^*$ and $\upsilon^*$, so that's where these guys come from). Finally $1\otimes \upsilon^\ast(t) = \beta(\upsilon^\ast t)$, so we can extend the above chain of equations by
\begin{align*}
p^\ast \xi^\ast \sigma&=\left(
\begin{array}{c}
	\text{image of }\sigma\text{ under}\\
	\Oo_S(W)\morphism\Oo_{S,s}\morphism[\upsilon^\ast]\Oo_{Y,y}\morphism[\beta]\Oo_{X,x}\otimes_{\Oo_{S,s}}
	\Oo_{Y,y}\morphism\Oo_{F,[x,y,\pp]}
\end{array}
\right)_{(x,y,\pp)\in (\upsilon q)^{-1}W}\\
&=\left(
\begin{array}{c}
	\text{image of }\upsilon^\ast\sigma\text{ under}\\
	\Oo_Y(\upsilon^{-1}W)\morphism \Oo_{Y,y}\morphism[\beta]\Oo_{X,x}\otimes_{\Oo_{S,s}}
	\Oo_{Y,y}\morphism\Oo_{F,[x,y,\pp]}
\end{array}
\right)_{(x,y,\pp)\in (\upsilon q)^{-1}W}
\\&=q^\ast\upsilon^\ast \sigma\;.
\end{align*}
This shows $\xi p=\upsilon q$.

\emph{Step 6.} We show the universal property. Let $X\lmorphism[\tau_X]T\morphism[\tau_Y]Y$ be morphisms of locally ringed spaces such that
$\xi\tau_X = \upsilon \tau_Y$. We define a map $T\morphism[\tau] F$ as follows:
For $t\in T$, we put $x = \tau_X(t), y = \tau_Y(t), s = \xi(x) = \xi(\tau_X(t)) = \upsilon(\tau_Y(t)) = \upsilon(y)$. By the universal property of $\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}$
as a cofibre product in the category of rings, there is a unique ring homomorphism
$\tau^\flat$ from this ring to $\Oo_{T,t}$ such that
\begin{diagram}[baseline=0.75cm-0.5ex][\lbl{diag:fibreProduct}]
	\node[ob](OXx) at (0,1.5) {$\Oo_{X,x}$};
	\node[ob](OTt) at (0,0) {$\Oo_{T,t}$};
	\node[ob](Tensor) at (3,1.5 ) {$\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}$};
	\node[ob](OYy) at (3,0) {$\Oo_{Y,y}$};
	\scriptsize
	\draw [->] (OXx) -- (OTt) node[pos=0.5,left] {$\tau_X^*$};
	\draw [->] (OYy) -- (OTt) node[pos=0.5, below] {$\tau_Y^*$};
	\draw [->] (OYy) -- (Tensor) node[pos=0.5, right] {$\beta$};
	\draw [->] (OXx) -- (Tensor) node[pos=0.5, above] {$\alpha$};
	\draw [->, dashed] (Tensor) -- (OTt) node[pos=0.5, below right] {$\exists!\ \tau^\flat$};
	\tag{$*$}
\end{diagram}
commutes.
It is given by $\tau^\flat(f\otimes g) = \tau_X^\ast(f)\cdot\tau^\ast_Y(g)$. Let $\pp = (\tau^\flat)^{-1}(\mm_{T,t})$.
By the above diagram,
\begin{align*}
\alpha^{-1}(\pp) = \alpha^{-1}(\tau^\flat)^{-1}(\mm_{T,t}) = \tau^\ast_X(\mm_{T,t}) = \mm_{X,x}\;,
\end{align*}
as $\tau_X$ is a morphism of locally ringed spaces. Similarly, $\beta^{-1}(\pp) = (\mm_{Y,y})$ Thus
\begin{align*}
\tau(t) \coloneqq (x,y,\pp)\in F\;.
\end{align*}

Clearly, we have $p\tau = \tau_X$ and $q\tau = \tau_Y$ as maps of underlying sets topological spaces. It remains to prove that $\tau$ is continuous and a morphism of locally ringed spaces

\emph{Continuity of $\tau$.} Let $U\subseteq X, V\subseteq Y$ be open and $f\in \Rr(U,V)$. As the last ring is a cofibre product
$\Oo_X(V)\otimes_{\Oo_S(S)} \Oo_{Y}(V)$, there is a unique ring homomorphism $\tau^\sharp$ from that ring 
to $\Oo_T(\Theta)$, where $\Theta = \tau_X^{-1}(U)\cap \tau_Y^{-1}(Y)$, such that the diagram
\begin{diagram*}
	\node[ob](OX) at (0,1.5) {$\Oo_X(U)$};
	\node[ob](OT) at (0,0) {$\Oo_T(\Theta)$};
	\node[ob](R) at (3,1.5 ) {$\Rr(U,V)$};
	\node[ob](OY) at (3,0) {$\Oo_Y(V)$};
	\scriptsize
	\draw [->] (OX) -- (OT) node[pos=0.5,left] {$\tau_X^*$};
	\draw [->] (OY) -- (OT) node[pos=0.5, below] {$\tau_Y^*$};
	\draw [->] (OY) -- (R) node[pos=0.5, right] {$g\mapsto 1\otimes g$};
	\draw [->] (OX) -- (R) node[pos=0.5, above] {$f\mapsto f\otimes 1$};
	\draw [->, dashed] (R) -- (OT) node[pos=0.5, below right] {$\exists!\ \tau^\sharp$};
\end{diagram*}
commutes, and $\tau^\sharp(f\otimes g) = \tau_X^\ast(f)\cdot \tau_Y^\ast(g)$. Then, for $\lambda\in \Rr(U,V)$,
\begin{align*}
\lbl{eq:fibreproducts-lrs-proof-tau-preimage}
\tau^{-1}\Omega(U,V,\lambda) &=\left\{t\in T \st
\begin{array}{c}
	 x\in U\text{, }y\in V\text{ and the image of }\lambda\text{ in }\Oo_{X,x}\otimes_{\Oo_{S,s}}
	 \Oo_{Y,y}\text{ is } \notin\pp\text{,}\\
	 \text{where we set }(x,y,\pp)=\tau(t)\text{ and }s=\xi\big(\tau_X(t)\big)=\upsilon\big(\tau_Y(t)\big)
\end{array} \right\}\\
&=\left\{t\in \Theta \st \left(\text{image of }\lambda\text{ in }\Oo_{X,x}\otimes_{\Oo_{S,s}}
\Oo_{Y,y}\right) \notin (\tau^\flat)^{-1}(\mm_{T,t}) \right\}\\
&=\left\{t\in \Theta\st\left(\text{image of }\tau^\sharp\lambda\text{ under }\Oo_T(\Theta)\to \Oo_{T,t}\right)\notin\mm_{T,t}\right\}\\
&=\Theta\setminus V(\tau^\sharp \lambda)\;,\tag{\#}
\end{align*}
which is open. The transition from the second line to the third line uses the commutativity of the following diagram:
\begin{diagram*}
	\node[ob](R) at (0,1.5) {$\Rr(U,V)$};
	\node[ob](OT) at (3,1.5) {$\Oo_T(\Theta)$};
	\node[ob](Tensor) at (0,0) {$\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}$};
	\node[ob](OTt) at (3, 0) {$\Oo_{T,t}$};
	\scriptsize
	\draw [->] (R) -- (Tensor);
	\draw [->] (R) -- (OT) node[pos=0.5,above] {$\tau^\sharp$};
	\draw [->] (Tensor) -- (OTt) node[pos=0.5,above] {$\tau^\flat$};
	\draw [->] (OT) -- (OTt);
\end{diagram*}
Indeed, the element $f\otimes g$ in the upper-left corner $\Rr(U,V)=\Oo_X(V)\otimes_{\Oo_S(S)} \Oo_Y(V)$ is mapped to via the upper-right corner to
\begin{align*}
\left(
\begin{array}{c}
	\text{image of }\tau^\sharp(f\otimes g)\text{ under}\\
	\Oo_T(\Theta)\morphism \Oo_{T,t}
\end{array}\right)&=\left(
\begin{array}{c}
	\text{image of }\tau_X^\ast(f)\cdot\tau_Y^\ast(g)\text{ under}\\
	\Oo_T(\Theta)\morphism \Oo_{T,t}
\end{array}\right)\\
&=\big(\text{image of }\tau_X^\ast(f)\text{ in } \Oo_{T,t}\big)\cdot\big(\text{image of }\tau_Y^\ast(g)\text{ in } \Oo_{T,t}\big)\\
&=\tau_X^\ast\big(\text{image of }f\text{ in }\Oo_{X,x}\big)
\cdot \tau_Y^\ast\big(\text{image of }g\text{ in }\Oo_{Y,y}\big)\\
&=\tau^\flat\big(\left(\text{image of }f\text{ in }\Oo_{X,x}\right) \otimes 
\left(\text{image of }g\text{ in }\Oo_{Y,y}\right)\big),
\end{align*}
which is the image of $f\otimes g$ via the lower-left corner. As these pure tensor products generate
$\Rr(U,V)$ as an abelian group, the stated commutativity of the diagram follows.

\emph{Definition of the algebraic component $\tau^\ast$ of $\tau$.}
Fix an open subset $\Omega\subseteq F$. We define
$\tau^*\left( \phi\right),$
where $\phi=(\phi_\omega)_{\omega\in \Omega} \in \prod_{\omega\in \Omega} \Oo_{F,[\omega]}$ must satisfy the coherence condition for sections of $\Oo_F$,
to be the preimage of $\big(\tau^* \varphi_{\tau(t)}\big)_{t\in \tau^{-1}(\Omega)}$ under $\Oo_T\left(\tau^{-1}\Omega\right)\morphism \prod_{t\in \tau^{-1}(
\Omega)} \Oo_{T,t}$. Here, $\tau^*$ is the unique ring homomorphism $\Oo_{F,[\tau(t)]} \rightarrow \Oo_{T,t}$ making the diagram
\begin{diagram*}
	\node[ob](Tensor) at (0,1.5) {$\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}$};
	\node[ob](OF) at (4.5,1.5) {$\left(\Oo_{X,x}\otimes_{\Oo_{S,s}} \Oo_{Y,y}\right)_{\pp}$\rlap{$\:=\Oo_{F,[x,y,\pp]}$}};
	\node[ob](OT) at (4.5, 0) {$\Oo_{T,t}$};
	\scriptsize
	\draw[->] (Tensor) -- (OF);
	\draw[->] (Tensor) -- (OT) node[pos=0.5, below left] {$\tau^\flat$};
	\draw[->, dashed] (OF) -- (OT) node[pos=0.5, right] {$\exists!\ \tau^*$};
\end{diagram*}
commute. It exists by the universal property of localizations, as $\pp = (\tau^\flat)^{-1} (\mm_{T,t})$.
To confirm that $\big(\tau^* \varphi_{\tau(t)}\big)_{t\in \tau^{-1}(\Omega)}$ has the coherence condition characterizing the
image of $\Oo_T(\tau^{-1}\Omega)$, let $\snake\Omega = \Omega(U,V,\lambda)$ be an open neighbourhood in $F$ of
$\tau(t)$ such that on $\snake\Omega\cap \Omega$, $\varphi$ is given by $f\in R(U,V)_\lambda$. By
\eqreff{eq:fibreproducts-lrs-proof-tau-preimage}, $\tau^{-1}(\snake\Omega) = \left(\tau_X^{-1}(V)\cap \tau_Y^{-1}(V)\right)\setminus
V\big(\tau^\sharp(\lambda)\big)$ is an open neighbourhood of $t$ on which $\tau^\sharp(g)\cdot\tau^\sharp(\lambda)^{-k}$ defines a section of $\Oo_T$,
where $g\in R(U,V)$ and $k\geq 0$ such that $f=g\cdot\lambda^{-k}$. Then
\begin{align*}
\tau^*\left(\varphi_{\tau(t)}\right) = \frac{\tau^\flat(g_{\tau(t)})}{\tau^\flat(\lambda_{\tau(t)})^k} = \left(\text{image of }\frac{\tau^\sharp(g)}
{\tau^\sharp(\lambda)^k}\text{ in }\Oo_{T,t}\right)
\end{align*}
for $t\in \tau^{-1}(\Omega)\cap \tau^{-1}(\snake\Omega)$, using the same equality as in the proof of 
\eqreff{eq:fibreproducts-lrs-proof-tau-preimage}.
This completes the description of the algebraic component $\tau^\ast$ of $\tau$. It is clear that it makes $\tau$ a morphism of ringed spaces,
that $\tau^\ast p^\ast = \tau_X^\ast$ and that $\tau^\ast q^\ast = \tau_Y^\ast$ hold (this follows from the commutativity of the triangles in
in \eqreff{diag:fibreProduct} and the fact that the map $\tau^\ast$ defined there coincides with
the map on stalks induced by the new $\tau^\ast$).

\emph{Locality of $\tau^\ast\colon \Oo_{F,\tau(t)}\rightarrow \Oo_{T,t}$.} We have a commutative diagram
\begin{diagram*}
	\node[ob](OF) at (0, 1.5) {$\Oo_{F,\tau(t)}$};
	\node[ob](OTt) at (4.5, 1.5) {$\Oo_{T,t}$};
	\node[ob](Tensor) at (0,0) {\llap{$\Oo_{F,[\tau(t)]}=\:$}$\left(\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}\right)_{\pp}$};
	\node[ob](L) at (4.5, 0) {$\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}$\rlap{$\:\eqqcolon\Ll$}};
	\path (Tensor) -- (OF) node[pos=0.5, sloped] {$\cong$};
	\scriptsize
	\draw[->] (OF) -- (OTt);
	\draw[->] (L) -- (Tensor);
	\draw[->] (L) -- (OTt) node[pos=0.5, right] {$\tau^\flat$};
	\draw[->] (Tensor) -- (OTt) node[pos=0.5, above left] {$\tau^*$};
\end{diagram*}
and $\tau^\flat$ maps $\pp \mathcal L_{\pp}$ to $\mm_{T,t}$ as $\tau^\ast(\pp)\subseteq \mm_{T,t}$ as
$\pp = \left(\tau^\ast\right)^{-1}\mm_{T,t}$ by the definition of $T$.

\emph{Uniqueness of $\tau$.} Let $t\in T$, $\tau(t) = (x,y,\pp)$, then obviously $x= \tau_X(t)$ and $y=\tau_Y(t)$. In the diagram
\begin{diagram*}
	\node[ob](Tensor) at (0,1.5) {$\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y}$};
	\node[ob](OX) at (0,0) {$\Oo_{X,x}$};
	\node[ob](OY) at (3,1.5) {$\Oo_{Y,y}$};
	\node[ob](OS) at (3,0) {$\Oo_{S,s}$};
	\node[ob](OT) at (-5.75, 2.75) {$\Oo_{T,t}$};
	\node[ob](OF) at (-3,1.5) {$\Oo_{F,[x,y,\pp]}$};
	\scriptsize
	\draw[->] (OX) -- (Tensor) node[pos=0.5, left] {$\alpha$};
	\draw[->] (OY) -- (Tensor) node[pos=0.5, above] {$\beta$};
	\draw[->] (OS) -- (OX) node[pos=0.5, above] {$\xi^*$};
	\draw[->] (OS) -- (OY) node[pos=0.5, right] {$\upsilon^*$};
	\draw[->, bend left] (OX) to node[pos=0.5, below left] {$\tau_X$} (OT); 
	\draw[->, bend right] (OY) to node[pos=0.5, above right] {$\tau_Y$} (OT); 
	\draw[->, dashed] (Tensor) -- (OT) node[pos=0.5, above right] {$\tau^\flat$};
	\draw [->] (Tensor) -- (OF);
	\draw [->, dotted] (OF) -- (OT) node[pos=0.5, below left] {$\tau^*$};
\end{diagram*}
 the dashed arrow $\tau^\flat$ is uniquely determined by the cocartesianness of the lower right corner. Because $\tau$ is a morphism of locally ringed spaces, the dotted arrow $\tau^*$ must be a local ring morphism, hence
\begin{align*}
    (\tau^*)^{-1}(\mm_{T,t}) = \pp\Oo_{F,[x,y,\pp]} = \pp\left(\Oo_{X,x}\otimes_{\Oo_{S,s}} \Oo_{Y,y}\right)_\pp\;.
\end{align*}
Since the preimage of this ideal in $\Oo_{X,x}\otimes_{\Oo_{S,s}} \Oo_{Y,y}$ equals $\pp$ and the diagram commutes, $\pp=(\tau^\flat)^{-1}(\mm_{T,t})$ is uniquely determined. By the universal property of localization, the dotted arrow is also unique. Thus $\tau^*$ is unique at stalks, hence unique. 
\end{proof}

\begin{cor}
    \begin{alphanumerate}
        \item \lbl{cor:fibreProductsInLRS}
            Let $X_{\mathrm{Top}}$ be the topological space underlying $X$, then the map
            \begin{align*}
                (X\times_SY)_{\mathrm{Top}} \morphism X_{\mathrm{Top}}\times_{S_{\mathrm{Top}}} Y_{\mathrm{Top}}
            \end{align*}
            (determined by the diagram
            \begin{diagram*}
            	\node[ob](P) at (0,1.5) {$X_{\mathrm{Top}}\times_{S_{\mathrm{Top}}}Y_{\mathrm{Top}}$};
            	\node[ob](X) at (0,0) {$X$};
            	\node[ob](Y) at (2.75,1.5) {$Y$};
            	\node[ob](S) at (2.75,0) {$S$};
            	\node[ob](T) at (-2, 3) {$(X\times_SY)_{\mathrm{Top}}$};
            	\scriptsize
            	\draw[->] (P) -- (X);
            	\draw[->] (P) -- (Y);
            	\draw[->] (X) -- (S) node[pos=0.5, above] {$\xi_{\mathrm{Top}}$};
            	\draw[->] (Y) -- (S) node[pos=0.5, right] {$\upsilon_{\mathrm{Top}}$};
            	\draw[->, bend right] (T) to node[pos=0.5, below left] {$p_{\mathrm{Top}}$} (X); 
            	\draw[->, bend left] (T) to node[pos=0.5, above right] {$q_{\mathrm{Top}}$} (Y); 
            	\draw[->, dashed] (T) -- (P) node[pos=0.5, above right] {$\exists!\ t$};
            \end{diagram*}            
            via the universal property of fibre products of topological spaces) is surjective.
        \item 
            If $U\subseteq X$, $V\subseteq Y$ and $W\subseteq S$ are open subsets of the respective spaces and $W\supseteq \xi(U)\cup\upsilon(V)$ then $p^{-1}(U)\cap q^{-1}(V) \subseteq F$ together with the restrictions of $p$ and $q$ is a fibre product of $U$ and $V$ over $W$.
    \end{alphanumerate}
\end{cor}

\begin{proof}
    To prove \itememph{a}, what we need to show is that for all $x\in X_{\mathrm{Top}}$ and $y\in Y_{\mathrm{Top}}$ such that $\xi(x) = \upsilon(y)\eqqcolon s$ there is an appropriate $\pp\in \Spec\left(\Oo_{X,x} \otimes_{\Oo_{S,s}}\Oo_{Y,y}\right)$ such that $\alpha^{-1}(\pp) = \mm_{X,x}$, $\beta^{-1}(\pp) = \mm_{Y,y}$. Consider the ring homomorphism
    \begin{align*}
        \Oo_{X,x}\otimes_{\Oo_{S,s}} \Oo_{Y,y} &\morphism[\phi] \KK(x) \otimes_{\KK(s)}\KK(y) = A\\
        f\otimes g &\longmapsto (f\bmod \mm_{X,x}) \otimes (g\bmod \mm_{Y,y})\;.
    \end{align*}
    If $\mm$ is any maximal ideal of $A$, then $\pp = \phi^{-1}(\mm)$ has the required property. Indeed, for instance,
    \begin{align*}
        (f\otimes 1)\in\pp \quad\Leftrightarrow\quad \phi(f\otimes 1)\in \mm \quad\Leftrightarrow\quad \big((f\bmod\mm_{X,x})\otimes 1\big) \in\mm\;.
    \end{align*}
    When $f\in \mm_{X,x}$ the right-hand side vanishes, otherwise $f$ and the right-hand side are units.
    
    The part \itememph{b} is a straightforward consequence of our explicit construction of fibre products and the surjectivity of $\Rr(U,V) \morphism \Rr(U,V,W)$.
\end{proof}

\begin{rem}
    The proof would work with infinitely many factors as well, with some modifications. When $S$ and $X_\lambda$ are preschemes, the fibre product may fail to be a prescheme unless all but finitely many of the morphisms $X_\lambda \morphism S$ are affine.
\end{rem}

\begin{defi}[Immersive morphisms] \lbl{def:immersiveMorphism}
    A morphism $Y\morphism[\upsilon] S$ of locally ringed spaces is called \defemph{immersive} (or an \defemph{embedding}) if, topologically, $\upsilon$ is a homeomorphism onto its image equipped with the induced topology with respect to $S$, and for every $y\in Y$ the map $\Oo_{S,\upsilon(y)} \morphism[\upsilon^*]\Oo_{Y,y}$ is surjective. 
       
    If $\upsilon(Y)\subseteq S$ is a closed subset, $\upsilon$ is called a \defemph{closed immersion}. If $\upsilon(Y)$ is open and, additionally, $\Oo_S\morphism[\upsilon^*]\upsilon_*\Oo_Y$ restricts to an isomorphism of sheaves $\Oo_S|_{\upsilon(Y)}\isomorphism\upsilon_*\Oo_Y$, $\upsilon$ is called an \defemph{open immersion}.
\end{defi}

\begin{cor}\lbl{cor:immersionBaseChange}
    Let $Y\morphism[\upsilon]S$ be a immersive morphism. Then its base change -- cf.\ Remark~\reff{rem:baseChange}\itememph{f} -- $F=X\times_SY\morphism[\snake \upsilon] X$ is immersive, and its image is $\xi^{-1}(\upsilon(Y))$.
\end{cor}
\begin{rem*}
	 In particular, the base change of a closed immersion is itself closed and likewise the base change of an open immersion is open again. For the last assertion, we also need to check that $\snake{\upsilon}^*$ induces isomorphisms on stalks, which will follow from the proof to come.
\end{rem*}
\begin{proof}[Proof of Corollary~\reff{cor:immersionBaseChange}]
    For $(x,y,\pp)$ and $s$ as in the description of $F$, let $I_s\subseteq \Oo_{S,s}$ be the kernel of $\Oo_{S,s}\morphism[\upsilon^*] \Oo_{Y,y}$. Then $\Oo_{Y,y}\cong \Oo_{S,s}/I_s$ (as $\upsilon^*$ is assumed surjective), hence 
    \begin{align*}
    	\Oo_{X,x}\otimes_{\Oo_{S,s}}\Oo_{Y,y} \cong \Oo_{X,x}/(\xi^*(I_s) \cdot \Oo_{X,x}) \eqqcolon \Oo_{X,x}/I_s\Oo_{X,x}\;. 
    \end{align*}
    Since $\alpha^{-1}(\pp)$ equals $\mm_{X,x}$, we have $\pp\supseteq \mm_{X,x}/(I_s \Oo_{X,x})$ which must be an equality as the right-hand side is the maximal ideal of local ring $\Oo_{X,x}/(I_s \Oo_{X,x})$. Thus, $\pp$ and $y$ are uniquely determined by $x$ ($y$ actually because $\upsilon$ has to be injective) and $\Oo_{F,[x,y,\pp]}\cong \Oo_{X,x}/(I_s \Oo_{X,x})$ is a quotient of $\Oo_{X,x}$ implying surjectivity of $\xi^*$ on stalks and that $F$ is mapped to $\xi^{-1}(\upsilon(Y))$. It remains to confirm that the topology is indeed the induced topology. Note that
    \begin{align}\lbl{eq:omegaCover}
        \Omega(U,V,f) = \bigcup_{\lambda\in \Lambda} \Omega\left(U,V_\lambda, f|_{\Rr(U,V_\lambda)}\right)\tag{$*$}
    \end{align}
    when $V=\bigcup_{\lambda\in \Lambda} V_\lambda$. Let $f\in \Rr(U,V)$, $f=\sum_{i=1}^n g_i\otimes h_i$, $g_i\in \Oo_X(U)$, $h_i\in\Oo_Y(V)$. As $Y$ carries the induced topology and $\upsilon^*$ is surjective on stalks, $V$ may be covered by open subsets of the form $V_\lambda = Y\cap W_\lambda$, $W_\lambda \subseteq S$ open, such that there are $\eta_{i,\lambda}\in \Oo_S(W_\lambda)$ satisfying $h_i|_{V_\lambda} = \upsilon^*(\eta_{i,\lambda})$. Then
    \begin{align*}
        f|_{\Rr(U,V_\lambda)} = \sum_{i=1}^n g_i\otimes \upsilon^*(\eta_{i,\lambda}) = \sum_{i=1}^n (\xi^*(\eta_{i,\lambda})\cdot g_i) \otimes 1 \eqqcolon\phi_\lambda\otimes 1
    \end{align*}
    in $\Rr(\xi^{-1}(W_\lambda)\cap U, V_\lambda; W_\lambda)$. Thus $\Omega\left(U,V_\lambda, f|_{\Rr(U,V_\lambda)}\right) = \big((U\cap \xi^{-1}(W_\lambda)\setminus V(\phi_\lambda)\big)\cap F$ is open in the induced topology. By \eqreff{eq:omegaCover}, $\Omega(U,V,f)$ is open as well.
\end{proof}
\begin{defi}[Sheaf of modules]\lbl{def:sheafOfModules}
    Let $\Rr$ be a sheaf of rings on $X$. A \defemph{sheaf of modules} over $\Rr$, or simply an $\Rr$-module, is a sheaf $\Mm$ of abelian groups on $X$ with multiplications
    \begin{align*}
        \Rr(U)\times \Mm(U) \morphism \Mm(U)
    \end{align*}
    giving $\Mm(U)$ the structure of an $\Rr(U)$-module and such that $(\rho\cdot \mu)|_V = (\rho|_V)\cdot (\mu|_V)$ when $V\subseteq U$ is an inclusion open subsets and $\rho\in\Rr(U)$, $\mu\in\Mm(U)$. 
    
    In the case where $\Mm(U) \subseteq \Rr(U)$ is an ideal in that ring and the module operations respectively $(-)|_V$ are the restrictions of the ring operations in $\Rr(U)$ respectively of $(-)|_V$ for $\Rr$ to $\Mm(U)$, we call $\Mm$ a \defemph{sheaf of ideals} in $\Rr$.
\end{defi}

\begin{prop}\lbl{prop:sheafOfIdeals}
    If $(\Ii_{[x]})_{x\in X}$ is a family of ideals in the stalks $\Rr_x$, then the following conditions are equivalent.
    \begin{alphanumerate}
        \item 
            There is a sheaf of ideals $\Ii$ on $X$ such that $\Ii_{[x]}$ equals the (isomorphic) image $\Ii_x$ in $\Rr_x$.
        \item  
            For every $x\in X$, every $\iota\in \Ii_{[x]}$ is the image of some $i\in\Rr(U)$ for some open neighbourhood $U$ of $x$, such that the image of $i$ in $\Rr_y$ lies in $\Ii_{[y]}$ for all $y\in U$.
    \end{alphanumerate}
    In this case $\Ii$ is determined uniquely.
\end{prop}
	\begin{proof}
		The implication \itememph{a} $\Rightarrow$ \itememph{b} is easy. If $\Ii\subseteq\Rr$ is such a sheaf of ideals and $\iota\in\Ii_{[x]}$ for some $x\in X$, choose an open neighbourhood $U$ of $x$ a preimage $i\in\Ii(U)$ of $\iota\in\Ii_{[x]}=\Ii_x$. Then the image of $i$ in $\Rr_y$ lies in $\Ii_y=\Ii_{[y]}$ for all $y\in U$.
		
		Conversely, suppose that \itememph{b} is fulfilled. We construct a sheaf $\Ii$ via
		\begin{align*}
			\Ii(U)=\left\{(\iota_x)\in\prod_{x\in U}\Ii_{[x]}\st
			\begin{array}{c}
			\text{for all }y\in U\text{ there are an open neighbourhood }V\text{ of }y\\
			\text{ and }i\in\Rr(U)\text{ such that }\iota_x=(\text{image of }i\text{ in }\Rr_x)\ \forall x\in U\cap V
			\end{array}\right\}\;.
		\end{align*}
		The ideal operations are defined in the obvious (stalk-wise) way. It's straightforward to check that they are compatible with the imposed coherence condition and that $\Ii$ is indeed a sheaf of ideals in $\Rr$. For $x\in X$ and $\iota\in\Ii_{[x]}$, the open neighbourhood $U$ of $x$ and $i\in\Rr(U)$ guaranteed by \itememph{b} provide a preimage of $\iota$ in $\Ii(U)$, i.e., $i\in\Ii(U)$ and the image of $i$ in $\Rr_x$ is $\iota$. Hence, $\Ii_{[x]}\subseteq\Ii_x$ for all $x\in X$. Conversely, if $(\iota_x)\in\Ii(U)$, then the image of $(\iota_x)$ in $\Rr_x$ is $\iota_x$ (by an argument like Proposition~\reff{prop:sheafificationMorphisms}\itememph{a}), proving $\Ii_x\subseteq\Ii_{[x]}$.
		
		Uniqueness of $\Ii$ (if it exists at all) follows from the fact that a sheaf can be recovered from its stalks, a special case of Proposition~\reff{prop:sheafificationMorphisms}\itememph{d}.
	\end{proof}
\begin{cor}\lbl{cor:trivialStalksOpen}
    If $\Ii\subseteq \Rr$ is a sheaf of ideals, $\left\{x\in X\st \Ii_x=\Rr_x\right\}$ is open in $X$.
\end{cor}
\begin{proof}
	If some $\Ii_x$ contains $1\in \Rr_x$, then, by Proposition~\reff{prop:sheafOfIdeals}\itememph{b} there is an open neighbourhood $U$ of $x$ such that the image of $1\in\Rr(U)$ also lies in $\Ii_y$ for all $y\in U$.
\end{proof}
\begin{prop}\lbl{prop:closedImmersionSheaves}
    For a locally ringed space $X$, let two immersions $K_1\morphism[\kappa_1] X\lmorphism[\kappa_2] K_2$ be called equivalent (write $\kappa_1\sim\kappa_2$) if there is an isomorphism $K_1\morphism[\iota] K_2$ of locally ringed spaces such that $\kappa_2\iota = \kappa_1$. Then there is a bijection 
    \begin{align*}
	    \left\{\text{closed immersions }K\morphism[\kappa]X\right\}/_\sim&\isomorphism\left\{\text{sheaves of ideals }\Ii\subseteq \Oo_X\right\}\\
        \big(K\morphism[\kappa]X\big)/_\sim &\longmapsto \Ii = \ker\big(\Oo_X\morphism[\kappa^*]\kappa_* \Oo_K\big)\;.
    \end{align*}
    If $K\morphism[\kappa] X$ belongs to the sheaf of ideals $\Ii$,
    \begin{align*}
        \Hom_{\cat{LRS}}(T,K) \isomorphism\left\{ g\in \Hom_{\cat{LRS}}(T,X) \st \Ii\subseteq \ker\big(\Oo_X \morphism[g^*]g_*\Oo_T\big)\right\}
    \end{align*}
    is bijective for any test object $T$.
\end{prop}
\begin{rem*}
    When $X$ is a prescheme, $K$ will fail to be a prescheme unless $\Ii$ is \emph{quasi-coherent} (cf.\ Definition~\reff{def:preschemeQuasiCoherent} and Proposition~\reff{prop:closedImmersionCoherentSheaves}).
\end{rem*}
\begin{proof}[Proof of Proposition~\reff{prop:closedImmersionSheaves}]
    The following proof is quite sketchy, because lots of technical details have been outsourced to exercise sheet \#8. Let $\Ii\subseteq \Oo_X$ be a sheaf of ideals. We put 
    \begin{align*}
        K = \left\{x\in X\st\Ii_x\subsetneq \Oo_{X,x}\right\} \morphism[\kappa] X\;,
    \end{align*}
    which is closed in $X$ by Corollary~\reff{cor:trivialStalksOpen}, and equip it with the induced topology with respect to $X$. We define pretender stalks 
    \begin{align*}
        \Oo_{K,[x]} = \Oo_{X,x} / \Ii_x
    \end{align*}
    and construct a sheaf $\Oo_K$ from it as we have seen several times before: The ring of sections $\Oo_K(U)$ consists of those families $(f_x)_{x\in U}\in \prod_{x\in U}\Oo_{K,[x]}$ such that for every $x\in U$ there exist an open neighbourhood $V$ of $x$ in $X$ and $\phi\in \Oo_X(V)$ such that for every $y\in U\cap V$, $f_y$ equals the image of $\phi$ under 
    \begin{align}\lbl{eq:stalkProj1.3.4}
        \Oo_X(V) \morphism \Oo_{X,y} \morphism \Oo_{K,[y]}\;.\tag{$*$}
    \end{align}
    In an argument similar to the proof of Proposition~\reff{prop:equalizerLRS} one shows $\Oo_{K,x}\isomorphism \Oo_{K,[x]}$.
    
    Let $\Oo_X \morphism[\kappa^*]\kappa_* \Oo_K$ send
    \begin{align*}
    	f\in\Oo_X(V)\longmapsto\Big(\text{image of }f\text{ under \eqreff{eq:stalkProj1.3.4}}\Big)_{y\in V\cap K}\in \Oo_K(V\cap K)=\Oo_K(\kappa^{-1}V)=\kappa_*\Oo_K(V)\;.
    \end{align*}
    It is easy to see that this makes $K$ a locally ringed space and $\kappa$ a closed immersion. It is also easy to see that the claimed description of $\Hom_{\cat{LRS}}(T,K)$ holds, and that $\Ii = \ker\big(\Oo_X \morphism[\kappa^*] \kappa_* \Oo_K\big)$. 
    
    If $L\morphism[\lambda] K$ is another closed immersion satisfying $\Ii= \ker \big(\Oo_X \morphism[\lambda^*] \lambda_* \Oo_L\big)$, then, by the description of $\Hom_{\cat{LRS}}(T,K)$, we have a morphism $L \morphism[\iota] K$ such that $\lambda = \kappa\iota$. The image of $L$ in $X$ coincides with $K$ because it equals $\left\{ x\in X\st (\lambda_*\Oo_L)_x \neq 0\right\} = \left\{ x\in X\st \Ii_x \subsetneq \Oo_{X,x}\right\}$. Indeed, if $x$ is not in the image of $L$, then it has some open neighbourhood not contained in the image of $L$, as $\lambda$ is a closed immersion, hence the stalk of $\lambda_*\Oo_L$ at $x$ has to be $0$. Conversely, if $x$ is in that image, then $(\lambda_*\Oo_L)_x$ contains $1$, proving it can't be $0$. Since both sets carry the induced topology, $\iota$ is a homeomorphism. For $\ell \in L$ and $x=\lambda(\ell)$ we have a commutative diagram
    \begin{diagram*}
    	\node[ob](OX) at (0,0) {$\Oo_{X,x}$};
    	\node[ob](OK) at (2,0.75) {$\Oo_{K,x}$\rlap{$\:\cong\Oo_{K,[x]}$}};
    	\node[ob](OL) at (2,-0.75) {$\Oo_{L,\ell}$};
    	\scriptsize 
    	\draw[->] (OX) -- (OK) node[pos=0.5, above left] {$\kappa^*$};
    	\draw[->] (OX) -- (OL) node[pos=0.5, below left] {$\lambda^*$};
    	\draw[->] (OK) -- (OL) node[pos=0.5, right] {$\iota^*$};
    \end{diagram*}
    where the two slanted arrows are surjections with kernel $\Ii_x$. It follows that the right vertical arrow $\iota^*$ is an isomorphism, and $\iota$ induces isomorphisms on stalks in addition to being a homeomorphism. It is thus an isomorphism and $(K\morphism[\kappa] X)$ is equivalent to $(L\morphism[\lambda] X)$.
\end{proof}
\begin{defi}
    If $X\morphism[f] Y$ is a morphism of ringed spaces and $\Mm$ an $\Oo_X$-module, we equip $f_* \Mm$ with the following structure of an $\Oo_Y$-module. $f_*\Mm$ is an $f_*\Oo_X$-module using multiplications
    \begin{align*}
        (f_*\Oo_X)(V)\times (f_*\Mm)(U)  = \Oo_X(f^{-1}(V))\times \Mm(f^{-1}(V)) \morphism[\cdot] \Mm(f^{-1}(V)) = (f_*\Mm)(V)
    \end{align*}
    and the morphism $\Oo_Y\morphism[f^*] f_* \Oo_X$ of sheaves of rings does the rest.
\end{defi}
\begin{fact}
    Let $X$ be a locally ringed space and $U\subseteq X$ open and $f\in \Oo_X(U)$. Then there are uniquely determined morphisms 
    \begin{align}\lbl{eq:moduleLoc}
        \Oo_X(U)_f \morphism \Oo_X(U\setminus V(f))\;,\quad\text{and}\quad
        \Mm(U)_f \morphism \Mm(U\setminus V(f))
    \end{align}
    for any $\Oo_X$-module $\Mm$.
\end{fact}
\begin{proof}
	Use the universal property of localization and these happy little diagrams
	\begin{center}
		\begin{minipage}{0.425\textwidth}
			\centering			
			\begin{diagram*}
				\node[ob](OXU) at (0,1.25) {$\Oo_X(U)$};
				\node[ob](OXUV) at (3,1.25) {$\Oo_X(U\setminus V(f))$};
				\node[ob](OXUf) at (1.5, 0) {$\Oo_X(U)_f$};
				\scriptsize
				\draw [->] (OXU) -- (OXUV);
				\draw [->] (OXU) -- (OXUf);
				\draw [->, dashed] (OXUf) -- (OXUV) node[pos=0.5, below right] {$\exists!$};
			\end{diagram*}
		\end{minipage}
		\begin{minipage}{0.425\textwidth}
			\centering			
			\begin{diagram*}
				\node[ob](MXU) at (0,1.25) {$\Mm(U)$};
				\node[ob](MXUV) at (3,1.25) {$\Mm(U\setminus V(f))$};
				\node[ob](MXUf) at (1.5, 0) {$\Mm(U)_f$};
				\scriptsize
				\draw [->] (MXU) -- (MXUV);
				\draw [->] (MXU) -- (MXUf);
				\draw [->, dashed] (MXUf) -- (MXUV) node[pos=0.5, below right] {$\exists!$};
			\end{diagram*}
		\end{minipage}
	\end{center}
	For $\Oo_X$, we already proved this in unnamed fact on page~\pageref{fact:O_X(U)Localization}. The case of $\Mm$ can be immediately deduced from this, as $\Mm(U)_f=\Mm(U)\otimes_{\Oo_X(U)}\Oo_X(U)_f$.
\end{proof}


\section{The structure sheaf and quasi-coherent sheaf of modules on \texorpdfstring{$\Spec R$}{Spec R}}
Let $R$ be a ring, $\Bb = \left\{ \Spec R\setminus V(f)\st f\in R\right\}$. This is a topology base of $\Spec R$ equipped with the Zariski-topology. Moreover, since $(\Spec R\setminus V(f))\cap (\Spec R\setminus V(g)) = \Spec R\setminus V(fg)$,  $\Bb$ is closed under intersection. The localization $R_f$ depends, up to unique isomorphism of $R$-algebras, only on $(\Spec R)\setminus V(f)$. To see this, we claim that when $\Spec R\setminus V(g)\subseteq \Spec R\setminus V(f)$ there is a unique homomorphism $R_f\morphism R_g$ of $R$-algebras. In fact, $V(g)\supseteq V(f)$ implies $g\in \sqrt{(f)}=\bigcap_{\pp\in V(f)}\pp$ which shows that some power of $g$ is divisible by $f$ and so $f$ is a unit in $R_g$. The universal property of localization thus establishes our claim.

From these considerations, we have a presheaf of rings on $\Bb$ via
\begin{align}\lbl{eq:SpecRingLoc}
    \Spec R\setminus V(f) \longmapsto R_f\;.
\end{align}
If $M$ is an $R$-module, we have a similar presheaf (of abelian groups or of modules over the former presheaf of rings)
\begin{align} \lbl{eq:SpecModuleLoc}
    \Spec R\setminus V(f) \longmapsto M_f
\end{align}
\begin{defi}
    Let $\Oo_{\Spec R}$ and $\snake M$ be the sheafifications of these presheaves \eqreff{eq:SpecRingLoc}, \eqreff{eq:SpecModuleLoc} on $\Bb$.
\end{defi}
\begin{rem*}
    Note that the stalks of the presheaves are easily calculated: The stalk of \eqreff{eq:SpecRingLoc} at $\pp$ is $\colimit[f\not \in \pp] R_f \cong R_\pp$ (the $f\notin\pp$ are ordered by divisibility). Similarly the stalk of \eqreff{eq:SpecModuleLoc} at a prime $\pp$ is given by $M_\pp$.
    
    Thus
    \begin{align*}
        \Oo_{\Spec R}(U) &\cong \left\{(r_\pp)_{\pp\in U}\in \prod_{\pp\in U} R_\pp \st
        \begin{array}{c}
	         \text{every prime ideal } \qq\in U \text{ has an open neighbourhood}\\
	         \Spec R\setminus V(f) \text{ and a } \rho \in R_f\text{ such that, for all }\pp\in U,
	          \\r_\pp\text{ equals the image of } \rho \text{ under } R_f\morphism R_\pp
        \end{array}\right\}\\        
        \snake M(U) &\cong \left\{(m_\pp)_{\pp\in U}\in \prod_{\pp\in U} M_\pp \st\text{ the analogous coherence condition}\right\}
    \end{align*}
    by our construction of the sheafification in Definition~\reff{def:sheafification}. Moreover, by Proposition~\reff{prop:sheafificationMorphisms}\itememph{a}, $\Oo_{\Spec R,\pp}\cong R_\pp$ and $(\snake M_\pp)\cong M_\pp$.
\end{rem*}
\begin{fact}\lbl{fact:SpecRfAndSpecRWithoutV(f)}
    The restricted sheaf $\Oo_{\Spec R}|_{\Spec R\setminus V(f)}$ is isomorphic to $\Oo_{\Spec R_f}$ under the identification $\Spec R_f\isomorphism \Spec R\setminus V(f)$ sending $\qq\in \Spec R_f$ to its preimage in $R$ and $\pp\in \Spec R$ to $\qq = \pp R_f$. In the following conditions we identify $\Spec R_f$ with $\Spec R\setminus V(f)$, for the sake of convenience.
\end{fact}
\begin{proof}
	Kinda obvious from the definitions.
\end{proof}
\begin{prop}\lbl{prop:RequalsGlobalSection}
    The maps $R\morphism \Oo_{\Spec R}(\Spec R)$ and $M\morphism \snake M (\Spec R)$, sending $r$ and $m$ (which are global sections of the in \eqreff{eq:SpecRingLoc} and \eqreff{eq:SpecModuleLoc} defined presheaves) to their images in the sheafifications, are isomorphisms.
\end{prop}
\begin{rem*}
    By the previous Fact~\reff{fact:SpecRfAndSpecRWithoutV(f)} and its analogue $\snake M|_{\Spec R_f} \cong \snake{M}_f$, we also have
    \begin{align*}
        \Oo_{\Spec R}\big(\Spec R\setminus V(f)\big) &\isomorphism R_f\\
        \snake M\big(\Spec R\setminus V(f)\big) &\isomorphism M_f\;.
    \end{align*}
    However our proof of Proposition~\reff{prop:RequalsGlobalSection} will yield this directly.
\end{rem*}
\begin{proof}[Proof of Proposition~\reff{prop:RequalsGlobalSection}]
    We show that the presheaves $\Spec R_f\mapsto R_f$ or $\Spec R_f\mapsto M_f$ satisfy the sheaf axiom for covers of elements of $\Bb= \left\{\Spec R_f\st f\in R\right\}$ by elements of $\Bb$. Having established this, the claim follows from Proposition~\reff{prop:sheafificationMorphisms}\itememph{d} (note that $\Bb$ is closed under intersections as we pointed out at the beginning of the section).  If $\Spec R_f = \bigcup_{\lambda\in\Lambda} \Spec R_{g_\lambda}$ is a cover of $\Spec R_f$, we may replace $R$ by $R_f$ so it's enough to consider covers of $\Spec R$ only.
    
    The following Lemma~\reff{lem:finCover} deals with the case of finite covers. The case of arbitrary covers will then be deduced from this special case in a more general setting in Lemma~\reff{lem:finiteCompactSheafAxiom}.
\end{proof}
\begin{lem}\lbl{lem:finCover}
    For every finite cover $\Spec R = \bigcup_{i=1}^n \Spec R_{f_i}$ we have
    \begin{align*}
        R &\isomorphism\left\{(r_i)_{i=1}^n \in \prod_{i=1}^n R_{f_i}\st \text{the images of } r_i \text{ and } r_j \text{ in } R_{f_if_j} \text{ coincide}\right\}\\
        M &\isomorphism\left\{(m_i)_{i=1}^n \in \prod_{i=1}^n M_{f_i}\st \text{the images of } m_i \text{ and } m_j \text{ in } M_{f_if_j} \text{ coincide}\right\}
    \end{align*}
\end{lem}
\begin{proof}
    The first assertion being the special case $M=R$ of the second, we prove the second. For injectivity, assume that $m$ is in the kernel of this map. Then $m$ must be killed be the localizations, hence there are $k_i\geq0$ such that $f^{k_i}_i m_i = 0$ for all $i\leq n$. Since $\emptyset = \bigcap_{i=1}^n V(f_i) = \bigcap_{i=1}^n V\big(f^{k_i}_i\big) = V\big(f_1^{k_1},\ldots, f_n^{k_n}\big)$ it follows that there are $g_i\in R$ such that $\sum_{i=1}^n f_i^{k_i}g_i = 1$ in $R$. Then 
    \begin{align*}
    	0=\sum_{i=1}^{n}f_i^{k_i}g_i\cdot m=1\cdot m=m\;.
    \end{align*}
    
	    To prove surjectivity, let $(m_i)_{i=1}^n$ be an element of the right-hand side and $m_i=\mu_if_i^{-k_i}$ for some $\mu_i\in M$ and $k_i\geq0$. We may always choose $k_i\geq1$ (or arbitrarily large). Replacing $f_i$ by $f_i^{k_i}$ then doesn't change the localization $R_{f_i}$), hence we may assume $m_i = \mu_if_i^{-1}$. If the tuple $(m_i)_{i=1}^n=\big(\mu_if_i^{-1}\big)_{i=1}^n$ is in the right-hand side, then the images of $\mu_if_i^{-1}$ and $\mu_jf_j^{-1}$ in $M_{f_if_j}$ coincide, i.e., there are $k_{i,j}\geq 0$ such that $(f_if_j)^{k_{i,j}}(f_i\mu_j - f_j\mu_i) = 0$ in $M$. Putting $k= \max\left\{ k_{i,j}\st 1\leq i <j\leq n\right\}$ we have 
    \begin{align*}
        f_i^{k+1}f_j^k\mu_j = f_i^k f_j^{k+1}\mu_i
    \end{align*}
    in $M$ or $\snake f_i\snake \mu_j = \snake f_j \snake \mu_i$ where $\snake f_i = f_i^{k+1}$, $\snake f_j = f_j^{k+1}$, $\snake \mu_i = f_i^k\mu_i$, $\snake \mu_j = f_j^k\mu_j$ satisfy $R_{\snake f_i} \cong R_{f_i}$ and $\mu_if_i^{-1} = \smash{\snake \mu_i\snake f_i^{-1}}$ in $M_{f_i} \cong M_{\snake f_i}$. Thus we may assume $f_i\mu_j = f_j\mu_i$ in $M$. As in the injectivity step there are $g_i\in R$ such that $\sum_{i=1}^n f_i g_i = 1$. Let $m = \sum_{i=1}^n g_i\mu_i$, then 
    \begin{align*}
    	f_jm = \sum_{i=1}^n g_if_j\mu_i = \sum_{i=1}^n g_i f_i\mu_j = \mu_j\;. 
    \end{align*}
    Thus $m_j$ is the image of $m$ in $M_{f_j}$.
\end{proof}
\begin{lem}\lbl{lem:finiteCompactSheafAxiom}
    Let $\Bb$ be a topology base of any topological space $X$ which is closed under intersection and $\Ff$ a presheaf on $\Bb$. If the elements of $\Bb$ are quasi-compact and $\Ff$ satisfies the sheaf axiom for finite covers of elements of $\Bb$ by elements of $\Bb$, then it also satisfies the sheaf axiom for arbitrary covers of elements of $\Bb$ by elements of $\Bb$.
\end{lem}
\begin{proof}
    Let $U\in \Bb$ be covered by $U = \bigcup_{\lambda\in \Lambda} U_\lambda$ with $U_\lambda \in \Bb$. As $U$ is quasi-compact, there are $\lambda_1,\ldots,\lambda_n\in \Lambda$ such that $U= \bigcup_{i=1}^n U_{\lambda_i}$. By the assumptions $\Ff(U)\morphism \prod_{i=1}^n \Ff(U_{\lambda_i})$, $f\mapsto \big(f|_{U_{\lambda_i}}\big)_{i=1}^n$ is injective. Hence so is $\Ff(U)\morphism \prod_{\lambda\in \Lambda} \Ff(U_\lambda)$, $f\mapsto\big(f|_{U_\lambda}\big)_{\lambda\in\Lambda}$. 
    
    For surjectivity, let $(f_\lambda)_{\lambda\in \Lambda}\in \prod_{\lambda\in U}\Ff(U_\lambda)$ such that $f_\lambda|_{U_{\lambda,\vartheta}} = f_\vartheta|_{U_{\lambda,\vartheta}}$ where we put $U_{\lambda,\vartheta}=U_\lambda\cap U_\vartheta$ for short. As the sheaf axiom holds for finite covers, there is $f\in \Ff(U)$ such that $f|_{U_{\lambda_i}} = f_{\lambda_i}$. We claim that $f|_\lambda = f_\lambda$. Indeed,
    \begin{align*}
        (f|_{U_\lambda})|_{U_{\lambda,\lambda_i}} = (f|_{U_{\lambda_i}})|_{U_{\lambda,\lambda_i}} = f_{\lambda_i}|_{U_{\lambda,\lambda_i}} = f_\lambda|_{U_{\lambda,\lambda_i}}\;.
    \end{align*}
    As $U_\lambda = \bigcup_{i=1}^n(U_\lambda\cap U_{\lambda_i})$ the map $\Ff(U_\lambda) \morphism \prod_{i=1}^n \Ff(U_\lambda\cap U_{\lambda_i})$, $f\mapsto (f|_{U_{\lambda,\lambda_i}})_{i=1}^n$ is injective by our assumptions. This implies $f|_{U_\lambda}=f_\lambda$ as stated.
\end{proof}
\begin{rem*}
    Another way to apply the principle of the proof of Lemma~\reff{lem:finCover} is to use the fact that when $\bigcap_{i=1}^n V(f_i) = \emptyset$ the \emph{Koszul complex} $K^\bullet\big((f_1,\ldots,f_n),M\big)$
    \begin{diagram*}
    	\node (0) at (0,0) {$0$};
    	\node (M) [right=0.75cm of 0] {$M$};
    	\node (M1) [right=0.75cm of M] {$\displaystyle\smash{\bigoplus_{1\leq i\leq n}}M$};
    	\node (m) [below=0.75cm of M] {$\hphantom{M}$};
    	\node (f) [right=0.75cm of m] {$\hphantom{\displaystyle\smash{\bigoplus_{1\leq i\leq n}}M}$};
    	\node (m1) [below=0.5cm of f] {$\hphantom{\displaystyle\smash{\bigoplus_{1\leq i\leq n}}M}$};
    	\scriptsize
    	\node at (m) {$m$};
    	\node at (m1) {$\big(m_i\big)_{\smash{i=1}}^{\smash{n}}$};    	
    	\node at (f) {$\big(f_im\big)_{\smash{i=1}}^{\smash{n}}$};
    	\node (m2) [right=0.75cm of f] {$\hphantom{\big(f_im_i-f_jm_j\big)_{\rlap{$\scriptstyle i<j$}}}$};
    	\node at (m2) {$\big(m_{i,j}\big)_{\smash{\rlap{$\scriptstyle i<j$}}}$};
    	\node (M2) [right=0.75cm of M1] {$\hphantom{\big(f_im_i-f_jm_j\big)_{\rlap{$\scriptstyle i<j$}}}$};
    	\node (M3) [right=0.75cm of M2] {$\hphantom{\big(f_km_{i,j}+f_im_{j,k}-f_jm_{i,k}\big)_{\rlap{$\scriptstyle i<j<k$}}}$};
    	\node (f3) [right=0.75cm of m2] {$\big(f_km_{i,j}+f_im_{j,k}-f_jm_{i,k}\big)_{\smash{\rlap{$\scriptstyle i<j<k$}}}$};
    	\node (f2) [right=0.75cm of m1] {$\big(f_im_i-f_jm_j\big)_{\smash{\rlap{$\scriptstyle i<j$}}}$};
    	\normalsize
    	\node at (M2) {$\displaystyle\smash{\bigoplus_{1\leq i<j\leq n}}M$};
    	\node at (M3) {$\displaystyle\smash{\bigoplus_{1\leq i<j<k\leq n}}M$};
    	\node (dots) [right=0.75cm of M3] {$\quad\cdots$};
    	\draw[->] (0) -- (M);
    	\draw[->] (M) -- (M1);
    	\draw[->] (M1) -- (M2);
    	\draw[->] (M2) -- (M3);
    	\draw[|->] (m) -- (f);
    	\draw[|->] (m1) -- (f2);
    	\draw[|->] (m2) -- (f3);
    	\draw[->] (M3) -- (dots);
    \end{diagram*}
    is \emph{contracted} by $(g_i)_{i=1}^n$ such that $\sum_{i=1}^n g_if_i = 1$ via
    \begin{align*}
    	(m_i)_{i=1}^n \longmapsto \sum_{i=1}^n g_im_i\;,\quad (m_{i,j})_{i<j}\longmapsto \bigg(\sum_{j=1}^n g_j m_{i,j}\bigg)_{i=1}^n\;,\quad\ldots
    \end{align*}
     (where $m_{i,j}=-m_{j,i}$ if $i>j$ and $m_{i,i}=0$). But if $\Uu$ denotes the cover $\Spec R = \bigcup_{i=1}^n \Spec R_{f_i}$ then 
     \begin{align*}
     	0\morphism M\morphism \check{C}^\bullet\Big(\Uu,\text{the presheaf giving } \snake M\Big)\lisomorphism \colimit[k\in\IN] K^\bullet\big((f_1^k, \ldots, f_n^k),M\big)
     \end{align*}
     which is the argument used in EGA to show Proposition~\reff{prop:RequalsGlobalSection} and the vanishing of higher cohomologies (an introduction to Koszul complexes and their connection to \v{C}ech complexes can be found in \cite[Section~2.1 and proof of Theorem~2]{alggeo2}).
\end{rem*}
\begin{example}
    \begin{alphanumerate}
        \item 
            When $\nil(R)\in \mSpec R$ (this is Frankespeak for ``$R$ has only one prime ideal''), $\Oo_{\Spec R}$ is already uniquely described by 
            \begin{align*}
            	\Oo_{\Spec R} (U) = 
            	\begin{cases}
	            	R& \text{if }U=\Spec R\\
	            	0 & \text{if }U=\emptyset
            	\end{cases}\;.
            \end{align*}
        \item 
            When $R$ is a a principal ideal domain (or more generally, a Dedekind domain with finite class group $\Cl_R$, as in this case $\pp^{\#\Cl_R}=(\pi)$ is a principal ideal for every prime ideal $\pp$ and $V(\pp)=V(\pi)$), $\Oo_{\Spec R}$ is already uniquely described by  
            \begin{align*}
            	\Oo_{\Spec R}(U)= 
            	\begin{cases}
	            	R_f&\text{if }U=\Spec R\setminus V(f)\\
	            	0 &\text{if }U=\emptyset
            	\end{cases} \;.
            \end{align*}
    \end{alphanumerate}
\end{example}
\begin{rem}
    Proposition \reff{prop:RequalsGlobalSection} would have failed if we had defined $\Oo_{\Spec R}$ as a sheaf of functions $\pp\morphism \KK(\pp)$ as $R$ may have nilpotent elements.
\end{rem}
\begin{prop}\lbl{prop:affineSchemeAdjunction}
    If $R$ is a ring and $X$ a locally ringed space, we have a canonical bijection
    \begin{align*}
        \Hom_{\cat{LRS}}(X,\Spec R) &\isomorphism \Hom_{\cat{Ring}}(R,\Oo_X(X))\\
        \big(X\morphism[\xi] \Spec R\big) &\longmapsto \Big(R\isomorphism \Oo_{\Spec R}(\Spec R) \morphism[\xi^*] \Oo_X(X)\Big)\;.
    \end{align*}
\end{prop}
\begin{rem*}
    Thus, $\cat{Ring}^\op \xrightarrow{\Spec(-)} \cat{LRS}$ is right-adjoint to $\cat{LRS} \xrightarrow{\Oo_-(-)} \cat{Ring}^\op$.
\end{rem*}
\begin{proof}[Proof of Proposition~\reff{prop:affineSchemeAdjunction}]
    Let $X\morphism[f] \Spec R$ be a morphism in $\cat{LRS}$. We want to show that it is uniquely determined by the composition 
    \begin{align*}
    	\phi\colon R \isomorphism (\Oo_{\Spec R})(\Spec R) \morphism[f^*]\Oo_X(X)=\Oo_X\big(f^{-1}(\Spec R)\big)=f_*\Oo_X(\Spec R)\;. 
    \end{align*}
    Let $x\in X$, $\pp=f(x)$. We have a commutative diagram
    \begin{diagram*}
    	\node[ob] (R) at (0,1.5) {$R$};
    	\node[ob] (OR) at (2.5,1.5) {$\Oo_{\Spec R}(\Spec R)$};
    	\node[ob] (OX) at (5.5,1.5) {$\Oo_X(X)$};
    	\node[ob] (Rp) at (0,0) {$R_\pp$};
    	\node[ob] (ORp) at (2.5,0) {$\Oo_{\Spec R,\pp}$};
    	\node[ob] (OXx) at (5.5,0) {$\Oo_{X,x}$};
    	\scriptsize
    	\draw[->] (R) -- (Rp);
    	\draw[->] (R) -- (OR) node[pos=0.5,above=-0.25ex] {$\sim$};
    	\draw[->] (Rp) -- (ORp) node[pos=0.5,above=-0.25ex] {$\sim$};
    	\draw[->] (OR) -- (ORp);
    	\draw[->] (OX) -- (OXx);
    	\draw[->] (OR) -- (OX) node[pos=0.5, above] {$f^*$};
    	\draw[->] (ORp) -- (OXx) node[pos=0.5, above] {$f^*$};
    \end{diagram*}
     As the arrow $\Oo_{\Spec R,\pp}\morphism \Oo_{X,x}$ is local and the preimages of the maximal ideal $\mm_{X,x}$ of $\Oo_{X,x}$ in $R_\pp$ and $R$ are $\pp R_\pp$ and $\pp$, the prime ideal $\pp$ is uniquely determined as the preimage of $\mm_{X,x}\subseteq \Oo_{X,x}$ under $R\morphism[\phi] \Oo_X(X)\morphism \Oo_{X,x}$. By the universal property of the localization $R\morphism R_\pp$, the arrow $\Oo_{\Spec R,\pp}\morphism \Oo_{X,x}$ is also uniquely determined by $\phi$ and the commutativity of the diagram. Thus, for all $x\in X$, the maps $\Oo_{\Spec R, f(x)}\morphism[f^*]\Oo_{X,x}$ are uniquely determined by $\phi$. It follows by the following fact that $f$ is uniquely determined.
\begin{fact}
    If $X\doublemorphism[a][\smash{b}] Y$ are morphisms in $\cat{LRS}$ such that $a(x)=b(x)$ for all points in $x\in X$ and such that $\Oo_{Y,a(x)} = \Oo_{Y,b(x)} \doublemorphism[\smash{a^*}][b^*] \Oo_{X,x}$ coincide for all $x\in X$, then $a=b$.
\end{fact}
\begin{proof}
    It is only necessary to show this for the pull-backs of $\upsilon\in \Oo_Y(U)$ under $a^*$ and $b^*$, for $U\subseteq Y$ open. But the images of $a^*\upsilon$ and $b^*\upsilon$ in $\Oo_{X,x}$, for $x\in f^{-1}U$, coincide with the images under $\upsilon$ under $\Oo_Y(U) \morphism \Oo_{Y,y}\doublemorphism[a^{\smash{*}}][b^*] \Oo_{X,x}$, hence are equal. But $\Oo_X(f^{-1}U) \morphism \prod_{x\in f^{-1}U} \Oo_{X,x}$ is injective by Corollary~\reff{cor:sheafDefinedByStalks}\itememph{a}. Thus $a^*\upsilon = b^*\upsilon$.
\end{proof}
\begin{cor}
    If $X\morphism[\iota] Y$ is a morphism in $\cat{LRS}$ such that $\iota$ is injective on points and such that $\Oo_{Y,\iota(x)} \morphism[\iota^*] \Oo_{X,x}$ is surjective, then $\iota$ is a monomorphism.
\end{cor}
    We are left to prove surjectivity. Let $R\morphism[\phi] \Oo_X(X)$ be given. We put 
    \begin{align}\lbl{eq:prop1.4.2surj}
        f(x) = \left\{r\in R\st x\in V\big(\phi(r)\big) \right\}\;.\tag{$*$}
    \end{align}
    Note that $f(x)$ is a prime ideal as it's the preimage of $\mm_{X,x} \subseteq \Oo_{X,x}$ under $R\morphism[\phi] \Oo_X(X) \morphism \Oo_{X,x}$. As before, let $\Bb$ be the topology base $\left\{\Spec R_\lambda\st \lambda\in R\right\}$ of $\Spec R$. If $U\in \Bb$, we have a morphism 
    \begin{align*}
        f^*\colon \Oo_{\Spec R}(U) \cong R_\lambda  \morphism[\phi] \Oo_X(X)_{\phi(\lambda)} \xrightarrow{\text{\eqreff{eq:moduleLoc}}} \Oo_X\big(X\setminus V(\phi(\lambda))\big) = \Oo_X(f^{-1} U)
    \end{align*}
    defining a homomorphism of presheaves on $\Bb$ with target $f_*\Oo_X|_\Bb$. Sheafifying gives a morphism of sheaves
    \begin{align*}
        f^*\colon \Oo_{\Spec R}\cong (\Oo_{\Spec R}|_\Bb)^\sh \morphism (f_*\Oo_X|_\Bb)^\sh \cong f_*\Oo_X\;.
    \end{align*}
    In particular, for $\lambda = 1$, we have that $R\cong  \Oo_{\Spec R}(\Spec R) \morphism[f^*] \Oo_X(X)$ equals $\phi$. The morphism induced on stalks by $f$ is thus the uniquely determined morphism $R_\pp \morphism \Oo_{X,x}$ (where $\pp=f(x)$) such that 
    \begin{diagram*}
    	\node[ob] (a) at (0,1.5) {$R$};
    	\node[ob][ob] (c) at (0,0) {$R_\pp$};
    	\node[ob] (b) at (2.5,1.5) {$\Oo_X(X)$};
    	\node[ob][ob] (d) at (2.5,0) {$\Oo_{X,x}$};
    	\scriptsize
    	\draw[->] (a) -- (b) node[pos=0.5, above] {$\phi$};
    	\draw[->] (a) -- (c);
    	\draw[->] (c) -- (d);
    	\draw[->] (b) -- (d);
    \end{diagram*}  
    commutes. By \eqreff{eq:prop1.4.2surj}, the morphism $R\morphism[\phi] \Oo_X(X) \morphism \Oo_{X,x}$ maps $\pp$ to $\mm_{X,x}$, hence $R_\pp \morphism \Oo_{X,x}$ maps $\pp\cdot R_\pp$ to $\mm_{X,x}$ and therefore is local. Thus $f$ is a morphism of locally ringed spaces and we are done.
\end{proof}
\begin{rem*}
    In particular, for $X=\Spec S$ any ring morphism $R\morphism[\phi] S$ defines a morphism of locally ringed spaces
    \begin{align}\lbl{eq:specFunctor}
    \begin{gathered}[m]
          \Spec \phi \colon \Spec S \morphism \Spec R\\
        (\Spec \phi)(\qq) = \phi^{-1}\qq\in\Spec R\;,\quad
        (\Spec \phi)^*\left(\frac{r}{f}\right) = \frac{\phi(r)}{\phi(f)} \in S_{\phi(f)} \cong \Oo_{\Spec S}(\Spec S_f)
        \end{gathered}
    \end{align}
    (with $\qq\in\Spec S$ and $\frac{r}{f}\in R_f$) turning $\Spec$ to a covariant functor from $\cat{Ring}^\op$ to $\cat{LRS}$ which is right-adjoint to the global sections functor. 
\end{rem*}
\begin{cor}
    $\Spec \IZ$ is a final object in $\cat{LRS}$. The unique morphism $X\morphism \Spec \IZ$ in $\cat{LRS}$ sends any $x\in X$ to the ideal in $\IZ$ generated by the characteristic of the residue field $\KK(x)$ and any fraction $\frac{a}{b}\in \Oo_{\Spec \IZ}(\IZ_b)$ to $\frac{a}{b} \in \Oo_X(X\setminus V(b))$.
\end{cor}
\begin{cor}
    If $R\doublemorphism[a][\smash{b}] S$ is a pair of ring homomorphisms and $I\subseteq S$ denotes the ideal $I=\left(a(r)-b(r)\st r\in R\right)_S$ then 
    \begin{align*}
        \Spec S/I \xrightarrow{\Spec \pi} \Spec S
    \end{align*}
    ($\pi$ denoting the projection $S\morphism S/I$) is an equalizer of 
    \begin{align*}
        \Spec S\xdoublemorphism[\Spec a][\Spec b] \Spec R\;.
    \end{align*}
\end{cor}
\begin{proof}    	
	Right-adjoint functors preserve arbitrary limits, in particular, equalizers.
\end{proof}
\begin{cor}\lbl{cor:affineSchemesFibreProduct}
    Let $R$ be a ring, $A$ and $B$ be $R$-algebras, and let 
    \begin{align*}
        A\morphism[\alpha] A\otimes_R B \lmorphism[\beta] B
    \end{align*}
    given by $\alpha(a) = a\otimes 1$ and $\beta(b) = 1\otimes b$. Then     
    \begin{diagram*}
    	\node[ob] (a) at (0,1.5) {$\Spec\left(A\otimes_R B\right)$};
    	\node[ob](c) at (0,0) {$\Spec A$};
    	\node[ob](b) at (3,1.5) {$\Spec B$};
    	\node[ob](d) at (3,0) {$\Spec R$};
    	\scriptsize
    	\draw[->] (a) -- (b) node[pos=0.5, above] {$\Spec \beta$};
    	\draw[->] (a) -- (c) node[pos=0.5, left] {$\Spec \alpha$};
    	\draw[->] (c) -- (d);
    	\draw[->] (b) -- (d);
    \end{diagram*}       
    is a fibre product of $\Spec A$ with $\Spec B$ over $\Spec R$ in $\cat{LRS}$. 
\end{cor}
\begin{proof}
	This follows from the fact that $A\otimes_R B$ is a cofibre product of $A$ with $B$ over $R$ hence a fibre product in $\cat{Ring}^\op$ and the (by Proposition~\reff{prop:affineSchemeAdjunction}) right-adjoint functor $\Spec(-)$ preserves arbitrary limits, in particular, fibre products.
\end{proof}
\begin{prop}\lbl{prop:affineSchemeAdjunctionModules}
    Let $M$ be an $R$-module and $\Nn$ an $\Oo_{\Spec R}$-module, then we have a canonical bijection 
    \begin{align*}
        \Hom_{\Oo_{\Spec R}} \big(\snake M, \Nn\big) \morphism \Hom_R\big(M, \Nn(\Spec R)\big)
    \end{align*}
    sending $\snake M \morphism[f] \Nn$ to the composition 
    \begin{align*}
        \phi\colon M\cong \snake M (\Spec R) \morphism[f] \Nn(\Spec R)\;.
    \end{align*}
\end{prop}
\begin{proof}
    If $f$ and $\phi$ are as above, then we have a commutative diagram
    \begin{diagram*}
		\node[ob](M) at (0,1.5) {$M\cong \snake{M}( \Spec R)$};
		\node[ob](N) at (3.5,1.5) {$\Nn(\Spec R)$};
		\node[ob](Mp) at (0,0) {$M_\pp\cong \snake M_\pp$};
		\node[ob](Np) at (3.5, 0) {$\Nn_\pp$};
		\scriptsize
		\draw [->] (M) -- (Mp);
		\draw [->] (M) -- (N) node[pos=0.5,above] {$\phi$};
		\draw [->] (Mp) -- (Np) node[pos=0.5,above] {$f$};
		\draw [->] (N) -- (Np);
	\end{diagram*}
	in which the lower horizontal arrow is, in view of the universal property of $M\morphism M_\pp$, uniquely determined by $\phi$. Therefore, the morphism induced by $f$ on stalks, and hence $f$ itself, are uniquely determined by $\phi$. 
	
	If conversely $\phi$ is given and $\Bb$ denotes the topology base $\left\{\Spec R_\lambda\st \lambda\in R\right\}$ as before, we have for any such $U=\Spec R_\lambda$ a unique morphism $M_\lambda\morphism \Nn(U)$ given as the composition 
	\begin{align*}
		M_\lambda \morphism[\phi] \Nn(\Spec R)_\lambda \morphism \Nn(U)\;. 
	\end{align*}
	Sheafifying gives
	\begin{align*}
	    \snake M = (\Spec R_\lambda \mapsto M_\lambda)^\sh \morphism (\Nn|_\Bb)^\sh \cong \Nn
	\end{align*}
	which induces $\phi$ on global sections. 
\end{proof}
\begin{defi}[Quasi-coherence]\lbl{def:quasicoherent}
    Let $X=\Spec R$. An $\Oo_X$-module $\Mm$ is called \defemph{quasi-coherent} if it satisfies the following equivalent conditions:
    \begin{alphanumerate}
        \item 
            $\Mm \cong\snake M$ for some $R$-module $M$.
        \item 
            The morphism $\Mm(X)_\lambda \xrightarrow{\text{\eqreff{eq:moduleLoc}}} \Mm(X\setminus V(\lambda))$ is an isomorphism for all $\lambda\in R$. 
        \item 
            The canonical morphism $\snake M \morphism[c] \Mm$ (with $M = \Mm(X)$) associated by Proposition~\reff{prop:affineSchemeAdjunctionModules} to $\id_M$ is an isomorphism.
    \end{alphanumerate} 
\end{defi}
A Franke lecture is no Franke lecture without a definition being proved.
\begin{proof}
    For \itememph{a} $\Rightarrow$ \itememph{b} note that $\snake M(X\setminus V(\lambda)) \lisomorphism M_\lambda$ by Proposition~\reff{prop:RequalsGlobalSection} and its first remark.
    
    Our construction and \itememph{b} imply that $c$ induces an isomorphism on sections on any element of the topology base $\Bb$, hence everywhere. This shows \itememph{b} $\Rightarrow$ \itememph{c}. 
    
    The last implication \itememph{c} $\Rightarrow$ \itememph{a} is obvious.
\end{proof}
\begin{cor}
    There is a canonical bijection from the quasi-coherent sheaves of ideals $\Jj$ on $X=\Spec R$ to the ideals $I\subseteq R$ by 
    \begin{align*}
    \left\{
    \begin{array}{c}
	    \text{quasi-coherent sheaves of}\\
	    \text{ideals }\Jj\text{ on }X=\Spec R
    \end{array}\right\}&\isomorphism \left\{\text{ideals }I\subseteq R\right\} \\
        \Jj&\longmapsto \Jj(X) \subseteq \Oo_X(X) \cong R\\
        \left(
        \begin{array}{c}
	        \text{image of } \snake I \text{ under}\\
	         \snake I \morphism \snake R \cong\Oo_X
        \end{array}\right)
         &\longmapsfrom I\;.
    \end{align*}
\end{cor}


\section{Preschemes and schemes}
\begin{defi}[Preschemes. \textsc{Yay, finally!}] \lbl{def:prescheme}
    A locally ringed space $X$ is a \defemph{prescheme} if every $x\in X$ has an open neighbourhood $U$ such that the locally ringed space $(U,\Oo_X|_U)$ is isomorphic to $\Spec R$ in $\cat{LRS}$, for some ring $R$. 
    
    The category of preschemes is a full subcategory of $\cat{LRS}$, i.e., every morphism of locally ringed spaces between two preschemes is a morphism of preschemes.
\end{defi}
\begin{example}
    For every ring $R$, $\Spec R$ is a prescheme.
\end{example}
\begin{example}
    If $X$ is a prescheme and $U\subseteq X$ an open subset, $(U, \Oo_X|_U)$ is a prescheme (called an \emph{open subprescheme} of $X$). This follows from Fact~\reff{fact:affineSchemesTopologyBase}.
\end{example}
\begin{example*}
    The empty set is a prescheme and is the initial object in both $\cat{PSch}$, the category of preschemes, and $\cat{LRS}$.
\end{example*}
\begin{defi}[Affine prescheme]\lbl{def:affinePrescheme}
    A prescheme $X$ is called \defemph{affine} if $X\cong \Spec R$ in $\cat{LRS}$, for some ring $R$. An open subset $U\subseteq X$ is called \emph{affine} if $(U,\Oo_X|_U)$ is an affine prescheme.
\end{defi}
\begin{rem*}
    By Proposition~\reff{prop:affineSchemeAdjunction} $X$ is affine iff $X\morphism \Spec R$ (with $R=\Oo_X(X)$, the morphism being the one associated to $\id_R$ by that proposition) is an isomorphism. 
\end{rem*}
\begin{rem*}
	\begin{alphanumerate}
		\item It's a well-known fact that $\Spec R$ is quasi-compact for any ring $R$, hence any affine open subset of a prescheme is quasi-compact. 
		\item Schemes will be preschemes with an additional separation condition implying (but not equivalent to) that a proper intersection of two affine open subsets is affine again (and hence quasi-compact).
		\item Also, recall the well-known fact that $\left\{\Spec R\setminus V(f)\right\}$ is a topology base on $\Spec R$ consisting of affine open subsets (as $\Spec R\setminus V(f)\cong \Spec R_f$, cf.\ \cite[Corollary~2.3.1\itememph{e}]{alg1}). 
	\end{alphanumerate}
\end{rem*}
\begin{fact}\lbl{fact:affineSchemesTopologyBase}
	Let $X$ be a prescheme.
	\begin{alphanumerate}
		\item  The affine open subsets of  $X$ form a topology base on $X$.
		\item More precisely if $X=\bigcup_{\lambda\in \Lambda} U_\lambda$ is a cover of $X$ by affine open subsets $U_\lambda$, then 
		\begin{align*}
		\left\{U_\lambda\setminus V(f)\st \lambda\in \Lambda\text{, }f\in \Oo_X(U_\lambda)\right\}
		\end{align*}
		is a topology base on $X$ consisting of affine open subsets.
	\end{alphanumerate}
\end{fact}
\begin{rem*}
    In particular, if $U\subseteq X$ is open, it can be covered by affine open subsets of $X$. 
\end{rem*}
\begin{proof}[Proof of Fact~\reff{fact:affineSchemesTopologyBase}]
    It is sufficient to show the second part. Let $V\subseteq X$ be open. As the sets $\left\{\Spec R\setminus V(g)\st g\in R\right\}$ form a topology base on $\Spec R$, we have
    \begin{align*}
    	V\cap U_\lambda = \bigcup_{\xi\in\Xi_\lambda} U_\lambda \setminus V(f_{\lambda,\xi})\;, 
    \end{align*}
    for some indexing sets $\Xi_\lambda$ and $f_{\lambda,\xi}\in \Oo_X(U_\lambda)$. Then 
    \begin{align*}
    	V= \bigcup_{\lambda\in\Lambda} V\cap U_\lambda= \bigcup_{\lambda\in \Lambda} \bigcup_{\xi\in\Xi_\lambda} U_\lambda\setminus V(f_{\lambda,\xi})\;,
    \end{align*}
    proving that $V$ can be covered by elements of the above set.
\end{proof}
\begin{defi}[Quasi-compact, quasi-separated]\lbl{def:quasicompact}
    A prescheme $X$ is called \defemph{quasi-compact} if it satisfies the following equivalent criteria:
    \begin{alphanumerate}
        \item 
            The topological space $X$ is quasi-compact.
        \item 
            $X$ may be covered by finitely many affine open subsets. 
        \item 
            $X$ may be covered by finitely many quasi-compact open subsets.
    \end{alphanumerate}
    A prescheme $X$ is called \defemph{quasi-separated}, if it satisfies the following equivalent conditions:
    \begin{alphanumerate}\setcounter{enumi}{3}
        \item 
            The intersection of two affine open subsets is quasi-compact.
        \item 
            The intersection of two quasi-compact subsets is quasi-compact. 
        \item 
            $X$ has a topology base $\Bb$ such that the intersection of two elements of $\Bb$ is quasi-compact.
    \end{alphanumerate}
\end{defi}
\begin{proof}[Aaand another definition demanding to be proved]
    The union $U$ of finitely many quasi-compact open subsets $U_1,\ldots,U_n$ of a topological space $X$ is again quasi-compact. Indeed, for any cover $U= \bigcup_{\lambda\in\Lambda} V_{\lambda}$ by open subsets, each $U_i = \bigcup_{\lambda\in \Lambda} U_i\cap V_\lambda$ has a finite subcover $U_i=\bigcup_{j=1}^{n_i}U_i\cap V_{\lambda_{i,j}}$ and all these finite subcovers give us a finite subcover $U = \bigcup_{i=1}^n \bigcup_{j=1}^{n_i} U_{\lambda_{i,j}}$. 
    
    So \itememph{a} implies \itememph{b} definition of quasi-compactness and Fact~\reff{fact:affineSchemesTopologyBase}, \itememph{b} implies \itememph{c} since $\Spec R$ is quasi-compact and \itememph{c} implies \itememph{a} by the above considerations. 
    
    We obtain \itememph{e} $\Rightarrow$ \itememph{d} since affine open subsets are quasi-compact and \itememph{d} $\Rightarrow$ \itememph{f} by Fact \reff{fact:affineSchemesTopologyBase}. To see that \itememph{f} implies \itememph{e}, let $\Bb$ be as in \itememph{f} and $V$ and $W$ be quasi-compact open subsets. Then $V= \bigcup_{i=1}^m B_i$, $W=\bigcup_{j=1}^n C_j$ with $B_i,C_j\in \Bb$. Then $V\cap W = \bigcup_{i=1}^m \bigcup_{j=1}^n B_i\cap C_j$ is quasi-compact since all $B_i\cap C_j$ are quasi-compact by assumption.
\end{proof}
\begin{fact}
    \begin{alphanumerate}
        \item
            $\Spec R$ is quasi-compact and quasi-separated. \lbl{fact:SpecRqcqs}
        \item   
            Suppose that $Y\morphism X$ is a morphism of preschemes which is a homeomorphism onto a closed subset of $X$ carrying the induced topology. Then $X$ being quasi-compact implies $Y$ being quasi-compact, and $X$ being quasi-separated implies $Y$ being quasi-separated.
    \end{alphanumerate}
\end{fact}
\begin{proof}
    The assertions about quasi-compactness are well-known. For quasi-separatedness in \itememph{a}, we take $\Bb=\left\{\Spec R_f\st f\in R\right\}$, whose elements are quasi-compact and which is closed under intersection, hence Definition~\reff{def:quasicompact}\itememph{f} applies. For \itememph{b} take $\Bb= \left\{V\cap Y\st V\subseteq X \text{ affine}\right\}$.
\end{proof}
\begin{prop}\lbl{prop:coherentDef}
    Let $X$ be a prescheme, $\Mm$ an $\Oo_X$-module. The following conditions are equivalent:
    \begin{alphanumerate}
        \item 
            $X$ may be covered by affine open subsets $U$ such that $\Mm|_U$ is quasi-coherent.
        \item 
            $X$ has a topology base consisting of affine open subsets $U$ such that $\Mm|_U$ is quasi-coherent.
        \item   
            When $U\subseteq X$ is open and quasi-compact, the morphism
            \begin{align}\lbl{eq:bijectiveQCQS}
                \Mm(U)_\lambda \xrightarrow{\text{\eqreff{eq:moduleLoc}}} \Mm\big(U\setminus V(\lambda)\big)\tag{$*$}
            \end{align}
            is injective for all $\lambda\in \Oo_X(U)$. It is bijective when $U$ is open, quasi-compact and quasi-separated.
        \item 
            \eqreff{eq:bijectiveQCQS} is bijective when $U$ is open, quasi-compact and quasi-separated.
        \item 
            \eqreff{eq:bijectiveQCQS} is bijective when $U$ is affine open.
        \item 
            For arbitrary affine open $U$, $\Mm|_U$ is quasi-coherent.
    \end{alphanumerate}
\end{prop}
\begin{proof}
    Assume \itememph{a}. Recall that $\snake M|_{\Spec R_f} \cong \snake M_f$ for $M$ an $R$-module and $f\in R$. In particular, when $X = \bigcup_{\lambda\in\Lambda}U_\lambda$ is a cover with $U_\lambda$ affine and $\Mm|_{U_\lambda}$ quasi-coherent, then $\Mm|_{U_\lambda\setminus V(f)}$ is quasi-coherent. By Fact~\reff{fact:affineSchemesTopologyBase}\itememph{b}, \itememph{b} follows.
    
    Now let \itememph{b} be given. Let $\Bb$ be a topology base of affine open subsets such that $\Mm|_U$ is quasi-coherent when $U\in\Bb$. By Definition~\reff{def:quasicoherent}\itememph{b}, \eqreff{eq:bijectiveQCQS} is an isomorphism for $U\in\Bb$. Now let $U$ be a quasi-compact open subset, $\lambda\in \Oo_X(U)$, $m=\mu \lambda^{-s}\in \Mm(U)_\lambda$ (with $\mu\in \Mm(U)$ and $s\geq0$) such that the image of $m$ under \eqreff{eq:bijectiveQCQS} vanishes. Then $\mu|_{U\setminus V(\lambda)} = 0$. As $U$ is quasi-compact it can be represented $U=\bigcup_{i=1}^n U_i$ with $U_i\in\Bb$. As \eqreff{eq:bijectiveQCQS} is bijective for $U_i$, we have $k_i\in\IN$ such that $\lambda^{k_i}\mu|_{U_i}= 0$ in $\Mm(V_i)$. Let $k=\max_{i=1,\ldots,n} k_i$, then $\lambda^k\mu|_{U_i} = 0$, hence $\lambda^k\mu = 0$ in $\Mm(U)$ as $\Mm$ is a sheaf. Thus, $m = \mu \lambda^{-s}\in M(U)_\lambda$ is zero, which shows injectivity.
    
    To show the asserted bijectivity, let $\Bb$ be as before, $U\subseteq X$ be open, quasi-compact and quasi-separated, and let $m\in \Mm(U\setminus V(f))$ be given. As before we have $U=\bigcup_{i=1}^n U_i$ with $U_i\in\Bb$. As \eqreff{eq:bijectiveQCQS} is an isomorphism on $U_i$ and there are only finitely many $U_i$, we find $\mu_i\in\Mm(U_i)$ and an exponent $k\geq0$ such that $m|_{U_i\setminus V(\lambda)} = \mu_i\lambda^{-k}$. For brevity, denote $U_{i,j}=U_i\cap U_j$. Let $\mu_{i,j} = \mu_i|_{U_{i,j}} - \mu_j|_{U_{i,j}}$, then $\mu_{i,j}|_{U_{i,j}\setminus V(\lambda)} = 0$. As $U$ is quasi-separated and the $U_i$ are affine, this implies $\lambda^{\ell_{i,j}} \mu_{i,j} = 0$ in $\Mm(U_{i,j})$ (for some exponents $\ell_{i,j}\geq0$) by the injectivity step, which applies here since $U_{i,j}$ is quasi-compact by Definition~\reff{def:quasicompact}\itememph{d}. Taking $\ell = \max_{i,j}\ell_{i,j}$ we have $\lambda^\ell\mu_i |_{U_{i,j}} = \lambda^\ell\mu_j|_{U_{i,j}}$ and replacing $k$ by $k+\ell$ and $\mu_i$ by $\lambda^\ell \mu_i$, we achieve $\mu_i|_{U_{i,j}} = \mu_j|_{U_{i,j}}$. As $\Mm$ is a sheaf, there is $\mu\in\Mm(U)$ such that $\mu|_{U_i} = \mu_i$. Then $\big(\mu \lambda^{-k}\big)|_{U\setminus V(\lambda)} = m$ as the restriction of the left-hand side to $U_i\setminus V(\lambda)$ equals $\mu_i\lambda^{-k} = m|_{U_i\setminus V(\lambda)}$. 
    
    The hard work being done, \itememph{c} trivially implies \itememph{d}. We obtain \itememph{d} $\Rightarrow$ \itememph{e} by Fact~\reff{fact:SpecRqcqs}\itememph{a}, \itememph{e} $\Rightarrow$ \itememph{f} by Definition~\reff{def:quasicoherent}\itememph{b} and \itememph{f} $\Rightarrow$ \itememph{a} by Definition~\reff{def:prescheme}.
\end{proof}
\begin{cor}\lbl{cor:OXInjectiveQuasiCompact}
    The morphism $\Oo_X(U)_\lambda\xrightarrow{\text{\eqreff{eq:moduleLoc}}} \Oo_X\big(U\setminus V(\lambda)\big)$ is injective when $U$ is quasi-compact and bijective, when $U$ is quasi-compact and quasi-separated. 
\end{cor}
\begin{cor}\lbl{cor:nilpotentVanishingSet}
    When $U$ is quasi-compact and $\lambda\in \Oo_X(U)$ such that $V(\lambda) = U$ then $\lambda$ is nilpotent. (Vice versa, we clearly have $V(\lambda) = U$ when $\lambda$ is nilpotent, even when $U$ is not quasi-compact.)
\end{cor}
\begin{proof}
	By Corollary~\reff{cor:OXInjectiveQuasiCompact}, $\Oo_X(U)_\lambda \morphism\Oo_X(\emptyset)$ is injective, hence $\Oo_X(U)_\lambda$ is the zero ring and $\lambda$ must be nilpotent.
\end{proof}
\begin{defi}[Quasi-coherence]\lbl{def:preschemeQuasiCoherent}
    Let $X$ be a prescheme. An $\Oo_X$-module is called \defemph{quasi-coherent}, if it satisfies the equivalent conditions of Proposition~\reff{prop:coherentDef}.
\end{defi}
\begin{fact}\lbl{fact:kernelQC}
    If $\Mm\morphism[\mu] \Nn$ is a morphism of $\Oo_X$-modules, with $\Mm$ and $\Nn$ quasi-coherent, then $\ker(\mu)$ is quasi-coherent.
\end{fact}
\begin{proof}
	Let $U\subseteq X$ be affine open. As $\Mm$ and $\Nn$ are quasi-coherent, there are $\Oo_X(U)$-modules $M$ and $N$ such that $\Mm|_U=\snake{M}$, $\Nn|_U=\snake{N}$. By Proposition~\reff{prop:affineSchemeAdjunctionModules}, $\Mm|_U\morphism[\mu]\Nn|_U$ corresponds to a morphism $M\morphism[\mu_U]N$. If intuition is worth anything in this world, we should have $\ker(\mu)|_U=\snake{P}$ with $P=\ker(\mu_U)$. Indeed, it's enough to check that $\snake{P}$ has the right stalks and it has, as $P_\pp=\ker\left(M_\pp\morphism[\mu_U]N_\pp\right)=\ker(\mu)_\pp$, using that localization is an exact functor and thus preserves kernels.
\end{proof}
\begin{example*}
    $\Oo_X$ is quasi-coherent.
\end{example*}
\begin{defi}\lbl{def:qcqs}
    Let $X\morphism[f] Y$ be a morphism between preschemes. We say that $f$ is
    \begin{alphanumerate}
        \item
            a \defemph{closed embedding} if it is a \emph{closed immersion} in the sense of Definition~\reff{def:immersiveMorphism}.
        \item 
            \defemph{quasi-compact} when it satisfies the following equivalent conditions:
            \begin{itemize}
              \item[\itememph{\alpha}]
                When $U\subseteq Y$ is affine, $f^{-1}(U)$ is quasi-compact.
              \item[\itememph{\beta}]
                When $U$ is quasi-compact, $f^{-1}(U)$ is quasi-compact.
              \item[\itememph{\gamma}]
                $Y$ has a topology base $\Bb$ such that $f^{-1}(U)$ is quasi-compact for $U\in \Bb$.
            \end{itemize}
        \item 
            \defemph{quasi-separated} if the preimage of any affine open subset of $Y$ is quasi-separated (two more equivalent conditions are given in Lemma~\reff{lem:qsmorphism}).
    \end{alphanumerate}
\end{defi}
\begin{rem}
    \begin{alphanumerate}
        \item \lbl{rem:qcqs}
            The equivalence of the three conditions in Definition~\reff{def:qcqs}\itememph{b} can be seen via \itememph{\beta} $\Rightarrow$ \itememph{\alpha} $\Rightarrow$ \itememph{\gamma} $\Rightarrow$ \itememph{\beta} as in the proof of Definition~\reff{def:quasicompact} (which actually is a special case of this). 
        \item 
            $X$ is quasi-separated iff for any quasi-compact open subset $U$ the embedding $U\monomorphism X$ is quasi-compact (preimages in this case are just intersections with $U$ and we obtain Definition~\reff{def:quasicompact}\itememph{e}).
        \item 
            Open embeddings are quasi-separated for trivial reasons.
        \item
	        Closed embeddings are quasi-compact. Indeed, taking the preimage in this case is the same as intersecting with the closed image of the closed embedding and closed subsets of quasi-compact spaces are quasi-compact again.
    \end{alphanumerate}
\end{rem}
\begin{prop}
    \begin{alphanumerate}
        \item\lbl{prop:closedEmbeddingPrescheme}
            A closed embedding of preschemes is quasi-compact and quasi-separated.
        \item 
            Let $X\morphism[\smash{f}] Y$ be a morphism of preschemes which is quasi-compact and quasi-separated and $\Mm$ a quasi-coherent $\Oo_X$-module, then $f_*\Mm$ is a quasi-coherent $\Oo_Y$-module.
    \end{alphanumerate}
\end{prop}
\begin{proof}
    Part \itememph{a} follows from Fact~\reff{fact:SpecRqcqs}.
    
    For \itememph{b} take $U\subseteq Y$ affine. Then \eqreff{eq:bijectiveQCQS} for $f_*\Mm$ and $U$ is an isomorphism by the diagram
    \begin{diagram*}
    	\node[ob] (a) at (0,1.5) {$\big(f_*\Mm(U)\big)_\lambda$};
    	\node[ob] (b) at (4,1.5) {$f_*\Mm\big(U\setminus V(\lambda)\big)$};
    	\node[ob] (c) at (0,0) {$\Mm\left(f^{-1}U\right)_{f^*\lambda}$};
    	\node[ob] (d) at (4,0) {$\Mm\left(f^{-1}U\setminus V(f^*\lambda)\right)$};
    	\scriptsize
    	\draw[->] (a) -- (b) node[pos=0.5, above] {\eqreff{eq:bijectiveQCQS}};
    	\draw[->] (c) -- (d) node[pos=0.5, above=-0.25ex] {$\sim$};
    	\draw[transform canvas={xshift=1pt}] (a) -- (c);
    	\draw[transform canvas={xshift=-1pt}] (a) -- (c);
    	\draw[transform canvas={xshift=1pt}] (b) -- (d);
    	\draw[transform canvas={xshift=-1pt}] (b) -- (d);
    \end{diagram*}
    in which the lower horizontal arrow is an isomorphism by Proposition~\reff{prop:coherentDef}\itememph{d} because $\Mm$ is quasi-coherent and $f^{-1}U$ is quasi-compact and quasi-separated by the assumptions on $f$.
\end{proof}
\begin{prop}\lbl{prop:closedImmersionCoherentSheaves}
    Let $X$ be a prescheme and $K$ a locally ringed space and $K\morphism[\iota] X$ a closed immersion in the sense of Definition~\reff{def:immersiveMorphism}. Then $K$ is a prescheme if and only if the sheaf of ideals $\Jj=\ker\big(\Oo_X\morphism[\iota^{\smash{*}}]\iota_*\Oo_K\big)$ associated to $\iota$ by Proposition~\reff{prop:closedImmersionSheaves} is quasi-coherent.
\end{prop}
\begin{proof}
    Let $K$ be a prescheme. By Proposition~\reff{prop:closedEmbeddingPrescheme} and Fact~\reff{fact:kernelQC}, $\Jj$ is quasi-coherent. 
    
    Conversely, let $\Jj$ be quasi-coherent. As the correspondence between $K$ and $\Jj$ is compatible with restriction to open subsets (being a closed immersion, being a kernel, and quasi-coherence are all local properties), it is sufficient to show that $K$ is a prescheme, when $X$ is affine. In this case ($X=\Spec R$), any quasi-coherent $\Jj\subseteq \Oo_X$ has the from $\Jj = \snake I$. But $\Spec R/I \morphism \Spec R$ is a closed embedding and our correspondence associates $\snake I$ to $\iota$. Thus, $K\cong \Spec(R/I)$ is affine in this case.
\end{proof}
\begin{defi}
	A \defemph{closed subprescheme} of a prescheme $X$ is an equivalence class of closed immersions $K\monomorphism[i]X$ of preschemes $K$, where two such closed immersions $K\monomorphism[i]X$ and $L\monomorphism[j]X$ are considered equivalent iff there is an isomorphism $K\isomorphism[\iota]L$ such that $i=j\iota$.
\end{defi}
\begin{rem}
	The isomorphism above is unique as $i$ and $j$ are monomorphisms.
\end{rem}
\begin{cor}
	\begin{alphanumerate}
		\item \lbl{cor:closedSubpreschemes} For a prescheme $X$, there is a one-to-one correspondence 
		\begin{align*}
			\left\{\text{closed subpreschemes }K\monomorphism[i]X\right\}&\isomorphism\left\{\text{quasi-coherent sheaves of ideals }\Jj\subseteq\Oo_X\right\}\\
			\big(K\monomorphism[i]X\big)&\longmapsto\ker\big(\Oo_X\morphism[i^*]i_*\Oo_K\big)\;.
		\end{align*}
		\item Any closed subprescheme of an affine scheme is affine.
	\end{alphanumerate}
\end{cor}
\begin{proof}
	Part \itememph{a} follows from Proposition~\reff{prop:closedImmersionCoherentSheaves} and Proposition~\reff{prop:closedImmersionSheaves}.
	
	Part \itememph{b}. On $\Spec R$, every quasi-coherent sheaf of ideals is of the form $\snake{I}$ for an ideal $I\subseteq R$, corresponding to $\Spec(R/I)\morphism\Spec R$.
\end{proof}
\begin{cor}
	For any prescheme $X$ and any ring $R$, the following map is bijective:
	\begin{align*}
		\Hom_{\cat{Ring}}\big(R,\Oo_X(X)\big)&\isomorphism\Hom_{\cat{PSch}}(X,\Spec R)\\
		\Big(R\cong \Oo_{\Spec R}(\Spec R)\morphism[f^*]\Oo_X(X)\Big)&\longmapsfrom \big(X\morphism[f]\Spec R\big)
	\end{align*}
\end{cor}
\begin{proof}
	This is a special case of Proposition~\reff{prop:affineSchemeAdjunction}.
\end{proof}
\begin{cor}
	$\Spec\IZ$ is a final object in the category of preschemes.
\end{cor}
\begin{cor}
	\begin{alphanumerate}
		\item \lbl{cor:preschemesEqualizers}The category of preschemes has equalizers.
		\item If $Y\morphism[\upsilon]Z$ is a monomorphism (e.g., an open/closed/arbitrary immersion), then
		\begin{align*}
			\Eq\Big(X\doublemorphism[a][b]Y\Big)\cong\Eq\Big(X\doublemorphism[\upsilon a][\upsilon b]Z\Big)\;.
		\end{align*}
		\item If $U\subseteq X$ is open and $X\doublemorphism[\smash{a}][b]Y$ a pair of morphisms of preschemes, then
		\begin{align*}
			\Eq\Big(U\doublemorphism[a|_U][b|_U]Y\Big)=\Eq\Big(X\doublemorphism[a][b]Y\Big)\cap U\;.
		\end{align*}
		\item If $R\doublemorphism[\smash{\alpha}][\smash{\beta}]S$ are morphisms of rings, then
		\begin{align*}
			\Eq\Big(\Spec S\xdoublemorphism[\Spec \alpha][\Spec \beta]\Spec R\Big)\cong \Spec\Big(\Coeq\big(R\doublemorphism[\smash{\alpha}][\smash{\beta}]S\big)\Big)\;.
		\end{align*}
		\item The morphism $\Eq\Big(X\doublemorphism[a][b]Y\Big)\morphism X$ is immersive.
	\end{alphanumerate}
\end{cor}
\begin{proof}
	Part \itememph{b} is true in any category an can be easily proved by abstract nonsense.
	
	Part \itememph{c} follows from our explicit construction of equalizers in $\cat{LRS}$ in Proposition~\reff{prop:equalizerLRS} as long as only equalizers in $\cat{LRS}$ are concerned. That the occurring equalizers are indeed preschemes will follow from the proof of \itememph{a}. Part \itememph{d} is a consequence of Proposition~\reff{prop:affineSchemeAdjunction} and the fact that $\Spec(-)$ is a contravariant functor. 
	
	Together, \itememph{b}, \itememph{c} (that is, what we proved of it so far) and \itememph{d} imply \itememph{a}. Indeed, let $E\subseteq X$ be the equalizer of $X\doublemorphism[a][b]Y$ in the category of locally ringed spaces, where $X$ and $Y$ are preschemes; we need to show that $E$ is a prescheme as well. Let $x\in E$. Choose an affine open neighbourhood $V$ of $a(x)=b(x)$ in $Y$ and an affine open neighbourhood of $U\subseteq a^{-1}(V)\cap b^{-1}(V)$ of $x$ in $X$. Then 
	\begin{align*}
		\Eq\Big(U\doublemorphism[a|_U][b|_U]V\Big)=\Eq\Big(U\doublemorphism[a|_U][b|_U]Y\Big)=\Eq\Big(X\doublemorphism[a][b]Y\Big)\cap U
	\end{align*}
	in which the first equality follows from \itememph{b} and the fact that $V\monomorphism Y$ is a monomorphism, whereas the second equality is due to \itememph{c}. By \itememph{d}, the left-hand side is an affine prescheme, thus providing us with an affine open neighbourhood of $x$ in $E$.
	
	For \itememph{e}, note by our explicit construction in Proposition~\reff{prop:equalizerLRS} the considered morphism of preschemes is a homeomorphism onto the subset
	\begin{align}\lbl{eq:equalizer1.5}
		K=\left\{x\in X\st a(x)=b(x)\eqqcolon y\text{ and }\KK(y) \doublemorphism[a^*][b^*] \KK(x)\text{ coincide}\right\}\subseteq X\tag{$*$}
	\end{align}
	and induces surjections on stalks of the structure sheaf.
\end{proof}
\begin{cor}
	\begin{alphanumerate}
		\item \lbl{cor:preschemesFibreProduct}The category of preschemes has fibre products. 
		\item Let the diagram
		\begin{diagram*}
			\node[ob](a) at (0,1.5) {$X\times_SY$};
			\node[ob](c) at (0,0) {$X$};
			\node[ob](b) at (2.5,1.5) {$Y$};
			\node[ob](d) at (2.5,0) {$S$};
			\scriptsize
			\draw[->] (a) -- (b) node[pos=0.5, above] {$p_Y$};
			\draw[->] (a) -- (c) node[pos=0.5, left] {$p_X$};
			\draw[->] (c) -- (d) node[pos=0.5, above] {$\xi$};
			\draw[->] (b) -- (d) node[pos=0.5, right] {$\upsilon$};
		\end{diagram*}        
		be a fibre product in $\cat{PSch}$. If $U\subseteq X$, $V\subseteq Y$ and $W\subseteq S$ are open subsets, then
		\begin{align*}
			U\times_WV=p_X^{-1}(U)\cap p_Y^{-1}(V)\subseteq X\times_SY\;.
		\end{align*}
		\item $\Spec A\times_{\Spec R}\Spec B\cong \Spec(A\otimes_RB)$.
		\item If $S\morphism T$ is a monomorphism, then $X\times_SY\cong X\times_TY$.
	\end{alphanumerate}
\end{cor}
\begin{proof}
	Assertion \itememph{d} again holds in any category and admits a pure abstract nonsense proof.
	
	Part \itememph{b} follows from Proposition~\reff{cor:fibreProductsInLRS}\itememph{b} except for the fact that the involved fibre products are preschemes, which will follow from the proof of \itememph{a}. Part \itememph{c} follows from Corollary~\reff{cor:affineSchemesFibreProduct} and together, \itememph{b}, \itememph{c} and \itememph{d} imply \itememph{a} by a technical argument as in the proof of Corollary~\reff{cor:preschemesEqualizers}.
\end{proof}
\begin{defi}\lbl{def:S-preschemes}
	Let $S$ be a prescheme. The category $\cat{PSch}/S$ of \defemph{$S$-preschemes} has morphisms $X\morphism[\xi]S$ of preschemes as objects and diagrams  
	\begin{diagram*}
		\node[ob](x) at (0,1.25) {$X$};
		\node[ob](s) at (1.25,0) {$S$};
		\node[ob](y) at (2.5,1.25) {$Y$};
		\scriptsize
		\draw[->] (x) -- (s) node[pos=0.5,below left] {$\xi$};
		\draw[->] (x) -- (y) node[pos=0.5,above] {$f$};
		\draw[->] (y) -- (s) node[pos=0.5,below right] {$\upsilon$};
	\end{diagram*}
	as morphisms. Compositions are given by 
	\begin{diagram*}
		\node[ob](x) at (0,1.5) {$X$};
		\node[ob](s) at (2,0) {$S$};
		\node[ob](y) at (2,1.5) {$Y$};
		\node[ob] (z) at (4,1.5) {$Z$};
		\scriptsize
		\draw[->] (x) -- (s) node[pos=0.5,below left] {$\xi$};
		\draw[->] (x) -- (y) node[pos=0.5,above] {$f$};
		\draw[->] (y) -- (s) node[pos=0.5,left] {$\upsilon$};
		\draw[->] (y) -- (z) node[pos=0.5, above] {$g$};
		\draw[->] (z) -- (s) node[pos=0.5, below right] {$\zeta$};
	\end{diagram*}
	and the identity on $X\morphism[\xi]S$ is $\id_X$.
\end{defi}
\begin{rem*}
	\begin{alphanumerate}
		\item This is a special case of the \emph{comma category} construction, cf.\ Remark~\reff{rem:commaCategory}.
		\item Products in $\cat{PSch}/S$ (which has $S\morphism[\id_S]S$ as a final object) are given by $X\times_SY$.
		\item The category $\cat{PSch}/\Spec \IZ$ is canonically isomorphic to $\cat{PSch}$.
	\end{alphanumerate}
\end{rem*}
\begin{defi}\lbl{def:baseLocal}
	A class $\Cc$ of morphisms in the category of preschemes is called
	\begin{alphanumerate}
		\item \defemph{stable} (or \defemph{closed}) \defemph{under base change} if in any fibre product diagram
		\begin{diagram*}
			\node[ob](a) at (0,1.5) {$X\times_YY'$};
			\node[ob](c) at (0,0) {$X$};
			\node[ob](b) at (2.5,1.5) {$Y'$};
			\node[ob](d) at (2.5,0) {$Y$};
			\scriptsize
			\draw[->] (a) -- (b) node[pos=0.5, above] {$\xi'$};
			\draw[->] (a) -- (c) node[pos=0.5, left] {$\upsilon'$};
			\draw[->] (c) -- (d) node[pos=0.5, above] {$\xi$};
			\draw[->] (b) -- (d) node[pos=0.5, right] {$\upsilon$};
		\end{diagram*}        
		we have $\xi'\in\Cc$ if $\xi\in\Cc$.
		\item \defemph{base-local} if for a morphism $X\morphism[\xi]Y$ the following conditions are equivalent:
		\begin{itemize}
			\item[\itememph{\alpha}] $\xi\in\Cc$.
			\item[\itememph{\beta}] For any open subset $U\subseteq Y$ the morphism $\xi^{-1}(U)\morphism U$ is $\in\Cc$.
			\item[\itememph{\gamma}] $Y$ may be covered by open subsets $U$ such that $\xi^{-1}(U)\morphism U$ is $\in \Cc$.
		\end{itemize}
	\end{alphanumerate}
\end{defi}
\begin{fact}\lbl{fact:immersionsBaseChangeStable}
	The classes $\Cc$ of open or closed or general immersions (homeomorphisms onto their images and surjective on stalks) are closed under composition, stable under base change and base-local. Moreover, they have the following cancellation property: $ij\in\Cc$ and $i\in \Cc$ implies $j\in\Cc$.
\end{fact}
\begin{proof}
	Closedness under composition holds because homeomorphisms work that way and compositions of surjections are surjective. Stability under base change follows from Corollary~\reff{cor:immersionBaseChange}. Base-locality is clear as both being a homeomorphism and being surjective on stalks are local properties. Finally, the cancellation property is due to the fact that if $ij$ and $i$ are homeomorphisms onto their image, then so is $j$, and if the morphisms $j^*i^*$ and $i^*$ induced on stalks are surjective, then so is $j^*$.
\end{proof}
\begin{fact}\lbl{fact:equalizerImmersive}
	For a pair $X\doublemorphism[a][b]Y$ of morphisms of preschemes, the morphism $\Eq\Big(X\doublemorphism[a][b]Y\Big)\morphism X$ is immersive and its image is locally closed. It is a closed immersion if and only if the above set $K$ described in \eqreff{eq:equalizer1.5} (on page~\pageref{eq:equalizer1.5}) is closed.
	
	When $Y$ has the property that arbitrary points $x,y\in Y$ have a common affine neighbourhood (this is, e.g., the case when $Y$ is affine), then $K$ is always closed.
\end{fact}
\begin{proof}
	With the possible exception of local closedness and the last assertion, this follows from our construction of equalizers in Proposition~\reff{prop:equalizerLRS}. 
	
	Let $x\in X$ and suppose that $W\subseteq Y$ is an affine open neighbourhood of $a(x)$ and $b(x)$. We claim that $x$ has an open neighbourhood $U$ (namely $U=a^{-1}(W)\cap b^{-1}(W)$) such that $K\cap U$ is closed in $U$. This implies local closedness (if $x\in K$, take any affine open neighbourhood $W$ of $a(x)=b(x)$) and also the other assertion, cf.\ Remark~\reff{rem:localClosedness}\itememph{a}. To show the claim about $U$, note that
	\begin{align*}
		K\cap U=\bigcap_{\lambda\in\Oo_Y(W)}V\big(a^*\lambda|_W-b^*\lambda|_W\big)
	\end{align*}
	by our description of $K$.
\end{proof}
\begin{fact}\lbl{fact:separatedDef}
	For any morphism $X\morphism[f]Y$ of preschemes, the following conditions are equivalent:
	\begin{alphanumerate}
		\item For every morphism pair $T\doublemorphism[a][b] X$ such that $fa=fb$, the equalizer $\Eq\Big(T\doublemorphism[a][b]X\Big)$ is a closed subprescheme of $T$.
		\item For $T\doublemorphism[a][b] X$ as in \itememph{a}, $\Eq\Big(T\doublemorphism[a][b]X\Big)$ is a closed subset of $T$.
		\item The conditions \itememph{a} or \itememph{b} hold when $T$ is affine.
	\end{alphanumerate}
\end{fact}
\begin{proof}
	\itememph{a} $\Leftrightarrow$ \itememph{b} follows from Fact~\reff{fact:equalizerImmersive}. The implication \itememph{a} $\Rightarrow$ \itememph{c} is trivial. It remains to show \itememph{c} $\Rightarrow$ \itememph{a}. Let $T$ be an arbitrary prescheme, $T\doublemorphism[a][b]X$ a pair of morphisms and $K$ the subset of $T$ on which $\smash{\Eq\Big(}T\doublemorphism[\smash{a}][b]X\smash{\Big)}$ maps homeomorphically. By Corollary~\reff{cor:preschemesEqualizers}\itememph{c} and the assumption, $K\cap U$ is closed in $U$ for any affine open $U\subseteq T$. As the affine open subsets cover $T$, this shows that $K$ is closed.
\end{proof}
\begin{defi}
	\begin{alphanumerate}
		\item \lbl{def:scheme} A morphism of preschemes is called \defemph{separated} if it satisfies the equivalent conditions from Fact~\reff{fact:separatedDef}.
		\item A prescheme $X$ is \defemph{separated} (or a \defemph{scheme}) if the morphism $X\morphism\Spec \IZ$ is separated; in other words, if $\Eq\Big(T\doublemorphism[a][b]X\Big)$ is always closed in $T$ for $T$ a prescheme.
	\end{alphanumerate}
\end{defi}
\begin{rem*}
	Maybe Grothendieck should have dropped the \emph{pre}fix \emph{pre} and rather have used the term \emph{scheme} instead of \emph{prescheme} in the first place. Indeed, in \emph{pre}sent days, this other notation is \emph{pre}dominating. However, Prefessor Franke \emph{pre}sumably \emph{pre}fers Grothendieck's \emph{pre}existing terminology.
\end{rem*}
\begin{fact}
	\begin{alphanumerate}
		\item \lbl{fact:separationStuff} Any monomorphism (e.g., open/closed/arbitrary immersions) of preschemes is separated.
		\item If $gf$ is separated, then so is $f$. In particular, any morphism between schemes is separated.
		\item The class of separated morphisms is closed under composition and stable under base change.
		\item A morphism $X\morphism[f]Y$ is separated iff the \emph{diagonal embedding} 
		\begin{align*}
			\Delta\colon X\xrightarrow{(\id_X,\id_X)}X\times_YX
		\end{align*}
		is a closed immersion.
	\end{alphanumerate}
\end{fact}
\begin{proof}
	Part \itememph{a} is obvious: If $X\morphism[f]Y$ is a monomorphism and $T\doublemorphism[a][b]X$ are such that $fa=fb$, then $a=b$ and the equalizer under consideration equals $T$. Part \itememph{b} is also trivial, as any $T\doublemorphism[a][b]X$ such that $fa=fb$ also satisfies $gfa=gfb$.
	
	Let's prove \itememph{d}. The diagonal is always immersive as $\Delta(X)\xrightarrow{p|_{\Delta(X)}=q|_{\Delta(X)}}X$ is inverse to $X\morphism\Delta(X)$. If $f$ is separated, then $\Delta(X)=\Eq\Big(X\times_YX\doublemorphism[p][q]X\Big)\monomorphism X\times_YX$ is a closed immersion, where $p,q$ denote the two canonical projections. Conversely, if $\Delta(X)\subseteq X\times_YX$ is closed and $T\doublemorphism[a][b]X$ is such that $fa=fb$, then we have a morphism $\tau\colon T\xrightarrow{(a,b)}X\times_YX$ and 
	\begin{align*}
		K=\Eq\Big(T\doublemorphism[a][b]X\Big)\cong T\times_{X\times_YX}\Delta(X)\;.
	\end{align*} 
	The morphism $K\monomorphism T$ is thus a base change of $\Delta(X)\monomorphism X\times_YX$ and hence a closed embedding by base change stability (Fact~\reff{fact:immersionsBaseChangeStable}).
	
	Now for \itememph{c}. For closednesss under composition, consider $X\morphism[f]Y\morphism[g]Z$ with $f,g$ separated. Let $T\doublemorphism[\smash{a}][b]X$ such that $gfa=gfb$. Then $K=\Eq\Big(T\doublemorphism[fa][fb]Y\Big)$ is a closed subprescheme of $T$ as $g$ is separated and 
	\begin{align*}
		\Eq\Big(T\doublemorphism[a][b]X\Big)\cong\Eq\Big(K\morphism T\doublemorphism[a][b]X\Big)
	\end{align*}
	is a closed subprescheme of $K$ as $f$ is separated. And finally stability under base change. Consider a cocartesian square (i.e., a fibre product diagram)
	\begin{diagram*}
		\node[ob](a) at (0,1.5) {\llap{$X\times_SY=\:$}$X'$};
		\node[ob](c) at (0,0) {$X$};
		\node[ob](b) at (2,1.5) {$Y'$};
		\node[ob](d) at (2,0) {$Y$};
		\scriptsize
		\draw[->] (a) -- (b) node[pos=0.5, above] {$\xi'$};
		\draw[->] (a) -- (c) node[pos=0.5, left] {$\upsilon'$};
		\draw[->] (c) -- (d) node[pos=0.5, above] {$\xi$};
		\draw[->] (b) -- (d) node[pos=0.5, right] {$\upsilon$};
	\end{diagram*}   
	in which $\xi$ is separated. If $T\doublemorphism[a][b]X'$ is such that $\xi'a=\xi'b$, then
	\begin{align*}
		\Eq\Big(T\doublemorphism[a][b]X'\Big)\cong\Eq\Big(T\doublemorphism[\upsilon'a][\upsilon'b]X\Big)
	\end{align*}
	by the universal property of the fibre product. As $\xi$ is separated, this is a closed subprescheme of $T$.
\end{proof}
\begin{fact}\lbl{fact:schemeConditions}
    For a prescheme $X$ the following conditions are equivalent:
    \begin{alphanumerate}
    \item 
        $X$ is a scheme.
    \item 
        For every pair, $T\doublemorphism[a][b] X$ the equalizer $K = \Eq\Big(T\doublemorphism[a][b] X\Big)$ is a closed subprescheme of $T$.
    \item 
        Under the same assumptions, $K$ is a closed subset of $T$.
    \item 
        The same, under the additional assumption that $T$ is affine. 
    \item 
        $X\xrightarrow{(\id_X,\id_X)} X\times X$ is a closed embedding. 
    \end{alphanumerate}
\end{fact}
\begin{proof}
	The equivalence of \itememph{a}, \itememph{b}, \itememph{c} and \itememph{d} follows from Definition~\reff{def:scheme} and Fact~\reff{fact:separatedDef}. As $\Spec\IZ$ is the final object in the category of preschemes, $X\times X=X\times_{\Spec\IZ}X$ and by Fact~\reff{fact:separationStuff}\itememph{d} we have that \itememph{e} is equivalent to the others.
\end{proof}
\begin{fact}
    \begin{alphanumerate}
    \item \lbl{fact:schemeStuff}
        Every affine prescheme is a scheme. More general, if for any two points of a prescheme $X$ there is an affine open subset of $X$ containing both of them, then $X$ is a scheme.
    \item 
        The class of schemes is closed under forming equalizers of pair of morphisms (to arbitrary preschemes) and fibre products.
    \item 
        Every open or closed subprescheme of a scheme is a scheme.
    \item 
        If $X$ is a scheme, any morphism $X\morphism Y$ of preschemes is separated.
    \end{alphanumerate}
\end{fact}
\begin{proof}
    Part \itememph{a} immediately follows from Fact~\reff{fact:equalizerImmersive} and Fact~\reff{fact:schemeConditions}\itememph{c}. The point \itememph{d} follows from Fact~\reff{fact:separationStuff}\itememph{b}. Indeed, as $\Spec\IZ$ is a final object, the composition $X\morphism[f]Y\morphism\Spec\IZ$ equals the uniquely determined morphism $X\morphism\Spec\IZ$, hence is separated, hence so is $f$.
    
    Let's prove \itememph{b}. If $X$, $Y$ and $S$ are schemes then any morphism $X\morphism S$ is separated by \itememph{d}, hence, by base change stability, its base change $X\times_S Y \morphism Y$ is separated as well, as is $X\times_S Y \morphism Y\morphism \Spec \IZ$ by closedness under composition (cf.\ Fact~\reff{fact:separationStuff}\itememph{c}). Thus $X\times_S Y$ is scheme. 
    
    If $X$ is a scheme and $X\doublemorphism[a][b] Y$ a pair of morphisms, then $K = \Eq\Big(X\doublemorphism[a][b] Y\Big) \morphism X$ is a monomorphism, hence separated by Fact~\reff{fact:separationStuff}\itememph{a}, and $K\morphism X\morphism \Spec \IZ$ is separated by closedness under composition (cf.\ Fact~\reff{fact:separationStuff}\itememph{c}). This proves \itememph{b}.
    
    If $Y\monomorphism X$ is any immersion, it is a monomorphism, hence separated and $Y\monomorphism X\morphism \Spec \IZ$ is separated by closedness under composition (cf.\ Fact~\reff{fact:separationStuff}\itememph{c}), proving \itememph{c}.
\end{proof}

\begin{prop}\lbl{prop:intersectionAffine}
    The intersection of two affine open subsets of a scheme is affine.
\end{prop}
\begin{rem*}
    In particular, schemes are quasi-separated (as one would expect that separatedness implies quasi-separatedness).
\end{rem*}
\begin{proof}[Proof of Proposition~\reff{prop:intersectionAffine}]
    Let $U,V\subseteq X$ be affine open subsets of a scheme $X$. By Corollary~\reff{cor:fibreProductsInLRS}, their product $U\times V$ equals $p^{-1}(U) \cap q^{-1} (V)\subseteq X\times X$ (where $X\times X\doublemorphism[p][q] X$ are the projections to the factors) and is affine by Corollary~\reff{cor:affineSchemesFibreProduct}. The diagonal 
    \begin{align*}
    	\Delta\colon X\xrightarrow{(\id_X,\id_X)}X\times X
    \end{align*}
     is a closed immersion by Fact~\reff{fact:schemeConditions}\itememph{e}. Then $\Delta(X)\cap (U\times V)$ is affine as a closed subprescheme of the affine scheme $U\times V$ by Corollary~\reff{cor:closedSubpreschemes}. Then its preimage under the isomorphism $X\isomorphism\Delta(X)$
    \begin{align*}
    	p\big(\Delta(X)\cap (U\times V)\big)&=p\big(\Delta(X)\cap p^{-1}(U)\cap q^{-1}(V)\big)\\
    	&=p\big(\Delta(X)\cap p^{-1}(U)\big)\cap q\big(\Delta(X)\cap q^{-1}(V)\big)=U\cap V
    \end{align*}
     is affine as well, as we wanted to show.
\end{proof}

\begin{fact}
    For a morphism $X\morphism[f] Y$ of preschemes, the following conditions are equivalent:
    \begin{alphanumerate}
    \item 
        $f$ is separated.
    \item 
        If $U\subseteq Y$ is an open subset which is scheme, then $f^{-1}(U)$ is a scheme.
    \item 
        It is possible to cover $Y$ by open subsets $U$ which are schemes such that $f^{-1}(U)$ is a scheme.
     \item
	     $Y$ may be covered by open subsets $U$ such that $f^{-1}(U)$ is a scheme.
    \end{alphanumerate}
\end{fact}
\begin{proof}
    \itememph{a} implies \itememph{b}, since for $U$ as in \itememph{b}, $f^{-1}(U)\morphism U$ is separated by Fact~\reff{fact:separationStuff}\itememph{c} as it is the base change of $f$ by $U\monomorphism Y$. Thus $f^{-1}(U)\morphism U\morphism \Spec\IZ$ is separated.
    
    The implication from \itememph{b} to \itememph{c} is trivial, as $Y$ may be covered by affine open subsets. The implication \itememph{c} $\Rightarrow$ \itememph{d} is even more trivial.
    
    Finally let's prove \itememph{d} $\Rightarrow$ \itememph{a}. Let $T\doublemorphism[a][b] X$ be such that $fa = fb$. If $Y=\bigcup_{i\in I} U_i$ is a cover by open subsets such that $f^{-1}(U_i)$ is a scheme, then $V_i = a^{-1}f^{-1}(U_i) = b^{-1}f^{-1} (U_i)$ form an open cover of $T$, and 
    \begin{align*}
    	\Eq(a,b) \cap V_i = \Eq\bigg(V_i\doublemorphism[a|_{V_i}][b|_{V_i}]f^{-1}(U_i) \bigg)
    \end{align*}
    (the equality follows from Corollary~\reff{cor:preschemesEqualizers}\itememph{c}) is closed in $V_i$ as $f^{-1}(U_i) $ is a scheme. By an argument like in Remark~\reff{rem:localClosedness}\itememph{a}, this shows that $\Eq(a,b)$ is closed in $T$, i.e., $f$ is separated.
\end{proof}
\begin{prop}\lbl{prop:separatedMorphismEmbedding}
    Any section (i.e., right-inverse) $s$ of a separated morphism is a closed embedding. 
\end{prop}
\begin{proof}
    Let $X\morphism[f] S$ be separated and $S\morphism[s] X$ be such that $fs = \id_S$. Then $S\morphism[s] X$ equals $\Eq\Big(X\doublemorphism[a][b] X\Big)\morphism X$ where $a=\id_X$ and $b= sf$. Indeed, if $T\morphism[g] X$ is a morphism of preschemes such that $ag = bg$ then $g = ag = bg = s\gamma$ with $\gamma = fg$. Thus, $g = s\gamma$ factors over $s$. Moreover, if $\gamma$ is such that $g= s\gamma$, then $\gamma = fs\gamma = fg$ is unique, proving our claim that $S=\Eq(a,b)$.
    
     Now $fa = f = fsf = fb$. Thus, by Fact~\reff{fact:separatedDef}\itememph{a} and separatedness of $f$, $S\morphism[s] X$ is a closed immersion.
\end{proof}

\begin{prop}[Graph of a morphism]\lbl{prop:graphOfMorphism}
    For a morphism of $S$-preschemes 
    \begin{diagram*}
    	\node[ob](x) at (0,1.25) {$X$};
    	\node[ob](s) at (1.25,0) {$S$};
    	\node[ob](y) at (2.5,1.25) {$Y$};
    	\scriptsize
    	\draw[->] (x) -- (s) node[pos=0.5,below left] {$\xi$};
    	\draw[->] (x) -- (y) node[pos=0.5,above] {$f$};
    	\draw[->] (y) -- (s) node[pos=0.5,below right] {$\upsilon$};
    \end{diagram*}
    with $\upsilon$ separated, the \defemph{graph} $\Gamma_f\colon X\xrightarrow{(\id_X,f)} X\times_S Y$ is a closed immersion.
\end{prop}
\begin{proof}
    In fact, $\Gamma_f$ is a section of the projection $X\times_S Y \morphism X$ which is a base change of $\upsilon$, thus separated.
\end{proof}


\chapter{Properties of (pre)schemes and their morphisms}

\section{(Mostly) topological properties}

\subsection{Compactness properties}
\begin{fact}\lbl{fact:qcmorphism}
    For a morphism $X\morphism[f] Y$ of preschemes, the following conditions are equivalent
    \begin{alphanumerate}
    \item 
        For any affine open $U\subseteq Y$, $f^{-1}(U)$ is quasi-compact
    \item 
        For any quasi-compact open $U\subseteq Y$, $f^{-1}(U)$ is quasi-compact.
    \item 
        The open subsets $U\subseteq Y$ such that $f^{-1}(U)$ is quasi-compact form a topology base.
    \item 
        $Y$ may be covered by affine open subsets $U$ such that $f^{-1}(U)$ is quasi-compact.
    \end{alphanumerate}
\end{fact}
\begin{proof}
	The equivalence of \itememph{a}, \itememph{b}, and \itememph{c} was proved in Remark~\reff{rem:qcqs}\itememph{a}. It is easy to see that \itememph{b} implies \itememph{d}. Assuming \itememph{d}, if $U\subseteq Y$ is affine and $f^{-1}(U)$ is quasi-compact, then for $\lambda\in \Oo_Y(U)$, we have $f^{-1}(U\setminus V(\lambda)) = f^{-1}(U) \setminus  V(f^*\lambda)$ being quasi-compact by Fact~\reff{fact:complementClosedQC}. By Fact~\reff{fact:affineSchemesTopologyBase}\itememph{b}, such $U\setminus V(\lambda)$ form a topology base.
\end{proof}
\begin{defi}[Quasi-compact morphism] \lbl{def:qcmorphism}
    A morphism with these properties is called \defemph{quasicompact}.
\end{defi}
\begin{fact}\lbl{fact:complementClosedQC}
    If $X$ is a quasi-compact prescheme and $f\in \Oo_X(X)$ then $X\setminus V(f)$ is quasi-compact.
\end{fact}
\begin{proof}
    If $X$ is affine, say $X=\Spec R$, then $X\setminus V(f) \cong \Spec R_f$ is affine, thus quasi-compact. If $X$ is quasi-compact, $X=\bigcup_{i=1}^n U_i$ with $U_i$ affine. Then $X\setminus V(f) = \bigcup_{i=1}^n(U_i\setminus V(f))$ is a finite union of quasi-compact open subsets, thus quasi-compact.
\end{proof}
\begin{fact}\lbl{fact:qcIsBaseLocalAndStuff}
    The class of quasi-compact morphisms is base-local, cf.\ Definition~\reff{def:baseLocal}\itememph{b}, and closed under composition and base change. 
\end{fact}
\begin{proof}
    Closedness under composition is obvious from Fact~\reff{fact:qcmorphism}\itememph{a} and base-locality is obvious from Fact~\reff{fact:qcmorphism}\itememph{c}. Closedness under base change may, by base-locality and Corollary~\reff{cor:fibreProductsInLRS}\itememph{b}, be reduced to the case $X\morphism[f]Y$ where $Y$ is affine and the base change is along $\snake Y\morphism Y$ with $\snake Y$ affine. In this case, $X=f^{-1}(Y)$ is quasi-compact, hence $X=\bigcup_{i=1}^nX_i$ with $X_i\subseteq X$ is affine open and $X\times_Y\snake Y=\bigcup_{i=1}^n X_i\times_Y \snake Y$ in which the factors $X_i\times_Y \snake Y$ are affine (as was seen in Corollary~\reff{cor:affineSchemesFibreProduct}) and thus quasi-compact. Then $X\times_Y\snake Y$, as a finite union of quasi-compact sets, is quasi-compact as well. 
    
    By the upcoming Fact~\reff{fact:qcToAffineIsQc}, the base change $X\times_Y\snake Y\morphism[\snake f]\snake Y$ of $f$ is quasi-compact.  
\end{proof}
\begin{fact}\lbl{fact:qcToAffineIsQc}
    Let $X$ be quasi-compact and $Y$ affine, then any morphism $X\morphism Y$ is quasi-compact.
\end{fact}
\begin{proof}\lbl{fact:qcmorphismBetweenQcAndAffine}
    This follows immediately from Fact~\reff{fact:qcmorphism}\itememph{d}.
\end{proof}

\begin{prop}\lbl{prop:closedSubsetPoint}
    When $X$ is quasi-compact, every closed $\emptyset\neq Y\subseteq X$ contains a closed point.
\end{prop}
\begin{proof}
    Induction on the minimal number of affine open subsets of $X$ needed to cover $Y$. When that number is $1$, we may assume $X$ to be affine, e.g., $X= \Spec R$, $Y=V(I)$ with $I\subsetneq R$ as $Y\neq\emptyset$. Then $I$ is contained in some maximal ideal $\mm$ of $R$ and $\{\mm\} = V(\mm)$ is closed and $\mm\in V(I)$.
    
    Let $(U_i)_{i=1}^n$ be affine open subsets covering $X$ and the assertion hold for closed subsets of $X$ which may be covered by fewer than $n$ affine open subsets of $X$. If $Y\subseteq U_1$ we are in the previous situation, otherwise $\snake Y = Y\setminus U_1$ is a non-empty closed subset of $Y$ which can be covered by $n-1$ affine open subsets and thus contains a closed point.
\end{proof}
\begin{example}
    In $X=\Spec \big(k\left[X_i \st i\in \IN\right]\big)$, the open subset $X\setminus \{m\}$ with $\mm= \left( X_i\st i\in\IN \right)$ fails to be quasi-compact as $X\setminus \{\mm\} = \bigcup_{i=1}^\infty X\setminus V(X_i)$ has no finite subcover. Then $X\setminus \{\mm\}\morphism X$ is a morphism which fails to be quasi-compact.
\end{example}
\begin{lem}\lbl{lem:qsmorphism}
    For a morphism $X\morphism[f] Y$ of preschemes, the following conditions are equivalent:
    \begin{alphanumerate}
    \item 
        For any affine open subset $U\subseteq Y$, $f^{-1}(U)$ is quasi-separated.
    \item 
        For any quasi-separated open subset $U\subseteq Y$, $f^{-1}(U)$ is quasi-separated.
    \item 
        The diagonal $\Delta\colon X \xrightarrow{(\id_X,\id_X)} X\times_Y X$ is a quasi-compact morphism.
    \end{alphanumerate}
\end{lem}
\begin{proof}
    Let's start proving \itememph{a} $\Rightarrow$ \itememph{b}. Let \itememph{a} be satisfied and $U\subseteq Y$ be quasi-separated, we have to show that $f^{-1}(U)$ is quasi-separated. Without losing generality we may assume $U=Y$ is quasi-separated and have to show that $X$ is quasi-separated, i.e., for two arbitrary quasi-compact open subsets $V$ and $W$ of $X$, $V\cap W$ is quasi-compact. We claim that it is sufficient to show this when $f(V)$ and $f(W)$ are contained in affine open subsets $\Omega$ and $\Theta$ of $Y$. Indeed, every $x\in V$ has some affine open neighbourhood $V_x\subseteq V$ with $f(V_x)\subseteq \Omega_x$ where $\Omega_x \subseteq Y$ is affine. Similarly, every $\xi\in W$ has a neighbourhood $W_\xi\subseteq W$ such that $f(W_\xi)\subseteq \Theta_\xi$ which is affine. Then for every $x\in V$ and $\xi \in W$, $V_x\cap W_\xi$ is quasi-compact by the special case we have yet to prove, and by quasi-compactness of $V,W$ there are $x_i\in V$, $\xi_j\in W$ such that $V=\bigcup_{i=1}^m V_{x_i}$ and $W = \bigcup_{j=1}^n W_{x_j}$. Then
    \begin{align*}
        V\cap W = \bigcup_{i=1}^m \bigcup_{j=1}^n (V_{x_i}\cap W_{\xi_j})
    \end{align*}
    is quasi-compact.
    
    Now, if $f(V)\subseteq \Omega$ and $f(W)\subseteq \Theta$ are as above, then $\Omega\cap \Theta$ is quasi-compact as $Y$ is quasi-separated. Since open subsets of that form form a topology base on $\Omega$, 
    \begin{align*}
        \Omega\cap \Theta = \bigcup_{i=1}^m (\Omega\setminus V(\omega_i))=\bigcup_{j=1}^n(\Theta \setminus V(\vartheta_j))
    \end{align*}
    with $\omega_i\in \Oo_Y(\Omega)$ and $\vartheta_j\in \Oo_Y(\Theta)$. Then $V\setminus V(f^*\omega_i)$ and $W\setminus V(f^* \vartheta_j)$ are quasi-compact by Fact~\reff{fact:complementClosedQC} and have image contained in $\Omega$, and $f^{-1}(\Omega)$ is quasi-separated (since we are assuming \itememph{a}), hence
    \begin{align*}
        (V\setminus V(f^*\omega_i))\cap (W\setminus V(f^* \vartheta_j))
    \end{align*}
    is quasi-compact, and so is their finite union $V\cap W$. This implies \itememph{b}.
    
    Now assume \itememph{c} for showing that \itememph{c} $\Rightarrow$ \itememph{a}. Let $\Delta$ be quasi-compact. If $U\subseteq Y$ is affine and $V$ and $W$ are affine open subsets of $f^{-1}(U)$, $V\times_Y W = V\times_U W$ as $U\monomorphism Y$ is monic (Corollary~\reff{cor:preschemesFibreProduct}\itememph{c}). As $U$, $V$, and $W$ are affine, so is $V\times_U W$ by Corollary~\reff{cor:affineSchemesFibreProduct}. But $V\cap W$ equals $\Delta^{-1}(V\times_Y W)$ (by an argument like in the proof of Proposition~\reff{prop:intersectionAffine}) which is quasi-compact as $\Delta$ is a quasi-compact morphism. This shows \itememph{a}.
    
    We show that \itememph{a} $\Rightarrow$ \itememph{c}. Consider \itememph{a} to be true. Let $V, W\subseteq X$ be affine open subsets of $X$ such that $f(V)\cup f(W) \subseteq U$ where $U\subseteq Y$ is affine. Note that such $V\times_U W = V\times_Y W$ cover $X\times_Y X$. As quasi-compactness of morphisms is a base-local property (Fact~\reff{fact:qcIsBaseLocalAndStuff}), it suffices to show that $\Delta^{-1}(V\times_Y W)\morphism V\times_Y W$ is quasi-compact. This however, follows from Fact~\reff{fact:qcToAffineIsQc} as $\Delta^{-1}(V\times_YW) = V\cap W$ is quasi-compact by our assumption and $V\times_Y W= V\times_U W$ is affine. This implies \itememph{c}.
    
    All right, and \itememph{b} $\Rightarrow$ \itememph{a} is trivial by Fact~\reff{fact:SpecRqcqs}\itememph{a}, closing the circle.
\end{proof}
\begin{defi}[Quasi-separated morphisms]\lbl{def:qsmorphism}
    Such morphisms are called \defemph{quasi-separated}.
\end{defi}
\begin{fact}\lbl{fact:qsmorphismProperties}
    Any separated morphism is quasi-separated. The class of quasi-separated morphisms is base-local and closed under base change and composition.
\end{fact}
\begin{proof}
    For the first assertion note that Fact~\reff{fact:separationStuff}\itememph{d} implies the condition from Lemma~\reff{lem:qsmorphism}\itememph{c} as any closed immersion is quasi-compact (cf.\ Remark~\reff{rem:qcqs}\itememph{d}). The closedness under composition follows from condition \itememph{b} of Lemma~\reff{lem:qsmorphism}. Base-locality follows from Lemma~\reff{lem:qsmorphism}\itememph{c}, since quasi-compactness of morphisms is base-local, and for $U\subseteq Y$ open and $X_U = f^{-1}(U)$ the $X_U\times_U X_U$ are open subsets covering $X\times_Y X$ and $\Delta^{-1}(X_U\times_U X_U) = X_U$. Closedness under base change is also a consequence of Lemma~\reff{lem:qsmorphism}\itememph{c} as, for $\snake Y\morphism Y$ and $\snake X = X\times_Y \snake Y$ we have that 
    \begin{align*}
    	\snake\Delta\colon\snake X \xrightarrow{\left(\id_{\snake X},\id_{\snake X}\right)} \snake X\times_{\snake Y}\snake X\;
    \end{align*}
    is a base change of $X\morphism[\Delta] X\times_Y X$ with respect to $\snake X\times_{\snake Y} \snake X \morphism X\times_Y X$ (after a bit abstract nonsense) and quasi-compactness is stable under base change (Fact~\reff{fact:qcIsBaseLocalAndStuff}).
\end{proof}

\subsection{Generic points}

\begin{fact}\lbl{fact:closureOfPointIrreducible}
    Let $X$ be any topological space, $x\in X$, then $\ov{\{x\}}$ is irreducible.
\end{fact}
\begin{defi}[Generic point]\lbl{def:genericPoint}
    Let $Z\subseteq X$ be closed. A \defemph{generic point} of $Z$ is any $\eta_Z\in Z$ such that $\ov{\{\eta_Z\}} = Z$.
\end{defi}
\begin{rem*}
    By Fact~\reff{fact:closureOfPointIrreducible}, $Z$ must be irreducible.
\end{rem*}
\begin{fact}
    A topological space is $T_0$ (or Kolmogorov) iff any irreducible closed subset of $X$ has at most one generic point.
\end{fact}
\begin{defi}[Sober space] \lbl{def:soberSpace}
    A topological space is called \defemph{sober} if any irreducible closed subset has precisely one generic point (which is often denoted by $n_Z$).
\end{defi}
\begin{rem*}
    Ever sober space is $T_0$ and every $T_2$ (Hausdorff) space is sober. There exist spaces which are sober but not $T_1$ and spaces which are $T_1$ but not sober.
\end{rem*}
\begin{fact}\lbl{fact:soberConditions}
    For a topological space $X$, the following are equivalent:
    \begin{alphanumerate}
    \item   
        $X$ is sober.
    \item 
        Any open subset $U$ of $X$ is sober.
    \item 
        $X$ may be covered by open subsets which are sober.
    \end{alphanumerate}
\end{fact}
\begin{proof}
	The implications \itememph{b} $\Rightarrow$ \itememph{a} and \itememph{a} $\Rightarrow$ \itememph{c} are trivial. Let's prove \itememph{c} $\Rightarrow$ \itememph{b}. Let $X=\bigcup_{i\in I}U_i$ be an open cover by sober subsets and $U\subseteq X$ open. Let $Z\subseteq U$ be irreducible closed and $i\in I$ such that $U_i\cap Z\neq 0$. Let $\eta_{Z\cap U_i}$ be the unique generic point of $Z\cap U_i$ (which is an open subset of $Z$ and thus irreducible again). Then the closure of $\eta_{Z\cap U_i}$ in $U$ equals $Z$ as $Z\cap U_i\subseteq Z$ is a nonempty open subset and thus dense, $Z$ being irreducible. Conversely, if $\eta_Z$ is a generic point of $Z$, then $\eta_Z\in U_i$ (as otherwise $\ov{\{\eta_Z\}}\subseteq Z\setminus U_i$) and the closure of $\eta_Z$ in $U_i$ equals $Z\cap U_i$, hence $\eta_Z=\eta_{Z\cap U_i}$.
\end{proof}
\begin{fact}
    The underlying topological space of any prescheme is sober.
\end{fact}
\begin{proof}
	By Fact~\reff{fact:soberConditions}\itememph{c}, it is enough to show that $\Spec R$ is sober for any ring $R$. For any $\pp\in \Spec R$, $V(\pp)$ is the smallest closed subset, that contains $\pp$, hence the closure of $\pp$. Since the map $V(-)$ from $\Spec R$ to the irreducible closed subsets of $\Spec R$ is bijective, every irreducible closed subset $V(\pp)$ contains exactly one generic point $\pp$.
\end{proof}
\begin{thm}[M. Hochster]\lbl{thm:hochster}
    A topological space $X$ is isomorphic to the spectrum of some ring $R$ iff $X$ is quasi-compact, quasi-separated, sober and the quasi-compact subsets form a topology base.
\end{thm}
\begin{proof}
	Omitted.
\end{proof}


\subsection{Irreducibility, reducedness and integrality}

\begin{fact}
    Let $X$ be a topological space, $\Rr$ a sheaf of rings on it. Let $U\subseteq X$ be open. Then the following conditions on $r\in\Rr(U)$ are equivalent:
    \begin{alphanumerate}
    \item   
        For every $x\in U$, the image of $r$ in $\Rr_x$ is nilpotent.
    \item 
        It is possible to cover $U$ by open subsets $U_i$ such that $r|_{U_i}$ is nilpotent.
    \end{alphanumerate}
        When $U$ is quasi-compact this is equivalent to $r$ being nilpotent.
\end{fact}
\begin{proof}
	The equivalence of \itememph{a} and \itememph{b} is trivial. If $U$ is quasi-compact and $r\in\Rr(U)$ nilpotent, then so are its restrictions $r|_V$ for any open $V\subseteq U$. Conversely, let $U=\bigcup_{i\in I}U_i$ be an open cover such that $(r|_{U_i})^{n_i}=0$ in $\Oo_X(U_i)$. By quasi-compactness, we may assume $I$ to be finite and take $n=\max_{i\in I}n_i$, then the sheaf axiom shows $r^n=0$ in $\Oo_X(U)$.
\end{proof}

\begin{defi}
    Such $r\in \Rr(U)$ is called \defemph{locally nilpotent} on $U$. If $\nil (\Rr)(U) \subseteq \Rr(U)$ denotes the ideal of locally nilpotent elements, then $\nil(\Rr)$ is a sheaf of ideals in $\Rr$ called the \defemph{nilradical} of $\Rr$.
\end{defi}

\begin{fact}\lbl{fact:nilRadical}
    For a prescheme $X$ we have
    \begin{align*}
        \nil(\Oo_X)(U) = \left\{f\in \Oo_X(U) \st V(f) = U\right\}\;.
    \end{align*}
\end{fact}
\begin{proof}
    If $U$ is quasi-compact, this follows from Corollary~\reff{cor:nilpotentVanishingSet}. The question being local, the assertion follows in general.
\end{proof}
\begin{prop}\lbl{prop:reduced}
    For a prescheme $X$, $\nil(\Oo_X)$ is quasi-coherent, and the following conditions are equivalent:
    \begin{alphanumerate}
    \item 
        $\nil(\Oo_X) = 0$
    \item 
        $X$ is the only closed subprescheme of $X$ containing all points of $X$.
    \end{alphanumerate}
\end{prop}
\begin{proof}
    First, we show that $\nil(\Oo_X)$ is quasi-coherent. It suffices to show that $\nil(\Oo_X) = \nil(R)^\qcmod$ when $X=\Spec R$. Since these open subsets form a topology base, it is sufficient to show $\nil(\Oo_X)(\Spec R_f) = \nil(R)_f$. As $\Spec R_f$ is quasi-compact, by Corollary~\reff{cor:nilpotentVanishingSet} the left-hand side equals $\nil(R_f)$, hence we have to show $\nil(R)_f = \nil(R_f)$. Clearly, an element of $\nil(R)_f\subseteq R_f$ is nilpotent in $R_f$ and hence $\nil(R)_f\subseteq\nil(R_f)$. To show $\nil(R)_f\supseteq\nil(R_f)$, let $rf^{-k}\in \nil(R_f)$, then $r^mf^{-km} = 0$ in $R_f$ for appropriate $m$, hence $f^\ell r^m = 0$ in $R$ for some $\ell\in\IN$. Then also $(rf^\ell)^m = 0$ in $R$, hence $f^\ell r\in \nil(R)$ but $rf^{-k}=f^\ell r\cdot f^{-(\ell+k)}\in \nil(R)_f$.
    
    Let's prove \itememph{a} $\Rightarrow$ \itememph{b}. Assume \itememph{a}. If $Y\subseteq X$ is a closed subprescheme containing all points of $X$ and $Y\monomorphism[\iota]X$ the corresponding closed immersion, then $Y$ is given via Proposition~\reff{prop:closedImmersionCoherentSheaves} by a quasi-coherent sheaf of ideals $\Jj=\ker(\Oo_X\morphism[\iota^*]\iota_*\Oo_Y)$. For $x\in X=Y$, we have $\Oo_{Y,x}= \Oo_{X,x}/\Jj_x$ hence for any $f\in \Oo_X(U)$ we have
    \begin{align*}
    	V(f) &= \left\{x\in U\st (\text{image of }f\text{ in }\Oo_{X,x})\in\mm_{X,x}\right\}\\
    	&= \left\{x\in U\st (\text{image of }\iota^*f\text{ in }\Oo_{Y,x}=\Oo_{X,x}/\Jj_x)\in\mm_{Y,x}=\mm_{X,x}/\Jj_x\right\}=V(\iota^*f)\;.
    \end{align*}
     For $f\in \Jj(U)$, $\iota^*f = 0$ hence $V(f) = U$ hence $f\in \nil(\Oo_X)(U)$ by Corollary~\reff{cor:nilpotentVanishingSet}, thus $f=0$ by \itememph{a}. It follows that $\Jj=0$ and $X=Y$ as preschemes.
    
    In the other direction, one can easily see that $\nil(\Oo_X) \neq 0$ defines a closed subprescheme containing all the points of $X$, hence \itememph{b} $\Rightarrow$ \itememph{a}.
\end{proof}
\begin{defi}[Reduced prescheme] \lbl{def:reduced}
    A prescheme with these properties is called \defemph{reduced}. For any prescheme $X$, let $X^{\red}$ be the closed subprescheme of $X$ defined by $\nil(\Oo_X)$.
\end{defi}
\begin{rem}
    $X^{\red}$ is the smallest closed subprescheme of $X$ containing all points of $X$, and is reduced.
\end{rem}
\begin{fact}
    Let $X$ be a reduced prescheme, $Y$ a scheme and $X\doublemorphism[f][g] Y$ two morphisms of preschemes coinciding on a dense open subset $U\subseteq X$. Then they coincide on $X$. In fact, $Y$ being a scheme can be weekend to the existence of a separated morphism $Y\morphism[\upsilon] S$ such that $\upsilon f = \upsilon g$.
\end{fact}
\begin{proof}
    Under our assumptions on $Y$, the equalizer $\Eq\Big(X\doublemorphism[f][g] Y\Big)$ is a closed subprescheme of $X$ containing all points of $U$, hence of $X$. By Proposition~\reff{prop:reduced}, $f$ and $g$ coincide on $X$.
\end{proof}
\begin{rem}
    It is easy to see that the scheme property of a prescheme $Y$ or the separateness of the morphisms $Y\morphism[\upsilon] S$, can be characterized by the validity of the above assertion for reduced $X$. In fact, it is sufficient to take $X=\Spec R$ where $R$ is a domain, or a general valuation ring, or, when $Y$ is noetherian, a discrete valuation ring (the \emph{valuation criterion for separatedness}).
\end{rem}
\begin{prop}
    \begin{alphanumerate}
    \item\lbl{prop:specStalksCorrespondence}
        Let $X$ be a prescheme. For $x\in X$, we have a bijection:
        \begin{align*}
            \Spec(\Oo_{X,x}) &\lisomorphism \left\{y\in X\st x\in \ov{\{y\}}\right\}\\
            \left\{(U,\lambda)/_\sim \in \Oo_{X,x}\st y\in V(\lambda)\right\} &\longmapsfrom y\;.
        \end{align*}
        Under this bijection, the generic points of the irreducible components (i.e., the maximal irreducible, hence automatically closed, subsets) of $X$ containing $x$ correspond to the minimal prime ideals of $\Oo_{X,x}$.
    \item
        The morphism $\Spec (\Oo_{X,x}) \morphism[\phi] X$ defined by 
        \begin{align*}
            \phi\colon\Spec(\Oo_{X,x} ) = \Spec\big(\Oo_X(U)_{\pp_x}\big) \morphism \Spec\big(\Oo_X(U)\big) = U \monomorphism X
        \end{align*}
        for an affine open neighbourhood $U$ of $x$ and $\pp_x\in \Spec(\Oo_X(U))$ the ideal of all $f\in \Oo_X(U)$ such that $x\in V(f)$, is independent of $U$ and defines the bijection of \itememph{a} on the level of points.
    \end{alphanumerate}
\end{prop}
\begin{proof}
    For \itememph{a}, we may assume $X$ to be affine because any affine open neighbourhood of $x$ contains all $y$ occurring on the right-hand side (in fact, any open neighbourhood $U$ of $x$ contains $y$ as otherwise $\ov{\{y\}}\subseteq X\setminus U$). When $X=\Spec R$, and $x$ is given by $\pp$ and $y$ by $\qq$ then $\ov{\{y\}} = V(\qq)$, hence $\qq$ defines an element of the right-hand side iff $\qq\subseteq \pp$. In this case, the image of $y$ in the left-hand side $\Spec(\Oo_{X,x})\cong \Spec R_\pp$ is the set of all $\frac{r}{f}\in R_\pp$ (where $f\notin\pp$) such that $\qq R_f$ is an element of the vanishing set of $\frac{r}{f}$ in $R_f$, i.e., $\frac{r}{f}\in \qq R_f$, hence the ideal of $R_\pp$ associated to $y$ is $\qq R_\pp$ (as one would expect). Now the map $\qq\mapsto\qq R_\pp$ gives indeed a bijection onto $\Spec R_\pp$, the inverse map being given by 
    \begin{align}\lbl{eq:localizationBijection}
    	\begin{split}
	    	\Spec R_\pp &\morphism \left\{\qq\in\Spec R\st\qq\subseteq\pp\right\}\\ \rr&\longmapsto \qq= (\text{preimage of }\rr\text{ under }R\to R_\pp)
    	\end{split}\tag{$*$}
    \end{align}
    (a special case of \cite[Corollary~2.3.1\itememph{e}]{alg1}). The correspondence between generic points of maximal irreducible subsets and minimal prime ideals of $\Oo_{X,x}$ is obvious.
    
    Now we prove \itememph{b}. The fact that the map on points defined by $\phi$ is the inverse to the map $\Spec(\Oo_{X,x}) \lisomorphism \left\{y\in X\st x\in \ov{\{y\}}\right\}$ in \itememph{a} follows from \eqreff{eq:localizationBijection}. In particular, $\phi$ is unique on the level of points. Let's consider it on the level of stalks of sections of the structure sheaf. For a $y\in X$ such that $x\in\ov{\{y\}}$ corresponding to the prime ideal $\qq\in\Spec(\Oo_{X,x})$ under the bijection from \itememph{a} we get a canonical morphism
    \begin{align*}
        \Oo_{X,x} = \colimit[U\ni x] \Oo_X(U) \morphism \colimit[V\ni y] \Oo_X(V)=\Oo_{X,y}
    \end{align*}
    from the fact that any open neighbourhood $U$ of $x$ also contains $y$. Under this canonical map, the complement of the prime ideal $\qq$ defined by $y$ maps to units, hence it factors over $(\Oo_{X,x})_\qq\morphism \Oo_{X,y}$ by the universal property of localization. This is the $(\Oo_{X,x})_\qq \cong (\Oo_{\Spec \Oo_{X,x}})_\qq \morphism \Oo_{X,y}$ defined by $\phi$, hence it is unique as well.
\end{proof}

\begin{prop}\lbl{prop:integralPrescheme}
    For a prescheme $X$, the following conditions are equivalent:
    \begin{alphanumerate}
    \item 
        $X$ (i.e., its underlying topological space) is irreducible and reduced.
    \item 
        $X\neq \emptyset$ and $\Oo_X(U)$ is a domain for all open $U\subseteq X$.
    \item 
        As \itememph{b}, but $U$ must be affine.
    \end{alphanumerate}
    If the underlying topological space is noetherian, this is equivalent to 
    \begin{alphanumerate}
    \item[\itememph{d}]
        $X$ is connected and $X\neq \emptyset$ and the stalks $\Oo_{X,x}$ for all $x\in X$ are domains.
    \item[\itememph{e}]
        $X$ is connected and $X\neq \emptyset$ and the stalks $\Oo_{X,x}$ for all closed $x\in X$ are domains.
    \end{alphanumerate}
\end{prop}
\begin{defi}[Integral preschemes]\lbl{def:integralPrescheme}
A prescheme satisfying the equivalent conditions \itememph{a}, \itememph{b}, \itememph{c} of Proposition~\reff{prop:integralPrescheme} is called \defemph{integral}.
\end{defi}
\begin{proof}[Proof of Proposition~\reff{prop:integralPrescheme}]
    Assume \itememph{a} and let $U\subseteq X$ be open and $f,g\in \Oo_X(U)$ such that $fg = 0$. Then $U = V(f)\cup V(g)$. As $U$ is irreducible (it is an open and thus dense subspace of the irreducible space $X$) and $V(f)$ and $V(g)$ are closed in $U$, we have without loss of generality $U = V(f)$ hence $f\in\nil(\Oo_X)(U)$ by Fact~\reff{fact:nilRadical}. As $X$ is reduced, $f=0$, which shows \itememph{a} $\Rightarrow$ \itememph{b}.
    
    It is obvious, that \itememph{b} implies \itememph{c}.
    
    Let's assume \itememph{c}, we show \itememph{c} $\Rightarrow$ \itememph{a}. Assume $\nil(\Oo_X) \neq 0$, so let $f\in \nil(\Oo_X)(U)$ with $f\neq 0$. We can cover $U$ with affine open subsets $U=\bigcup_{i\in I}U_i$. By the sheaf axiom, there has to be an affine $U_i \subseteq U$ such that $f|_{U_i} \neq 0$. But $f\in \nil(\Oo_X)(U_i)$, contradiction. This shows reducedness. 
    
    For irreducibility, take $X=A\cup B$ where $A$ and $B$ are closed and not equal to $X$. Then $V=X\setminus A$ and $W= X\setminus B$ are non-empty open subsets, hence contain non-empty affine open subsets $\snake V \subseteq V$ and $\snake W \subseteq W$. Let $f,g\in \Oo_X(\snake V\cup\snake W)$ be such that $f|_{\snake V} = 1$, $f|_{\snake W} = 0$, $g|_{\snake V} = 0$, $g|_{\snake W} = 1$ (we can do this by the sheaf axiom as $\snake V\cap\snake W=\emptyset$, i.e., there's no intersection to check), then $\snake V\cup \snake W$ is affine and $f$ and $g$ are non-zero zero divisors in $\Oo_X(\snake V\cup \snake W)$. Here, we used the following 
    \begin{fact*}
    	When $X$ and $Y$ are affine, so is their disjoint union $X\amalg Y$.
    \end{fact*}
    \begin{proof}[Proof of the fact] 
    	We have $(\Spec A) \amalg (\Spec B) \cong \Spec A\oplus B$.
    \end{proof}
    
    We return to the proof of Proposition~\reff{prop:integralPrescheme}. If we assume \itememph{b}, then 
    \begin{align*}
        \Oo_{X,x} = \colimit[U\ni x] \Oo_X(U)\;,
    \end{align*}
    as a colimit of domains, is a domain again. So we conclude \itememph{b} $\Rightarrow$ \itememph{d}. It is obvious that \itememph{d} is stronger then \itememph{e}.
    
    Now let $X$ be noetherian and \itememph{e} be true. We show that \itememph{e} $\Rightarrow$ \itememph{a}. Let $y\in X$ and $x\in\ov{\{y\}}$ a closed point, which exists by Proposition~\reff{prop:closedSubsetPoint} (note that $X$ is noetherian, hence quasi-compact, cf.\ \cite[Definition~2.1.2]{alg1}). Choosing an affine open neighbourhood $U\cong \Spec R$ in which $y$ corresponds to the prime ideal $\pp$ and $x$ to the maximal ideal $\mm$, we see that $\Oo_{X,y}\cong R_\pp$ is a localization of $\Oo_{X,x}\cong R_\mm$ and thus a reduced ring since $\Oo_{X,x}$ is. Hence $X$ is reduced at stalks (i.e., \itememph{d} holds) and it's easy to see that this implies reducedness.
    
    Let $X=\bigcup_{i=1}^nX_i$ be the decomposition of $X$ into irreducible components (i.e., maximal irreducible subsets, which are then automatically closed). If $X_i\cap X_j \neq \emptyset$ for $i\neq j$ it would contain a closed point $x$ by Proposition~\reff{prop:closedSubsetPoint} (again by quasi-compactness). By Proposition~\reff{prop:specStalksCorrespondence}\itememph{a} $\Oo_{X,x}$ would contain two different minimal prime ideals (corresponding to $X_i$ and $X_j$ -- or rather their generic points), hence fail to be a domain. Thus $X=\coprod_{i=1}^nX_i$. The $X_i$ are closed, hence open and connected since they are irreducible. Thus $n=1$ by connectedness of $X$. This proves that \itememph{d} $\Rightarrow$ \itememph{a}.
\end{proof}
\begin{rem}\lbl{rem:Prop2.1.4Withoutnoetherian}%I need to ask Franke about this.%not anymore
	\begin{alphanumerate}
		\item Without the noetherianness assumption, the following implications hold
		\begin{center}
			\begin{tikzpicture}
			\node (a) at (0,0) {\itememph{a}};
			\node [right=0.75cm of a] (b) {\itememph{b}};
			\path (a.east) -- (b.west) node[pos=0.5] {$\Longleftrightarrow$};
			\node [right=0.75cm of b] (c) {\itememph{c}};
			\path (b.east) -- (c.west) node[pos=0.5] {$\Longleftrightarrow$};
			\node [right=0.75cm of c] (d) {\itememph{d}};
			\path (c.east) -- (d.west) node[pos=0.5] {$\Longrightarrow$};
			\node [below right=0.75cm of d] (e) {\itememph{e}};
			\path (d.south east) -- (e.north west) node[pos=0.5, rotate=-45] {$\Longrightarrow$};
			\node [below left=0.75cm of d] (x) {$X$ reduced};
			\path (d.south west) -- (x.north east) node[pos=0.5, rotate=-135] {$\Longrightarrow$}; 
			\scriptsize
			\draw[-implies, double equal sign distance,dotted, bend right=45] (e) to node[pos=0.5, above right] {$X$ quasi-compact} (d);
			\end{tikzpicture}
		\end{center}
		\item Note that in the last step of the above proof we crucially need the finiteness of the number of irreducible components. Without noetherianness, there are even examples of affine schemes which are connected and have all stalks domains, but are not irreducible (cf.\ exercise 6 on exercise sheet \#12).
		\item Also note that such $X$ as in Proposition~\reff{prop:integralPrescheme}\itememph{e} do not need to be reduced if quasi-compactness isn't required. There are even examples of preschemes without closed points, such as \url{http://math.stanford.edu/~vakil/files/schwede03.pdf}. If we replace the $A'$ on page 11 by $A''=A'[T]/(T^2)$ and localize at $(T,x_1,x_2,\ldots)$ instead, we get a non-reduced version of that counterexample.
	\end{alphanumerate}
\end{rem}

\section{Finiteness properties of preschemes and morphisms of preschemes}

\subsection{Morphisms of (locally) finite type}
\begin{prop}\lbl{prop:locFiniteMorph}
    For a morphism $X\morphism[f] Y$ of preschemes, the following conditions are equivalent:
    \begin{alphanumerate}
    \item 
        If $U\subseteq X$ and $V\subseteq Y$ are affine open subsets and $f(U)\subseteq V$ then $\Oo_X(U)$ is of finite type over $\Oo_Y(V)$.
    \item 
        It is possible to cover $X$ by affine open subsets $U$ for which there are affine open $V\subseteq Y$ such that $f(U) \subseteq V$ and $\Oo_X(U)$ is of finite type over $\Oo_X(V)$.
    \end{alphanumerate}
\end{prop}
To prove this, we first consider the case where $Y=\Spec A$ is affine.
\begin{lem}\lbl{lem:finiteTypeAffine}
    Let $X\morphism \Spec A$ be a morphism of preschemes, then the following conditions are equivalent:
    \begin{alphanumerate}
    \item   
        For any affine open $U\subseteq X$, $\Oo_X(U)$ is of finite type over $A$.
    \item 
        $X$ may be covered by affine open subsets $U$ such that $\Oo_X(U)$ is of finite type over $A$.
    \end{alphanumerate}
\end{lem}
We derive this from two other lemmas, the first of which is very useful in general for assertions of this type.
\begin{lem}\lbl{lem:propsOfAffine}
    Let $\Pp$ be a property of affine open subsets of a prescheme $X$ satisfying the following properties:
    \begin{alphanumerate}
    \item[\itememph{\alpha}] 
        $\Pp(V)$ implies $\Pp(V\setminus V(f))$ for all $f\in \Oo_X(V)$.
    \item[\itememph{\beta}] 
        If $V$ is affine and $f_1,\ldots,f_n \in \Oo_X(V)$ such that $\bigcap_{i=1}^n V(f_i)=\emptyset$ and such that $\Pp(V\setminus V(f_i))$ for all $i$, then $\Pp(V)$ holds.
    \end{alphanumerate}
    Then the following conditions are equivalent:
    \begin{alphanumerate}
      \item
        $X$ may be covered by affine open subsets $U$ such that $\Pp$ holds for all of them.
    \item
        $\Pp$ holds for arbitrary affine open subsets of $X$.
    \end{alphanumerate}
\end{lem}
\begin{proof}
    The implication \itememph{b} $\Rightarrow$ \itememph{a} being trivial we have to show the other direction. This will be done in two steps.
        
    \emph{Step 1.} We first show that $\Pp(U)$ holds when $U\subseteq V$ are affine and $\Pp(V)$ holds. Since the $V\setminus V(\lambda)$ (for $\lambda\in \Oo_X(V)$) form a topology base on $V$, $U$ may be covered by such subsets which inherit $\Pp$ by \itememph{\alpha}. But $V\setminus V(\lambda)$ equals $U\setminus V(\lambda)$ when it is a subset of $U$. By the quasi-compactness of $U$ and \itememph{\beta}, $\Pp(U)$ holds. 
    
    \emph{Step 2.} Now let $U$ be an arbitrary affine open subset of $X$. If $x\in U$, then $x$ is contained in some affine open subset $V$ of $X$ with $\Pp(V)$. Let $W\subseteq U\cap V$ be an affine open neighbourhood of $x$, we have $\Pp(W)$ by the initial step. We may actually assume $W=U\setminus V(\lambda)$ with $\lambda\in \Oo_X(U)$ as such $W$ form a topology base on $U$. Thus, $U$ may be covered by $W=U\setminus V(\lambda)$ with $\Pp(W)$. By the quasi-compactness of $U$ it has a finite cover of that type, and by \itememph{\beta}, $\Pp(U)$ holds.
\end{proof}
\begin{lem}\lbl{lem:finiteTypeOnGenerators}
    Let $R$ be a ring, $A$ an $R$-algebra, $f_1,\ldots,f_n$ elements of $A$ such that $(f_1,\ldots, f_n)_A = A$ (in other words, $\bigcap_{i=1}^n V(f_i) =\emptyset$ in $\Spec A$). If $A_{f_i}$ is an $R$-algebra of finite type for $1\leq i\leq n$, then $A$ is an $R$-algebra of finite type.
\end{lem}
\begin{proof}
    By our assumption there are $g_1,\ldots,g_n\in A$ such that $1=\sum_{i=1}^n f_ig_i$. Let $A_{f_i}$ be generated by $(\alpha_{i,j})_{j=1}^m$, $\alpha_{i,j} = a_{i,j}\cdot f_i^{-\ell}\in A_{f_i}$ (with $a_{i,j}\in A$, $\ell\geq0$), as an $R$-algebra. Let $\snake A\subseteq A$ be the sub-$R$-algebra of $A$ generated by $f_1,\ldots,f_n$, $g_1,\ldots,g_n$ and the  $a_{i,j}$. We claim $\snake A = A$. Let $x\in A$, we first show that $f_i^kx \in \snake A$ for $i=1,\ldots, n$, when $k$ is large enough. We have 
    \begin{align*}
        x = \sum_{\beta \in \IN_0^m} \rho_{i,\beta} \alpha_{i,1}^{\beta_1}\cdot\ldots\cdot \alpha_{i,m}^{\beta_m}\quad\text{in }A_{f_i}\text{,}
    \end{align*}
    where $\rho_{i,\beta}\in R$ and equal to zero for all but finitely many $\beta$. When $k\geq \ell\cdot \max\left\{|\beta|\st \rho_{i,\beta}\neq 0\right\}$ (where we put $|\beta|=\beta_1+\ldots+\beta_m$), we have
    \begin{align*}
        f_i^kx = \sum_{\beta \in \IN_0^m} \rho_{i,\beta}f_i^{k-\ell\cdot|\beta|} a_{i,1}^{\beta_1}\cdot\ldots\cdot a_{i,m}^{\beta_m}\text{in }A_{f_i}
    \end{align*}
    with $k-\ell\cdot|\beta|\geq 0$ if $\rho_{i,\beta}\neq 0$. The right-hand side can be seen as an element $a\in\snake{A}$. As this is (only) an equality in $A_{f_i}$, we get $f^{k+k'}x=f^{k'}a$ as an equality in $A$ for some $k'\geq0$. But still, $f^{k'}a\in\snake{A}$, establishing the claim. But if $k$ has this property,
    \begin{align*}
        x = \left(\sum_{i=1}^n f_ig_i\right)^{nk}\cdot x= \sum_{\gamma\in\IN_0^n} \frac{(nk)!}{\gamma_1!\cdots\gamma_n!} \left(\prod_{i=1}^n (f_ig_i)^{\gamma_i}\right)\cdot x
    \end{align*}
    in which $\frac{(nk)!}{\gamma_1!\cdots\gamma_n!}$ is integral and $\prod_{i=1}^n (f_ig_i)^{\gamma_i}x\in \snake A$ as $\gamma_i\geq k$ for at least one $i$, hence $f_i^{\gamma_i}x\in\snake A$, as are the other factors.
\end{proof}

\begin{proof}[Proof of Lemma~\reff{lem:finiteTypeAffine}]
    Let $\Pp(V)$ be the property ``$\Oo_X(V)$ is of finite type over $A$'' of affine open $V\subseteq X$. If $V\subseteq X$ is affine having property $\Pp$ and $\lambda\in\Oo_X(V)$, then $\Oo_X(V\setminus V(\lambda))\cong\Oo_X(V)_\lambda=\Oo_X(V)[\lambda^{-1}]$ is of finite type over $\Oo_X(V)$ and thus over $A$ as well, i.e., $\Pp$ has property \itememph{\alpha} of Lemma~\reff{lem:propsOfAffine}. By Lemma~\reff{lem:finiteTypeOnGenerators}, it also has property \itememph{\beta}. Applying Lemma~\reff{lem:propsOfAffine} to $\Pp$ gives Lemma~\reff{lem:finiteTypeAffine}.
\end{proof}

\begin{proof}[Proof of Proposition~\reff{prop:locFiniteMorph}]
    The implication \itememph{a} $\Rightarrow$ \itememph{b} being trivial, let's assume \itememph{b}. We cover $X=\bigcup_{i\in I}U_i$ by affine open $U_i$ for which there are affine open $V_i\supseteq f(U_i)$ such that $\Oo_X(U_i)/\Oo_Y(V_i)$ is of finite type. Now let $U\subseteq X$ and $V\subseteq Y$ be arbitrary affine open subsets such that $V\supseteq f(U)$.
     
     \emph{Step 1.} It is possible to cover $f^{-1}(V)=\bigcup_{j\in J}\snake U_j$ by affine open $\snake U_j$ for which there is an affine open $\snake V_j$ such that $f(\snake U_j) \subseteq \snake V_j\subseteq V$ and $\Oo_X(\snake U_j)/\Oo_Y(\snake V_j)$ is of finite type. 
     
     Indeed, if $x\in f^{-1}(V)$ then $x\in U_i$ for some $i\in I$ and there exists $\lambda_x \in \Oo_Y(V_i)$ such that $f(x)\not\in V(\lambda_x)$ and $\snake V_x \coloneqq V_i\setminus V(\lambda_x) \subseteq V$ (as open subsets of this form form a topology base by Fact~\reff{fact:affineSchemesTopologyBase}\itememph{b}). Keep in mind that $V(f^*\lambda_x)=f^{-1}\big(V(\lambda_x)\big)$ as $f$ is a morphism of locally ringed spaces, cf.\ Definition~\reff{def:localMorphisms}\itememph{b}. Then, with $\snake U_x = U_i\setminus V(f^*(\lambda_x))$, we have $x\in\snake U_x$, $f(\snake U_x)\subseteq \snake V_x$ and finally $\Oo_X(\snake U_x)\cong \Oo_X(U_x)_\lambda\cong\Oo_X(U_i)[(f^*\lambda_x)^{-1}]$ is of finite type over $\Oo_X(U_i)$ hence $\Oo_Y(V_i)$, hence $\Oo_Y(\snake V_x)=\Oo_Y(V_i)_{\lambda_x}$. Taking $J$ to be a subset of $f^{-1}(V)$ such that the $\snake U_j$ for $j\in J$ cover $f^{-1}(V)$ (e.g., just choose $J=f^{-1}(V)$), we proved Step~1.
     
     \emph{Step 2.} It is possible to do the same thing with $\snake V_j= V\setminus V(\lambda)$. Indeed, open subsets of this form being a topology base, it is possible to find $\lambda_{j,k}\in \Oo_Y(V)$ such that $V\setminus V(\lambda_{j,k})$ are subsets of $\snake V_j$ covering it. Then the $\snake U_{j,k} = \snake U_j\setminus V(f^*\lambda_{j,k})$ cover $\snake U_j$ and $\Oo_X(\snake U_{j,k}) \cong \Oo_X(\snake U_j)_{f^*\lambda_{j,k}}$ is of finite type over $\Oo_X(\snake U_j)$ hence $\Oo_Y(\snake V_j)$ hence $\Oo_Y(V\setminus V(\lambda_{i,j}))=\Oo_Y(V)_{\lambda_{j,k}}$.
     
     \emph{Step 3.} In Step 2, $\Oo_Y(V)_{\lambda_{j,k}}$ is of finite type over $\Oo_X(V)$. Hence $\Oo_X(\snake U_{j,k})/\Oo_X(V)$ is of finite type. Then the affine open cover $f^{-1}(V)=\bigcup_{j,k}\smash{\snake U}_{j,k}$ satisfies the property \itememph{b} from Lemma~\reff{lem:finiteTypeAffine} with respect to the morphism of preschemes $f^{-1}(V)\morphism V\cong\Spec\Oo_Y(V)$. We thus get from Lemma~\reff{lem:finiteTypeAffine}\itememph{a} that $\Oo_X(U)$ is of finite type over $\Oo_X(V)$, which is what we wanted to show.
\end{proof}

\begin{defi}[Morphism of (locally) finite type]\lbl{def:morphismFiniteType}
    A morphism is of \defemph{locally finite type} if it satisfies the equivalent conditions \itememph{a} and \itememph{b} from Proposition~\reff{prop:locFiniteMorph}. It is of \defemph{finite type} if it is quasi-compact and of locally finite type.
\end{defi}

\begin{fact}
    If $Y=\Spec R$, the structure of a $Y$-prescheme on $X$ (cf.\ Definition~\reff{def:S-preschemes}) is equivalent to the structure of a sheaf of $R$-algebras on $\Oo_X$ and $X$ is of locally finite type over $Y$ iff the $\Oo_X(U)$ for affine $U$ are $R$-algebras of finite type, and it is of finite type, iff it is in addition quasi-compact.
\end{fact}
\begin{proof}
	Note that such a  morphism $X\morphism[f]Y$ is quasi-compact iff $X$ is quasi-compact using \itememph{\alpha} and \itememph{\gamma} of Definition~\reff{def:qcqs}\itememph{b}. The rest is quite obvious.
\end{proof}
\begin{fact}\lbl{fact:locFiniteTypeProperties}
    The class of morphisms of locally finite type is base-local and stable under composition and base change. The same holds for morphisms of finite type. 
\end{fact}
\begin{proof}
    According to Fact~\reff{fact:qcIsBaseLocalAndStuff}, the class of quasi-compact morphisms have these properties, thus it suffices to prove them for morphisms of locally finite type. 
    
    If $W\subseteq Y$ is open, it is clear that $f^{-1}(W)\morphism W$ inherits the property \itememph{a} from Proposition~\reff{prop:locFiniteMorph} from $f$. Conversely, let $Y=\bigcup_{i\in I}W_i$ be covered by open subsets $W_i$ for which $f^{-1}(W_i)\morphism W_i$ is of locally finite type. Then $f^{-1}(W_i)$ may be covered by $U$ as in property \itememph{b} of Proposition~\reff{prop:locFiniteMorph}. Hence $X$ may be covered this way. This proves base-locality.
    
    As being of finite type is transitive for ring extensions, property \itememph{a} of Proposition~\reff{prop:locFiniteMorph} is stable under composition.
    
    By base-locality, it is sufficient to show base change stability in the special case of $X\morphism \Spec A$ being base changed along $\Spec B\morphism \Spec A$. By Lemma~\reff{lem:finiteTypeAffine}\itememph{a}, it is possible to cover $X$ by affine $U_i\cong \Spec(C_i)$ such that the $C_i$ are of finite type over $A$. Then $X\times_{\Spec A} \Spec B$ is covered by the $U_i\times_{\Spec A} \Spec B \cong \Spec(C_i\otimes_A B)$ and $C_i\otimes_A B$ is of finite type over $B$, being generated by the $c_{i,j}\otimes 1$ over $B$ if the $(c_{i,j})_{j=1}^{n_i}$ generate $C_i/A$.
\end{proof}
\begin{rem*}
    Being of locally finite type is also local in the sense that it is inherited by $U\morphism[f] V$ from $X\morphism[f] Y$ if $U$ and $V$ are open with $f(U)\morphism V$ and that it holds for $f$ if $X$ may be covered by such open subsets $U$ (for which an appropriate $V$ exists).
\end{rem*}
\begin{cor}\lbl{cor:affineInclusionFiniteType}
    If $U\subseteq V$ is an inclusion of affine open subsets of a prescheme $X$, then $\Oo_X(U)$ is of finite type over $\Oo_X(V)$.
\end{cor}
\begin{proof}
	The morphism $\id_X$ is of finite type as Proposition~\reff{prop:locFiniteMorph}\itememph{b} obviously holds. Then Proposition~\reff{prop:locFiniteMorph}\itememph{a} does it.
\end{proof}
\begin{cor}\lbl{cor:openImmersionFiniteType}
    Any open immersion is of locally finite type. 
\end{cor}
\begin{proof}
	Follows from Corollary~\reff{cor:affineInclusionFiniteType}.
\end{proof}
\begin{cor}\lbl{cor:closedImmersionFiniteType}
    Any closed immersion is of finite type.
\end{cor}
\begin{proof}
	As we noted in Remark~\reff{rem:qcqs}\itememph{d}, closed immersions are always quasi-compact. To show locally finite typeness, let $K\morphism[\iota]X$ be a closed immersion, then Proposition~\reff{prop:closedImmersionCoherentSheaves} assigns to $K$ a quasi-coherent sheaf of ideals $\Jj\subseteq\Oo_X$. Restricting to an affine open subset $U\cong\Spec R$ of $X$, $\Jj$ has the form $\snake I$ for some ideal $I\subseteq R$ and $\iota^{-1}U\morphism U$ is given by $\Spec R/I\morphism\Spec R$. Now $R/I$ is of finite type over $R$ and by Proposition~\reff{prop:locFiniteMorph}\itememph{b} we are done.
\end{proof}
\begin{cor}
    Any locally closed immersion is of locally finite type.
\end{cor}
\begin{proof}
	A locally closed immersion is, by definition (a definition that was never given, but here's what Professor Franke -- I asked him -- would have given, if he had given it), a morphism of the form $j\circ i$ with $i$ an open immersion followed by $j$ a closed one (and not just an immersion with locally closed image). Then Corollary~\reff{cor:openImmersionFiniteType} and Corollary~\reff{cor:closedImmersionFiniteType} do it. 
\end{proof}

\subsection{(Locally) noetherian preschemes}

\begin{prop}\lbl{prop:locnoetherian}
    For a prescheme $X$, the following are equivalent:
    \begin{alphanumerate}
    \item 
        For any quasi-compact open $U\subseteq X$, any ascending sequence $\Jj_0\subseteq \Jj_1\subseteq\ldots \subseteq \Oo_X|_U$ of quasi-coherent sheaves of ideals on $U$ terminates at some $N$ with $\Jj_N= \Jj_n$, when $n\geq N$.
    \item 
        For any affine open $U\subseteq X$, \itememph{a} holds.
    \item 
        For any affine open $U\subseteq X$, $\Oo_X(U)$ is noetherian.
    \item  
        $X$ may be covered by affine open $U$ such that $\Oo_X(U)$ is noetherian.
    \item   
        $X$ may be covered by affine open $U$ for which \itememph{a} holds.
    \end{alphanumerate}
\end{prop}
\begin{proof}
    Since there is a bijection between quasi-coherent sheaves of ideals on $U=\Spec A$ and the ideals in $A$, $A$ is noetherian iff \itememph{a} holds for $U=\Spec A$. Thus \itememph{b} $\Leftrightarrow$ \itememph{c} as well as \itememph{d} $\Leftrightarrow$ \itememph{e}. The implications \itememph{a} $\Rightarrow$ \itememph{b} $\Rightarrow$ \itememph{e} are trivial.  
    
    Let's show \itememph{e} $\Rightarrow$ \itememph{a}. By \itememph{e}, $X=\bigcup_{i\in I}U_i$ may be covered by affine open $U_i$ for which $\Oo_X(U_i)$ is noetherian. For $\lambda\in\Oo_X(U_i)$, the $\Oo_X(U_i\setminus V(\lambda)) \cong \Oo_X(U_i)_\lambda$ are also noetherian, hence the $U_i\setminus V(\lambda)$ satisfy \itememph{a}. By Fact~\reff{fact:affineSchemesTopologyBase}\itememph{b} they form a topology base. Hence any quasi-compact open $U$ may be covered by finitely many such $U_i\setminus V(\lambda)$. Since the sequence $(\Jj_i)_{i\in\IN_0}$ stabilizes on each of these finitely many subsets, it stabilizes on $U$ (using the sheaf axiom).
\end{proof}
\begin{defi}[(Locally) noetherian preschemes]\lbl{def:locnoetherian}
    Such preschemes are called \defemph{locally noetherian}. $X$ is \defemph{noetherian} if it is locally noetherian and quasi-compact.
\end{defi}

\begin{fact}
    \begin{alphanumerate}
    \item 
        A prescheme of locally finite type over a locally noetherian preschemes is locally noetherian.
    \item   
        A prescheme of finite type over noetherian prescheme is noetherian.
    \item 
        The underlying topological space of a noetherian prescheme is noetherian.
    \item 
        Let a topological space $X$ be called \defemph{locally noetherian} if the following equivalent conditions hold:
        \begin{itemize}
        \item[\itememph{\alpha}]
            Any quasi-compact open subset is $U\subseteq X$ noetherian, and $X$ can be covered by quasi-compact open subsets.
        \item[\itememph{\beta}]
            $X$ can be covered by noetherian open subsets.
        \item[\itememph{\gamma}] 
            $X=\bigcup_{i\in I}U_i$ can be covered by quasi-compact open subsets $U_i$ such that any open $U\subseteq U_i$ is quasi-compact again.
        \end{itemize}
        Then the underlying topological space of a locally noetherian prescheme is locally noetherian.
    \end{alphanumerate}
\end{fact}
\begin{proof}
	Part \itememph{a} follows from Proposition~\reff{prop:locnoetherian}\itememph{d}, Proposition~\reff{prop:locFiniteMorph}\itememph{b} and the Hilbert Basissatz. Part \itememph{b} follows in the same way as quasi-compactness is preserved by morphisms of finite type.
	
	Now let's prove \itememph{c} (which is \emph{not} just a trivial consequence of Proposition~\reff{prop:locnoetherian}\itememph{a}). If $X$ is a noetherian prescheme, there is a finite affine open cover $X=\bigcup_{i=1}^kU_i$ with $\Oo_X(U_i)$ noetherian, hence each $U_i$ is noetherian. If $X\supseteq C_0\supseteq C_1\supseteq \ldots$ is a descending chain of closed subsets, then each $(U_i\cap C_n)_{n\in\IN_0}$ stabilizes, hence so does $(C_n)_{n\in\IN_0}$. Part \itememph{d} is similar (equivalence of \itememph{\alpha}, \itememph{\beta}, and \itememph{\gamma} follows from \cite[Definition~2.1.2]{alggeo1} and some easy arguments).
\end{proof}

\section{The relation between varieties and schemes}

Let $X$ be a noetherian $T_1$-space and $X^* = X\cup H $, where 
\begin{align*}
    H= \left\{\eta_Z\st Z\subseteq X \text{ irreducible closed, }\#Z> 1\right\}\;,
\end{align*}
the two sets are assumed to be disjoint and where $\eta_Z\neq \eta_Y$ when $Z\neq Y$. For open $U\subseteq X$, let 
\begin{align*}
    U^* &= U \cup \left\{\eta_Z\in H\st Z\cap U \neq \emptyset\text{, }\# Z > 1\right\} = U\cup \left\{\eta_Y \st Y\subseteq U\text{ irreducible closed, }\#Y > 1\right\}\;.
\end{align*}
The second equality can be seen as follows: If $Y\subseteq U$ is irreducible and $\#Y>1$, then its closure $\ov Y\subseteq X$ is irreducible and clearly has also at least $2$ points. Conversely, if $Z\subseteq X$ is irreducible and $\# Z>1$, then $Z\cap U$ is irreducible if it is $\neq\emptyset$ and must contain more than $1$ point. Indeed, if not, then this point would be open in $Z$ but also closed (by $T_1$-ness), thus $Z$ wouldn't be connected and, in particular, not irreducible.

We have $(U\cap V)^* = U^* \cap V^*$, $\bigcup_{i\in I} U_i^* = \big(\bigcup_{i\in I} U_i\big)^*$ by basic properties of irreducibility. Thus, there is a topology base on $X^*$ by the open subsets $U^*$. As the posets of $X$ and $X^*$ (i.e., the partially ordered sets with respect to inclusion) are isomorphic, the presheaf categories on $X$ and $X^*$ are isomorphic and the validity of the sheaf axiom turns out to be preserved. 

\begin{fact}\lbl{fact:catIsoT1Sober}
    We have an equivalence of categories between the noetherian $T_1$-spaces and the the noetherian sober spaces such that the closed points are dense in any closed subset. 
    \begin{align*}
        X =\left\{\text{closed points of } Y\right\} &\longmapsfrom Y\\
        X&\longmapsto Y= X^*\;.
    \end{align*}
\end{fact}
\begin{proof}
	Omitted.
\end{proof}
\begin{fact}
	If $k$ is an algebraically closed field and $X\morphism \Spec k$ is a morphism of finite type, then a point $x\in X$ is closed iff it is closed in some affine open subset which again is equivalent to $\KK(x)=\Oo_{X,x}/\mm_x = k$ (where $\mm_x$ is the maximal ideal of $\Oo_{X,x}$). 
\end{fact}
\begin{proof}
	Indeed, if $x\in X$ is closed, then $\{x\}\monomorphism X$ is a closed immersion, hence of finite type by Corollary~\reff{cor:closedImmersionFiniteType}, hence so is the composite $\{x\}\morphism\Spec k$ by stability under composition (cf.\ Fact~\reff{fact:locFiniteTypeProperties}), hence $\Oo_{X,x}$ is of finite type over $k$ and its residue field must equal $k$ by Hilbert's Nullstellensatz.
	
	Conversely, if $\KK(x)=k$, choose an open neighbourhood $U\cong \Spec R$ of $x$, such that $x$ corresponds to $\pp\in\Spec R$. Then $\KK(x)$ equals the residue field of the local ring $R_\pp$ which is the same as the quotient field of $R/\pp$. The ring $R=\Oo_X(U)$ being of finite type over $k$, Noether normalization  shows that $R/\pp$ is integral over $k[a_1,\ldots,a_n]$ with some $a_1,\ldots,a_n\in R/\pp$ algebraically independent over $k$. As $\KK(x)=k$ we must have $n=0$ and $R/\pp$ is integral over a field, thus a field itself (cf.\ for example \cite[Proposition~1.5.1\itememph{d}]{alg1}). Then $\pp$ is a maximal ideal and $\{x\}=V(\pp)$ is closed in $U$. As this holds for any affine open neighbourhood of $x$ and, of course, also for those affine open sets not containing $x$, it follows that $x\in X$ is a closed point.
	
	Finally, $\KK(x)$ doesn't change when restricting to an affine open neighbourhood of $x$. This shows that the above-asserted equivalence.
\end{proof}
Then every $f\in \Oo_X(U)$ defines a function from the closed points of $U$ to $k$ by mapping $x\in X$ to the image of $f$ under
\begin{align*}
    \Oo_X(U)\morphism \Oo_{X,x} \morphism \Oo_{X,x}/\mm_x \cong k\;.
\end{align*}
This should be enough to motivate the following
\begin{thm}
    We have an equivalence of categories between the category of prevarieties over $k$ and the integral preschemes $X$ of finite type over $\Spec k$ by
    \begin{align*}
        Y &\longmapsto Y^*\\
        Y = \left\{\text{closed points of } X\right\} &\longmapsfrom X
    \end{align*}
    with the prevariety $Y$ equipped with the above sheaf of $k$-valued functions. The prescheme $Y^*$ of finite type over $\Spec k$ is equipped with the unique sheaf of rings on $Y^*$ corresponding to $\Oo_Y$ under isomorphism of categories from Fact~\reff{fact:catIsoT1Sober}.
\end{thm}
\begin{proof}
	Omitted.
\end{proof}
\section{Jacobson preschemes}

In this section we want to consider the following problem. Let $R$ be a discrete valuation ring with maximal (principal) ideal $(\pi)$. Then $\Spec R = \{s,\eta\}$, where $s= (\pi)$ is closed and $\eta = 0$ is open. Thus the closed points of $\Spec R$ are not dense in $\Spec R$, and $\Spec K \morphism \Spec R$, where $K= R[\pi^{-1}]$ is the quotient field of $R$, is of finite type and maps the unique (hence closed) point of $\Spec K$ to the non-closed $\eta\in \Spec R$.

\begin{example}
    Let $S= \Spec R$, $X=\IA^1_R=\Spec R[T]$ (the \emph{affine line} over $R$), and  $\IP_R^1=\Proj \left(R[T_0,T_1]\right)$ (also cf.\ Definition~\reff{def:Proj} and Definition~\reff{def:projectiveScheme}). We have a commutative diagram
    \begin{diagram*}
    	\node[ob](x) at (0,1.25) {$X$};
    	\node[ob](s) at (1.25,0) {$S$};
    	\node[ob](y) at (2.5,1.25) {$\IP^1_R$};
    	\scriptsize
    	\draw[->] (x) -- (s);
    	\draw[right hook->] (x) -- (y);
    	\draw[->] (y) -- (s);
    \end{diagram*}
    The morphism $X\morphism S = \{\eta, s\}$ is of finite type and the ideal $\pp = (1 - T\pi)_{R[T]}\subseteq R[T]$ is maximal (as $R[T]/\pp = R[\pi^{-1}] = K$), hence closed in $X$ (but not in $\IP_R^1$, where the point $\infty$ on the fibre over $s$ is in its closure) and the image of $\pp$ in $S$ is $\eta$, hence not closed. We have $\codim(\{\pp\}, X) =1$ by Krull's principal ideal theorem (cf.\ \cite[Theorem~11]{alg2}) or just \cite[Proposition~2.1.3]{alg1}. But the closed points of the fibre over $s$ have codimension two. Indeed, using that $R[T]$ is factorial since $R$ is, it's easy to see that $\pi R[T]\subseteq R[T]$ is still prime, but $R[T]/\pi R[T]\cong R/(\pi)[T]$ is one-dimensional as it is the polynomial ring over the field $R/(\pi)$. Hence this gives an example of a prescheme which is catenary and integral but not \emph{equicodimensional}, i.e., not every closed point has the same codimension.
\end{example}

\begin{fact}\lbl{fact:closedPointsDense}
    Consider the following ``two'' properties of topological spaces:
    \begin{alphanumerate}
    \item 
        The closed points of $X$ are dense in any closed subset.
    \item 
        The closed points of $X$ are dense in any irreducible closed subset.
    \item   
        If $U\subseteq X$ is open and $x\in U$ closed in $U$ then $x$ is closed in $X$.
    \end{alphanumerate}
    Then \itememph{a} and \itememph{b} are equivalent and imply \itememph{c}. If in addition there is a topology base consisting of open subsets $U$ such that any closed subset of $U$ contains a closed point (this is equivalent to any irreducible closed subset of $U$ containing a closed point) then \itememph{c} also implies \itememph{a}.
\end{fact}
\begin{proof}
    It is obvious that \itememph{a} implies \itememph{b}. Now assume \itememph{b} and let $A\subseteq X$ be closed, $U\subseteq X$ open and $a\in A\cap U$ and $B= \ov{\{a\}} \subseteq A$. Then $B$ is irreducible closed hence $B\cap U$ contains a closed point $b$ of $X$ and $b\in B\cap U\subseteq A\cap U$. So \itememph{a} holds.
    
    Again assuming \itememph{b}, we want to show \itememph{c}. Let $U\subseteq X$ be open, $x\in U$ closed in $U$ and $\ov{\{x\}}= A$ be its closure in $X$. Then $A\cap U$ is the closure of $x$ in $U$, hence $A\cap U = \{x\}$ and $x$ must be closed in $X$ because $A\cap U\neq \emptyset$ would fail to contain a closed point otherwise.
    
    We now want to show the remaining implication under the stated assumption. Let $\Bb$ be such a topology base with the desired properties. Let $A\subseteq X$ be closed, $A\neq \emptyset $ and $a\in A$ and $U\in \Bb$ such that $a\in U$. Then there is $x\in A\cap U$ closed in $U$, hence also in $X$. 
\end{proof}

Recall (not from this lecture but from Algebra~II, so if you do not participate in the other lecture, you may want to read the nice script \cite{alg2}), that for any ring $R$ we define its \defemph{Jacobson radical} 
\begin{align*}
    \rad R = \bigcap_{\mm\in\mSpec R} \mm = \left\{r\in R\st 1-\rho r \in R^\times\ \forall \rho\in R\right\}
\end{align*}

\begin{lem}\lbl{lem:whenRadIsZero}
    Let $R$ be a domain such that $\rad R = 0$, then $R$ is a field or its field of quotients $K$ fails to be of finite type over $R$.
\end{lem}
\begin{proof}
    If $K$ is of finite type over $R$ (say generated by $\frac{z_1}{n_1},\ldots,\frac{z_k}{n_k}$) then $K= R_f$ for some $f\in R\setminus \{0\}$ (e.g., $f = n_1\cdots n_k$) and every $x\in R\setminus \{0\}$, being invertible in $K=R_f$, divides some power of $f$. Hence $f$ is contained in any non-zero prime ideal, thus $f\in\rad R$ (and so $\rad R\neq 0$) or $0$ is a maximal ideal (and so $R$ is a field).
\end{proof}
\begin{prop}\lbl{prop:JacobsonRing}
    For a ring $R$, the following conditions are equivalent:
    \begin{alphanumerate}
    \item 
        $\Spec R$ satisfies the equivalent properties of Fact~\reff{fact:closedPointsDense} (including the additional property, as we will see).
    \item  
        Any $\pp\in \Spec R$ is the intersection of the maximal ideals containing it.
    \item 
        For any $\pp\in \Spec R$, $\rad(R/\pp) = 0$.
    \item  
        If $A$ is any $R$-algebra of finite type and $\mm$ a maximal ideal of $A$, then its preimage in $R$ is also maximal.
    \end{alphanumerate}
\end{prop}
\begin{proof}
    The equivalence between \itememph{b} and \itememph{c} follows from the formula for the Jacobson radical recalled above.
    
    The points \itememph{a} and \itememph{b} are equivalent, which follows from the description of the topology on $\Spec R$. Indeed, let $\pp\in\Spec R$ and $\MM=\left\{\mm\in\mSpec R\st \mm\supseteq\pp\right\}$. We certainly have 
    \begin{align*}
    	\bigcup_{\mm\in\MM}\{\mm\}=\bigcup_{\mm\in\MM}V(\mm)\subseteq V\bigg(\bigcap_{\mm\in\MM}\mm\bigg)
    \end{align*}
     (but equality doesn't necessarily hold for infinite intersections) and the points of $V(\pp)$ which are closed in $\Spec R$ are precisely given by the left-hand side. If \itememph{a} holds, then, by Fact~\reff{fact:closedPointsDense}\itememph{b}, $\bigcup_{\mm\in\MM}\{\mm\}$ intersects the open set $V(\pp)\setminus V\left(\bigcap_{\mm\in\MM}\mm\right)$ if it is non-empty, hence, by the above inclusion, it must be empty and $\pp=\bigcap_{\mm\in\MM}\mm$. Thus \itememph{a} $\Rightarrow$ \itememph{b}.
     
     Conversely, assume that \itememph{b} holds and let $V(\pp)\setminus V(I)$ for some ideal $I\supsetneq\pp$ be an open subset of the irreducible set $V(\pp)\subseteq \Spec R$. Then $I\not\subseteq \bigcap_{\mm\in\MM}\mm$, hence there is an $\mm\in\MM$ such that $I\not\subseteq\mm$ and so $\mm\in V(\pp)\setminus V(I)$. Thus, $\bigcup_{\mm\in\MM}\{\mm\}$ is dense in $V(\pp)$ and Fact~\reff{fact:closedPointsDense}\itememph{b} holds, proving that \itememph{b} $\Rightarrow$ \itememph{a}.
    
    Assume \itememph{b}, we want to show \itememph{b} $\Rightarrow$ \itememph{d}. Let $R\morphism[\alpha]A$ be an $R$-algebra of finite type, $\mm\in \mSpec A$, we have to show $\alpha^{-1}(\mm) \in \mSpec R$. Replacing $A$ by $A/\mm$, we may assume $A$ to be a field. Replacing $R$ by $R/\pp$ with $\pp = \alpha^{-1}(\mm)$ (this certainly is a prime ideal of $R$) we may assume $R$ to be a subring of that field. Then $A$ contains the field $K$ of quotients of $R$ over which it is of finite type. By the Nullstellensatz $A/K$ is a finite field extension, hence $A$ is a finitely generated $K$-module. By a theorem of Artin--Tate (cf.\ \cite[Proposition~1.4.2]{alg1}), $K$ is of finite type over $R$. By $\rad R = 0$ and Lemma~\reff{lem:whenRadIsZero}, $R=K$, hence all prime ideals of $R$ are maximal. 
    
    To show that \itememph{d} implies \itememph{a}, we upgrade Fact~\reff{fact:closedPointsDense} to Fact~\reff{fact:1++} (the proof of Fact~\reff{fact:closedPointsDense} essentially shows this).
    
    \begin{varthm}[$^{++}$]{fact}\lbl{fact:1++}
        Let $X$ be a topological space with a topology base $\Bb$ such that any non-empty closed subset of an element $U$ of $\Bb$ contains a closed point of $U$ and such that every closed point of any  element of $\Bb$ stays closed in $X$. Then $X$ satisfies Fact~\reff{fact:closedPointsDense}\itememph{a}.
    \end{varthm}
    
    Applying this to $\Bb = \left\{\Spec R_f \st f\in R\right\}$, the $R_f$ are of finite type over $R$ and preimages of maximal ideals of $R_f$ remain maximal, hence points which are closed in $\Spec R_f$ are also closed in $\Spec R$. Also, any nonempty closed subset $V(I)\subseteq \Spec R_f$ with $I\subseteq R_f$ a proper ideal contains a closed point, namely $\mm$ if $\mm$ is a maximal ideal of $R_f$ above $I$. By Fact~\reff{fact:1++}, the conclusion follows. 
\end{proof}
\begin{defi}[Jacobson ring]\lbl{def:JacobsonRing}
    A ring with the equivalent properties from Proposition~\reff{prop:JacobsonRing} is called a \defemph{Jacobson ring}.
\end{defi}
\begin{example}
    Any field is a Jacobson ring as is any principal ideal domain with infinitely many prime ideals, or any Dedekind domain with infinitely many prime ideals. Semilocal rings (with only finitely many maximal ideals) are non-Jacobson unless $\Spec R$ is discrete (this is equivalent to $R$ being Artinian, provided $R$ is noetherian).
\end{example}
\begin{cor}\lbl{cor:NillstellensatzReloaded}
    Any algebra of finite type over a Jacobson ring is Jacobson.
\end{cor}
\begin{proof}
    Let $R$ be Jacobson and $A/R$ as well as $B/A$ be ring extensions of finite type. Let $\mm\in \mSpec B$ and $\nn = A\cap \mm$, then $\nn\cap R = \mm\cap R$ is a maximal ideal as $B/R$ is of finite type and $R$ is Jacobson. Hence $A/\nn$ is a subring of $B/\mm$ and $B/\mm$ is of finite type over $R/(R\cap\mm)$, hence it is a finite field extension of $R/(R\cap\mm)$ by the Nullstellensatz. Now $A/\nn$ gets sandwiched via $R/(R\cap\mm) \subseteq A/\nn \subseteq B/\mm$ where the outer terms form a finite field extension, then $A/\nn$ is a domain and $B/\mm$ a field integral over it, hence $A/\nn$ must be a field itself (cf.\ \cite[Proposition~1.5.1\itememph{d}]{alg1}) and $\nn$ a maximal ideal. Hence $A$ satisfies Property \itememph{d} of Proposition~\reff{prop:JacobsonRing}.
\end{proof}
\begin{defi}[Finally Franke openly admits it is actually also a proposition -- a fault confessed is half redressed]\lbl{def:JacobsonPrescheme}
    For a prescheme $X$, the following conditions are equivalent:
    \begin{alphanumerate}
    \item 
        The underlying topological space satisfies the equivalent properties of Fact~\reff{fact:closedPointsDense}.
    \item 
        For any affine open $U\subseteq X$, $\Oo_X(U)$ is a Jacobson ring.
    \item 
        $X$ may be covered by affine open $U$ such that $\Oo_X(U)$ is a Jacobson ring.
    \item 
        If $Y\morphism[f] X$ is a morphism of locally finite type and $y\in Y$ closed, $f(y)$ is closed in $X$. 
    \end{alphanumerate}
    A prescheme with these properties is called \defemph{Jacobson prescheme}. Any prescheme of locally finite type over a Jacobson prescheme is Jacobson.
\end{defi}
\begin{rem*}
    In view of these facts, Jacobsonness is a local property. It is inherited by the open subsets. A prescheme $X$ is Jacobson if it may be covered by open subset which are Jacobson.
\end{rem*}
\begin{proof}[Proposition or not, we need to prove Definition~\reff{def:JacobsonPrescheme} anyway]
    Assume \itememph{a}. Let $U\subseteq X$ be an affine open subset, $A\subseteq U$ closed and irreducible, and $V\subseteq U$ open such that $V\cap A\neq \emptyset$. Let $B$ be the closure of $A$ in $X$. Then $A\cap V = B\cap V$ contains a point which is closed in $X$, hence in $U$ and thus the closed points of $U$ are dense in $A$. This proves \itememph{a} $\Rightarrow $ \itememph{b}.
    
    That \itememph{b} implies \itememph{c} is trivial.
    
    Now assume \itememph{c}, we want to show \itememph{a}. If $U\subseteq X$ is affine open and $\Oo_X(U)$ is Jacobson, then $\Oo_X(U\setminus V(\lambda))$ is Jacobson for any $\lambda\in \Oo_X(U)$ as $\Oo_X(U)_\lambda$ is of finite type over $\Oo_X(U)$ and we can use Corollary~\reff{cor:NillstellensatzReloaded}. By Fact~\reff{fact:affineSchemesTopologyBase}\itememph{b} the affine open $U$ such that $\Oo_X(U)$ is Jacobson thus form a topology base and the assertion is easily seen similar to Fact~\reff{fact:1++}.
    
    Let's show \itememph{d} $\Rightarrow$ \itememph{a}. If $U\subseteq X$ is open, then the open immersion $U\monomorphism X$ is of locally finite type (by Corollary~\reff{cor:openImmersionFiniteType}) hence maps closed points to closed ones if we assume \itememph{d}. Then Fact~\reff{fact:closedPointsDense}\itememph{c} holds which implies \itememph{a}.
    
    To close the circle, we assume \itememph{a} and \itememph{b} (these being equivalent) and show \itememph{d}. Let $y\in Y$ be closed and choose affine open subsets $V\subseteq Y$, $U\subseteq X$ such that $y\in V$ and $f(V)\subseteq U$. Then $\Oo_X(U)$ is Jacobson and $\Oo_Y(V)$ of finite type over it, hence $f(y)$ is closed in $U$ by the Proposition~\reff{prop:JacobsonRing}\itememph{d}, hence $f(y)$ is closed in $X$ by \itememph{a} (using the property from Fact~\reff{fact:closedPointsDense}\itememph{c}).
\end{proof}

\begin{thm}[Serre] \lbl{thm:serre}
    For a noetherian local ring $R$ with maximal ideal $\mm$ and residue field $k$, the following are equivalent:
    \begin{alphanumerate}
    \item 
        $k$ admits a finite free resolution, i.e., there are free $R$-modules $F_i$ and an exact sequence
            \begin{align*}
                0 \lmorphism k \lmorphism F_0 \lmorphism F_1 \lmorphism \ldots \lmorphism F_n \lmorphism 0\;.
            \end{align*}
    \item 
        $k$ admits a finite flat resolution, i.e., an exact sequence of $R$-modules
            \begin{align*}
                0 \lmorphism k \lmorphism F_0 \lmorphism F_1 \lmorphism \ldots \lmorphism F_n \lmorphism 0
            \end{align*}
        where the $F_i$ are flat. That is, each $-\otimes F_i$ is an exact functor.
    \item 
        Any $R$-module admits a finite free resolution.
    \item 
        Any $R$-module admits a finite flat resolution.
    \item 
        Equality occurs in the inequality $\dim R \leq \dim_k (\mm/\mm^2)$.
    \end{alphanumerate}
\end{thm}
\begin{proof}
	The proof requires a bunch of theory we didn't do in the lecture and may be found in \cite[Theorem~1]{homalg}.
\end{proof}

\begin{defi}[Regular ring] \lbl{def:regular}
    Such $R$ are called \defemph{regular}.
\end{defi}
\begin{cor}\lbl{cor:localizationRegular}
    If $R$ is a regular local ring and $\pp\in \Spec R$, then $R_\pp$ is regular.
\end{cor}
\begin{proof}
	An $R_\pp$-module $M$ is also an $R$-module and thus admits a finite resolution by free $R$-modules by Theorem~\reff{thm:serre}\itememph{c}. Tensoring this resolution with $R_\pp$ (which is flat, since localization is an exact functor) gives a finite free resolution of $M\otimes_RR_\pp\cong M$ (well, $M$ is an $R_\pp$-module already) by free $R_\pp$-modules, hence $R_\pp$ is regular again by Theorem~\reff{thm:serre}\itememph{c}.
\end{proof} 
\begin{defi}[Normal ring]\lbl{def:normal}
    A domain is called \defemph{normal} if it is integrally closed in its field of quotients.
\end{defi}
 It is easy to see that normality is inherited by localization. 
\begin{defi}[Regular and normal prescheme]\lbl{def:regularNormalPrescheme}
    A locally noetherian prescheme $X$ is called \defemph{regular} (respectively \defemph{normal}) if $\Oo_{X,x}$ is regular (respectively normal) for all $x\in X$.
\end{defi}
\begin{rem}
    \begin{alphanumerate}
    \item 
        If $X$ is quasi-compact or Jacobson and $\Oo_{X,x}$ regular for closed $x$, then $X$ is regular. Indeed, let $x\in X$, by Proposition~\reff{prop:closedSubsetPoint} (for $X$ quasi-compact) or Fact~\reff{fact:closedPointsDense}\itememph{a} (for $X$ Jacobson), $\ov{\{x\}}$ contains a closed point $y$. Then $\Oo_{X,y}$ is regular as is its localization $\Oo_{X,x}$ (we  use Proposition~\reff{prop:specStalksCorrespondence} to see that $\Oo_{X,x}$ is indeed a localization of $\Oo_{X,y}$) by Corollary~\reff{cor:localizationRegular}.
    \item   
        Note that $\left\{x\in X\st \Oo_{X,x} \text{ singular}\right\}$ may fail to be closed, despite Theorem~\reff{thm:serre}. As you might expect, \emph{singular} means \emph{not regular}.
    \item 
        For a domain $A$ with field of quotients $K$, one has 
        \begin{align*}
        	A=\bigcap_{\pp\in \Spec A}  A_\pp = \bigcap_{\mm\in\mSpec} A_\mm\;.
        \end{align*}
        (the intersection being taken in $K$). Indeed, it's obvious that $A$ is contained in these intersections. Conversely, consider $r$ in this intersection and $I=\left\{a\in A\st ar\in A\right\}$ then $I$ fails to be contained in any maximal ideal of $A$, while being an ideal, hence $I=A$ and $r=1\cdot r\in A$. 
        
        It easily follows that $A$ is normal iff all $A_\mm$ (or all $A_\pp$) are. Hence, for $X$ a locally noetherian prescheme, we have that the conditions
        \begin{itemize}
        	\item[\itememph{\alpha}] $X$ is normal
        	\item[\itememph{\beta}] $\Oo_X(U)$ is a normal domain for any affine open, connected, and non-empty $U$
        	\item[\itememph{\gamma}] $X$ may be covered by affine open $U$ such that $\Oo_X(U)$ is a normal domain
        \end{itemize}
         are equivalent. When $X$ is quasi-compact or Jacobson, this is moreover equivalent to $\Oo_{X,x}$ being a normal domain when $x$ is closed in $X$.
         
         Indeed, \itememph{\alpha} $\Rightarrow$ \itememph{\beta} follows from Proposition~\reff{prop:integralPrescheme}\itememph{d} and \itememph{c} applied to $U$ (note that the $\Oo_X(U)$ appearing here are noetherian by Proposition~\reff{prop:locnoetherian}\itememph{b}) and the above locality of a ring being normal. To see \itememph{\beta} $\Rightarrow$ \itememph{\gamma}, by Lemma~\reff{lem:noetherianConnectedComponentsOpen} we can cover $X$ by affine open and connected subsets. Finally, \itememph{\gamma} $\Rightarrow$ \itememph{\alpha} follows from Proposition~\reff{prop:integralPrescheme}\itememph{c} and \itememph{d} (note that such $U$ as in \itememph{\gamma} are irreducible, being the spectrum of a domain, and thus connected).
         
         If $X$ is quasi-compact, we can use Remark~\reff{rem:Prop2.1.4Withoutnoetherian} to deduce the stated equivalence. If $X$ is Jacobson, a point $x\in X$ is closed in $X$ iff it is closed in some open subset $U\subseteq X$ by Fact~\reff{fact:closedPointsDense}\itememph{c} and we may apply Proposition~\reff{prop:integralPrescheme}\itememph{e} and \itememph{d} on suitable affine open and connected subsets $U\subseteq X$.
    \item 
        Let $R_k$ be the condition: $\Oo_{X,x}$ is regular when $\codim(\ov{\{x\}}, X) \leq k$. Then $R_0$ may be expressed as the regularity of $\Oo_{X,\eta}$ where $Z=\ov{\left\{\eta\right\}}$ is an irreducible component of $X$ (and thus $\eta$ its generic point), which for zero-dimensional noetherian local rings is equivalent to $\Oo_{X,\eta}$ being a field. 
        
        Well, two things are to check here. First, that $\Oo_{X,\eta}$ is zero-dimensional. Let $\Spec R\cong U\subseteq X$ be affine open intersecting $Z$, then $Z\cap U\cong V(\pp)$ for some prime ideal $\pp\in\Spec R$ which has height $0$ as $V(\pp)$ is maximal irreducible. Then $R_\pp\cong \Oo_{X,\eta}$ is zero-dimensional.  
        
        And second, that a zero-dimensional noetherian local ring $R$ is regular iff it is a field. If $R$ is a field, it's clearly regular. Conversely, let $\mm$ be the maximal ideal, and $f_1,\ldots,f_n$ generators of it. If $\mm=\mm^2$, $f_1$ is representable as a linear combination of $f_if_j$. In particular, $f_1$ is contained in the ideal generated by $f_2,\ldots,f_n$, and $f_1^2$. We can thus replace each $f_i$ by $f_i^2$. Repeating this, we get $\mm=0$ as each $f_i$ is nilpotent.
        
          By (probably) Serre, $X$ is reduced iff $X$ is $R_0$ and $\Oo_X(U)\morphism \Oo_X(V)$ are injective when $V$ is dense in $U$ (i.e., if $X$ is $S_1$, a yet-to-define, though never defined criterion). By the \emph{normality criterion} of Serre, $X$ is normal iff $X$ is $R_1$ and $\Oo_X(U)\morphism \Oo_X(V)$ are injective when $V$ is dense in $U$ and $\Oo_X(U)\morphism \Oo_X(V)$ is an isomorphism if all irreducible components of $U\setminus V$ are of codimension greater than $1$ (i.e., if $X$ is $S_2$). The $S_k$ are related  to \emph{Cohen-Macaulay}ness (which actually is $S_\infty$).
    \end{alphanumerate}
\end{rem}
The following lemma wasn't covered in the lecture, but is perhaps worthwhile to know.
\begin{lem}\lbl{lem:noetherianConnectedComponentsOpen}
	When $X$ is a noetherian prescheme (e.g., $X=\Spec R$ with $R$ a noetherian ring), then $X$ has finitely many irreducible components. In particular, every connected component of $X$ is open.
\end{lem}
\begin{proof}
	Since $X$ is a noetherian topological space by assumption, we may express it as a finite union of irreducible components, as proved in \cite[Proposition~2.1.1]{alg1}. Irreducible sets being connected, we conclude that every connected component must contain an irreducible component, hence there are finitely many connected components. Therefore, every connected component of $X$ is open.
\end{proof}

\section{Affine and finite morphisms}

\begin{defi}[Affine morphism] \lbl{def:affineMorphism}
    A morphism $X\morphism[f] Y$ of preschemes is called \defemph{affine} if it satisfies the following equivalent conditions:
    \begin{alphanumerate}
    \item 
        $U\subseteq Y$ is open affine, then $f^{-1}(U)$ is an affine open subset of $X$.
    \item 
        It is possible to cover $Y$ by affine open $U$ such that $f^{-1}(U)$ is an affine open subset of $X$.
    \end{alphanumerate}
\end{defi}
We will prove the equivalence of \itememph{a} and \itememph{b} once we have the $\SPEC_Y$ functor available (cf.\ Lemma~\reff{lem:affineMorphismEquivalence}).
\begin{defi}[Finite and integral morphism]\lbl{def:finiteIntegralMorphism}
    A morphism $X\morphism[f] Y$ of preschemes is called \defemph{finite} (respectively \defemph{integral}) if it is affine and in addition the following equivalent conditions hold
    \begin{alphanumerate}
    \item 
        If $U\subseteq Y$ is open affine then $\Oo_X(f^{-1}(U))$ is finite (respectively integral) over $\Oo_Y(U)$.
    \item 
        $Y$ may be covered by affine open subsets $U$ for which this is the case. 
    \end{alphanumerate}
\end{defi}
\begin{proof}[Proof of equivalence]
	The implication \itememph{a} $\Rightarrow$ \itememph{b} being trivial, we need to prove \itememph{b} $\Rightarrow$ \itememph{a}. We apply Lemma~\reff{lem:propsOfAffine} to the property $\Pp$, where
	\begin{quote}
		$\Pp(U)\colon\Oo_X(f^{-1}(U))$ is finite/integral over $\Oo_Y(U)$.
	\end{quote}
	Indeed, we have that $\Oo_Y(U\setminus V(\lambda))\cong \Oo_Y(U)_\lambda$ and $\Oo_X(f^{-1}(U\setminus V(\lambda))) \cong \Oo_X(f^{-1}(U))_{f^*\lambda}$. For the second isomorphism, note that by Proposition~\reff{prop:coherentDef}\itememph{a}, for any morphism $f$ with Property \itememph{b} of Definition~\reff{def:affineMorphism}, $f_*\Oo_X$ is a quasi-coherent $\Oo_Y$-module and this isomorphism follows from Proposition~\reff{prop:coherentDef}\itememph{e}. Hence finiteness and integrality of the ring extension is preserved in these situations, i.e., the property from Lemma~\reff{lem:propsOfAffine}\itememph{\alpha} holds. 
	
	Moreover, $\Pp$ can be tested on such covers as from Lemma~\reff{lem:propsOfAffine}\itememph{\beta}. That is, an $R$-module $M$ is finitely generated iff $\Spec R$ can be covered $\Spec R = \bigcup_{i=1}^n \Spec R_{\lambda_i}$ such that $M_{\lambda_i}$ is finitely generated. 
	
	To see this, for each $i$ choose a finite set $m_{i,1},\ldots,m_{i,n_i}$ of $R_{\lambda_i}$-generators of $M_{\lambda_i}$. We may take the $m_{i,j}$ from the image of $M$ in $M_{\lambda_i}$. Let $M'\subseteq M$ be the module generated by preimages of all these generators $m_{i,j}$ (still finitely many). Then, by construction, the inclusion $M'\monomorphism M$ becomes bijective when localized at any prime ideal, hence must be bijective as well.
\end{proof}
\subsection{The relative \texorpdfstring{$\SPEC$}{Spec} functor}


There is a sheaf version of $\Spec$ as follows:
Let $\Aa$ be any quasi-coherent $\Oo_X$-algebra, then we construct a scheme $\SPEC_X(\Aa)$ with the following properties.
\begin{itemize}
	\item \emph{Underlying set.} As a set,
	\begin{align*}
		\SPEC_X(\Aa) = \left\{(x,\pp) \st 
		\begin{array}{c}
			x\in X\text{, }\pp \in \Spec(\Aa_x) \text{ such that the preimage of }\pp\\
			\text{under } \Oo_{X,x}\morphism \Aa_x \text{ is } \mm_{X,x}\text{ (the maximal ideal of }\Aa_x)
		\end{array}
		\right\}
	\end{align*}
	\item \emph{Topology base.} Let
	\begin{align*}
		\Omega(U,\lambda) = \left\{ (x,\pp) \st x\in U\text{ and }\pp\not\ni (\text{image of } \lambda \text{ under } \Aa(U)\to \Aa_x)\right\}
	\end{align*}
	where $U\subseteq X$ is open and $\lambda \in \Aa(U)$. As $\Omega(U,\lambda) \cap \Omega(V,\vartheta) = \Omega(U\cap V, \lambda|_{U\cap V} \cdot \vartheta|_{U\cap V})$ this is indeed a base for some topology.
	\item \emph{Pretender stalk.} There is only one reasonable choice and this is $\Oo_{Y,[x,\pp]} \coloneqq (\Aa_x)_\pp$. Here, $Y=\SPEC_X(\Aa)$ for brevity.
	\item \emph{Structure sheaf.} For $\Omega\subseteq Y$ open, let
	\begin{align*}
	\Oo_Y(\Omega) = \left\{\alpha=(\alpha_{x,\pp})\in \prod_{(x,\pp)\in \Omega} \Oo_{Y,[x,\pp]}\st 
	\begin{array}{c}
		\alpha\text{ fulfills the }\\
		\text{\emph{coherence condition}}
	\end{array}
	\right\}\;.
	\end{align*}
	Here, the \emph{coherence condition} says that every $\omega\in \Omega$ has a neighbourhood $\Omega(U,\lambda)$ together with an $a\in \Aa(U)_\lambda$ such that whenever $(x,\pp)\in \Omega\cap \Omega(U,\lambda)$, we have
	\begin{align*}
		\alpha_{x,\pp}=\left(
		\begin{array}{c}
			\text{image of }a\text{ under }\\
			\Aa(U)_\lambda \morphism (\Aa_x)_\lambda \morphism (\Aa_x)_\pp = \Oo_{Y,[x,\pp]}
		\end{array}\right)\;.
	\end{align*}
\end{itemize}
As was done in section~\reff{sec:locRingedSpaces} for equalizers and fibre products, one checks that the pretender stalks are canonically isomorphic to the actual stalks. Hence $Y$ is a locally ringed space. It is also easy to check that $Y\morphism[p] X$, $p(x,\pp)=x$ is continuous (the preimage of $U\subseteq X$ open is $\Omega(U, 1)$) and one has a morphism $Y\morphism[p] X$ of locally ringed spaces, whose algebraic component $\Oo_X\morphism[p^*]p_*\Oo_Y$ for $f\in\Oo_X(U)$ is given by 
\begin{align*}
	p^* f=\left(
	\begin{array}{c}
		\text{image of }f\text{ under}\\
		\Oo_X(U) \morphism \Oo_{X,x} \morphism \Aa_x \morphism (\Aa_x)_\pp 
	\end{array}\right)_{(x,\pp)\in p^{-1}(U)}
\end{align*}
One then notes that $p^{-1} (U)\cong \SPEC_X(\Aa|_U)$. This reduces the question of $\SPEC_X(\Aa)$ being a prescheme to the case where $X=\Spec R$ is affine. In this case, one has $\Aa= \snake A$ where $A$ is an $R$-algebra, and it is natural to assume 
\begin{align*}
    \SPEC(\Aa)&\isomorphism \Spec A\\
    (\text{preimage of }\qq\text{ in }R, \qq \cdot A_x) &\longmapsfrom \qq\\
    (x,\pp)  &\longmapsto (\text{preimage of }\pp\text{ under } A\to A_x \cong \Aa_x)\;.
\end{align*}
Indeed, one has $(\Oo_{\SPEC \Aa})_{(x,\pp)} = (\Aa_x)_\pp \cong (A_x)_\pp \cong A_\qq \cong (\Oo_{\Spec A})_\qq$ and the identification of the coherence conditions is also easy.

\begin{prop}
    Let $S$ be a prescheme, $\Aa$ any quasi-coherent $\Oo_S$-algebra, $X\morphism[\xi] S$ any $S$-prescheme. Then one has a natural bijection
    \begin{align}\lbl{eq:SPECAdjunction}
        \Hom_{\cat{PSch}/S} \big(X, \SPEC_S(\Aa)\big) \cong \Hom_{\cat{Alg}(\Oo_S)} (\Aa, \xi_* \Oo_X)
    \end{align}
    sending $X\morphism[f] \Spec \Aa$ to $\Aa \cong p_* \Oo_{\Spec \Aa} \xrightarrow{p_*(f^*)} p_*f_* \Oo_X = \xi_* \Oo_X$. Here, $p$ denotes the morphism $\SPEC_S \Aa \morphism[p] S$.
\end{prop}
\begin{proof}
    First note that indeed $p_*f_*=\xi_*$ as $f$ is a morphism of $S$-preschemes. As, for open subsets $U\subseteq S$, the assignments
    \begin{align*}
        U&\longmapsto \Hom_{\cat{PSch}/U} \left(\xi^{-1}(U), p^{-1}(U)\right) = \Hom_{\cat{PSch}/S}\left(\xi^{-1}(U), p^{-1}(U)\right)\\
        U&\longmapsto \Hom_{\cat{Alg}(\Oo_U)} \Big(\Aa|_U, (\xi_*\Oo_X)|_U\Big) = \Hom_{\cat{Alg}(\Oo_U)}\left(\Aa|_U, (\xi|_{\xi^{-1}(U)})_* \Oo_{\xi^{-1}(U)}\right)
    \end{align*}
    are easily seen to be sheaves of sets on $S$, it is sufficient to check the adjunction \eqreff{eq:SPECAdjunction} on the affine open subsets of $S$ where it follows from the similar adjunction from Proposition~\reff{prop:affineSchemeAdjunction}.
\end{proof}

\begin{lem}\lbl{lem:affineMorphismEquivalence}
    The conditions \itememph{a} and \itememph{b} from Definition~\reff{def:affineMorphism} are equivalent. Moreover, they are equivalent to the following
    \begin{alphanumerate}
    	\item[\itememph{c}] The morphism $X\morphism[f]Y$ is quasi-compact and quasi-separated. The sheaf $f_*\Oo_X$ is a quasi-coherent $\Oo_Y$-module and the canonical morphism
    	\begin{align}\lbl{eq:isomAffine}
    	X\morphism \SPEC_Y(f_*\Oo_X)\tag{$*$}
    	\end{align}
    	corresponding to $\id_{f_*\Oo_X}$ under the adjunction \eqreff{eq:SPECAdjunction} is an isomorphism.
    \end{alphanumerate}
\end{lem}
\begin{proof}
    The implication \itememph{a} $\Rightarrow$ \itememph{b} is trivial. Assume \itememph{b}. Note that \itememph{b} precisely guarantees that $f_*\Oo_X$ is a quasi-coherent $\Oo_Y$-module. Over the affine open $U\subseteq Y$ such that $V= f^{-1}(U)$ is affine, we have
     \begin{diagram*}
     	\node[ob](x) at (0,1.5) {$\SPEC_Y\big((f_*\Oo_X)|_U\big)$};
     	\node[ob](s) at (1.875,0) {$V$};
     	\node[ob](y) at (3.75,1.5) {$\Spec\big(\Oo_X(V)\big)$};
     	\scriptsize
     	\draw[->] (s) -- (x);
     	\draw[->] (x) -- (y) node[pos=0.5,above=-0.25ex] {$\sim$};
     	\draw[->] (s) -- (y) node[pos=0.5,above=-0.25ex,sloped] {$\sim$};
     \end{diagram*}
     
    where the rightward arrows are isomorphisms. Hence \eqreff{eq:isomAffine} is an isomorphism over open $U$ such that $f^{-1}(U)$ is affine (and $f$ is quasi-compact and quasi-separated over such $U$). If $X$ may be covered by such $U$ the conditions hold globally and we obtain \itememph{c}.
    
    To obtain \itememph{c} $\Rightarrow$ \itememph{a}, note that for any quasi-coherent $\Oo_Y$-algebra $\Aa$ and $U\subseteq Y$ affine open, its preimage $p^{-1}(U)$ under $\SPEC_Y(\Aa)\morphism[p]Y$ equals $\SPEC_U(\Aa|_U)\cong \Spec A$ if $\Aa|_U=\snake A$ for $A$ an $\Oo_Y(U)$-algebra (and such an $A$ may be found by Proposition~\reff{prop:coherentDef}\itememph{a} and Definition~\reff{def:quasicoherent}\itememph{a} as $\Aa$ is quasi-coherent). Then the argument from \itememph{b} $\Rightarrow$ \itememph{c} can be reversed.
\end{proof}
\begin{cor}\lbl{cor:AffineStableUnderBaseChange}
    The classes of affine and of finite or integral morphisms are stable under composition and base change and are base-local.
\end{cor}
\begin{proof}
	Stability under composition and base locality follow immediately from the equivalent conditions of Definition~\reff{def:affineMorphism} resp. Definition~\reff{def:finiteIntegralMorphism}. Now let $X\morphism[\xi]S$ be affine and $X\times_SY\morphism[\xi']Y$ its base change along $Y\morphism[\upsilon] S$. Let $W\subseteq S$ be affine, $U=\xi^{-1}(W)\subseteq X$ (which is affine by assumption) and $V\subseteq Y$ an affine subset contained in $\upsilon^{-1}(W)$. Then $(\xi')^{-1}(V)\subseteq(\upsilon')^{-1}(U)$ (where $X\times_SY\morphism[\upsilon']X$) and thus
	\begin{align*}
		(\xi')^{-1}(V)=(\xi')^{-1}(V)\cap (\upsilon')^{-1}(U)\cong U\times_WV
	\end{align*}
	by Corollary~\reff{cor:fibreProductsInLRS}\itememph{b}. Since $U\times_WV$ is affine by Corollary~\reff{cor:affineSchemesFibreProduct} and $Y$ can be covered by such $V$, $\xi'$ is an affine morphism by Definition~\reff{def:affineMorphism}\itememph{b} and it's clear that finiteness or integrality conditions are inherited as well.
\end{proof}
\begin{prop}\lbl{prop:finiteClosed}
    If $X\morphism[f] Y$ is finite or just integral and $A$ a closed subset of $X$, then $f(A)$ is closed in $Y$.
\end{prop}
\begin{proof}
    The question is local with respect to $Y$, hence we may assume that $Y\cong \Spec R$ is affine. The morphism being affine, $X$ is also affine, e.g., $X= \Spec S$, where $S$ is an $R$-algebra and integral over $R$. If $A=V(I)$ we have $A\cong \Spec(S/I)$. Replacing $S$ by $S/I$, we may assume that $A=X$ and have to show $f(X)$ is closed. Let $J = \ker(R\morphism S)$, then $f(X)\subseteq V(J)$ and it is sufficient to show equality. We may replace $R$ by $R/J$ and assume $R\morphism S$ to be injective. By the going-up theorem (cf.\ \cite[Theorem~7\itememph{a}]{alg1}), $\Spec S\morphism \Spec R$ is surjective in this case. 
\end{proof}

\begin{defi}[Universally closed morphism]\lbl{def:univClosed}
    A morphism $X\morphism Y$ is closed if $f(A)\subseteq Y$ is closed whenever $A$ is closed in $X$. It is \defemph{universally closed} if all its base changes $\snake X = X\times_Y \snake Y \morphism \snake Y$ are closed.
\end{defi}
\begin{rem}
    \begin{alphanumerate}
    \item \lbl{rem:universallyClosed}
        The class of closed morphisms is base-local and closed under composition.
    \item  
        The class of universally closed morphisms is base-local and closed under composition and base change.
    \item 
        Any finite or integral morphism is universally closed. Indeed, a finite (resp.\ integral) morphism is closed by Proposition~\reff{prop:finiteClosed}, and by Corollary~\reff{cor:AffineStableUnderBaseChange} all its base changes are finite (resp.\ integral) again.
    \end{alphanumerate}
\end{rem}
\begin{example}
	If $k$ is a field, $\Spec k[X]\morphism\Spec k$ has no choice but to be closed as $\Spec k$ consists of a single point. Its base change $\Spec k[X,Y]\morphism\Spec k[Y]$, however, isn't. Consider for example $A=V(1-XY)$, then $f(A)=\Spec k[Y]\setminus V(Y)$ is open but not closed.
\end{example}
\section{Proper and projective morphisms}
\begin{defi}[Proper morphism]\lbl{def:properMorphism}
    A morphism $X\morphism[f] Y$ of preschemes is called \defemph{proper} if it is of finite type, separated and universally closed.
\end{defi}
\begin{rem}
    \begin{alphanumerate}
    \item 
        Being of (globally) finite type any such morphism is quasi-compact.
    \item 
        The class of proper morphisms is base-local and closed under composition and base change.
    \end{alphanumerate}
\end{rem}
\begin{example}
    Every finite morphism is proper. Indeed, it is clearly of finite type and universally closed, as was noted in Remark~\reff{rem:universallyClosed}\itememph{c}. Separatedness follows from the following fact.
\end{example}
\begin{fact}[wasn't covered in the lecture]
	Any affine morphism $X\morphism[f]Y$ is separated.
\end{fact}
\begin{proof}
	By Fact~\reff{fact:separationStuff}\itememph{e}, it suffices to check that the diagonal $\Delta\colon X\xrightarrow{(\id_X,\id_X)}X\times_YX$ is a closed immersion. It is enough to show that $X\times_YX$ can be covered by open subsets $\Omega$ for which $\Omega\cap\Delta(X)$ is closed in $\Omega$ (cf.\ Remark~\reff{rem:localClosedness}\itememph{a}). Take $W\subseteq Y$ affine open, then $U=f^{-1}(W)\subseteq X$ is affine open as well and $\Delta(X)\cap U\times_WU=\Delta(U)$ (we can view $U\times_WU$ as a subset of $X\times_YX$ by Corollary~\reff{cor:fibreProductsInLRS}\itememph{b}). Then $\Delta|_U\colon U\morphism U\times_WU$ is a closed immersion as $U$ and $U\times_WU$ are affine, thus schemes and hence $U\morphism W$ is separated as is any morphism between schemes by Fact~\reff{fact:schemeStuff}\itememph{d}. 
	Since the $U\times_WU$ cover $X\times_YX$, we are done as explained above.
\end{proof}
Note that the crucial point here is to be allowed to choose $U=f^{-1}(W)$, which only works because $f$ is affine. Otherwise, in order to cover $X\times_YX$, we would have been forced to consider $U\times_WV$ for some affine open $U,V\subseteq f^{-1}(W)$ and for $U\neq V$ the above argument collapses.
\begin{defi}\lbl{def:Proj}
    Let $R$ be an $\IN$-graded ring and 
    \begin{align*}
        \Proj R = \left\{\pp\in\Spec R \st \pp \text{ is homogeneous and } \pp\not \supseteq R_+\right\}\;.
    \end{align*}
    The closed sets of $\Proj R$ are precisely the sets $V(I)=\left\{\pp\in\Proj R\st \pp\supseteq I\right\}$ for homogeneous ideals $I\subseteq R$. The structure sheaf of $P=\Proj (R)$ has stalks $\Oo_{P,\pp} \cong (R_\pp)_0$ and $\Oo_P(U)$ is the set of all $(\phi_\pp)_{\pp\in U}\in \prod_{\pp\in U} \Oo_{P,\pp}$ satisfying the following coherence condition. 
    \begin{quote}
    	Every $\pp\in U$ has a neighbourhood $P\setminus V(\lambda)$ (for some homogeneous $\lambda$) and some $f\in (R_\lambda)_0$, such that $\phi_\qq$ equals the image of $f$ under $(R_\lambda)_0 \morphism (R_\qq)_0$ for all $\qq\in U\cap P\setminus V(\lambda)$. 
    \end{quote}
\end{defi}
    One shows that $P\setminus V(\lambda) \cong \Spec(R_\lambda)_0$ when $\lambda$ has positive degree. One can use this to derive $P\times_{\Spec R_0} \Spec S \cong \Proj(R\otimes_{R_0} S)$. Note that $\Proj$ is only functorial with respect to $R\morphism S$ such that $S_+$ is generated by the image of $R_+$ as an ideal.
    
    For more about $\Proj$, see exercise sheet \#11.
\begin{example}
    Let $R_0$ be any ring, $A$ an $R_0$-algebra and $R_k = A$ for $k>0$. Equip $R=\bigoplus_{k\geq 0}R_k$ with the obvious ring operations. That is, for $a\in R_i$ and $b\in R_j$ their product is $ab$ viewed as an element of $R_{i+j}$. Then $P\setminus V(\lambda) \cong \Spec(R_\lambda)_0$ may be applied where $\lambda = 1\in A$ viewed in degree $1$ (i.e., multiplication by $\lambda$ is a ``right shift''). As $V(\lambda)=\emptyset$ (since $(\lambda)=R_+$), this shows $\Proj R\cong \Spec A$ as a $\Spec R_0$-prescheme. In particular, $\Proj R\morphism \Spec R_0$ may easily fail to be closed.
\end{example}
If we assume that $R_1$ is a finitely generated $R_0$-module and $R_+$ generated by $R_1$ as an ideal (or equivalently $R$ by $R_1$ as $R_0$-algebra), then $R_k$ is also finitely generated over $R_0$ and the sequence of ideals 
\begin{align*}
    I_k = \Ann_{R_0}\bigg(\bigoplus_{\ell\geq k} R_\ell\bigg) = \Ann_{R_0} (R_k)
\end{align*}
is ascending. Let $I_\infty = \bigcup_{k=1}^\infty I_k$.

\begin{prop}
    In this situation, the image of $P=\Proj R$ in $\Spec R_0$ equals $V(I_\infty)$.
\end{prop}
\begin{proof}
    Note that for any finitely generated $R_0$-module $M$ 
    \begin{align*}
        \left\{\pp\in \Spec R_0\st M\otimes_{R_0}\KK(\pp)\neq 0\right\} &= \left\{\pp\in \Spec R_0 \st M_\pp/\pp M_\pp \neq 0\right\}\\
        &= \left\{\pp\in \Spec R_0\st M_\pp\neq 0\right\}\\
        &= V\left(\Ann_{R_0}(M)\right)
    \end{align*}
    by well-known facts from commutative Algebra (which you should be familiar with, otherwise, you may want to think about attending Algebra $\mathrm{II}$ instead -- or have a look at \cite[Lemma~3.4.1]{alg2}, where we prove this). The second to last step is done by the Nakayama lemma (cf.\ \cite[Proposition~1.2.3]{alg2}). Hence 
    \begin{align*}
        V(I_\infty) = \left\{\pp\in \Spec R_0\st R_\ell\otimes_{R_0} \KK(\pp)\neq 0 \text{ for arbitrarily large } \ell\right\}
    \end{align*}
    (one could replace \emph{arbitrarily large} by \emph{all}, as the $I_\ell$ form an ascending chain of ideals). Now $\Proj(R\otimes_{R_0} \KK(\pp)) = P\times_{\Spec R_0} \Spec\KK(\pp)$ which, as a set, is the fibre of $P\morphism \Spec R_0$ over $\pp$ (i.e., the preimage of $\pp$) by the explicit description of the fibre product with the immersive morphism $\Spec \KK(\pp) \monomorphism R_0$ (cf.\ Corollary~\reff{cor:immersionBaseChange}). 
    
    Hence, it is enough to show that for any graded algebra $A=\bigoplus_{d\geq 0}A_d$ of finite type over a field $k$ we have $\Proj A\neq 0$ if and only if $A_d \neq 0$ for arbitrarily large $d$. Suppose the latter is the case. But then there must be a homogeneous $f\in A_+$ which is not nilpotent (some positive-degree homogeneous component of some $k$-generator of $A$ will do, otherwise $A_d=0$ for large $d$, contradicting the assumption) hence $A_f \neq 0$ and $\Spec(A_f)_0 \cong \Proj A\setminus V(f)$ is not empty. Conversely, if $A_d = 0$ for large $d$ then $A_+ = \sqrt{0}$ is the nilradical of $A$ and $\Proj A = \emptyset$.
\end{proof}
\begin{cor}\lbl{cor:ProjRclosed}
    The morphism $\Proj R \morphism \Spec R_0$ is closed under the above assumption.
\end{cor}
\begin{proof}
    We have seen that its image is closed. The same holds for the image of $V(I) \cong \Proj R/I$ in $\Spec (R_0/I_0)$ for any homogeneous ideal $I\subseteq R$ and $\Spec (R_0/I_0)\monomorphism \Spec R_0$ is a closed immersion.
\end{proof}
\begin{rem}
    In fact, it is sufficient to assume $R_+$ to be finitely generated. Indeed, in this case $R$ is an $R_0$-algebra of finite type (e.g., by taking the homogeneous components of $R$-generators of the ideal $R_+$) and $R_k$ is a finitely generated $R_0$-module for all $k$, which is all we ever needed finitely generatedness for.
\end{rem}
\begin{rem}\lbl{rem:universallyClosedAffineSuffices}
    Closedness of a morphism $X\morphism[f] Y$ being base-local, universal closedness already follows when all base changes of $f$ by $\Spec A \morphism Y$ are closed.
\end{rem}
\begin{cor}
    If $R$ is a finitely generated $R_0$-algebra (or, more specifically $R_1$ a finitely generated $R_0$ module generating the ideal $R_+$) then $\Proj R\morphism \Spec R_0$ is a proper morphism.
\end{cor}
\begin{proof}
	Let $P=\Proj R$. By Proposition~\reff{prop:locFiniteMorph}\itememph{b}, to show that $P\morphism\Spec R_0$ is of finite type it suffices that $(R_\lambda)_0\cong \Oo_P(P\setminus V(\lambda))$ is of finite type over $R_0$ for homogeneous $\lambda\in R_+$. Let $d>0$ be the homogeneous degree of $\lambda$ and  $\alpha_1,\ldots,\alpha_n$ be homogeneous elements of degrees $d_1,\ldots,d_n>0$ such that $R=R_0[\alpha_1,\ldots,\alpha_n]$ (e.g., the positive-degree homogeneous components of $R_0$-generators of $R$). Then one may check that $(R_\lambda)_0$ is generated as an $R_0$-algebra by those
	\begin{align*}
		\alpha_1^{k_1}\cdots \alpha_n^{k_n}\cdot\lambda^{-k}\quad\text{where }0\leq k_i<d\text{ and }0\leq k<d\cdot(d_1+\ldots+d_n)
	\end{align*}
	which have homogeneous degree $0$.
	
	As pointed out in Remark~\reff{rem:universallyClosedAffineSuffices}, for universal closedness we only have to consider base changes by $\Spec S\morphism\Spec R_0$. But then $\Proj(R\otimes_{R_0}S)=P\times_{\Spec R_0}\Spec S\morphism\Spec S=\Spec (R\otimes_{R_0}S)_0$ is closed by Corollary~\reff{cor:ProjRclosed}.
	
	Separatedness is immediate once we realize that $P$ is a scheme. Indeed, for $\pp,\qq\in P$ choose homogeneous elements $\lambda,\mu$ of degrees $d,e>0$ such that $\lambda\notin\pp$ and $\mu\notin\qq$ (which is possible as $\pp,\qq\not\supseteq R_+$). Then one of the positive-degree homogeneous elements $\lambda$, $\mu$, or $\lambda^e+\mu^d$ is not contained in both $\pp$ and $\qq$. If $\gamma$ has this property, $P\setminus V(\gamma)\cong \Spec (R_\gamma)_0$ is a common affine open neighbourhood of $\pp$ and $\qq$ and we're done by Fact~\reff{fact:schemeStuff}\itememph{a}.
\end{proof}
\begin{defi}\lbl{def:projectiveScheme}
	We put
    \begin{align*}
        \IP^n_R = \Proj R[X_1,\ldots, X_n]\cong \Proj \IZ[X_1,\ldots,X_n]\times_{\Spec \IZ}\Spec R\;.
    \end{align*}
\end{defi}
\begin{rem}
    There seems to be no universally adopted notion of ``projective morphism''. Grothendieck has a sheaf-$\mathbf{Proj}$ (obtained from $\Proj$ like $\SPEC$ from $\Spec$ -- more about this in \cite[Section~2.3]{alggeo2}) and defines an $S$-prescheme $X$ (or the morphism $X\morphism[\xi] S$) to be projective iff $X= \mathbf{Proj}_S(\Rr)$ where $\Rr$ is a quasi-coherent $\IN$-graded $\Oo_S$-algebra such that $\Rr_1(U)$ is a finitely generated $\Oo_S(U)$-module when $U$ is affine, and generated by $\Rr_+(U)$ in that case.
    
    This class is not base-local. One could require this locally or require that locally $\xi^{-1}(U) \subseteq \IP^n_U$ ($U$ affine, $n$ depending on $U$).
\end{rem}
Well, we don't know (yet -- cf.\ \cite[Definition~2.3.1]{alggeo2}) what a projective morphism is, but let's state Chow's lemma anyway.
\begin{prop}[Chow's lemma]
    Let $X\morphism[f] Y=\Spec R$ be a proper morphism and $X$ integral (irreducible and reduced). Then there is a projective morphism $\snake X\morphism[\pi] X$ such that $\snake X\morphism Y$ is projective and such that there is a dense open subset $U$ of $X$ for which $\pi^{-1}(U) \morphism[\pi] U$ is an isomorphism.
\end{prop}
\begin{proof}[Sketch of a proof] 
	A detailed version of the following sketch proof may be found in \cite[Section~A.3]{alggeo2}.
	
    Let $U_i\subseteq X$ be affine open subsets covering $X$, $U_i\cong \Spec A_i$ where $A_i\cong R[X_1,\ldots, X_{n_i}]/J_i$ giving a closed embedding $U_i\morphism \IA^{n_i}_R$. Let $U = \bigcap_i U_i$; we have embeddings 
    \begin{align*}
        U\monomorphism X\times_Y \fprod{Y}_i \IA^{n_i}_R\monomorphism X\times_Y\fprod{Y}_i \IP^{n_i}_R\;.
    \end{align*}
    Let $\snake X$ be the closure of the image of $U$ under that embedding (equipped with its reduced subprescheme structure), then $\snake X\morphism X$ has the desired properties (e.g., is an isomorphism over $U$) and $\snake X\morphism \prod_{Y}\IP^{n_i}_R$ (obtained by projection to the second factor) is a closed embedding, which shows projectiveness of $\snake{X}\morphism Y$.
\end{proof}































    
    
     
    
    
    
    \appendix
    \chapter{Appendix -- category theory corner}
\section{Fundamental concepts}
\begin{defi}[Category]
	A \defemph{category} ${\cat A}$ is a class $\Ob({\cat A})$ of \emph{objects} of ${\cat A}$ together with:
	\begin{alphanumerate}
	    \item 
	        For two arbitrary $X,Y\in \Ob({\cat A})$, a set $\Hom_{\cat A}(X,Y)$ of \emph{morphisms} from $X$ to $Y$ in ${\cat A}$.
	    \item 
	        For $X,Y,Z\in\Ob({\cat A})$, a map 
	        \begin{align*}
	            \Hom_{\cat A}(X,Y)\times \Hom_{\cat A}(Y,Z) &\longto \Hom_{\cat A}(X,Z)\\
	            (f,g) &\longmapsto g\circ f
	        \end{align*}
	        called the \emph{composition of morphisms} in ${\cat A}$.
	\end{alphanumerate}
	The following assumptions must be satisfied:
	\begin{rmnumerate}
	    \item
	        If $A\morphism[f] B \morphism[g] C\morphism[h] D$ are morphisms in ${\cat A}$, then $h\circ(g\circ f) = (h\circ g)\circ f$.
	    \item
	        For any $A\in\Ob({\cat A})$ there is a unique morphism $A\morphism[\id_A] A$ in $\Hom_{\cat A}(A,A)$ such that $\id_A \circ f = f$ and $g\circ \id_A = g$ for any $f\in \Hom_{\cat A}(B,A)$ and any $g\in \Hom_{\cat A}(A,C)$ for arbitrary $B,C\in \Ob({\cat A})$.
	\end{rmnumerate}
\end{defi}
\begin{example}
    \begin{alphanumerate}
        \item 
            The category $\cat{Set}$ of sets where $\Ob({\cat A})$ is the class of sets, $\Hom_{\cat A}(X,Y)$ is the set of maps from $X$ to $Y$ and the composition of morphism is the composition of maps.
        \item 
            The category $\cat{Grp}$ of groups where $\Ob({\cat A})$ is the class of groups, $\Hom_{\cat A}(X,Y)$ is the set of group morphisms from $X$ to $Y$ and the composition of morphisms is the composition of maps.
        \item 
            The categories of rings $\cat{Ring}$, commutative rings $\cat{Ab}$ and abelian groups $\cat{Ab}$ are all defined similarly.
        \item 
            The topological spaces with the continuous maps $\cat{Top}$.
        \item 
            The Banach spaces with bounded (continuous) maps.
        \item 
            The $k$-vector spaces with $k$-linear maps $\cat{Vect}(k)$ or $R$-modules with $R$-linear maps $\cat{Mod}(R)$.
    \end{alphanumerate}
\end{example}
\begin{defi}\lbl{def:subcategory}
	Let ${\cat A}$ and ${\cat B}$ be categories. We call ${\cat B}$
	\begin{alphanumerate}
		\item a \defemph{subcategory} of ${\cat A}$ if $\Ob({\cat B}) \subseteq \Ob({\cat A})$ and $\Hom_{\cat B}(X,Y) \subseteq \Hom_{\cat A}(X,Y)$ and for arbitrary objects $X,Y$ of ${\cat B}$, the identity $\id_X$ of $X$ in ${\cat A}$ is a morphism in $\Hom_{\cat B}(X,X)$.
		\item a \defemph{full subcategory} of ${\cat A}$ if additionally $\Hom_{\cat A}(X,Y) = \Hom_{\cat B}(X,Y)$ for arbitrary objects $X,Y\in\Ob({\cat B})$.
		\item an \defemph{equivalent subcategory} of ${\cat A}$ if it is a full subcategory and every object $X\in \Ob({\cat A})$ is isomorphic to some $Y\in\Ob({\cat B})$, where we call a morphism $X\morphism[f] Y$ an \defemph{isomorphism} iff there  is a (unique) $Y\morphism[g] X$ such that $f\circ g = \id_Y$ and $g\circ f= \id_X$.
	\end{alphanumerate}
\end{defi}
  A further example is the category of prevarieties (with morphisms according to Definition \reff{def:preVarieties}) and its full subcategory of varieties, containing all varieties as objects.
\begin{defi}
	A category is called \defemph{small} if its class of objects is a set.
\end{defi}
\section{Functors, functor morphisms, and the Yoneda lemma}
  \begin{defi}
  	A (covariant) \defemph{functor} ${\cat A}\morphism[F]{\cat B}$ consists of the following data:
  	\begin{itemize}
  		\item a map $F\colon \Ob({\cat A})\to\Ob({\cat B})$,
  		\item for $X,Y\in\Ob({\cat A})$ a map $F\colon\Hom_{\cat A}(X,Y)\to\Hom_{\cat B}(FX,FY)$ such that $F(\id_X)=\id_{FX}$ whenever $X\in\Ob({\cat A})$ and $F(\psi\phi)=F(\psi)F(\phi)$ when $X\morphism[\phi]Y\morphism[\psi]Z$ are morphisms in ${\cat A}$.
  	\end{itemize}
  	A functor is called \defemph{faithful} if $F:\Hom_{\cat A}(X,Y)\to\Hom_{\cat B}(FX,FY)$ is injective and \defemph{fully faithful} if it's bijective.
  \end{defi}
    
  %Professor Franke would like to draw a line here. We hope, this one will do: \tikz\draw(0,0) -- (2.6,0);.
  
  \begin{example*}
  	We have \emph{forgetful} functors like $\cat{Vect}(k)\to\cat{Ab}$ or $\cat{Ab}\to\cat{Set}$. These functors are faithful (at least for the two examples).
  \end{example*}
  

  \begin{rem*}
  	\begin{alphanumerate}
  		\item 
  		If ${\cat A}\morphism[F] \cat{Set}$ is a faithful functor, and $f$ a morphism such that $Ff$ is injective (respectively surjective) then $f$ is a monomorphism (respectively epimorphism). 
  		\item
  		In the categories of sets or $R$-modules, $f$ is a monomorphism (epimorphism) iff $f$ is injective (surjective).
  		\item
  		In the category of Banach spaces and bounded linear maps, $f$ is a epimorphism iff its image is dense.
  		\item
  		The map from a domain to its field of quotients is an epimorphism in the category of rings.
  	\end{alphanumerate}
  \end{rem*}
  \begin{defi}[Canonical morphism]\lbl{def:canonicalMorphism}
  	Let ${\cat A}\doublemorphism[F][\smash{G}] {\cat B}$ be functors. A \defemph{functor morphism} or \defemph{canonical morphism} from $F$ to $G$ is a collection of morphisms $\smash{F(A) \morphism[\phi_A]G(A)}$, for all $A\in \Ob {\cat A}$ such that the diagram
  	\begin{diagram*}
  		\node[ob](FA) at (0,1.5) {$F(A)$};
  		\node[ob](FB) at (0,0) {$F(B)$};
  		\node[ob](GA) at (2.5,1.5) {$G(A)$};
  		\node[ob](GB) at (2.5,0) {$G(B)$};
  		\scriptsize
  		\draw[->] (FA) -- (FB) node[pos=0.5, left] {$F(\alpha)$};
  		\draw[->] (FA) -- (GA) node[pos=0.5, above] {$\phi_A$};
  		\draw[->] (GA) -- (GB) node[pos=0.5, right] {$G(\alpha)$};
  		\draw[->] (FB) -- (GB) node[pos=0.5, above] {$\phi_B$};
  	\end{diagram*}
  	commutes for arbitrary morphisms $A\morphism[\alpha] B$ in ${\cat A}$. The functors ${\cat A}\morphism[F]{\cat B}$ as objects with canonical morphisms as morphisms thus form a category, the \emph{functor category} $\Funct({\cat A},{\cat B})$. Also cf.\ \cite[page~26]{alg1}.
  \end{defi}
  \begin{defi}[Adjoint functors]\lbl{def:adjointFunctors}
  	Let ${\cat A}$ and ${\cat B}$ be categories. An \defemph{adjoint pair of functors} 
  	\begin{align*}
  	{\cat A}\doublelrmorphism[L][R]{\cat B}
  	\end{align*}
  	is a pair of functors of the specified type together with an isomorphism 
  	\begin{align*}
  	\Hom_{\cat B}(LX, Y) \isomorphism \Hom_{\cat A}(X, RY)
  	\end{align*}
  	which in functorial in $X$ and $Y$. We may say that $L$ is left-adjoined to $R$ and that  $R$ is right adjoined to $L$. By Yoneda-style arguments, $RY$ is uniquely determined (up to unique morphism) by $L$ (and $Y$) if it exists, and $LX$ is uniquely determined by $R$ (and $X$) if it exists.
  \end{defi}
  \begin{defi}\lbl{def:contravariantFunctor}
  	\begin{alphanumerate}
  		\item If ${\cat A}$ is a category, its \defemph{opposite} or \defemph{dual category} ${\cat A}^\op$ is defined by  $\Ob({\cat A}^\op) = \Ob({\cat A})$ and $\Hom_{{\cat A}^\op}(X,Y) = \Hom_{\cat A}(Y,X)$.
  		\item A \defemph{contravariant functor} ${\cat A}\morphism[F]{\cat B}$ is a functor ${\cat A}^\op\morphism {\cat B}$. In other words, it consists of maps $\Ob({\cat A})\morphism[F]\Ob({\cat B})$ and $\Hom_{\cat A}(X,Y) \morphism[F] \Hom_{\cat B}(FY, FX)$ such that $F(\id_X) = \id_{F(X)}$ and $F(\beta\alpha)  = F(\alpha)F(\beta)$ where $X\morphism[\alpha]Y\morphism[\beta] Z$ are composable morphisms in ${\cat A}$.
  	\end{alphanumerate}
  \end{defi}
  \begin{rem*}
  	\begin{alphanumerate}
  		\item 
  		Equivalently, a contravariant functor ${\cat A}\morphism {\cat B}$ is a covariant functor ${\cat A}\morphism {\cat B}^\op$.
  		\item
  		The map $V\morphism V^\ast$ (to the dual vector space) on the category of vector spaces over some fixed field $k$ is an example.
  	\end{alphanumerate}
  \end{rem*}
  \begin{lem}[Yoneda lemma for covariant functors]\lbl{lem:yoneda}
  	For any $M\in\Ob {\cat A}$, the map $\Cov_M(X) = \Hom_{\cat A}(M,X)$ defines a covariant functor $\Cov_M=\Hom_{\cat A}(M,-)\colon {\cat A}\morphism \cat{Set}$ and 
  	\begin{align*}
  	\Hom_{\cat A}(M,N) \morphism[\Yy] \Hom_{\Funct({\cat A},\cat{Set})} (\Cov_N, \Cov_M),
  	\end{align*}
  	is bijective. The image $\Yy(M\morphism[\mu]N)$ of $\mu\in\Hom_{\cat A}(M,N)$ under the Yoneda map $\Yy$ maps $N\morphism[\xi]X$ to $M\morphism[\mu]N\morphism[\xi]X$.
  \end{lem}
  \begin{lem}[Yoneda lemma, contravariant case] \lbl{lem:contraYoneda}
  	For any $M\in\Ob {\cat A}$, $\Con_M(X) = \Hom_{\cat A}(X,M)$ defines a contravariant functor $\Con_M=\Hom_{\cat A}(-,M)\colon {\cat A}\morphism \cat{Set}$ and 
  	\begin{align*}
  	\Hom_{\cat A}(M,N) \morphism[\Yy] \Hom_{\Funct({\cat A}^\op,\cat{Set})}(\Con_M,\Con_N)
  	\end{align*}
  	is bijective. The image $\Yy(M\morphism[\mu]N)$ of $\mu\in\Hom_{\cat A}(M,N)$ under the Yoneda map $\Yy$ maps $X\morphism[\xi]M\in\Con_M(X)$ to $X\morphism[\xi]M\morphism[\mu]N\in\Con_N(X)$.
  \end{lem}
  \begin{defi}
  	\begin{alphanumerate}
  		\item We say that a functor ${\cat A}\morphism[F] \cat{Set}$ is \defemph{representable} if there is a functor-isomorphism $F\cong \Cov_M$, i.e., $F(X) \cong \Hom_{\cat A}(M,X)$ for all $X\in\Ob{\cat A}$. In this case, we say that $M$ \emph{represents} $F$. The Yoneda-Lemma shows that $M$ is unique up to unique isomorphism.
  		\item We say that a contravariant functor ${\cat A}\morphism[F]\cat{Set}$ is \defemph{representable} iff $F\cong \Con_M$ for some $M\in\Ob{\cat A}$ in which case we say that $M$ \emph{represents} $F$.
  	\end{alphanumerate}
  \end{defi}
  \begin{rem*}
  	\begin{alphanumerate}
  		\item  For instance, $LX$ exists in Definition~\reff{def:adjointFunctors} iff the covariant functor 
  		\begin{align*}
  		\Hom_{\cat A}(X,R(-))\colon{\cat B}&\morphism\cat{Set}\\
  		Y &\longmapsto \Hom_{\cat A}(X, RY)
  		\end{align*}
  		is representable.
  		\item
  		In the above Definition~\reff{def:adjointFunctors}, $RY$ exists iff 
  		\begin{align*}
  		\Hom_{\cat B}(L(-), Y)\colon{\cat A}^\op&\morphism\cat{Set}\\
  		X&\longmapsto \Hom_{\cat B}(LX,Y)
  		\end{align*}
  		is representable.
  		\item 
  		Many important constructions in algebraic topology (classifying spaces) and algebraic geometry (Moduli spaces, Picard/Hilbert schemes) amount to representing certain functors.
  	\end{alphanumerate}
  \end{rem*}
  \begin{lem}[Yoneda Lemma, $3\ordinalrd$ try or something]\lbl{lem:functorYoneda}
  	Let $\Hom_{\Funct({\cat A},{\cat B})}(F,G)$ denote the ``class'' of functor-morphisms between covariant functors ${\cat A}\doublemorphism[F][G] {\cat B}$.
  	\begin{alphanumerate}
  		\item The Yoneda map
  		\begin{align*}
  		\Yy\colon\Hom_{\Funct({\cat A},\cat{Set})}(\Cov_M, F) &\longto F(M)\\
  		\alpha &\longmapsto \alpha_M(\id_M)\\
  		F(-)(\mu) = \alpha &\longmapsfrom \mu
  		\end{align*}
  		is bijective. Herein, $\alpha=F(-)(\mu)$ should be read as follows: A morphism ${(M\morphism[\xi]X)}\in \Cov_M(X)$ induces a morphism $F(M)\morphism[F(\xi)]F(X)$. Evaluating at $\mu\in F(M)$, we get an element $F(\xi)(\mu)\in F(X)$. Now, $\Cov_M\morphism[\alpha]F$ is given by 
  		\begin{align*}
  		\alpha_X\colon\Cov_M(X)&\morphism F(X)\\
  		\xi&\longmapsto F(\xi)(\mu)\;.
  		\end{align*}
  		\item The Yoneda map
  		\begin{align*}
  		\Yy\colon\Hom_{\Funct({\cat A}^\op,\cat{Set})}(\Con_M, F) &\longto F(M)\\
  		\alpha &\longmapsto \alpha_M(\id_M)\\
  		F(-)(\mu) = \alpha &\longmapsfrom \mu
  		\end{align*}
  		is bijective. Herein, $\alpha=F(-)(\mu)$ should be read as follows: A morphism ${(X\morphism[\xi]M)}\in \Con_M(X)$ induces a morphism $F(M)\morphism[F(\xi)]F(X)$ (remember that this time $F$ is contravariant). Evaluating at $\mu\in F(M)$, we get an element $F(\xi)(\mu)\in F(X)$. Now, $\Con_M\morphism[\alpha]F$ is given by 
  		\begin{align*}
  		\alpha_X\colon\Con_M(X)&\morphism F(X)\\
  		\xi&\longmapsto F(\xi)(\mu)\;.
  		\end{align*}
  	\end{alphanumerate}
  \end{lem}
  \begin{proof}
  	We prove only \itememph{a}, \itememph{b} being the dual assertion. The well-definedness of $\mapsto$ is obvious. For $\mapsfrom$ is is necessary to show that $\alpha$ is a natural transformation. For this, let $X\morphism[\nu] Y$ be a morphism in ${\cat A}$ and $\xi\in\Cov_M(X)$, we have to show that
  	\begin{diagram*}
  		\node[ob](CovMX) at (0,1.5) {$\Cov_M(X)$};
  		\node[ob](CovMY) at (0,0) {$\Cov_M(Y)$};
  		\node[ob](FX) at (2.5,1.5) {$F(X)$};
  		\node[ob](FY) at (2.5,0) {$F(Y)$};
  		\scriptsize
  		\draw[->] (CovMX) -- (CovMY) node[pos=0.5, left] {$\Cov_M(\nu)$};
  		\draw[->] (CovMX) -- (FX) node[pos=0.5, above] {$\alpha_X$};
  		\draw[->] (FX) -- (FY) node[pos=0.5, right] {$F(\nu)$};
  		\draw[->] (CovMY) -- (FY) node[pos=0.5, above] {$\alpha_Y$};
  	\end{diagram*}
  	commutes. Let $M\morphism[\xi]X$. As $F$ is a functor and $M\morphism[\xi]X\morphism[\nu]Y$, we have $F(\nu)F(\xi)=F(\nu\xi)$. Also, $\Cov_M(\nu)(\xi)=\nu\xi\in\Cov_M(Y)$. Hence,
  	\begin{align*}
  	F(\nu)\big(\alpha_X(\xi)\big)=F(\nu)F(\xi)(\mu)=F(\nu\xi)(\mu)=F\big(\Cov_M(\nu)(\xi)\big)(\mu)=\alpha_Y\big(\Cov_M(\nu)(\xi)\big)
  	\end{align*}
  	and that's exactly what we wanted to show.
  	
  	To show that the maps are inverse to each other first look at $\mu\in F(M)$ and its image $\alpha\in\Hom_{\Funct({\cat A},\cat{Set})}(\Cov_M, F)$. Then we have $\alpha_M(\id_M) = F(\id_M)(\mu) = \id_{F(M)}(\mu)=\mu$. Conversely, let $\beta\colon \Cov_M\morphism F$ be a natural transformation and $\mu = \beta_M(\id_M)$ and let $\alpha$ be defined by $\mu$ as above. Let $M\morphism[\xi]X$. As $\beta$ is a natural transformation, the diagram
  	\begin{diagram*}
  		\node[ob](CovMM) at (0,1.5) {$\Cov_M(M)$};
  		\node[ob](CovMX) at (0,0) {$\Cov_M(X)$};
  		\node[ob](FM) at (2.5,1.5) {$F(M)$};
  		\node[ob](FX) at (2.5,0) {$F(X)$};
  		\scriptsize
  		\draw[->] (CovMM) -- (CovMX) node[pos=0.5, left] {$\Cov_M(\xi)$};
  		\draw[->] (CovMM) -- (FM) node[pos=0.5, above] {$\beta_M$};
  		\draw[->] (FM) -- (FX) node[pos=0.5, right] {$F(\xi)$};
  		\draw[->] (CovMX) -- (FX) node[pos=0.5, above] {$\beta_X$};
  	\end{diagram*}
  	commutes, i.e., $F(\xi)\beta_M=\beta_X\Cov_M(\xi)$. Hence,
  	\begin{align*}
  	\alpha_X(\xi) = F(\xi)(\mu) = F(\xi)\big(\beta_M(\id_M)\big) = \beta_X\big(\Cov_M(\xi)(\id_M)\big) = \beta_X(\xi)\;,
  	\end{align*}
  	and thus $\alpha = \beta$, as we wanted to show.
  \end{proof}
  Putting $F= \Cov_N$ respectively $F=\Con_N$ we obtain the above special cases.
  
  \section{Products and (co-)equalizers}
  Our goal is to formulate a notion of \emph{sheaf} that allows to define sheaves for arbitrary target categories. Recall that the sheaf axiom (\hyperref[sheafAxiom]{this one}) requires
  \begin{align}\lbl{eq:sheafAxiom}
  	\Gg(U)\longrightarrow\left\{(g_i)_{i\in I}\in\prod_{i\in I}\Gg(U_i)\st g_i|_{U_{i,j}}=g_j|_{U_{i,j}}\ \forall i,j\in I\right\}\tag{$*$}
  \end{align}
  to be bijective (i.e., an isomorphism) for any open cover $U=\bigcup_{i\in I}\Gg(U_i)$, where we set $U_{i,j}=U_i\cap U_j$ for convenience.
  
  \begin{defi}[Products]
  	A \defemph{product} of objects $(A_i)_{i\in I}$ of ${\cat A}$ is an object $\prod_{i\in I}A_i$ together with morphisms $\prod_{i\in I}A_i\morphism[\pi_i]A_i$ for each $i\in I$ such that the following \emph{universal property} holds:
  	\begin{quote}
  		If $T\in\Ob({\cat A})$ comes with morphisms $T\morphism[\tau_i]A_i$ for each $i\in I$, then there is a unique morphism $T\morphism[\exists!\ f]\prod_{i\in I}A_i$ such that $\tau_i=\pi_i\circ f$.
  	\end{quote}
  	In other words, $\prod_{i\in I}A_i=\limit[i\in I]{A_i}$ is the \emph{limiting cone} over the trivial diagram consisting only of the $A_i$ without any arrows.
  \end{defi}
  Note that nobody ever guaranteed that products exist in general.
  \begin{rem*}
  	\begin{alphanumerate}
  		\item Compare this to e.g., the universal property of localizations where the universal object is on the left -- here it is on the right.
  		\item In the case of sets, (abelian) groups, $R$-modules, and rings, one can take $\prod_{i\in I}A_i$ to be the set-theoretic product equipped with the respective product structure and the set-theoretic projections $\prod_{i\in I}A_i\morphism[\pi_i]A_i$, $\pi_i\big((a_j)_{j\in I}\big)=a_i$.
  		\item The above definition characterizes $\prod_{i\in I}A_i$ up to \emph{unique isomorphism}: If the $T$ above satisfies the same universal property, then $f$ is an isomorphism.
  		\item If $I=\emptyset$, the empty product is the \emph{final object}, i.e., an object $F\in\Ob({\cat A})$ such that for any $T\in\Ob({\cat A})$ there is precisely one morphism $T\to F$ in ${\cat A}$. We have the following dual notion: $I$ (now an object and no indexing set anymore) is called \emph{initial object} if $\Hom_{\cat A}(I,T)$ has precisely one element for each $T\in\Ob({\cat A})$.
  	\end{alphanumerate}
  \end{rem*}
  \begin{rem*}
  	In $\cat{Set}$, $\emptyset$ is the only initial object and the one-point sets are the final objects. For the \emph{abelian} categories $\cat{Mod}(R)$, the canonical morphisms from the (only) initial to the (only) final object is an isomorphism.
  \end{rem*}
	Let $X$ be a topological space. A \emph{presheaf} on $X$ with values in ${\cat A}$ is a map associating
	\begin{itemize}
		\item to each open subset $U\subseteq X$ an object $\Gg(U)\in\Ob({\cat A})$
		\item and to each inclusion $V\subseteq U$ a morphism $(-)|_V^U\in\Hom_{\cat A}(\Gg(U), \Gg(V))$ which equals $\id_{\Gg(U)}$ if $U=V$ and such that $(-)|_W^U=(-)|_W^V\circ(-)|_V^U$ whenever $W\subseteq V\subseteq U$ is an inclusion of open sets.
	\end{itemize}
	To formulate the sheaf axiom, it is convenient to assume that $\prod_{i\in I}\Gg(U_i)$ exists, i.e., that ${\cat A}$ has arbitrary products.
	
	Recall our convention that $U_{i,j}=U_i\cap U_j$. There are unique morphisms
	\begin{align*}
		\alpha,\beta\colon \prod_{i\in I}\Gg(U_i)\longrightarrow\prod_{(i,j)\in I\times I}\Gg(U_{i,j})
	\end{align*}
	characterized by $\pi_{ij}\circ\alpha=(-)|_{U_{i,j}}^{U_i}\circ\pi_i$ and $\pi_{ij}\circ\beta=(-)|_{U_{i,j}}^{U_j}\circ\pi_j$, where $\prod_{i\in I}\Gg(U_i)\morphism[\pi_i]\Gg(U_i)$ and $\prod_{(i,j)\in I\times I}\Gg(U_{i,j})\morphism[\pi_{ij}]\Gg(U_{i,j})$ are the morphisms defining the product structure.
	
	In the example of presheaves of sets, rings, etc. we have 
	\begin{align*}
		\alpha\big((g_i)_{i\in I}\big)=\left(g_i|_{U_{i,j}}\right)_{(i,j)\in I\times I}\quad\text{and}\quad\beta\big((g_i)_{i\in I}\big)=\left(g_j|_{U_{i,j}}\right)_{(i,j)\in I\times I}\;,
	\end{align*}
	such that \eqreff{eq:sheafAxiom} is the ``largest subobject on which $\alpha$ and $\beta$ coincide".
	\begin{defi}[Equalizer]
		Let $A\doublemorphism[\alpha][\beta]B$ be a pair of morphisms. An \defemph{equalizer} of this pair is an object $E\in\Ob({\cat A})$ together with a morphism $E\morphism[\smash{\epsilon}]A$ such that $\alpha\epsilon=\beta\epsilon$ and such that the following universal property holds:
		\begin{quote}
			If $T\morphism[\tau]A$ is any morphism in ${\cat A}$ such that $\alpha\tau=\beta\tau$, then there's a unique $T\morphism[t]E$ such that the following diagram commutes.
			\begin{diagram*}
				\node[ob](A) at (0,0) {$A$};
				\node[ob](B) at (3,0) {$B$};
				\node[ob](E) at (1.5,1.5) {$E$};
				\node[ob](T) at (1.5,3) {$T$};
				\scriptsize
				\draw[->,dashed] (T) -- (E) node[pos=0.5, right] {$\exists!\ t$};
				\draw[->, bend left] (A) to node[pos=0.5, below] {$\alpha$} (B) ;				
				\draw[->, bend right] (A) to node[pos=0.5, above] {$\beta$} (B) ;
				\draw[->] (E) -- (A) node[pos=0.5, above left] {$\epsilon$};
				\draw[->] (E) -- (B);
				\draw[->, bend right] (T) to node[pos=0.5, left] {$\tau$} (A);
				\draw[->, bend left] (T) to (B);
			\end{diagram*}
			In other words, $E$ is the \emph{limit} over the diagram $A\doublemorphism[\alpha][\beta]B$.
		\end{quote}
	\end{defi}
	\begin{rem*}
		\begin{alphanumerate}
			\item By the usual Yoneda argument one sees that the universal property characterizes $E$ up to unique isomorphism.
			\item The sheaf axiom for presheaves with values in an arbitrary category with products now translates into the condition that $\Gg(U)\to\prod_{i\in I}\Gg(U_i)$ is, for any open cover $U=\bigcup_{i\in I}U_i$, an equalizer of the above pair of morphisms $\prod_{i\in I}\Gg(U_i)\doublemorphism[\alpha][\beta]\prod_{(i,j)\in I\times I}\Gg(U_{i,j})$. 
			
			By merging the universal properties, the notion of a sheaf can be generalized to arbitrary target categories.
			\item For sets, abelian groups etc. the equalizer is 
			\begin{align*}
				\Eq\Big(A\doublemorphism[\alpha][\beta]B\Big)=\left\{a\in A\st \alpha(a)=\beta(a)\right\}\;.
			\end{align*}
			\item For the \emph{abelian} category $\cat{Mod}(R)$, 
			\begin{align*}
				\ker\Big(M\morphism[f]N\Big)=\Eq\Big(M\doublemorphism[f][0]N\Big)\quad\text{and}\quad\Eq\Big(M\doublemorphism[f][g]N\Big)=\ker\Big(M\xrightarrow{f-g}N\Big)\;.
			\end{align*}
		\end{alphanumerate}
	\end{rem*}
	\begin{defi}[Mono- and epimorphism]
		Let ${\cat A}$ be a category, $X\morphism[f] Y$ a morphism in ${\cat A}$. We say that $f$ is \defemph{monomorphism} (\defemph{epimorphism}) if for any object $T$ and any pair $T \doublemorphism[\alpha][\smash{\beta}] X$ (respectively $Y\doublemorphism[\smash{\alpha}][\beta] T$) with $f\alpha = f\beta$ (respectively $\alpha f= \beta f$) we get $\alpha =\beta$.
	\end{defi}
	\begin{defi}[Coequalizer]
        Moreover, $Y\morphism[c] C$ is a \defemph{coequalizer} in ${\cat A}$ (of $X\doublemorphism[a][\smash{b}] Y$) iff $C^\op\morphism[\smash{c^\op}] X^\op$ is an equalizer of $Y^\op\doublemorphism[\smash{a^\op}][\smash{b^\op}]X^\op$ in ${\cat A}^\op$. In other words, 
        \begin{align*}
	        \Hom_{\cat A}(C,T) &\isomorphism \left\{g\in \Hom_{\cat A}(Y,T)\st ga = gb\right\}\\
	        f &\longmapsto fc
        \end{align*}must be bijective. In even more other words $C$ is a coequalizer iff it fulfills the following universal property:
        \begin{quote}
        	 If $Y\morphism[\tau]T$ is any morphism in ${\cat A}$ such that $\tau a=\tau b$, then there's a unique $C\morphism[t]T$ such that the following diagram commutes.
        	 \begin{diagram*}
        	 	\node[ob](X) at (0,0) {$X$};
        	 	\node[ob](Y) at (3,0) {$Y$};
        	 	\node[ob](C) at (1.5,-1.5) {$C$};
        	 	\node[ob](T) at (1.5,-3) {$T$};
        	 	\scriptsize
        	 	\draw[->,dashed] (C) -- (T) node[pos=0.5, right] {$\exists!\ t$};
        	 	\draw[->, bend left] (X) to node[pos=0.5, below] {$a$} (Y) ;				
        	 	\draw[->, bend right] (X) to node[pos=0.5, above] {$b$} (Y) ;
        	 	\draw[->] (Y) -- (C) node[pos=0.5, below right] {$c$};
        	 	\draw[->] (X) -- (C);
        	 	\draw[->, bend left] (Y) to node[pos=0.5, right] {$\tau$} (T);
        	 	\draw[->, bend right] (X) to (T);
        	 \end{diagram*}
        	 In yet another other words, $C$ is the \emph{colimit} below the diagram $X\doublemorphism[a][b]Y$.
        \end{quote}
	\end{defi}
	\begin{fact}\lbl{fact:coequalizerOfRings}
        Let $A\doublemorphism[\alpha][\beta] B$ be a ring morphism. Then a coequalizer is given by $B/I$ where $I$ is the ideal generated by $\left\{\alpha(a)-\beta(a)\st a\in A\right\}$. When $A,B$ are local rings and $\alpha,\beta$ local ring morphisms, this is a local ring iff $\alpha$ and $\beta$ induce the same morphism on the residue fields, and $0$ otherwise. 
        
        Let us denote this by $\Coeq\Big(A\doublemorphism[\alpha][\beta] B\Big)$.
	\end{fact}
	\begin{proof}
        Let $C = B/I \lepimorphism[\pi] B$. Obviously, $\pi \alpha = \pi\beta$. Let $B\morphism[t] T$ be a ring homomorphism such that $t\alpha = t\beta$. Then $t(\alpha(a)-\beta(a)) = 0$ hence $\left\{\alpha(a)-\beta(a)\st a\in A\right\} \subseteq \ker(t)$ hence $I\subseteq \ker(t)$ as $\ker(t)$ is an ideal, and $t$ has a unique representation as $t=\tau\pi$ for $C\morphism[\tau] T$, by the universal property of the quotient ring.
        
        The second assertion is also easy: Denote the maximal ideals by $\mm_A$ and $\mm_B$, then $I$ is a proper ideal iff $\alpha(a)-\beta(a)\in\mm_B$ for all $a\in A$, i.e., if the induced morphisms $\KK(\mm_A)\doublemorphism[\alpha][\smash{\beta}]\KK(\mm_B)$ coincide. In this case, $B/I$ is local with maximal ideal $\mm_B/I$, and $0$ otherwise.
	\end{proof}
	

\section{Fibre products}

\begin{defi}[Fibre product]\lbl{def:fibreProduct}
    Given morphisms $X\morphism[\xi] S\lmorphism[\upsilon] Y$ in some category ${\cat A}$, a \defemph{fibre product} of $X$ with $Y$ over $S$ is an object $P\in\Ob({\cat A})$ with morphisms $X\lmorphism[p] P \morphism[q] Y$ satisfying $\xi p = \upsilon q$ and enjoying the following universal property:
    \begin{quote}
    	Whenever $T\in\Ob({\cat A})$ comes with morphisms $X\lmorphism[\tau_X]T\morphism[\tau_Y]Y$ such that $\xi\tau_X=\upsilon\tau_Y$, then there is a unique morphism $T\morphism[t]P$ such that the below diagram commutes.
    	\begin{diagram*}
    		\node[ob](P) at (0,1.5) {$P$};
    		\node[ob](X) at (0,0) {$X$};
    		\node[ob](Y) at (2,1.5) {$Y$};
    		\node[ob](S) at (2,0) {$S$};
    		\node[ob](T) at (-1.25, 2.75) {$T$};
    		\scriptsize
    		\draw[->] (P) -- (X) node[pos=0.5, left] {$p$};
    		\draw[->] (P) -- (Y) node[pos=0.5, above] {$q$};
    		\draw[->] (X) -- (S) node[pos=0.5, above] {$\xi$};
    		\draw[->] (Y) -- (S) node[pos=0.5, right] {$\upsilon$};
    		\draw[->, bend right] (T) to node[pos=0.5, below left] {$\tau_X$} (X); 
    		\draw[->, bend left] (T) to node[pos=0.5, above right] {$\tau_Y$} (Y); 
    		\draw[->, dashed] (T) -- (P) node[pos=0.5, above right] {$\exists!\ t$};
    	\end{diagram*}
    	That is, in terms of limits, $P$ is the \emph{limit} over the diagram $X\morphism[\xi]S\lmorphism[\upsilon]Y$.
    \end{quote}
    Often we will write $P = X\times_S Y$. By the typical Yoneda-style argument the fibre product is unique up to unique isomorphism.
\end{defi}
\begin{rem}
    \begin{alphanumerate}
      \item 
        In other words, $P$ must represent the functor 
        \begin{align}\lbl{eq:fibreProductAsFunctor}
            T \longmapsto \left\{(\tau_X,\tau_Y) \in \Hom_{\cat A}(T,X) \times \Hom_{\cat A}(T,Y)\st \xi\tau_X = \upsilon \tau_Y\right\}
        \end{align}
      \item 
        If $S=F$ is a final object, then the equality $\xi \tau_X = \upsilon \tau_Y $ is automatic and we obtain $X\times_F Y = X\times Y$.
      \item 
        If $S$ is arbitrary and $X\lmorphism[\pi_X] X\times Y \morphism[\pi_Y] Y$ is a product of $X$ and $Y$ in ${\cat A}$ then 
        \begin{align*}
            \Eq\Big(X\times Y \doublemorphism[\xi\pi_X][\upsilon \pi_Y] S\Big) \cong X\times_S Y.
        \end{align*}
      \item \lbl{rem:commaCategory}
        Let the \emph{comma category} ${\cat A}\morphism S$ (or ${\cat A}/S$) be the category whose objects are pairs $(X,\xi)$ with $X\in\Ob({\cat A})$ an object and $X\morphism[\xi] S$ a morphism in ${\cat A}$, and where a morphism $(X,\xi) \morphism[f] (Y,\upsilon)$ is a morphism $X\morphism[f]Y$ in ${\cat A}$ such that we have $\upsilon f= \xi$, i.e., 
        \begin{diagram*}
            	\node[ob](x) at (0,1.25) {$X$};
            	\node[ob](s) at (1.25,0) {$S$};
            	\node[ob](y) at (2.5,1.25) {$Y$};
            	\scriptsize
            	\draw[->] (x) -- (s) node[pos=0.5,below left] {$\xi$};
            	\draw[->] (x) -- (y) node[pos=0.5,above] {$f$};
            	\draw[->] (y) -- (s) node[pos=0.5,below right] {$\upsilon$};
            \end{diagram*}      
        commutes. Then $X\times_S Y$ is the product of $(X,\xi)$ and $(Y,\upsilon)$ in ${\cat A}\morphism S$.
      \item 
        Fibre products with any (possibly cardinal) number of factors can be defined in the same way or as products in $A\morphism S$.
      \item \lbl{rem:baseChange}
        The smallest square in the diagram above illustrating the universal property of fibre products is called \emph{cartesian} if $P$ is a fibre product. If is also often useful to think of $p$ as morphism such that the \emph{fibre} $p^{-1}(x)$ is isomorphic to $\upsilon^{-1}(\xi(x))$. Then one prefers a terminology
        \begin{diagram*}
    	\node[ob](a) at (0,1.5) {$P$};
    	\node[ob](c) at (0,0) {$X$};
    	\node[ob](b) at (2,1.5) {$Y$};
    	\node[ob](d) at (2,0) {$S$};
    	\scriptsize
    	\draw[->] (a) -- (b) node[pos=0.5, above] {$\xi'$};
    	\draw[->] (a) -- (c) node[pos=0.5, left] {$\upsilon'$};
    	\draw[->] (c) -- (d) node[pos=0.5, above] {$\xi$};
    	\draw[->] (b) -- (d) node[pos=0.5, right] {$\upsilon$};
    \end{diagram*}        
        and calls $\upsilon'$ a \emph{base change} of $\upsilon$ with respect to $\xi$ and likewise $\xi'$ a base change of $\xi$ with respect to $\upsilon$.
      \item 
        In a number of easy cases (sets, (abelian) groups, (commutative) rings, topological spaces) fibre products may be constructed as 
        \begin{align*}
            X\times_S Y = \left\{(x,y)\in X\times Y\st  \xi(x) = \upsilon(y)\right\},
        \end{align*}
        equipped with component-wise operations $(x,y)\circ(\snake x, \snake y) = (x\circ \snake x, y\circ\snake y)$ and (possibly) the induced topology from $X\times Y$.
    \end{alphanumerate}
\end{rem}
\begin{defi}[Cofibre product] \lbl{def:cofibreProduct}
    A \defemph{dual fibre product} or \defemph{cofibre product} or also \defemph{push-out} of morphisms $X\lmorphism B\morphism Y$ in some category ${\cat A}$ is a commutative diagram 
    \begin{diagram*}
    	\node[ob](a) at (0,1.5) {$B$};
    	\node[ob](c) at (0,0) {$X$};
    	\node[ob](b) at (2,1.5) {$Y$};
    	\node[ob](d) at (2,0) {$P$};
    	\scriptsize
    	\draw[->] (a) -- (b) node[pos=0.5, above] {};
    	\draw[->] (a) -- (c) node[pos=0.5, left] {};
    	\draw[->] (c) -- (d) node[pos=0.5, above] {$j$};
    	\draw[->] (b) -- (d) node[pos=0.5, right] {$k$};
    \end{diagram*}
    enjoying the universal property for such diagrams, that is: 
    \begin{quote}
    	Whenever $T\in\Ob({\cat A})$ comes with morphisms $X\morphism T\lmorphism Y$ such that the left of the below diagrams commutes, there is a unique (dashed) morphism $P\morphism T$ in the right diagram making it commute.
    	
    	\begin{center}
    		\begin{minipage}{0.4\textwidth}
    			\centering		
    			\begin{diagram*}
    				\node[ob](B) at (0,1.5) {$B$};
    				\node[ob](X) at (0,0) {$X$};
    				\node[ob](Y) at (2,1.5) {$Y$};
    				\node[ob](T) at (3.25, -1.25) {$T$};
    				\scriptsize
    				\draw[->] (B) -- (X);
    				\draw[->] (B) -- (Y);
    				\draw[->, bend right] (X) to (T); 
    				\draw[->, bend left] (Y) to (T); 
    			\end{diagram*}
    		\end{minipage}
    		\begin{minipage}{0.4\textwidth}
    			\centering	
    			\begin{diagram*}
    				\node[ob](B) at (0,1.5) {$B$};
    				\node[ob](X) at (0,0) {$X$};
    				\node[ob](Y) at (2,1.5) {$Y$};
    				\node[ob](P) at (2,0) {$P$};
    				\node[ob](T) at (3.25, -1.25) {$T$};
    				\scriptsize
    				\draw[->] (B) -- (X);
    				\draw[->] (B) -- (Y);
    				\draw[->] (X) -- (P) node[pos=0.5, above] {$j$};
    				\draw[->] (Y) -- (P) node[pos=0.5, right] {$k$};
    				\draw[->, bend right] (X) to (T); 
    				\draw[->, bend left] (Y) to (T); 
    				\draw[->, dashed] (P) -- (T) node[pos=0.5, above right] {$\exists!$};
    			\end{diagram*}
    		\end{minipage}
    	\end{center}
    	In colimited language, $P$ is the \emph{colimit} below the diagram $X\lmorphism B\morphism Y$.
    \end{quote}
\end{defi}
\begin{example}
    Let $R$ be a ring, $A$ and $B$ be $R$-algebras. Then their tensor product $A\otimes_R B$ over $R$ has a unique ring structure such that $(a\otimes b)\cdot(\alpha\otimes \beta) = (a\cdot \alpha)\otimes(b \cdot \beta)$. Then $A\morphism A\otimes_R \lmorphism B$ sending $a\in A$ to $a\otimes 1$ and $b\in B$ to $1\otimes b$ are ring morphisms such that
    \begin{diagram*}
    	\node[ob](a) at (0,1.5) {$R$};
    	\node[ob](c) at (0,0) {$A$};
    	\node[ob](b) at (2.5,1.5) {$B$};
    	\node[ob](d) at (2.5,0) {$A\otimes_R B$};
    	\scriptsize
    	\draw[->] (a) -- (b);
    	\draw[->] (a) -- (c);
    	\draw[->] (c) -- (d) node[pos=0.5, above] {$a\mapsto a\otimes 1$};
    	\draw[->] (b) -- (d) node[pos=0.5, right] {$b\mapsto1\otimes b$};
    \end{diagram*}
    is \emph{cocartesian} in the category of rings, i.e., a cofibre product of $A$ and $B$ over $R$.
\end{example}

%I don't like this. This section is a joke. Let's rather refer to Algebra I in the first place.
%\section{Usefull stuff from Algebra I}

%\begin{lem}[Eakin-Nagata]\lbl{lem:eakinNagata}
%    Let $A\subseteq B$ be a subring of a noetherian ring $B$ such that $B$ is a finitely generated $A$-module. Then $A$ is also noetherian.
%\end{lem}
%\begin{lem}[Artin--Tate]\lbl{lem:artinTate}
%    Let $R$ be a noetherian ring, $B$ an $R$-algebra of finite type and $A\subseteq B$ an $R$-subalgebra such that $B$ is finitely generated as an $A$-module. Then $A$ is of finite type over $R$.
%\end{lem}


\printbibliography

\end{document}          
